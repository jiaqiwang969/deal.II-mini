<!-- HTML header for doxygen 1.8.13-->
<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml">
<head>
<link rel="canonical" href="https://www.dealii.org/current/doxygen/deal.II/step_45.html" />
<meta http-equiv="Content-Type" content="text/xhtml;charset=UTF-8"/>
<meta http-equiv="X-UA-Compatible" content="IE=9"/>
<meta name="generator" content="Doxygen 1.8.13"/>
<meta name="viewport" content="width=device-width, initial-scale=1"/>
<title>The deal.II Library: The step-45 tutorial program</title>
<link href="tabs.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="jquery.js"></script>
<script type="text/javascript" src="dynsections.js"></script>
<link href="search/search.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="search/searchdata.js"></script>
<script type="text/javascript" src="search/search.js"></script>
<script type="text/x-mathjax-config">
  MathJax.Hub.Config({
    extensions: ["tex2jax.js", "TeX/AMSmath.js", "TeX/AMSsymbols.js"],
    jax: ["input/TeX","output/HTML-CSS"],
});
</script><script type="text/javascript" src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.0/MathJax.js"></script>
<link href="doxygen.css" rel="stylesheet" type="text/css" />
<link href="stylesheet.css" rel="stylesheet" type="text/css"/>
<link rel="SHORTCUT ICON" href="deal.ico"></link>
<script type="text/javascript" src="custom.js"></script>
<meta name="author" content="The deal.II Authors <authors@dealii.org>"></meta>
<meta name="copyright" content="Copyright (C) 1998 - 2021 by the deal.II authors"></meta>
<meta name="deal.II-version" content="10.0.0-pre"></meta>
</head>
<body>
<div id="top"><!-- do not remove this div, it is closed by doxygen! -->
<div id="titlearea">
<table cellspacing="0" cellpadding="0">
 <tbody>
 <tr style="height: 56px;">
  <td id="projectlogo"><img alt="Logo" src="logo200.png"/></td>
  <td id="projectalign" style="padding-left: 0.5em;">
   <div id="projectname">
   &#160;<span id="projectnumber">Reference documentation for deal.II version 10.0.0-pre</span>
   </div>
  </td>
 </tr>
 </tbody>
</table>
</div>
<!--Extra macros for MathJax:-->
<div style="display:none">
\(\newcommand{\dealvcentcolon}{\mathrel{\mathop{:}}}\)
\(\newcommand{\dealcoloneq}{\dealvcentcolon\mathrel{\mkern-1.2mu}=}\)
\(\newcommand{\jump}[1]{\left[\!\left[ #1 \right]\!\right]}\)
\(\newcommand{\average}[1]{\left\{\!\left\{ #1 \right\}\!\right\}}\)
</div>
<!-- end header part -->
<!-- Generated by Doxygen 1.8.13 -->
<script type="text/javascript">
var searchBox = new SearchBox("searchBox", "search",false,'Search');
</script>
<script type="text/javascript" src="menudata.js"></script>
<script type="text/javascript" src="menu.js"></script>
<script type="text/javascript">
$(function() {
  initMenu('',true,false,'search.php','Search');
  $(document).ready(function() { init_search(); });
});
</script>
<div id="main-nav"></div>
<!-- window showing the filter options -->
<div id="MSearchSelectWindow"
     onmouseover="return searchBox.OnSearchSelectShow()"
     onmouseout="return searchBox.OnSearchSelectHide()"
     onkeydown="return searchBox.OnSearchSelectKey(event)">
</div>

<!-- iframe showing the search results (closed by default) -->
<div id="MSearchResultsWindow">
<iframe src="javascript:void(0)" frameborder="0" 
        name="MSearchResults" id="MSearchResults">
</iframe>
</div>

</div><!-- top -->
<div class="header">
  <div class="headertitle">
<div class="title">The step-45 tutorial program </div>  </div>
</div><!--header-->
<div class="contents">
<div class="textblock"><p>This tutorial depends on <a class="el" href="step_6.html">step-6</a>.</p>
<p> 
<table class="tutorial" width="50%">
<tr><th colspan="2"><b><small>Table of contents</small></b></th></tr>
<tr><td width="50%" valign="top">
<ol>
  <li> <a href="#Intro" class=bold>Introduction</a>
    <ul>
    </ul>
  <li> <a href="#CommProg" class=bold>The commented program</a>
    <ul>
        <li><a href="#Settingupperiodicityconstraintsondistributedtriangulations">Setting up periodicity constraints on distributed triangulations</a>
      </ul>
</ol></td><td width="50%" valign="top"><ol>
  <li value="3"> <a href="#Results" class=bold>Results</a>
    <ul>
    </ul>
  <li> <a href="#PlainProg" class=bold>The plain program</a>
</ol> </td> </tr> </table>
 examples/step-45/doc/intro.dox</p>
<p><br />
</p>
<p>［<em>This program was contributed by Daniel Arndt and Matthias Maier.</em>］ ［<a class="anchor" id="Intro"></a>］</p>
<p><a class="anchor" id="Introduction"></a></p><h1>Introduction</h1>
<p>在这个例子中，我们介绍了如何在deal.II中使用周期性边界条件。周期性边界条件是代数约束，通常出现在一个大域的代表性区域的计算中，这些区域在一个或多个方向上重复。</p>
<p>一个例子是模拟光子晶体的电子结构，因为它们有一个类似格子的结构，因此，往往只需要在格子的一个盒子上进行实际计算。为了能够以这种方式进行，我们必须假设该模型可以周期性地扩展到其他盒子上；这要求解决方案具有周期性结构。</p>
<p><a class="anchor" id="Procedure"></a></p>
<p><a class="anchor" id="Procedure"></a></p><h1>Procedure</h1>
<p>deal.II提供了一些高水平的入口来施加周期性边界条件。应用周期性边界条件的一般方法包括三个步骤（也见 <a class="el" href="DEALGlossary.html#GlossPeriodicConstraints">关于周期性边界条件的词汇表条目</a>）。</p>
<ol type="1">
<li>创建一个网格</li>
<li>识别边界不同部分的那些面对，在这些面对上的解应该是对称的，使用 <a class="el" href="namespaceGridTools.html#a213a31f196cd53ccbcc809e567934442">GridTools::collect_periodic_faces()</a> 。</li>
<li>使用 <a class="el" href="classparallel_1_1distributed_1_1Triangulation.html#aa7b797070e5443a18f03a4a7f0267453">parallel::distributed::Triangulation::add_periodicity()</a> 将周期性信息添加到网格中。</li>
<li>使用 <a class="el" href="namespaceDoFTools.html#a929249499b1e5624728d212e90a8e037">DoFTools::make_periodicity_constraints()</a> 添加周期性约束。</li>
</ol>
<p>第二和第三步对于使用 <a class="el" href="classparallel_1_1distributed_1_1Triangulation.html">parallel::distributed::Triangulation</a> 类的平行网格是必要的，以确保位于域的对面但由周期性面连接的单元是鬼层的一部分，如果它们中的一个存储在本地处理器上。如果三角结构不是 <a class="el" href="classparallel_1_1distributed_1_1Triangulation.html">parallel::distributed::Triangulation</a>, 类，这些步骤就没有必要。</p>
<p>第一步包括收集匹配的周期性面，并将它们存储在 <code>std::vector</code> 的 <a class="el" href="structGridTools_1_1PeriodicFacePair.html">GridTools::PeriodicFacePair</a>. 中，这是通过函数 <a class="el" href="namespaceGridTools.html#a213a31f196cd53ccbcc809e567934442">GridTools::collect_periodic_faces()</a> 来完成的，例如可以这样调用。</p>
<div class="fragment"><div class="line"><a class="code" href="namespaceGridTools.html#a213a31f196cd53ccbcc809e567934442">GridTools::collect_periodic_faces</a>(dof_handler,</div><div class="line">                                  b_id1,</div><div class="line">                                  b_id2,</div><div class="line">                                  direction,</div><div class="line">                                  matched_pairs,</div><div class="line">                                  offset = &lt;<span class="keywordflow">default</span> value&gt;,</div><div class="line">                                  <a class="code" href="namespaceLAPACKSupport.html#a1a9009db0d9a77923a7031b549b9b638a5bc7c54a9c20485772672825c6a73003">matrix</a> = &lt;<span class="keywordflow">default</span> value&gt;,</div><div class="line">                                  first_vector_components = &lt;<span class="keywordflow">default</span> value&gt;);</div></div><!-- fragment --><p>这个调用在周期性边界上的容器dof_handler的所有面进行循环，其边界指标分别为 <code>b_id1</code> 和 <code>b_id2</code>, 。(你可以在创建粗略网格后手工分配这些边界指标，见 <a class="el" href="DEALGlossary.html#GlossBoundaryIndicator">边界指标</a>。另外，如果你指定了 "着色 "标志，你也可以让命名空间GridGenerator中的许多函数来做这件事；在这种情况下，这些函数会给边界的不同部分分配不同的边界指标，细节通常在这些函数的文档中详细说明）。)</p>
<p>具体来说，如果 \(\text{vertices}_{1/2}\) 是两个面 \(\text{face}_{1/2}\) 的顶点，那么上面的函数调用将匹配成对的面（和道夫），使得 \(\text{vertices}_2\) 和 \(matrix\cdot \text{vertices}_1+\text{offset}\) 之间的差异在除方向之外的每个分量中都消失，并将产生的对与相关数据存储在 <code>matched_pairs</code>. 中（关于匹配过程的详细信息，见 <a class="el" href="namespaceGridTools.html#ac2a1903382c6cff07b33d456a641f6d9">GridTools::orthogonal_equality()</a> ）。</p>
<p>例如，考虑彩色单位方块 \(\Omega=[0,1]^2\) ，其边界指标0在左边，1在右边，2在下面，3在上面的面。参见 <a class="el" href="namespaceGridGenerator.html#acea0cbcd68e52ce8113d1134b87de403">GridGenerator::hyper_cube()</a> 的文件，了解这个关于如何分配边界指标的惯例）。然后。</p>
<div class="fragment"><div class="line"><a class="code" href="namespaceGridTools.html#a213a31f196cd53ccbcc809e567934442">GridTools::collect_periodic_faces</a>(dof_handler,</div><div class="line">                                  <span class="comment">/*b_id1*/</span> 0,</div><div class="line">                                  <span class="comment">/*b_id2*/</span> 1,</div><div class="line">                                  <span class="comment">/*direction*/</span> 0,</div><div class="line">                                  matched_pairs);</div></div><!-- fragment --><p>将产生周期性约束，使 \(u(0,y)=u(1,y)\) 为所有 \(y\in[0,1]\) 。</p>
<p>如果我们转而考虑由 \((0,0)\) , \((1,1)\) , \((1,2)\) , \((0,1)\) 的凸壳给出的平行四边形，我们可以通过指定一个 <code>offset:</code> 来实现约束 \(u(0,y)=u(1,y+1)\) 。</p>
<div class="fragment"><div class="line"><a class="code" href="namespaceGridTools.html#a213a31f196cd53ccbcc809e567934442">GridTools::collect_periodic_faces</a>(dof_handler,</div><div class="line">                                  <span class="comment">/*b_id1*/</span> 0,</div><div class="line">                                  <span class="comment">/*b_id2*/</span> 1,</div><div class="line">                                  <span class="comment">/*direction*/</span> 0,</div><div class="line">                                  matched_pairs,</div><div class="line">                                  <a class="code" href="classTensor.html">Tensor&lt;1, 2&gt;</a>(0.,1.));</div></div><!-- fragment --><p>或</p>
<div class="fragment"><div class="line"><a class="code" href="namespaceGridTools.html#a213a31f196cd53ccbcc809e567934442">GridTools::collect_periodic_faces</a>(dof_handler,</div><div class="line">                                  <span class="comment">/*b_id1*/</span> 0,</div><div class="line">                                  <span class="comment">/*b_id2*/</span> 1,</div><div class="line">                                  <span class="comment">/*arbitrary direction*/</span> 0,</div><div class="line">                                  matched_pairs,</div><div class="line">                                  <a class="code" href="classTensor.html">Tensor&lt;1, 2&gt;</a>(1.,1.));</div></div><!-- fragment --><p>在这里，边界指标0和1的分配也是源于 <a class="el" href="namespaceGridGenerator.html#a324b8447f05b148e2f58bdbcf89f5325">GridGenerator::parallelogram()</a> 的文件。</p>
<p>由此产生的 <code>matched_pairs</code> 可以在 <a class="el" href="namespaceDoFTools.html#a929249499b1e5624728d212e90a8e037">DoFTools::make_periodicity_constraints</a> 中使用，用于为AffineConstraints对象填充周期性约束。</p>
<div class="fragment"><div class="line"><a class="code" href="namespaceDoFTools.html#a929249499b1e5624728d212e90a8e037">DoFTools::make_periodicity_constraints</a>(matched_pairs, constraints);</div></div><!-- fragment --><p>除了这个高水平的接口外，还有结合这两个步骤的 <a class="el" href="namespaceDoFTools.html#a929249499b1e5624728d212e90a8e037">DoFTools::make_periodicity_constraints</a> 的变体（见 DofTools::make_periodicity_constraints). 的变体）可用。</p>
<p>如果需要更多的灵活性，也有一个与 <a class="el" href="namespaceDoFTools.html#a929249499b1e5624728d212e90a8e037">DoFTools::make_periodicity_constraints</a> 的低级接口。该低级变体允许直接指定两个应被约束的面。</p>
<div class="fragment"><div class="line"><span class="keyword">using namespace </span><a class="code" href="namespaceDoFTools.html">DoFTools</a>;</div><div class="line"><a class="code" href="namespaceDoFTools.html#a929249499b1e5624728d212e90a8e037">make_periodicity_constraints</a>(face_1,</div><div class="line">                             face_2,</div><div class="line">                             affine_constraints,</div><div class="line">                             component_mask = &lt;<span class="keywordflow">default</span> value&gt;;</div><div class="line">                             face_orientation = &lt;<span class="keywordflow">default</span> value&gt;,</div><div class="line">                             face_flip = &lt;<span class="keywordflow">default</span> value&gt;,</div><div class="line">                             face_rotation = &lt;<span class="keywordflow">default</span> value&gt;,</div><div class="line">                             <a class="code" href="namespaceLAPACKSupport.html#a1a9009db0d9a77923a7031b549b9b638a5bc7c54a9c20485772672825c6a73003">matrix</a> = &lt;<span class="keywordflow">default</span> value&gt;);</div></div><!-- fragment --><p>在这里，我们需要使用 <code>face_orientation</code>, <code>face_flip</code> 和 <code>face_orientation</code>. 来指定两个面的方向。 要想了解更详细的描述，请看 <a class="el" href="namespaceDoFTools.html#a929249499b1e5624728d212e90a8e037">DoFTools::make_periodicity_constraints</a>. 的文档。除了自我解释的 <code>component_mask</code> 和 <code>affine_constraints</code>. 之外，其余的参数与高级接口相同。</p>
<p><a class="anchor" id="problem"></a></p>
<p><a class="anchor" id="Apracticalexample"></a></p><h1>A practical example</h1>
<p>在下文中，我们将展示如何在一个更复杂的例子中使用上述函数。任务是对斯托克斯流的速度分量实施旋转的周期性约束。</p>
<p>在由 \(\Omega=\{{\bf x}\in(0,1)^2:\|{\bf x}\|\in (0.5,1)\}\) 定义的四分之一圆上，我们要解决斯托克斯问题</p>
<p class="formulaDsp">
\begin{eqnarray*} -\Delta \; \textbf{u} + \nabla p &amp;=&amp; (\exp(-100\|{\bf x}-(.75,0.1)^T\|^2),0)^T, \\ -\textrm{div}\; \textbf{u}&amp;=&amp;0,\\ \textbf{u}|_{\Gamma_1}&amp;=&amp;{\bf 0}, \end{eqnarray*}
</p>
<p>其中边界 \(\Gamma_1\) 被定义为 \(\Gamma_1 \dealcoloneq \{x\in \partial\Omega: \|x\|\in\{0.5,1\}\}\) 。对于边界的其余部分，我们将使用周期性边界条件，即</p>
<p class="formulaDsp">
\begin{align*} u_x(0,\nu)&amp;=-u_y(\nu,0)&amp;\nu&amp;\in[0,1]\\ u_y(0,\nu)&amp;=u_x(\nu,0)&amp;\nu&amp;\in[0,1]. \end{align*}
</p>
<p>网格将由 <a class="el" href="namespaceGridGenerator.html#acd7c51b0e8032db65db9a5ff73ccca50">GridGenerator::quarter_hyper_shell()</a>, 生成，该文件还记录了如果其<code>colorize'参数设置为</code>true'，它是如何为其各种边界分配边界指标的。</p>
<p><a class="anchor" id="CommProg"></a> </p><h1>The commented program</h1>
<p>这个例子程序是对 <a class="el" href="step_22.html">step-22</a> 的轻微修改，使用Trilinos并行运行，以演示交易.II中周期性边界条件的使用。因此我们不讨论大部分的源代码，只对处理周期性约束的部分进行评论。其余的请看 <a class="el" href="step_22.html">step-22</a> 和底部的完整源代码。</p>
<p>为了实现周期性边界条件，只有两个函数需要修改。</p>
<ul>
<li><code>StokesProblem&lt;dim&gt;::setup_dofs()</code> : 用周期性约束来填充AffineConstraints对象</li>
<li><code>StokesProblem&lt;dim&gt;::create_mesh()</code> : 为分布式三角形提供周期性信息。</li>
</ul>
<p>程序的其余部分与 <a class="el" href="step_22.html">step-22</a> 相同，所以让我们跳过这一部分，只在下面显示这两个函数。完整的程序可以在下面的 "普通程序 "部分找到）。 </p>
</div></div><!-- contents -->
<!-- HTML footer for doxygen 1.8.13-->
<!-- start footer part -->
<hr class="footer"/><address class="footer"><small>
Generated by &#160;<a href="http://www.doxygen.org/index.html">
<img class="footer" src="doxygen.png" alt="doxygen"/>
</a> 1.8.13
</small></address>
</body>
</html>
