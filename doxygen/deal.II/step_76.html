<!-- HTML header for doxygen 1.8.13-->
<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml">
<head>
<link rel="canonical" href="https://www.dealii.org/current/doxygen/deal.II/step_76.html" />
<meta http-equiv="Content-Type" content="text/xhtml;charset=UTF-8"/>
<meta http-equiv="X-UA-Compatible" content="IE=9"/>
<meta name="generator" content="Doxygen 1.8.13"/>
<meta name="viewport" content="width=device-width, initial-scale=1"/>
<title>The deal.II Library: The step-76 tutorial program</title>
<link href="tabs.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="jquery.js"></script>
<script type="text/javascript" src="dynsections.js"></script>
<link href="search/search.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="search/searchdata.js"></script>
<script type="text/javascript" src="search/search.js"></script>
<script type="text/x-mathjax-config">
  MathJax.Hub.Config({
    extensions: ["tex2jax.js", "TeX/AMSmath.js", "TeX/AMSsymbols.js"],
    jax: ["input/TeX","output/HTML-CSS"],
});
</script><script type="text/javascript" src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.0/MathJax.js"></script>
<link href="doxygen.css" rel="stylesheet" type="text/css" />
<link href="stylesheet.css" rel="stylesheet" type="text/css"/>
<link rel="SHORTCUT ICON" href="deal.ico"></link>
<script type="text/javascript" src="custom.js"></script>
<meta name="author" content="The deal.II Authors <authors@dealii.org>"></meta>
<meta name="copyright" content="Copyright (C) 1998 - 2021 by the deal.II authors"></meta>
<meta name="deal.II-version" content="10.0.0-pre"></meta>
</head>
<body>
<div id="top"><!-- do not remove this div, it is closed by doxygen! -->
<div id="titlearea">
<table cellspacing="0" cellpadding="0">
 <tbody>
 <tr style="height: 56px;">
  <td id="projectlogo"><img alt="Logo" src="logo200.png"/></td>
  <td id="projectalign" style="padding-left: 0.5em;">
   <div id="projectname">
   &#160;<span id="projectnumber">Reference documentation for deal.II version 10.0.0-pre</span>
   </div>
  </td>
 </tr>
 </tbody>
</table>
</div>
<!--Extra macros for MathJax:-->
<div style="display:none">
\(\newcommand{\dealvcentcolon}{\mathrel{\mathop{:}}}\)
\(\newcommand{\dealcoloneq}{\dealvcentcolon\mathrel{\mkern-1.2mu}=}\)
\(\newcommand{\jump}[1]{\left[\!\left[ #1 \right]\!\right]}\)
\(\newcommand{\average}[1]{\left\{\!\left\{ #1 \right\}\!\right\}}\)
</div>
<!-- end header part -->
<!-- Generated by Doxygen 1.8.13 -->
<script type="text/javascript">
var searchBox = new SearchBox("searchBox", "search",false,'Search');
</script>
<script type="text/javascript" src="menudata.js"></script>
<script type="text/javascript" src="menu.js"></script>
<script type="text/javascript">
$(function() {
  initMenu('',true,false,'search.php','Search');
  $(document).ready(function() { init_search(); });
});
</script>
<div id="main-nav"></div>
<!-- window showing the filter options -->
<div id="MSearchSelectWindow"
     onmouseover="return searchBox.OnSearchSelectShow()"
     onmouseout="return searchBox.OnSearchSelectHide()"
     onkeydown="return searchBox.OnSearchSelectKey(event)">
</div>

<!-- iframe showing the search results (closed by default) -->
<div id="MSearchResultsWindow">
<iframe src="javascript:void(0)" frameborder="0" 
        name="MSearchResults" id="MSearchResults">
</iframe>
</div>

</div><!-- top -->
<div class="header">
  <div class="headertitle">
<div class="title">The step-76 tutorial program </div>  </div>
</div><!--header-->
<div class="contents">
<div class="textblock"><p>This tutorial depends on <a class="el" href="step_67.html">step-67</a>.</p>
<p> 
<table class="tutorial" width="50%">
<tr><th colspan="2"><b><small>Table of contents</small></b></th></tr>
<tr><td width="50%" valign="top">
<ol>
  <li> <a href="#Intro" class=bold>Introduction</a>
    <ul>
        <li><a href="#SharedmemoryandhybridparallelizationwithMPI30">Shared-memory and hybrid parallelization with MPI-3.0</a>
      <ul>
        <li><a href="#Motivation">Motivation</a>
        <li><a href="#BasicMPI30commands">Basic MPI-3.0 commands</a>
        <li><a href="#MPI30andLinearAlgebradistributedVector">MPI-3.0 and LinearAlgebra::distributed::Vector</a>
        <li><a href="#MPI30andMatrixFree">MPI-3.0 and MatrixFree</a>
      </ul>
        <li><a href="#Cellcentricloops">Cell-centric loops</a>
      <ul>
        <li><a href="#MotivationFCLvsCCL">Motivation: FCL vs. CCL</a>
        <li><a href="#CellcentricloopsandMatrixFree">Cell-centric loops and MatrixFree</a>
      </ul>
        <li><a href="#ProvidinglambdastoMatrixFreeloops">Providing lambdas to MatrixFree loops</a>
        <li><a href="#VectorizedArrayType">VectorizedArrayType</a>
    </ul>
  <li> <a href="#CommProg" class=bold>The commented program</a>
    <ul>
        <li><a href="#Parametersandutilityfunctions">Parameters and utility functions</a>
        <li><a href="#EuleroperatorusingacellcentricloopandMPI30sharedmemory">Euler operator using a cell-centric loop and MPI-3.0 shared memory</a>
      </ul>
</ol></td><td width="50%" valign="top"><ol>
  <li value="3"> <a href="#Results" class=bold>Results</a>
    <ul>
        <li><a href="#Possibilitiesforextensions">Possibilities for extensions</a>
      <ul>
        <li><a href="#ExtensiontothecompressibleNavierStokesequations">Extension to the compressible Navier-Stokes equations</a>
        <li><a href="#BlockGaussSeidellikepreconditioners">Block Gauss-Seidel-like preconditioners</a>
    </ul>
    </ul>
  <li> <a href="#PlainProg" class=bold>The plain program</a>
</ol> </td> </tr> </table>
 examples/step-76/doc/intro.dox</p>
<p><br />
</p>
<p><em> This program was contributed by Martin Kronbichler, Peter Munch, and David Schneider. Many of the features shown here have been added to deal.II during and for the development of the deal.II-based, efficient, matrix-free finite-element library for high-dimensional partial differential equations hyper.deal (see <a href="https://github.com/hyperdeal/hyperdeal">https://github.com/hyperdeal/hyperdeal</a>). For more details and for applications of the presented features in slightly different contexts (high-dimensional advection equation and Vlasov-Poisson equations) see the release paper <b>[munch2020hyperdeal]</b>.</em></p>
<p><em>This work was partly supported by the German Research Foundation (DFG) through the project "High-order discontinuous Galerkin for the exa-scale" (ExaDG) within the priority program "Software for Exascale Computing" (SPPEXA) and by the Bavarian government through the project "High-order matrix-free finite
element implementations with hybrid parallelization and improved data locality" within the KONWIHR program. </em></p>
<p><a class="anchor" id="Intro"></a></p>
<p><a class="anchor" id="Introduction"></a></p><h1>Introduction</h1>
<p>本教程程序求解流体力学的欧拉方程，使用显式时间积分器和无矩阵框架应用于空间的高阶非连续Galerkin离散化。这里使用的数值方法与<a class="el" href="step_67.html">step-67</a>中使用的相同，但是，我们利用不同的高级MatrixFree技术来达到更高的吞吐量。</p>
<p>本教程的两个主要特点是。</p>
<ul>
<li>使用MPI-3.0中的共享内存特性和</li>
<li>使用以单元为中心的循环，它只允许向全局向量写入一次，因此，是使用共享内存的理想选择。</li>
</ul>
<p>我们在本教程中讨论的其他主题是模板参数VectorizedArrayType的用法和好处（而不是简单地使用VectorizedArray&lt;Number&gt;），以及向MatrixFree循环传递lambdas的可能性。</p>
<p>关于数字的细节，我们参考步骤-67的文件。我们在这里只集中讨论关键的差异。</p>
<p><a class="anchor" id="SharedmemoryandhybridparallelizationwithMPI30"></a></p><h3>Shared-memory and hybrid parallelization with MPI-3.0</h3>
<p><a class="anchor" id="Motivation"></a></p><h4>Motivation</h4>
<p>存在许多基于线程的共享内存库，如TBB、OpenMP或TaskFlow。将这些库集成到现有的MPI程序中，就可以使用共享内存。然而，这些库对程序员来说有一定的开销，因为所有可并行的代码部分都必须根据所使用的库进行查找和转换，包括当一些第三方数值库，如迭代求解器包，只依赖MPI时的困难。</p>
<p>考虑到一个纯粹的MPI并行化的有限元应用，我们可以发现，使用共享内存的主要时间和内存优势来自于访问同一计算节点上的进程所拥有的解决方案矢量的部分，而不需要进行明确的复制和缓冲。因此，MPI-3.0提供了基于所谓窗口的共享内存功能，进程可以直接访问同一共享内存域中的邻居的数据。</p>
<p><a class="anchor" id="BasicMPI30commands"></a></p><h4>Basic MPI-3.0 commands</h4>
<p>有几个相关的MPI-3.0命令值得详细讨论。一个新的MPI通信器 <code>comm_sm</code> ，由通信器 <code>comm</code> 的进程组成，这些进程可以访问相同的共享内存，可以通过以下方式创建。</p>
<div class="fragment"><div class="line">MPI_Comm_split_type(comm, MPI_COMM_TYPE_SHARED, rank, MPI_INFO_NULL, &amp;comm_sm);</div></div><!-- fragment --><p>下面的代码片断显示了共享内存的简化分配例程，包括值类型 <code>T</code> 和大小 <code>local_size</code> ，以及如何查询属于同一共享内存域的进程的数据指针。</p>
<div class="fragment"><div class="line">MPI_Win          win;         <span class="comment">// window</span></div><div class="line">T *              data_this;   <span class="comment">// pointer to locally-owned data</span></div><div class="line">std::vector&lt;T *&gt; data_others; <span class="comment">// pointers to shared data</span></div><div class="line"></div><div class="line"></div><div class="line"><span class="comment">// configure shared memory</span></div><div class="line">MPI_Info info;</div><div class="line">MPI_Info_create(&amp;info);</div><div class="line">MPI_Info_set(info, <span class="stringliteral">&quot;alloc_shared_noncontig&quot;</span>, <span class="stringliteral">&quot;true&quot;</span>);</div><div class="line"></div><div class="line"></div><div class="line"><span class="comment">// allocate shared memory</span></div><div class="line">MPI_Win_allocate_shared(local_size * <span class="keyword">sizeof</span>(T), <span class="keyword">sizeof</span>(T), info, comm_sm, &amp;data_this, &amp;win);</div><div class="line"></div><div class="line"></div><div class="line"><span class="comment">// get pointers to the shared data owned by the processes in the same sm domain</span></div><div class="line">data_others.resize(size_sm);</div><div class="line"><span class="keywordtype">int</span> disp_unit = 0; <span class="comment">// displacement size - an output parameter we don&#39;t need right now</span></div><div class="line">MPI_Aint ssize = 0; <span class="comment">// window size - an output parameter we don&#39;t need right now</span></div><div class="line"><span class="keywordflow">for</span> (<span class="keywordtype">int</span> i = 0; i &lt; size_sm; ++i)</div><div class="line">  MPI_Win_shared_query(win, i, &amp;ssize, &amp;disp_unit, &amp;data_others[i]);</div><div class="line"></div><div class="line"></div><div class="line"><a class="code" href="group__Exceptions.html#ga70a0bb353656e704acf927945277bbc6">Assert</a>(data_this == data_others[rank_sm], <a class="code" href="group__Exceptions.html#gae9a45f517af1401c50811a11083f9114">ExcMessage</a>(<span class="stringliteral">&quot;Something went wrong!&quot;</span>));</div></div><!-- fragment --><p>一旦不再需要这些数据，窗口就必须被释放，这也释放了本地拥有的数据。</p>
<div class="fragment"><div class="line">MPI_Win_free(&amp;win);</div></div><!-- fragment --><p><a class="anchor" id="MPI30andLinearAlgebradistributedVector"></a></p><h4>MPI-3.0 and <a class="el" href="classLinearAlgebra_1_1distributed_1_1Vector.html">LinearAlgebra::distributed::Vector</a></h4>
<p>上一节提到的命令被整合到了 <a class="el" href="classLinearAlgebra_1_1distributed_1_1Vector.html">LinearAlgebra::distributed::Vector</a> 中，如果为reinit()函数提供了可选的（第二个）通信器，那么这些命令就被用来分配共享内存。</p>
<p>例如，可以用一个分区器（包含全局通信器）和一个子通信器（包含同一计算节点上的进程）来设置一个向量。</p>
<div class="fragment"><div class="line">vec.reinit(partitioner, comm_sm);</div></div><!-- fragment --><p>本地拥有的值和幽灵值可以像往常一样被处理。然而，现在用户也可以通过该函数读取共享内存邻居的值。</p>
<div class="fragment"><div class="line"><span class="keyword">const</span> std::vector&lt;ArrayView&lt;const Number&gt;&gt; &amp;</div><div class="line"><a class="code" href="classLinearAlgebra_1_1distributed_1_1Vector.html#ad16bd935d90fe664309c52be1615bd4b">LinearAlgebra::distributed::Vector::shared_vector_data</a>() <span class="keyword">const</span>;</div></div><!-- fragment --><p><a class="anchor" id="MPI30andMatrixFree"></a></p><h4>MPI-3.0 and <a class="el" href="classMatrixFree.html">MatrixFree</a></h4>
<p>虽然 <a class="el" href="classLinearAlgebra_1_1distributed_1_1Vector.html">LinearAlgebra::distributed::Vector</a> 提供了分配共享内存和以协调的方式访问相邻进程的共享内存值的选项，但它实际上并没有利用共享内存的使用本身的好处。</p>
<p>然而，MatrixFree的基础设施确实如此。</p>
<ul>
<li>一方面，在无矩阵循环 <a class="el" href="classMatrixFree.html#a0e9669e4a5cfaceac78f5e26c285c2ea">MatrixFree::loop()</a>, <a class="el" href="classMatrixFree.html#abc204ec41ead1b5060f47ef3a5a066d7">MatrixFree::cell_loop()</a>, 和 <a class="el" href="classMatrixFree.html#a60ebe2e71cfd7602ef9bc612d22385f8">MatrixFree::loop_cell_centric()</a>, 中，只有需要更新的幽灵值 <em> 被 </em> 更新。来自共享内存邻居的幽灵值可以被直接访问，这使得缓冲，即把值复制到矢量的幽灵区域可能是多余的。 为了处理可能的竞赛条件，在MatrixFree中进行了必要的同步。在数值必须被缓冲的情况下，数值被直接从邻近的共享内存进程中复制，绕过了基于 <code>MPI_ISend</code> 和 <code>MPI_IRecv</code> 的更昂贵的MPI操作。</li>
<li>另一方面，像FEEvaluation和FEFaceEvaluation这样的类可以直接从共享内存中读取，所以在某些情况下确实不需要缓冲值。</li>
</ul>
<p>为了能够使用MatrixFree的共享内存功能，MatrixFree必须通过提供用户创建的子通信器进行适当的配置。</p>
<div class="fragment"><div class="line"><span class="keyword">typename</span> <a class="code" href="structMatrixFree_1_1AdditionalData.html">MatrixFree&lt;dim, Number&gt;::AdditionalData</a> additional_data;</div><div class="line"></div><div class="line"></div><div class="line"><span class="comment">// set flags as usual (not shown)</span></div><div class="line"></div><div class="line"></div><div class="line">additional_data.<a class="code" href="structMatrixFree_1_1AdditionalData.html#afdca3541da950e50d2e8dca2de4ceb90">communicator_sm</a> = comm_sm;</div><div class="line"></div><div class="line"></div><div class="line">data.reinit(mapping, dof_handler, constraint, quadrature, additional_data);</div></div><!-- fragment --><p><a class="anchor" id="Cellcentricloops"></a></p><h3>Cell-centric loops</h3>
<p><a class="anchor" id="MotivationFCLvsCCL"></a></p><h4>Motivation: FCL vs. CCL</h4>
<p>"以面为中心的循环"（简称FCL）在单独的循环中访问单元和面（内部和边界的）。因此，每个实体只被访问一次，单元之间的通量只被评估一次。如何在 <a class="el" href="classMatrixFree.html#a0e9669e4a5cfaceac78f5e26c285c2ea">MatrixFree::loop()</a> 的帮助下，通过提供三个函数（一个用于细胞积分，一个用于内部，一个用于边界面）来执行以面为中心的循环，已经在步骤59和步骤67中提出。</p>
<p>与此相反，"以单元为中心的循环"（在hyper.deal发布的论文中简称CCL或ECL（代表以元素为中心的循环），处理一个单元并直接连续处理其所有面（即访问所有面两次）。在文献 <b>[KronbichlerKormann2019]</b> 中，它们的好处对于现代CPU处理器架构来说已经很清楚了，尽管这种循环意味着通量必须被计算两次（对于内部面的每一面）。CCL有两个主要优点。</p>
<ul>
<li>一方面，在CCL的情况下，解向量中的条目正好被写回主内存一次，而在FCL的情况下，尽管高速缓存有效地调度了单元和面环，但由于高速缓存容量的错过，至少有一次。</li>
<li>另一方面，由于解向量的每个条目只被访问一次，在CCL的情况下，访问解向量时不需要线程间的同步。在写入目标向量的过程中不存在竞赛条件，这使得CCL特别适用于共享内存并行化。</li>
</ul>
<p>我们还应该注意到，尽管在CCL的情况下通量被计算了两次，但这并不自动转化为计算量的翻倍，因为已经内插到单元正交点的值可以用简单的一维内插法内插到一个面上。</p>
<p><a class="anchor" id="CellcentricloopsandMatrixFree"></a></p><h4>Cell-centric loops and <a class="el" href="classMatrixFree.html">MatrixFree</a></h4>
<p>对于以单元为中心的循环实现，可以使用函数 <a class="el" href="classMatrixFree.html#a60ebe2e71cfd7602ef9bc612d22385f8">MatrixFree::loop_cell_centric()</a> ，用户可以向其传递一个应该在每个单元上执行的函数。</p>
<p>为了得出一个适当的函数，可以在 <a class="el" href="classMatrixFree.html#a60ebe2e71cfd7602ef9bc612d22385f8">MatrixFree::loop_cell_centric()</a>, 中传递，原则上可以转换/合并以下三个函数，它们可以传递给 <a class="el" href="classMatrixFree.html#a0e9669e4a5cfaceac78f5e26c285c2ea">MatrixFree::loop()</a>: 。</p>
<div class="fragment"><div class="line">matrix_free.template loop&lt;VectorType, VectorType&gt;(</div><div class="line">  [&amp;](<span class="keyword">const</span> <span class="keyword">auto</span> &amp;data, <span class="keyword">auto</span> &amp;dst, <span class="keyword">const</span> <span class="keyword">auto</span> &amp;src, <span class="keyword">const</span> <span class="keyword">auto</span> range) {</div><div class="line">    <span class="comment">// operation performed on cells</span></div><div class="line"></div><div class="line"></div><div class="line">    <a class="code" href="classFEEvaluation.html">FEEvaluation&lt;dim, degree, degree + 1, 1, Number&gt;</a> phi(data);</div><div class="line">    <span class="keywordflow">for</span> (<span class="keywordtype">unsigned</span> <span class="keywordtype">int</span> cell = range.first; cell &lt; range.second; ++cell)</div><div class="line">      {</div><div class="line">        phi.reinit(cell);</div><div class="line">        phi.gather_evaluate(src, cell_evaluation_flags);</div><div class="line"></div><div class="line"></div><div class="line">        <span class="comment">// some operations on the cell quadrature points</span></div><div class="line"></div><div class="line"></div><div class="line">        phi.integrate_scatter(cell_evaluation_flags, dst);</div><div class="line">      }</div><div class="line">  },</div><div class="line">  [&amp;](<span class="keyword">const</span> <span class="keyword">auto</span> &amp;data, <span class="keyword">auto</span> &amp;dst, <span class="keyword">const</span> <span class="keyword">auto</span> &amp;src, <span class="keyword">const</span> <span class="keyword">auto</span> range) {</div><div class="line">    <span class="comment">// operation performed inner faces</span></div><div class="line"></div><div class="line"></div><div class="line">    <a class="code" href="classFEFaceEvaluation.html">FEFaceEvaluation&lt;dim, degree, degree + 1, 1, Number&gt;</a> phi_m(data, <span class="comment">/*is_interior_face=*/</span><span class="keyword">true</span>);</div><div class="line">    <a class="code" href="classFEFaceEvaluation.html">FEFaceEvaluation&lt;dim, degree, degree + 1, 1, Number&gt;</a> phi_p(data, <span class="comment">/*is_interior_face=*/</span><span class="keyword">false</span>);</div><div class="line"></div><div class="line"></div><div class="line">    <span class="keywordflow">for</span> (<span class="keywordtype">unsigned</span> <span class="keywordtype">int</span> face = range.first; face &lt; range.second; ++face)</div><div class="line">      {</div><div class="line">        phi_m.reinit(face);</div><div class="line">        phi_m.gather_evaluate(src, face_evaluation_flags);</div><div class="line">        phi_p.reinit(face);</div><div class="line">        phi_p.gather_evaluate(src, face_evaluation_flags);</div><div class="line"></div><div class="line"></div><div class="line">        <span class="comment">// some operations on the face quadrature points</span></div><div class="line"></div><div class="line"></div><div class="line">        phi_m.integrate_scatter(face_evaluation_flags, dst);</div><div class="line">        phi_p.integrate_scatter(face_evaluation_flags, dst);</div><div class="line">      }</div><div class="line">  },</div><div class="line">  [&amp;](<span class="keyword">const</span> <span class="keyword">auto</span> &amp;data, <span class="keyword">auto</span> &amp;dst, <span class="keyword">const</span> <span class="keyword">auto</span> &amp;src, <span class="keyword">const</span> <span class="keyword">auto</span> range) {</div><div class="line">    <span class="comment">// operation performed boundary faces</span></div><div class="line"></div><div class="line"></div><div class="line">    <a class="code" href="classFEFaceEvaluation.html">FEFaceEvaluation&lt;dim, degree, degree + 1, 1, Number&gt;</a> phi_m(data, <span class="comment">/*is_interior_face=*/</span><span class="keyword">true</span>);</div><div class="line"></div><div class="line"></div><div class="line">    <span class="keywordflow">for</span> (<span class="keywordtype">unsigned</span> <span class="keywordtype">int</span> face = range.first; face &lt; range.second; ++face)</div><div class="line">      {</div><div class="line">        phi_m.reinit(face);</div><div class="line">        phi_m.gather_evaluate(src, face_evaluation_flags);</div><div class="line"></div><div class="line"></div><div class="line">        <span class="comment">// some operations on the face quadrature points</span></div><div class="line"></div><div class="line"></div><div class="line">        phi_m.integrate_scatter(face_evaluation_flags, dst);</div><div class="line">      }</div><div class="line">  },</div><div class="line">  dst,</div><div class="line">  src);</div></div><!-- fragment --><p>以下列方式进行。</p>
<div class="fragment"><div class="line">matrix_free.template loop_cell_centric&lt;VectorType, VectorType&gt;(</div><div class="line">  [&amp;](<span class="keyword">const</span> <span class="keyword">auto</span> &amp;data, <span class="keyword">auto</span> &amp;dst, <span class="keyword">const</span> <span class="keyword">auto</span> &amp;src, <span class="keyword">const</span> <span class="keyword">auto</span> range) {</div><div class="line">    <a class="code" href="classFEEvaluation.html">FEEvaluation&lt;dim, degree, degree + 1, 1, Number&gt;</a>     phi(data);</div><div class="line">    <a class="code" href="classFEFaceEvaluation.html">FEFaceEvaluation&lt;dim, degree, degree + 1, 1, Number&gt;</a> phi_m(data, <span class="comment">/*is_interior_face=*/</span><span class="keyword">true</span>);</div><div class="line">    <a class="code" href="classFEFaceEvaluation.html">FEFaceEvaluation&lt;dim, degree, degree + 1, 1, Number&gt;</a> phi_p(data, <span class="comment">/*is_interior_face=*/</span><span class="keyword">false</span>);</div><div class="line"></div><div class="line"></div><div class="line">    <span class="keywordflow">for</span> (<span class="keywordtype">unsigned</span> <span class="keywordtype">int</span> cell = range.first; cell &lt; range.second; ++cell)</div><div class="line">      {</div><div class="line">        phi.reinit(cell);</div><div class="line">        phi.gather_evaluate(src, cell_evaluation_flags);</div><div class="line"></div><div class="line"></div><div class="line">        <span class="comment">// some operations on the cell quadrature points</span></div><div class="line"></div><div class="line"></div><div class="line">        phi.integrate_scatter(cell_evaluation_flags, dst);</div><div class="line"></div><div class="line"></div><div class="line">        <span class="comment">// loop over all faces of cell</span></div><div class="line">        <span class="keywordflow">for</span> (<span class="keywordtype">unsigned</span> <span class="keywordtype">int</span> face = 0; face &lt; GeometryInfo&lt;dim&gt;::faces_per_cell; ++face)</div><div class="line">          {</div><div class="line">            <span class="keywordflow">if</span> (data.get_faces_by_cells_boundary_id(cell, face)[0] ==</div><div class="line">                <a class="code" href="namespacenumbers.html#a4e5d3fa25689151c833ba46dcc96fa5b">numbers::internal_face_boundary_id</a>)</div><div class="line">              {</div><div class="line">                <span class="comment">// internal face</span></div><div class="line">                phi_m.reinit(cell, face);</div><div class="line">                phi_m.gather_evaluate(src, face_evaluation_flags);</div><div class="line">                phi_p.reinit(cell, face);</div><div class="line">                phi_p.gather_evaluate(src, face_evaluation_flags);</div><div class="line"></div><div class="line"></div><div class="line">                <span class="comment">// some operations on the face quadrature points</span></div><div class="line"></div><div class="line"></div><div class="line">                phi_m.integrate_scatter(face_evaluation_flags, dst);</div><div class="line">              }</div><div class="line">            <span class="keywordflow">else</span></div><div class="line">              {</div><div class="line">                <span class="comment">// boundary face</span></div><div class="line">                phi_m.reinit(cell, face);</div><div class="line">                phi_m.gather_evaluate(src, face_evaluation_flags);</div><div class="line"></div><div class="line"></div><div class="line">                <span class="comment">// some operations on the face quadrature points</span></div><div class="line"></div><div class="line"></div><div class="line">                phi_m.integrate_scatter(face_evaluation_flags, dst);</div><div class="line">              }</div><div class="line">          }</div><div class="line">      }</div><div class="line">  },</div><div class="line">  dst,</div><div class="line">  src);</div></div><!-- fragment --><p>应该注意的是，FEFaceEvaluation现在是用两个数字初始化的，即单元号和本地面孔号。给出的例子只是强调了如何将以面为中心的循环转化为以单元为中心的循环，而且绝非高效，因为数据要从全局向量中多次读写，而且计算也是重复进行的。下面，我们将讨论针对这些问题的高级技术。</p>
<p>为了能够使用 <a class="el" href="classMatrixFree.html#a60ebe2e71cfd7602ef9bc612d22385f8">MatrixFree::loop_cell_centric()</a>, ，必须启用 <a class="el" href="structMatrixFree_1_1AdditionalData.html">MatrixFree::AdditionalData</a> 的下列标志。</p>
<div class="fragment"><div class="line"><span class="keyword">typename</span> <a class="code" href="structMatrixFree_1_1AdditionalData.html">MatrixFree&lt;dim, Number&gt;::AdditionalData</a> additional_data;</div><div class="line"></div><div class="line"></div><div class="line"><span class="comment">// set flags as usual (not shown)</span></div><div class="line"></div><div class="line"></div><div class="line">additional_data.<a class="code" href="structMatrixFree_1_1AdditionalData.html#a1b94beb12bfea048e9fbbdf52c36ecb4">hold_all_faces_to_owned_cells</a>       = <span class="keyword">true</span>;</div><div class="line">additional_data.<a class="code" href="structMatrixFree_1_1AdditionalData.html#aae675b9c61c8b1515f297d41595740d7">mapping_update_flags_faces_by_cells</a> =</div><div class="line">  additional_data.<a class="code" href="structMatrixFree_1_1AdditionalData.html#a5c25759917955940e0b2b74a6704012c">mapping_update_flags_inner_faces</a> |</div><div class="line">  additional_data.<a class="code" href="structMatrixFree_1_1AdditionalData.html#aa326b1a098e1c037334cc05bdc2decc6">mapping_update_flags_boundary_faces</a>;</div><div class="line"></div><div class="line"></div><div class="line">data.reinit(mapping, dof_handler, constraint, quadrature, additional_data);</div></div><!-- fragment --><p>特别是，这些标志使内部数据结构能够为所有单元格的面设置。</p>
<p>目前，deal.II中以单元为中心的循环只适用于均匀细化的网格，并且不应用任何约束条件（这是通常使用的DG的标准情况）。</p>
<p><a class="anchor" id="ProvidinglambdastoMatrixFreeloops"></a></p><h3>Providing lambdas to <a class="el" href="classMatrixFree.html">MatrixFree</a> loops</h3>
<p>上面给出的例子已经使用了lambdas，它已经被提供给无矩阵循环。下面的简短例子介绍了如何在使用类和指向其方法之一的指针的版本和利用lambdas的变体之间转换函数。</p>
<p>在下面的代码中，一个类和它的一个方法的指针被传递给了 <a class="el" href="classMatrixFree.html#a0e9669e4a5cfaceac78f5e26c285c2ea">MatrixFree::loop()</a>: ，这个方法应该被解释为单元格积分。</p>
<div class="fragment"><div class="line"><span class="keywordtype">void</span></div><div class="line">local_apply_cell(<span class="keyword">const</span> <a class="code" href="classMatrixFree.html">MatrixFree&lt;dim, Number&gt;</a> &amp;              data,</div><div class="line">                 VectorType &amp;                                 dst,</div><div class="line">                 <span class="keyword">const</span> VectorType &amp;                           src,</div><div class="line">                 <span class="keyword">const</span> std::pair&lt;unsigned int, unsigned int&gt; &amp;range)<span class="keyword"> const</span></div><div class="line"><span class="keyword"></span>{</div><div class="line">  <a class="code" href="classFEEvaluation.html">FEEvaluation&lt;dim, degree, degree + 1, 1, Number&gt;</a> phi(data);</div><div class="line">  <span class="keywordflow">for</span> (<span class="keywordtype">unsigned</span> <span class="keywordtype">int</span> cell = range.first; cell &lt; range.second; ++cell)</div><div class="line">    {</div><div class="line">      phi.reinit(cell);</div><div class="line">      phi.gather_evaluate(src, cell_evaluation_flags);</div><div class="line"></div><div class="line"></div><div class="line">      <span class="comment">// some operations on the quadrature points</span></div><div class="line"></div><div class="line"></div><div class="line">      phi.integrate_scatter(cell_evaluation_flags, dst);</div><div class="line">    }</div><div class="line">}</div></div><!-- fragment --><div class="fragment"><div class="line">matrix_free.<a class="code" href="classMatrixFree.html#abc204ec41ead1b5060f47ef3a5a066d7">cell_loop</a>(&amp;Operator::local_apply_cell, <span class="keyword">this</span>, dst, src);</div></div><!-- fragment --><p>然而，也可以通过lambda函数传递匿名函数，结果是一样的。</p>
<div class="fragment"><div class="line">matrix_free.template cell_loop&lt;VectorType, VectorType&gt;(</div><div class="line">  [&amp;](<span class="keyword">const</span> <span class="keyword">auto</span> &amp;data, <span class="keyword">auto</span> &amp;dst, <span class="keyword">const</span> <span class="keyword">auto</span> &amp;src, <span class="keyword">const</span> <span class="keyword">auto</span> range) {</div><div class="line">    <a class="code" href="classFEEvaluation.html">FEEvaluation&lt;dim, degree, degree + 1, 1, Number&gt;</a> phi(data);</div><div class="line">    <span class="keywordflow">for</span> (<span class="keywordtype">unsigned</span> <span class="keywordtype">int</span> cell = range.first; cell &lt; range.second; ++cell)</div><div class="line">      {</div><div class="line">        phi.reinit(cell);</div><div class="line">        phi.gather_evaluate(src, cell_evaluation_flags);</div><div class="line"></div><div class="line"></div><div class="line">        <span class="comment">// some operations on the quadrature points</span></div><div class="line"></div><div class="line"></div><div class="line">        phi.integrate_scatter(cell_evaluation_flags, dst);</div><div class="line">      }</div><div class="line">  },</div><div class="line">  dst,</div><div class="line">  src);</div></div><!-- fragment --><p><a class="anchor" id="VectorizedArrayType"></a></p><h3>VectorizedArrayType</h3>
<p><a class="el" href="classVectorizedArray.html">VectorizedArray&lt;Number&gt;</a>类是实现deal.II中无矩阵算法的高节点级性能的一个关键组件。它是一个围绕Number类型的 \(n\) 条目的短向量的包装类，并通过内在函数将算术操作映射到适当的单指令/多数据（SIMD）概念。向量的长度可以通过 <a class="el" href="classVectorizedArrayBase.html#acb35404acc1693aee6e990228924cc09">VectorizedArray::size()</a> 查询，其底层数字类型可以通过 <a class="el" href="classVectorizedArray.html#ad5e3061a2d2cf13c446354059e6fa8ef">VectorizedArray::value_type</a>. 查询。</p>
<p>在默认情况下（ <code><a class="el" href="classVectorizedArray.html">VectorizedArray&lt;Number&gt;</a></code> ），向量长度在库的编译时被设置为与给定的处理器架构所支持的最高值相匹配。然而，也可以指定第二个可选的模板参数，如 <code>VectorizedArray&lt;Number, size&gt;</code>, where <code>size</code> 明确控制特定指令集能力范围内的向量长度。下表列出了支持的向量长度的完整列表。</p>
<table align="center" class="doxtable">
<tr>
<th>double </th><th>float </th><th>ISA  </th></tr>
<tr>
<td><code>VectorizedArray&lt;double, 1&gt;</code> </td><td><code>VectorizedArray&lt;float, 1&gt;</code> </td><td>(auto-vectorization)  </td></tr>
<tr>
<td><code>VectorizedArray&lt;double, 2&gt;</code> </td><td><code>VectorizedArray&lt;float, 4&gt;</code> </td><td>SSE2/AltiVec  </td></tr>
<tr>
<td><code>VectorizedArray&lt;double, 4&gt;</code> </td><td><code>VectorizedArray&lt;float, 8&gt;</code> </td><td>AVX/AVX2  </td></tr>
<tr>
<td><code>VectorizedArray&lt;double, 8&gt;</code> </td><td><code>VectorizedArray&lt;float, 16&gt;</code> </td><td>AVX-512  </td></tr>
</table>
<p>这允许用户选择矢量长度/ISA，因此，在无矩阵算子评估中一次处理的单元数，可能会减少对缓存的压力，这对非常高的度数（和尺寸）来说是一个严重的问题。</p>
<p>减少填充通道数量的另一个可能的原因是为了简化调试：不用看例如8个单元，而是可以集中在一个单元上。</p>
<p>VectorizedArray的接口也能够被任何具有匹配接口的类型所替代。具体来说，这为deal.II准备了 <code>std::simd</code> 类，它计划成为C++23标准的一部分。下表比较了deal.II特定的SIMD类和相应的C++23类。</p>
<table align="center" class="doxtable">
<tr>
<th><a class="el" href="classVectorizedArray.html">VectorizedArray</a> (deal.II) </th><th>std::simd (C++23)  </th></tr>
<tr>
<td><code><a class="el" href="classVectorizedArray.html">VectorizedArray&lt;Number&gt;</a></code> </td><td><code>std::experimental::native_simd&lt;Number&gt;</code>  </td></tr>
<tr>
<td><code>VectorizedArray&lt;Number, size&gt;</code> </td><td><code>std::experimental::fixed_size_simd&lt;Number, size&gt;</code>  </td></tr>
</table>
<p><a class="anchor" id="CommProg"></a> </p><h1>The commented program</h1>
<p><a class="anchor" id="Parametersandutilityfunctions"></a> </p><h3>Parameters and utility functions</h3>
<p>包括与 <a class="el" href="step_67.html">step-67</a> 中相同的内容。</p>
<div class="fragment"><div class="line"><span class="preprocessor">#include &lt;<a class="code" href="conditional__ostream_8h.html">deal.II/base/conditional_ostream.h</a>&gt;</span> </div><div class="line"><span class="preprocessor">#include &lt;<a class="code" href="function_8h.html">deal.II/base/function.h</a>&gt;</span> </div><div class="line"><span class="preprocessor">#include &lt;<a class="code" href="logstream_8h.html">deal.II/base/logstream.h</a>&gt;</span> </div><div class="line"><span class="preprocessor">#include &lt;<a class="code" href="time__stepping_8h.html">deal.II/base/time_stepping.h</a>&gt;</span> </div><div class="line"><span class="preprocessor">#include &lt;<a class="code" href="timer_8h.html">deal.II/base/timer.h</a>&gt;</span> </div><div class="line"><span class="preprocessor">#include &lt;<a class="code" href="include_2deal_8II_2base_2utilities_8h.html">deal.II/base/utilities.h</a>&gt;</span> </div><div class="line"><span class="preprocessor">#include &lt;<a class="code" href="vectorization_8h.html">deal.II/base/vectorization.h</a>&gt;</span> </div><div class="line"></div><div class="line"><span class="preprocessor">#include &lt;<a class="code" href="distributed_2tria_8h.html">deal.II/distributed/tria.h</a>&gt;</span> </div><div class="line"></div><div class="line"><span class="preprocessor">#include &lt;<a class="code" href="dofs_2dof__handler_8h.html">deal.II/dofs/dof_handler.h</a>&gt;</span> </div><div class="line"></div><div class="line"><span class="preprocessor">#include &lt;<a class="code" href="fe__dgq_8h.html">deal.II/fe/fe_dgq.h</a>&gt;</span></div><div class="line"><span class="preprocessor">#include &lt;<a class="code" href="fe__system_8h.html">deal.II/fe/fe_system.h</a>&gt;</span> </div><div class="line"></div><div class="line"><span class="preprocessor">#include &lt;<a class="code" href="grid__generator_8h.html">deal.II/grid/grid_generator.h</a>&gt;</span> </div><div class="line"><span class="preprocessor">#include &lt;<a class="code" href="grid_2tria_8h.html">deal.II/grid/tria.h</a>&gt;</span> </div><div class="line"><span class="preprocessor">#include &lt;<a class="code" href="tria__accessor_8h.html">deal.II/grid/tria_accessor.h</a>&gt;</span> </div><div class="line"><span class="preprocessor">#include &lt;<a class="code" href="tria__iterator_8h.html">deal.II/grid/tria_iterator.h</a>&gt;</span> </div><div class="line"></div><div class="line"><span class="preprocessor">#include &lt;<a class="code" href="affine__constraints_8h.html">deal.II/lac/affine_constraints.h</a>&gt;</span> </div><div class="line"><span class="preprocessor">#include &lt;<a class="code" href="la__parallel__vector_8h.html">deal.II/lac/la_parallel_vector.h</a>&gt;</span> </div><div class="line"></div><div class="line"><span class="preprocessor">#include &lt;<a class="code" href="fe__evaluation_8h.html">deal.II/matrix_free/fe_evaluation.h</a>&gt;</span> </div><div class="line"><span class="preprocessor">#include &lt;<a class="code" href="matrix__free_8h.html">deal.II/matrix_free/matrix_free.h</a>&gt;</span> </div><div class="line"><span class="preprocessor">#include &lt;<a class="code" href="operators_8h.html">deal.II/matrix_free/operators.h</a>&gt;</span> </div><div class="line"></div><div class="line"><span class="preprocessor">#include &lt;<a class="code" href="numerics_2data__out_8h.html">deal.II/numerics/data_out.h</a>&gt;</span> </div><div class="line"></div><div class="line"><span class="preprocessor">#include &lt;fstream&gt;</span> </div><div class="line"><span class="preprocessor">#include &lt;iomanip&gt;</span> </div><div class="line"><span class="preprocessor">#include &lt;iostream&gt;</span> </div></div><!-- fragment --><p>一个新的包含，用于根据其边界ID对单元格进行分类。</p>
<div class="fragment"><div class="line"><span class="preprocessor">#include &lt;<a class="code" href="tools_8h.html">deal.II/matrix_free/tools.h</a>&gt;</span> </div><div class="line"></div><div class="line"><span class="keyword">namespace </span>Euler_DG </div><div class="line">{ </div><div class="line">  <span class="keyword">using namespace </span><a class="code" href="namespacedealii.html">dealii</a>; </div></div><!-- fragment --><p>与 <a class="el" href="step_67.html">step-67</a> 中的输入参数相同。</p>
<div class="fragment"><div class="line">constexpr <span class="keywordtype">unsigned</span> <span class="keywordtype">int</span> testcase             = 1; </div><div class="line">constexpr <span class="keywordtype">unsigned</span> <span class="keywordtype">int</span> dimension            = 2; </div><div class="line">constexpr <span class="keywordtype">unsigned</span> <span class="keywordtype">int</span> n_global_refinements = 2; </div><div class="line">constexpr <span class="keywordtype">unsigned</span> <span class="keywordtype">int</span> fe_degree            = 5; </div><div class="line">constexpr <span class="keywordtype">unsigned</span> <span class="keywordtype">int</span> n_q_points_1d        = fe_degree + 2; </div></div><!-- fragment --><p>这个参数指定共享内存组的大小。目前，只有1和 <a class="el" href="namespacenumbers.html#a8ae36952c7e0cc778b47b5371b3aeff1">numbers::invalid_unsigned_int</a> 的值是可能的，这导致了内存功能可以被关闭，或者所有访问同一共享内存域的进程被分组。</p>
<div class="fragment"><div class="line">constexpr <span class="keywordtype">unsigned</span> <span class="keywordtype">int</span> group_size = <a class="code" href="namespacenumbers.html#a8ae36952c7e0cc778b47b5371b3aeff1">numbers::invalid_unsigned_int</a>; </div><div class="line"></div><div class="line"><span class="keyword">using</span> Number = double; </div></div><!-- fragment --><p>这里，数据结构的类型被选择为矢量化。在默认情况下，使用VectorizedArray&lt;Number&gt;，也就是说，在给定的硬件上使用最高的指令集架构扩展，具有最大数量的向量通道。然而，人们可能会减少填充通道的数量，例如，通过编写 <code>using VectorizedArrayType = VectorizedArray&lt;Number, 4&gt;</code> ，只处理4个单元。</p>
<div class="fragment"><div class="line"><span class="keyword">using</span> VectorizedArrayType = <a class="code" href="classVectorizedArray.html">VectorizedArray&lt;Number&gt;</a>; </div></div><!-- fragment --><p>以下参数没有改变。</p>
<div class="fragment"><div class="line">constexpr <span class="keywordtype">double</span> gamma       = 1.4; </div><div class="line">constexpr <span class="keywordtype">double</span> final_time  = testcase == 0 ? 10 : 2.0; </div><div class="line">constexpr <span class="keywordtype">double</span> output_tick = testcase == 0 ? 1 : 0.05; </div><div class="line"></div><div class="line"><span class="keyword">const</span> <span class="keywordtype">double</span> courant_number = 0.15 / <a class="code" href="vectorization_8h.html#ae5c8b2cd70b2640bab8f1ee4ccb7f4cc">std::pow</a>(fe_degree, 1.5); </div></div><!-- fragment --><p>指定对性能研究有用的最大时间步骤数。</p>
<div class="fragment"><div class="line">constexpr <span class="keywordtype">unsigned</span> <span class="keywordtype">int</span> max_time_steps = <a class="code" href="namespacenumbers.html#a8ae36952c7e0cc778b47b5371b3aeff1">numbers::invalid_unsigned_int</a>; </div></div><!-- fragment --><p>与Runge-Kutta有关的函数从 <a class="el" href="step_67.html">step-67</a> 复制过来，并稍作修改，以尽量减少全局矢量访问。</p>
<div class="fragment"><div class="line"><span class="keyword">enum</span> LowStorageRungeKuttaScheme </div><div class="line">{ </div><div class="line">  stage_3_order_3, </div><div class="line">  stage_5_order_4, </div><div class="line">  stage_7_order_4, </div><div class="line">  stage_9_order_5, </div><div class="line">}; </div><div class="line">constexpr LowStorageRungeKuttaScheme lsrk_scheme = stage_5_order_4; </div><div class="line"></div><div class="line"><span class="keyword">class </span>LowStorageRungeKuttaIntegrator </div><div class="line">{ </div><div class="line"><span class="keyword">public</span>: </div><div class="line">  LowStorageRungeKuttaIntegrator(<span class="keyword">const</span> LowStorageRungeKuttaScheme scheme) </div><div class="line">  { </div><div class="line">    <a class="code" href="namespaceTimeStepping.html#abff97b5326e452552f108a379dd6cff4">TimeStepping::runge_kutta_method</a> lsrk; </div><div class="line">    <span class="keywordflow">switch</span> (scheme) </div><div class="line">      { </div><div class="line">        <span class="keywordflow">case</span> stage_3_order_3: </div><div class="line">          lsrk = <a class="code" href="namespaceTimeStepping.html#abff97b5326e452552f108a379dd6cff4aba5c997ffa7c63d0c0f6b046a53d63bf">TimeStepping::LOW_STORAGE_RK_STAGE3_ORDER3</a>; </div><div class="line">          <span class="keywordflow">break</span>; </div><div class="line">        <span class="keywordflow">case</span> stage_5_order_4: </div><div class="line">          lsrk = <a class="code" href="namespaceTimeStepping.html#abff97b5326e452552f108a379dd6cff4af4a68ccb74e043ac956cddf23fa57e48">TimeStepping::LOW_STORAGE_RK_STAGE5_ORDER4</a>; </div><div class="line">          <span class="keywordflow">break</span>; </div><div class="line">        <span class="keywordflow">case</span> stage_7_order_4: </div><div class="line">          lsrk = <a class="code" href="namespaceTimeStepping.html#abff97b5326e452552f108a379dd6cff4af34241e1b27c2f0f2f90715ee9f97bdb">TimeStepping::LOW_STORAGE_RK_STAGE7_ORDER4</a>; </div><div class="line">          <span class="keywordflow">break</span>; </div><div class="line">        <span class="keywordflow">case</span> stage_9_order_5: </div><div class="line">          lsrk = <a class="code" href="namespaceTimeStepping.html#abff97b5326e452552f108a379dd6cff4a6a1cbeb6dd2a5ed5ac2e3efe3293e941">TimeStepping::LOW_STORAGE_RK_STAGE9_ORDER5</a>; </div><div class="line">          <span class="keywordflow">break</span>; </div><div class="line"></div><div class="line">        <span class="keywordflow">default</span>: </div><div class="line">          <a class="code" href="group__Exceptions.html#gafc0ca7ad85b3ebd64e8e51689ac85caf">AssertThrow</a>(<span class="keyword">false</span>, <a class="code" href="group__Exceptions.html#ga7b52b286796c23ef9ff178faf7a4b68f">ExcNotImplemented</a>()); </div><div class="line">      } </div><div class="line">    <a class="code" href="classTimeStepping_1_1LowStorageRungeKutta.html">TimeStepping::LowStorageRungeKutta</a>&lt; </div><div class="line">      <a class="code" href="classLinearAlgebra_1_1distributed_1_1Vector.html">LinearAlgebra::distributed::Vector&lt;Number&gt;</a>&gt; </div><div class="line">                        rk_integrator(lsrk); </div><div class="line">    std::vector&lt;double&gt; ci; <span class="comment">// not used </span></div><div class="line">    rk_integrator.get_coefficients(ai, bi, ci); </div><div class="line">  } </div><div class="line"></div><div class="line">  <span class="keywordtype">unsigned</span> <span class="keywordtype">int</span> n_stages()<span class="keyword"> const </span></div><div class="line"><span class="keyword">  </span>{ </div><div class="line">    <span class="keywordflow">return</span> bi.size(); </div><div class="line">  } </div><div class="line"></div><div class="line">  <span class="keyword">template</span> &lt;<span class="keyword">typename</span> VectorType, <span class="keyword">typename</span> Operator&gt; </div><div class="line">  <span class="keywordtype">void</span> perform_time_step(<span class="keyword">const</span> Operator &amp;pde_operator, </div><div class="line">                         <span class="keyword">const</span> <span class="keywordtype">double</span>    current_time, </div><div class="line">                         <span class="keyword">const</span> <span class="keywordtype">double</span>    time_step, </div><div class="line">                         VectorType &amp;    solution, </div><div class="line">                         VectorType &amp;    vec_ri, </div><div class="line">                         VectorType &amp;    vec_ki)<span class="keyword"> const </span></div><div class="line"><span class="keyword">  </span>{ </div><div class="line">    <a class="code" href="group__Exceptions.html#ga9442b63275c9ef3fab29bc222831c49c">AssertDimension</a>(ai.size() + 1, bi.size()); </div><div class="line"></div><div class="line">    vec_ki.swap(solution); </div><div class="line"></div><div class="line">    <span class="keywordtype">double</span> sum_previous_bi = 0; </div><div class="line">    <span class="keywordflow">for</span> (<span class="keywordtype">unsigned</span> <span class="keywordtype">int</span> stage = 0; stage &lt; bi.size(); ++stage) </div><div class="line">      { </div><div class="line">        <span class="keyword">const</span> <span class="keywordtype">double</span> c_i = stage == 0 ? 0 : sum_previous_bi + ai[stage - 1]; </div><div class="line"></div><div class="line">        pde_operator.perform_stage(stage, </div><div class="line">                                   current_time + c_i * time_step, </div><div class="line">                                   bi[stage] * time_step, </div><div class="line">                                   (stage == bi.size() - 1 ? </div><div class="line">                                      0 : </div><div class="line">                                      ai[stage] * time_step), </div><div class="line">                                   (stage % 2 == 0 ? vec_ki : vec_ri), </div><div class="line">                                   (stage % 2 == 0 ? vec_ri : vec_ki), </div><div class="line">                                   solution); </div><div class="line"></div><div class="line">        <span class="keywordflow">if</span> (stage &gt; 0) </div><div class="line">          sum_previous_bi += bi[stage - 1]; </div><div class="line">      } </div><div class="line">  } </div><div class="line"></div><div class="line"><span class="keyword">private</span>: </div><div class="line">  std::vector&lt;double&gt; bi; </div><div class="line">  std::vector&lt;double&gt; ai; </div><div class="line">}; </div></div><!-- fragment --><p>来自 <a class="el" href="step_67.html">step-67</a> 的欧拉特定实用函数。</p>
<div class="fragment"><div class="line"><span class="keyword">enum</span> EulerNumericalFlux </div><div class="line">{ </div><div class="line">  lax_friedrichs_modified, </div><div class="line">  harten_lax_vanleer, </div><div class="line">}; </div><div class="line">constexpr EulerNumericalFlux numerical_flux_type = lax_friedrichs_modified; </div><div class="line"></div><div class="line"><span class="keyword">template</span> &lt;<span class="keywordtype">int</span> dim&gt; </div><div class="line"><span class="keyword">class </span>ExactSolution : <span class="keyword">public</span> <a class="code" href="classFunction.html">Function</a>&lt;dim&gt; </div><div class="line">{ </div><div class="line"><span class="keyword">public</span>: </div><div class="line">  ExactSolution(<span class="keyword">const</span> <span class="keywordtype">double</span> time) </div><div class="line">    : <a class="code" href="classFunction.html">Function</a>&lt;dim&gt;(dim + 2, time) </div><div class="line">  {} </div><div class="line"></div><div class="line">  <span class="keyword">virtual</span> <span class="keywordtype">double</span> <a class="code" href="classFunction.html#acbfcab66b2fc63bfea59268f40772bb4">value</a>(<span class="keyword">const</span> <a class="code" href="classPoint.html">Point&lt;dim&gt;</a> &amp; p, </div><div class="line">                       <span class="keyword">const</span> <span class="keywordtype">unsigned</span> <span class="keywordtype">int</span> component = 0) <span class="keyword">const override</span>; </div><div class="line">}; </div><div class="line"></div><div class="line"><span class="keyword">template</span> &lt;<span class="keywordtype">int</span> dim&gt; </div><div class="line"><span class="keywordtype">double</span> ExactSolution&lt;dim&gt;::value(<span class="keyword">const</span> <a class="code" href="classPoint.html">Point&lt;dim&gt;</a> &amp; x, </div><div class="line">                                 <span class="keyword">const</span> <span class="keywordtype">unsigned</span> <span class="keywordtype">int</span> component)<span class="keyword"> const </span></div><div class="line"><span class="keyword"></span>{ </div><div class="line">  <span class="keyword">const</span> <span class="keywordtype">double</span> t = this-&gt;<a class="code" href="classFunctionTime.html#ae7d37ddb04314b38cf67c6cba22923f6">get_time</a>(); </div><div class="line"></div><div class="line">  <span class="keywordflow">switch</span> (testcase) </div><div class="line">    { </div><div class="line">      <span class="keywordflow">case</span> 0: </div><div class="line">        { </div><div class="line">          <a class="code" href="group__Exceptions.html#ga70a0bb353656e704acf927945277bbc6">Assert</a>(dim == 2, <a class="code" href="group__Exceptions.html#ga7b52b286796c23ef9ff178faf7a4b68f">ExcNotImplemented</a>()); </div><div class="line">          <span class="keyword">const</span> <span class="keywordtype">double</span> beta = 5; </div><div class="line"></div><div class="line">          <a class="code" href="classPoint.html">Point&lt;dim&gt;</a> x0; </div><div class="line">          x0[0] = 5.; </div><div class="line">          <span class="keyword">const</span> <span class="keywordtype">double</span> radius_sqr = </div><div class="line">            (x - x0).norm_square() - 2. * (x[0] - x0[0]) * t + t * t; </div><div class="line">          <span class="keyword">const</span> <span class="keywordtype">double</span> factor = </div><div class="line">            beta / (numbers::PI * 2) * std::exp(1. - radius_sqr); </div><div class="line">          <span class="keyword">const</span> <span class="keywordtype">double</span> density_log = std::log2( </div><div class="line">            std::abs(1. - (gamma - 1.) / gamma * 0.25 * factor * factor)); </div><div class="line">          <span class="keyword">const</span> <span class="keywordtype">double</span> density = std::exp2(density_log * (1. / (gamma - 1.))); </div><div class="line">          <span class="keyword">const</span> <span class="keywordtype">double</span> u       = 1. - factor * (x[1] - x0[1]); </div><div class="line">          <span class="keyword">const</span> <span class="keywordtype">double</span> v       = factor * (x[0] - t - x0[0]); </div><div class="line"></div><div class="line">          <span class="keywordflow">if</span> (component == 0) </div><div class="line">            <span class="keywordflow">return</span> density; </div><div class="line">          <span class="keywordflow">else</span> <span class="keywordflow">if</span> (component == 1) </div><div class="line">            <span class="keywordflow">return</span> density * u; </div><div class="line">          <span class="keywordflow">else</span> <span class="keywordflow">if</span> (component == 2) </div><div class="line">            <span class="keywordflow">return</span> density * v; </div><div class="line">          <span class="keywordflow">else</span> </div><div class="line">            { </div><div class="line">              <span class="keyword">const</span> <span class="keywordtype">double</span> pressure = </div><div class="line">                std::exp2(density_log * (gamma / (gamma - 1.))); </div><div class="line">              <span class="keywordflow">return</span> pressure / (gamma - 1.) + </div><div class="line">                     0.5 * (density * u * u + density * v * v); </div><div class="line">            } </div><div class="line">        } </div><div class="line"></div><div class="line">      <span class="keywordflow">case</span> 1: </div><div class="line">        { </div><div class="line">          <span class="keywordflow">if</span> (component == 0) </div><div class="line">            <span class="keywordflow">return</span> 1.; </div><div class="line">          <span class="keywordflow">else</span> <span class="keywordflow">if</span> (component == 1) </div><div class="line">            <span class="keywordflow">return</span> 0.4; </div><div class="line">          <span class="keywordflow">else</span> <span class="keywordflow">if</span> (component == dim + 1) </div><div class="line">            <span class="keywordflow">return</span> 3.097857142857143; </div><div class="line">          <span class="keywordflow">else</span> </div><div class="line">            <span class="keywordflow">return</span> 0.; </div><div class="line">        } </div><div class="line"></div><div class="line">      <span class="keywordflow">default</span>: </div><div class="line">        <a class="code" href="group__Exceptions.html#ga70a0bb353656e704acf927945277bbc6">Assert</a>(<span class="keyword">false</span>, <a class="code" href="group__Exceptions.html#ga7b52b286796c23ef9ff178faf7a4b68f">ExcNotImplemented</a>()); </div><div class="line">        <span class="keywordflow">return</span> 0.; </div><div class="line">    } </div><div class="line">} </div><div class="line"></div><div class="line"><span class="keyword">template</span> &lt;<span class="keywordtype">int</span> dim, <span class="keyword">typename</span> Number&gt; </div><div class="line"><span class="keyword">inline</span> <a class="code" href="config_8h.html#a1d1d58e8be15e5c4285f6892e5f33136">DEAL_II_ALWAYS_INLINE</a> <span class="comment">// </span></div><div class="line">  <a class="code" href="classTensor.html">Tensor&lt;1, dim, Number&gt;</a> </div><div class="line">  euler_velocity(<span class="keyword">const</span> <a class="code" href="classTensor.html">Tensor&lt;1, dim + 2, Number&gt;</a> &amp;conserved_variables) </div><div class="line">{ </div><div class="line">  <span class="keyword">const</span> Number inverse_density = Number(1.) / conserved_variables[0]; </div><div class="line"></div><div class="line">  <a class="code" href="classTensor.html">Tensor&lt;1, dim, Number&gt;</a> velocity; </div><div class="line">  <span class="keywordflow">for</span> (<span class="keywordtype">unsigned</span> <span class="keywordtype">int</span> d = 0; d &lt; dim; ++<a class="code" href="namespacePhysics_1_1Elasticity_1_1Kinematics.html#a15728437b942dab0b0042eb06a407d2c">d</a>) </div><div class="line">    velocity[d] = conserved_variables[1 + d] * inverse_density; </div><div class="line"></div><div class="line">  <span class="keywordflow">return</span> velocity; </div><div class="line">} </div><div class="line"></div><div class="line"><span class="keyword">template</span> &lt;<span class="keywordtype">int</span> dim, <span class="keyword">typename</span> Number&gt; </div><div class="line"><span class="keyword">inline</span> <a class="code" href="config_8h.html#a1d1d58e8be15e5c4285f6892e5f33136">DEAL_II_ALWAYS_INLINE</a> <span class="comment">// </span></div><div class="line">  Number </div><div class="line">  euler_pressure(<span class="keyword">const</span> <a class="code" href="classTensor.html">Tensor&lt;1, dim + 2, Number&gt;</a> &amp;conserved_variables) </div><div class="line">{ </div><div class="line">  <span class="keyword">const</span> <a class="code" href="classTensor.html">Tensor&lt;1, dim, Number&gt;</a> velocity = </div><div class="line">    euler_velocity&lt;dim&gt;(conserved_variables); </div><div class="line"></div><div class="line">  Number rho_u_dot_u = conserved_variables[1] * velocity[0]; </div><div class="line">  <span class="keywordflow">for</span> (<span class="keywordtype">unsigned</span> <span class="keywordtype">int</span> d = 1; d &lt; dim; ++<a class="code" href="namespacePhysics_1_1Elasticity_1_1Kinematics.html#a15728437b942dab0b0042eb06a407d2c">d</a>) </div><div class="line">    rho_u_dot_u += conserved_variables[1 + d] * velocity[d]; </div><div class="line"></div><div class="line">  <span class="keywordflow">return</span> (gamma - 1.) * (conserved_variables[dim + 1] - 0.5 * rho_u_dot_u); </div><div class="line">} </div><div class="line"></div><div class="line"><span class="keyword">template</span> &lt;<span class="keywordtype">int</span> dim, <span class="keyword">typename</span> Number&gt; </div><div class="line"><span class="keyword">inline</span> <a class="code" href="config_8h.html#a1d1d58e8be15e5c4285f6892e5f33136">DEAL_II_ALWAYS_INLINE</a> <span class="comment">// </span></div><div class="line">  <a class="code" href="classTensor.html">Tensor&lt;1, dim + 2, Tensor&lt;1, dim, Number&gt;</a>&gt; </div><div class="line">  euler_flux(<span class="keyword">const</span> <a class="code" href="classTensor.html">Tensor&lt;1, dim + 2, Number&gt;</a> &amp;conserved_variables) </div><div class="line">{ </div><div class="line">  <span class="keyword">const</span> <a class="code" href="classTensor.html">Tensor&lt;1, dim, Number&gt;</a> velocity = </div><div class="line">    euler_velocity&lt;dim&gt;(conserved_variables); </div><div class="line">  <span class="keyword">const</span> Number pressure = euler_pressure&lt;dim&gt;(conserved_variables); </div><div class="line"></div><div class="line">  <a class="code" href="classTensor.html">Tensor&lt;1, dim + 2, Tensor&lt;1, dim, Number&gt;</a>&gt; flux; </div><div class="line">  <span class="keywordflow">for</span> (<span class="keywordtype">unsigned</span> <span class="keywordtype">int</span> d = 0; d &lt; dim; ++<a class="code" href="namespacePhysics_1_1Elasticity_1_1Kinematics.html#a15728437b942dab0b0042eb06a407d2c">d</a>) </div><div class="line">    { </div><div class="line">      flux[0][<a class="code" href="namespacePhysics_1_1Elasticity_1_1Kinematics.html#a15728437b942dab0b0042eb06a407d2c">d</a>] = conserved_variables[1 + <a class="code" href="namespacePhysics_1_1Elasticity_1_1Kinematics.html#a15728437b942dab0b0042eb06a407d2c">d</a>]; </div><div class="line">      <span class="keywordflow">for</span> (<span class="keywordtype">unsigned</span> <span class="keywordtype">int</span> e = 0; e &lt; dim; ++<a class="code" href="namespacePhysics_1_1Elasticity_1_1Kinematics.html#a9587d5229555daa5b1fa1ba2f8a40adb">e</a>) </div><div class="line">        flux[e + 1][d] = conserved_variables[e + 1] * velocity[d]; </div><div class="line">      flux[d + 1][<a class="code" href="namespacePhysics_1_1Elasticity_1_1Kinematics.html#a15728437b942dab0b0042eb06a407d2c">d</a>] += pressure; </div><div class="line">      flux[dim + 1][<a class="code" href="namespacePhysics_1_1Elasticity_1_1Kinematics.html#a15728437b942dab0b0042eb06a407d2c">d</a>] = </div><div class="line">        velocity[<a class="code" href="namespacePhysics_1_1Elasticity_1_1Kinematics.html#a15728437b942dab0b0042eb06a407d2c">d</a>] * (conserved_variables[dim + 1] + pressure); </div><div class="line">    } </div><div class="line"></div><div class="line">  <span class="keywordflow">return</span> flux; </div><div class="line">} </div><div class="line"></div><div class="line"><span class="keyword">template</span> &lt;<span class="keywordtype">int</span> n_components, <span class="keywordtype">int</span> dim, <span class="keyword">typename</span> Number&gt; </div><div class="line"><span class="keyword">inline</span> <a class="code" href="config_8h.html#a1d1d58e8be15e5c4285f6892e5f33136">DEAL_II_ALWAYS_INLINE</a> <span class="comment">// </span></div><div class="line">  <a class="code" href="classTensor.html">Tensor&lt;1, n_components, Number&gt;</a> </div><div class="line">  <a class="code" href="complex__overloads_8h.html#a285c79b547d28de482e34d02cee71bb2">operator*</a>(<span class="keyword">const</span> <a class="code" href="classTensor.html">Tensor</a>&lt;1, n_components, <a class="code" href="classTensor.html">Tensor&lt;1, dim, Number&gt;</a>&gt; &amp;matrix, </div><div class="line">            <span class="keyword">const</span> <a class="code" href="classTensor.html">Tensor&lt;1, dim, Number&gt;</a> &amp;                         vector) </div><div class="line">{ </div><div class="line">  <a class="code" href="classTensor.html">Tensor&lt;1, n_components, Number&gt;</a> result; </div><div class="line">  <span class="keywordflow">for</span> (<span class="keywordtype">unsigned</span> <span class="keywordtype">int</span> d = 0; d &lt; <a class="code" href="classFunction.html#a7248c7e11dc434fb7d16cdc5e41e3770">n_components</a>; ++<a class="code" href="namespacePhysics_1_1Elasticity_1_1Kinematics.html#a15728437b942dab0b0042eb06a407d2c">d</a>) </div><div class="line">    result[d] = matrix[d] * vector; </div><div class="line">  <span class="keywordflow">return</span> result; </div><div class="line">} </div><div class="line"></div><div class="line"><span class="keyword">template</span> &lt;<span class="keywordtype">int</span> dim, <span class="keyword">typename</span> Number&gt; </div><div class="line"><span class="keyword">inline</span> <a class="code" href="config_8h.html#a1d1d58e8be15e5c4285f6892e5f33136">DEAL_II_ALWAYS_INLINE</a> <span class="comment">// </span></div><div class="line">  <a class="code" href="classTensor.html">Tensor&lt;1, dim + 2, Number&gt;</a> </div><div class="line">  euler_numerical_flux(<span class="keyword">const</span> <a class="code" href="classTensor.html">Tensor&lt;1, dim + 2, Number&gt;</a> &amp;u_m, </div><div class="line">                       <span class="keyword">const</span> <a class="code" href="classTensor.html">Tensor&lt;1, dim + 2, Number&gt;</a> &amp;u_p, </div><div class="line">                       <span class="keyword">const</span> <a class="code" href="classTensor.html">Tensor&lt;1, dim, Number&gt;</a> &amp;    normal) </div><div class="line">{ </div><div class="line">  <span class="keyword">const</span> <span class="keyword">auto</span> velocity_m = euler_velocity&lt;dim&gt;(u_m); </div><div class="line">  <span class="keyword">const</span> <span class="keyword">auto</span> velocity_p = euler_velocity&lt;dim&gt;(u_p); </div><div class="line"></div><div class="line">  <span class="keyword">const</span> <span class="keyword">auto</span> pressure_m = euler_pressure&lt;dim&gt;(u_m); </div><div class="line">  <span class="keyword">const</span> <span class="keyword">auto</span> pressure_p = euler_pressure&lt;dim&gt;(u_p); </div><div class="line"></div><div class="line">  <span class="keyword">const</span> <span class="keyword">auto</span> flux_m = euler_flux&lt;dim&gt;(u_m); </div><div class="line">  <span class="keyword">const</span> <span class="keyword">auto</span> flux_p = euler_flux&lt;dim&gt;(u_p); </div><div class="line"></div><div class="line">  <span class="keywordflow">switch</span> (numerical_flux_type) </div><div class="line">    { </div><div class="line">      <span class="keywordflow">case</span> lax_friedrichs_modified: </div><div class="line">        { </div><div class="line">          <span class="keyword">const</span> <span class="keyword">auto</span> lambda = </div><div class="line">            0.5 * <a class="code" href="vectorization_8h.html#a303f564e3c189251976da401ee2e44fa">std::sqrt</a>(<a class="code" href="namespaceVectorTools_1_1EvaluationFlags.html#ac6721740e24732d6afabcf28ddfc1ffda8e7f5b8545162dccd5ed717792bdf420">std::max</a>(velocity_p.norm_square() + </div><div class="line">                                       gamma * pressure_p * (1. / u_p[0]), </div><div class="line">                                     velocity_m.norm_square() + </div><div class="line">                                       gamma * pressure_m * (1. / u_m[0]))); </div><div class="line"></div><div class="line">          <span class="keywordflow">return</span> 0.5 * (flux_m * normal + flux_p * normal) + </div><div class="line">                 0.5 * lambda * (u_m - u_p); </div><div class="line">        } </div><div class="line"></div><div class="line">      <span class="keywordflow">case</span> harten_lax_vanleer: </div><div class="line">        { </div><div class="line">          <span class="keyword">const</span> <span class="keyword">auto</span> avg_velocity_normal = </div><div class="line">            0.5 * ((velocity_m + velocity_p) * normal); </div><div class="line">          <span class="keyword">const</span> <span class="keyword">auto</span>   avg_c = <a class="code" href="vectorization_8h.html#a303f564e3c189251976da401ee2e44fa">std::sqrt</a>(std::abs( </div><div class="line">            0.5 * gamma * </div><div class="line">            (pressure_p * (1. / u_p[0]) + pressure_m * (1. / u_m[0])))); </div><div class="line">          <span class="keyword">const</span> Number s_pos = </div><div class="line">            <a class="code" href="namespaceVectorTools_1_1EvaluationFlags.html#ac6721740e24732d6afabcf28ddfc1ffda8e7f5b8545162dccd5ed717792bdf420">std::max</a>(Number(), avg_velocity_normal + avg_c); </div><div class="line">          <span class="keyword">const</span> Number s_neg = </div><div class="line">            <a class="code" href="namespaceVectorTools_1_1EvaluationFlags.html#ac6721740e24732d6afabcf28ddfc1ffdaeb244a97c0c9e9e7ca4765e096f0badc">std::min</a>(Number(), avg_velocity_normal - avg_c); </div><div class="line">          <span class="keyword">const</span> Number inverse_s = Number(1.) / (s_pos - s_neg); </div><div class="line"></div><div class="line">          <span class="keywordflow">return</span> inverse_s * </div><div class="line">                 ((s_pos * (flux_m * normal) - s_neg * (flux_p * normal)) - </div><div class="line">                  s_pos * s_neg * (u_m - u_p)); </div><div class="line">        } </div><div class="line"></div><div class="line">      <span class="keywordflow">default</span>: </div><div class="line">        { </div><div class="line">          <a class="code" href="group__Exceptions.html#ga70a0bb353656e704acf927945277bbc6">Assert</a>(<span class="keyword">false</span>, <a class="code" href="group__Exceptions.html#ga7b52b286796c23ef9ff178faf7a4b68f">ExcNotImplemented</a>()); </div><div class="line">          <span class="keywordflow">return</span> {}; </div><div class="line">        } </div><div class="line">    } </div><div class="line">} </div></div><!-- fragment --><p>来自 <a class="el" href="step_67.html">step-67</a> 的通用实用函数。</p>
<div class="fragment"><div class="line"><span class="keyword">template</span> &lt;<span class="keywordtype">int</span> dim, <span class="keyword">typename</span> VectorizedArrayType&gt; </div><div class="line">VectorizedArrayType </div><div class="line">evaluate_function(<span class="keyword">const</span> <a class="code" href="classFunction.html">Function&lt;dim&gt;</a> &amp;                  <span class="keyword">function</span>, </div><div class="line">                  <span class="keyword">const</span> <a class="code" href="classPoint.html">Point&lt;dim, VectorizedArrayType&gt;</a> &amp;p_vectorized, </div><div class="line">                  <span class="keyword">const</span> <span class="keywordtype">unsigned</span> <span class="keywordtype">int</span>                     component) </div><div class="line">{ </div><div class="line">  VectorizedArrayType result; </div><div class="line">  <span class="keywordflow">for</span> (<span class="keywordtype">unsigned</span> <span class="keywordtype">int</span> v = 0; v &lt; VectorizedArrayType::size(); ++v) </div><div class="line">    { </div><div class="line">      <a class="code" href="classPoint.html">Point&lt;dim&gt;</a> p; </div><div class="line">      <span class="keywordflow">for</span> (<span class="keywordtype">unsigned</span> <span class="keywordtype">int</span> d = 0; d &lt; dim; ++<a class="code" href="namespacePhysics_1_1Elasticity_1_1Kinematics.html#a15728437b942dab0b0042eb06a407d2c">d</a>) </div><div class="line">        p[d] = p_vectorized[d][v]; </div><div class="line">      result[v] = <span class="keyword">function</span>.value(p, component); </div><div class="line">    } </div><div class="line">  <span class="keywordflow">return</span> result; </div><div class="line">} </div><div class="line"></div><div class="line"><span class="keyword">template</span> &lt;<span class="keywordtype">int</span> dim, <span class="keyword">typename</span> VectorizedArrayType, <span class="keywordtype">int</span> n_components = dim + 2&gt; </div><div class="line"><a class="code" href="classTensor.html">Tensor&lt;1, n_components, VectorizedArrayType&gt;</a> </div><div class="line">evaluate_function(<span class="keyword">const</span> <a class="code" href="classFunction.html">Function&lt;dim&gt;</a> &amp;                  <span class="keyword">function</span>, </div><div class="line">                  <span class="keyword">const</span> <a class="code" href="classPoint.html">Point&lt;dim, VectorizedArrayType&gt;</a> &amp;p_vectorized) </div><div class="line">{ </div><div class="line">  <a class="code" href="group__Exceptions.html#ga9442b63275c9ef3fab29bc222831c49c">AssertDimension</a>(<span class="keyword">function</span>.n_components, n_components); </div><div class="line">  <a class="code" href="classTensor.html">Tensor&lt;1, n_components, VectorizedArrayType&gt;</a> result; </div><div class="line">  <span class="keywordflow">for</span> (<span class="keywordtype">unsigned</span> <span class="keywordtype">int</span> v = 0; v &lt; VectorizedArrayType::size(); ++v) </div><div class="line">    { </div><div class="line">      <a class="code" href="classPoint.html">Point&lt;dim&gt;</a> p; </div><div class="line">      <span class="keywordflow">for</span> (<span class="keywordtype">unsigned</span> <span class="keywordtype">int</span> d = 0; d &lt; dim; ++<a class="code" href="namespacePhysics_1_1Elasticity_1_1Kinematics.html#a15728437b942dab0b0042eb06a407d2c">d</a>) </div><div class="line">        p[d] = p_vectorized[d][v]; </div><div class="line">      <span class="keywordflow">for</span> (<span class="keywordtype">unsigned</span> <span class="keywordtype">int</span> d = 0; d &lt; n_components; ++<a class="code" href="namespacePhysics_1_1Elasticity_1_1Kinematics.html#a15728437b942dab0b0042eb06a407d2c">d</a>) </div><div class="line">        result[d][v] = <span class="keyword">function</span>.value(p, d); </div><div class="line">    } </div><div class="line">  <span class="keywordflow">return</span> result; </div><div class="line">} </div></div><!-- fragment --><p><a class="anchor" id="EuleroperatorusingacellcentricloopandMPI30sharedmemory"></a> </p><h3>Euler operator using a cell-centric loop and MPI-3.0 shared memory</h3>
<p>来自 <a class="el" href="step_67.html">step-67</a> 的欧拉算子，有一些变化，详见下文。</p>
<div class="fragment"><div class="line"><span class="keyword">template</span> &lt;<span class="keywordtype">int</span> dim, <span class="keywordtype">int</span> degree, <span class="keywordtype">int</span> n_po<span class="keywordtype">int</span>s_1d&gt; </div><div class="line"><span class="keyword">class </span>EulerOperator </div><div class="line">{ </div><div class="line"><span class="keyword">public</span>: </div><div class="line">  <span class="keyword">static</span> constexpr <span class="keywordtype">unsigned</span> <span class="keywordtype">int</span> n_quadrature_points_1d = n_points_1d; </div><div class="line"></div><div class="line">  EulerOperator(<a class="code" href="classTimerOutput.html">TimerOutput</a> &amp;timer_output); </div><div class="line"></div><div class="line">  ~EulerOperator(); </div><div class="line"></div><div class="line">  <span class="keywordtype">void</span> <a class="code" href="namespaceinternal.html#a38181f4582ff69679bda7d8e31c37291">reinit</a>(<span class="keyword">const</span> <a class="code" href="classMapping.html">Mapping&lt;dim&gt;</a> &amp;   mapping, </div><div class="line">              <span class="keyword">const</span> <a class="code" href="classDoFHandler.html">DoFHandler&lt;dim&gt;</a> &amp;dof_handler); </div><div class="line"></div><div class="line">  <span class="keywordtype">void</span> set_inflow_boundary(<span class="keyword">const</span> <a class="code" href="classunsigned_01int.html">types::boundary_id</a>       boundary_id, </div><div class="line">                           std::unique_ptr&lt;<a class="code" href="classFunction.html">Function&lt;dim&gt;</a>&gt; inflow_function); </div><div class="line"></div><div class="line">  <span class="keywordtype">void</span> set_subsonic_outflow_boundary( </div><div class="line">    <span class="keyword">const</span> <a class="code" href="classunsigned_01int.html">types::boundary_id</a>       boundary_id, </div><div class="line">    std::unique_ptr&lt;<a class="code" href="classFunction.html">Function&lt;dim&gt;</a>&gt; outflow_energy); </div><div class="line"></div><div class="line">  <span class="keywordtype">void</span> set_wall_boundary(<span class="keyword">const</span> <a class="code" href="classunsigned_01int.html">types::boundary_id</a> boundary_id); </div><div class="line"></div><div class="line">  <span class="keywordtype">void</span> set_body_force(std::unique_ptr&lt;<a class="code" href="classFunction.html">Function&lt;dim&gt;</a>&gt; body_force); </div><div class="line"></div><div class="line">  <span class="keywordtype">void</span> </div><div class="line">  perform_stage(<span class="keyword">const</span> <span class="keywordtype">unsigned</span> <span class="keywordtype">int</span>                                stage, </div><div class="line">                <span class="keyword">const</span> Number                                      cur_time, </div><div class="line">                <span class="keyword">const</span> Number                                      bi, </div><div class="line">                <span class="keyword">const</span> Number                                      ai, </div><div class="line">                <span class="keyword">const</span> <a class="code" href="classLinearAlgebra_1_1distributed_1_1Vector.html">LinearAlgebra::distributed::Vector&lt;Number&gt;</a> &amp;current_ri, </div><div class="line">                <a class="code" href="classLinearAlgebra_1_1distributed_1_1Vector.html">LinearAlgebra::distributed::Vector&lt;Number&gt;</a> &amp;      vec_ki, </div><div class="line">                <a class="code" href="classLinearAlgebra_1_1distributed_1_1Vector.html">LinearAlgebra::distributed::Vector&lt;Number&gt;</a> &amp;solution) <span class="keyword">const</span>; </div><div class="line"></div><div class="line">  <span class="keywordtype">void</span> <a class="code" href="namespaceVectorTools.html#ac6b404bf03cb2a742b290421cc2789fe">project</a>(<span class="keyword">const</span> <a class="code" href="classFunction.html">Function&lt;dim&gt;</a> &amp;                       <span class="keyword">function</span>, </div><div class="line">               <a class="code" href="classLinearAlgebra_1_1distributed_1_1Vector.html">LinearAlgebra::distributed::Vector&lt;Number&gt;</a> &amp;solution) <span class="keyword">const</span>; </div><div class="line"></div><div class="line">  std::array&lt;double, 3&gt; compute_errors( </div><div class="line">    <span class="keyword">const</span> <a class="code" href="classFunction.html">Function&lt;dim&gt;</a> &amp;                             <span class="keyword">function</span>, </div><div class="line">    <span class="keyword">const</span> <a class="code" href="classLinearAlgebra_1_1distributed_1_1Vector.html">LinearAlgebra::distributed::Vector&lt;Number&gt;</a> &amp;solution) <span class="keyword">const</span>; </div><div class="line"></div><div class="line">  <span class="keywordtype">double</span> compute_cell_transport_speed( </div><div class="line">    <span class="keyword">const</span> <a class="code" href="classLinearAlgebra_1_1distributed_1_1Vector.html">LinearAlgebra::distributed::Vector&lt;Number&gt;</a> &amp;solution) <span class="keyword">const</span>; </div><div class="line"></div><div class="line">  <span class="keywordtype">void</span> </div><div class="line">  initialize_vector(<a class="code" href="classLinearAlgebra_1_1distributed_1_1Vector.html">LinearAlgebra::distributed::Vector&lt;Number&gt;</a> &amp;vector) <span class="keyword">const</span>; </div><div class="line"></div><div class="line"><span class="keyword">private</span>: </div></div><!-- fragment --><p>包含子通信器的SubCommunicatorWrapper实例，我们需要将其传递给 <a class="el" href="classMatrixFree.html#adb324d469b296f2a6921b41208732ddf">MatrixFree::reinit()</a> ，以便能够利用MPI-3.0的共享内存功能。</p>
<div class="fragment"><div class="line">  <a class="code" href="classMPI__Comm.html">MPI_Comm</a> subcommunicator; </div><div class="line"></div><div class="line">  <a class="code" href="classMatrixFree.html">MatrixFree&lt;dim, Number, VectorizedArrayType&gt;</a> data; </div><div class="line"></div><div class="line">  <a class="code" href="classTimerOutput.html">TimerOutput</a> &amp;timer; </div><div class="line"></div><div class="line">  std::map&lt;types::boundary_id, std::unique_ptr&lt;Function&lt;dim&gt;&gt;&gt; </div><div class="line">    inflow_boundaries; </div><div class="line">  std::map&lt;types::boundary_id, std::unique_ptr&lt;Function&lt;dim&gt;&gt;&gt; </div><div class="line">                                 subsonic_outflow_boundaries; </div><div class="line">  std::set&lt;types::boundary_id&gt;   wall_boundaries; </div><div class="line">  std::unique_ptr&lt;Function&lt;dim&gt;&gt; body_force; </div><div class="line">}; </div></div><!-- fragment --><p>新的构造函数，可以创建一个子通信器。用户可以通过全局参数group_size指定子通信器的大小。如果大小被设置为-1，一个共享内存域的所有MPI进程将被合并为一个组。指定的大小对于MatrixFree的共享内存能力的好处是决定性的，因此，设置为 <code>size</code> to <code>-1</code> 是一个合理的选择。通过设置 <code>1</code> ，用户明确地禁用了MatrixFree的MPI-3.0共享内存功能，而完全依赖MPI-2.0功能，如 <code>MPI_Isend</code> 和 <code>MPI_Irecv</code> 。</p>
<div class="fragment"><div class="line">  <span class="keyword">template</span> &lt;<span class="keywordtype">int</span> dim, <span class="keywordtype">int</span> degree, <span class="keywordtype">int</span> n_po<span class="keywordtype">int</span>s_1d&gt; </div><div class="line">  EulerOperator&lt;dim, degree, n_points_1d&gt;::EulerOperator(<a class="code" href="classTimerOutput.html">TimerOutput</a> &amp;timer) </div><div class="line">    : timer(timer) </div><div class="line">  { </div><div class="line"><span class="preprocessor">#if DEAL_II_MPI_VERSION_GTE(3, 0) </span></div><div class="line">    <span class="keywordflow">if</span> (group_size == 1) </div><div class="line">      { </div><div class="line">        this-&gt;subcommunicator = MPI_COMM_SELF; </div><div class="line">      } </div><div class="line">    <span class="keywordflow">else</span> <span class="keywordflow">if</span> (group_size == <a class="code" href="namespacenumbers.html#a8ae36952c7e0cc778b47b5371b3aeff1">numbers::invalid_unsigned_int</a>) </div><div class="line">      { </div><div class="line">        <span class="keyword">const</span> <span class="keyword">auto</span> rank = <a class="code" href="namespaceUtilities_1_1MPI.html#a895dcd8223a0ee6f0e6a80b80e2d5982">Utilities::MPI::this_mpi_process</a>(MPI_COMM_WORLD); </div><div class="line"></div><div class="line">        MPI_Comm_split_type(MPI_COMM_WORLD, </div><div class="line">                            MPI_COMM_TYPE_SHARED, </div><div class="line">                            rank, </div><div class="line">                            MPI_INFO_NULL, </div><div class="line">                            &amp;subcommunicator); </div><div class="line">      } </div><div class="line">    <span class="keywordflow">else</span> </div><div class="line">      { </div><div class="line">        <a class="code" href="group__Exceptions.html#ga70a0bb353656e704acf927945277bbc6">Assert</a>(<span class="keyword">false</span>, <a class="code" href="group__Exceptions.html#ga7b52b286796c23ef9ff178faf7a4b68f">ExcNotImplemented</a>()); </div><div class="line">      } </div><div class="line"><span class="preprocessor">#else </span></div><div class="line">    (void)subcommunicator; </div><div class="line">    (void)group_size; </div><div class="line">    this-&gt;subcommunicator = MPI_COMM_SELF; </div><div class="line"><span class="preprocessor">#endif </span></div><div class="line"><span class="preprocessor">  } </span></div></div><!-- fragment --><p>新增负责释放子通信器的析构器。</p>
<div class="fragment"><div class="line">  <span class="keyword">template</span> &lt;<span class="keywordtype">int</span> dim, <span class="keywordtype">int</span> degree, <span class="keywordtype">int</span> n_po<span class="keywordtype">int</span>s_1d&gt; </div><div class="line">  EulerOperator&lt;dim, degree, n_points_1d&gt;::~EulerOperator() </div><div class="line">  { </div><div class="line"><span class="preprocessor">#ifdef DEAL_II_WITH_MPI </span></div><div class="line">    <span class="keywordflow">if</span> (this-&gt;subcommunicator != MPI_COMM_SELF) </div><div class="line">      MPI_Comm_free(&amp;subcommunicator); </div><div class="line"><span class="preprocessor">#endif </span></div><div class="line"><span class="preprocessor">  } </span></div></div><!-- fragment --><p>修改了 <a class="el" href="namespaceinternal.html#a38181f4582ff69679bda7d8e31c37291">reinit()</a> 函数，以设置 <a class="el" href="classMatrixFree.html">MatrixFree</a> 中的内部数据结构，使其可以被以单元为中心的循环使用，并使用 MPI-3.0 的共享内存功能。</p>
<div class="fragment"><div class="line"><span class="keyword">template</span> &lt;<span class="keywordtype">int</span> dim, <span class="keywordtype">int</span> degree, <span class="keywordtype">int</span> n_po<span class="keywordtype">int</span>s_1d&gt; </div><div class="line"><span class="keywordtype">void</span> <a class="code" href="namespaceinternal.html#a38181f4582ff69679bda7d8e31c37291">EulerOperator&lt;dim, degree, n_points_1d&gt;::reinit</a>( </div><div class="line">  <span class="keyword">const</span> <a class="code" href="classMapping.html">Mapping&lt;dim&gt;</a> &amp;   mapping, </div><div class="line">  <span class="keyword">const</span> <a class="code" href="classDoFHandler.html">DoFHandler&lt;dim&gt;</a> &amp;dof_handler) </div><div class="line">{ </div><div class="line">  <span class="keyword">const</span> std::vector&lt;const DoFHandler&lt;dim&gt; *&gt; dof_handlers = {&amp;dof_handler}; </div><div class="line">  <span class="keyword">const</span> <a class="code" href="classAffineConstraints.html">AffineConstraints&lt;double&gt;</a>            dummy; </div><div class="line">  <span class="keyword">const</span> std::vector&lt;const AffineConstraints&lt;double&gt; *&gt; constraints = {&amp;dummy}; </div><div class="line">  <span class="keyword">const</span> std::vector&lt;Quadrature&lt;1&gt;&gt; quadratures = {<a class="code" href="classQGauss.html">QGauss&lt;1&gt;</a>(n_q_points_1d), </div><div class="line">                                                  <a class="code" href="classQGauss.html">QGauss&lt;1&gt;</a>(fe_degree + 1)}; </div><div class="line"></div><div class="line">  <span class="keyword">typename</span> <a class="code" href="structMatrixFree_1_1AdditionalData.html">MatrixFree&lt;dim, Number, VectorizedArrayType&gt;::AdditionalData</a> </div><div class="line">    additional_data; </div><div class="line">  additional_data.<a class="code" href="structMatrixFree_1_1AdditionalData.html#aa5d597e6c4441d273f4100b6139a2552">mapping_update_flags</a> = </div><div class="line">    (<a class="code" href="group__feaccess.html#ggaa94b67d2fdcc390690c523f28019e52facbcc430975fa6af05f75ca786dc6fe20">update_gradients</a> | <a class="code" href="group__feaccess.html#ggaa94b67d2fdcc390690c523f28019e52fa714204722e9eeb43aadbd0d5ddc48c85">update_JxW_values</a> | <a class="code" href="group__feaccess.html#ggaa94b67d2fdcc390690c523f28019e52fad5c9ff886b9615349a5d04a6c782df4a">update_quadrature_points</a> | </div><div class="line">     <a class="code" href="group__feaccess.html#ggaa94b67d2fdcc390690c523f28019e52fa4057ca2f127aa619c65886a9d3ad4aea">update_values</a>); </div><div class="line">  additional_data.<a class="code" href="structMatrixFree_1_1AdditionalData.html#a5c25759917955940e0b2b74a6704012c">mapping_update_flags_inner_faces</a> = </div><div class="line">    (<a class="code" href="group__feaccess.html#ggaa94b67d2fdcc390690c523f28019e52fa714204722e9eeb43aadbd0d5ddc48c85">update_JxW_values</a> | <a class="code" href="group__feaccess.html#ggaa94b67d2fdcc390690c523f28019e52fad5c9ff886b9615349a5d04a6c782df4a">update_quadrature_points</a> | <a class="code" href="group__feaccess.html#ggaa94b67d2fdcc390690c523f28019e52fa5e7366a91c84a50ca4e7dbd43ca6369f">update_normal_vectors</a> | </div><div class="line">     <a class="code" href="group__feaccess.html#ggaa94b67d2fdcc390690c523f28019e52fa4057ca2f127aa619c65886a9d3ad4aea">update_values</a>); </div><div class="line">  additional_data.<a class="code" href="structMatrixFree_1_1AdditionalData.html#aa326b1a098e1c037334cc05bdc2decc6">mapping_update_flags_boundary_faces</a> = </div><div class="line">    (<a class="code" href="group__feaccess.html#ggaa94b67d2fdcc390690c523f28019e52fa714204722e9eeb43aadbd0d5ddc48c85">update_JxW_values</a> | <a class="code" href="group__feaccess.html#ggaa94b67d2fdcc390690c523f28019e52fad5c9ff886b9615349a5d04a6c782df4a">update_quadrature_points</a> | <a class="code" href="group__feaccess.html#ggaa94b67d2fdcc390690c523f28019e52fa5e7366a91c84a50ca4e7dbd43ca6369f">update_normal_vectors</a> | </div><div class="line">     <a class="code" href="group__feaccess.html#ggaa94b67d2fdcc390690c523f28019e52fa4057ca2f127aa619c65886a9d3ad4aea">update_values</a>); </div><div class="line">  additional_data.<a class="code" href="structMatrixFree_1_1AdditionalData.html#a0bcce2facca91b925d3e1a5a00c7704b">tasks_parallel_scheme</a> = </div><div class="line">    <a class="code" href="classMatrixFree.html">MatrixFree&lt;dim, Number, VectorizedArrayType&gt;::AdditionalData::none</a>; </div></div><!-- fragment --><p>对单元格进行分类，使所有车道的每个面都有相同的边界ID。这在严格意义上是没有必要的，但是，可以在 EulerOperator::perform_stage() 中写出更简单的代码，不需要屏蔽，因为可以保证所有分组的单元格（在一个VectorizedArray中）也要对面进行完全相同的操作。</p>
<div class="fragment"><div class="line"><a class="code" href="namespaceMatrixFreeTools.html#ae034b98c0db11285fae23a08ef3f197f">MatrixFreeTools::categorize_by_boundary_ids</a>(dof_handler.<a class="code" href="classDoFHandler.html#a7797f796c0be511fbc7f230ccc22532e">get_triangulation</a>(), </div><div class="line">                                            additional_data); </div></div><!-- fragment --><p>通过提供子通信器在MatrixFree中启用MPI-3.0共享内存功能。</p>
<div class="fragment"><div class="line">  additional_data.<a class="code" href="structMatrixFree_1_1AdditionalData.html#afdca3541da950e50d2e8dca2de4ceb90">communicator_sm</a> = subcommunicator; </div><div class="line"></div><div class="line">  data.reinit( </div><div class="line">    mapping, dof_handlers, constraints, quadratures, additional_data); </div><div class="line">} </div></div><!-- fragment --><p>下面这个函数是做Runge&ndash;Kutta更新的整个阶段，并且是</p>
<ul>
<li>旁边的设置稍作修改</li>
</ul>
<p>与 <a class="el" href="step_67.html">step-67</a> 相比，我们没有依次执行平流步骤（使用 <a class="el" href="classMatrixFree.html#a0e9669e4a5cfaceac78f5e26c285c2ea">MatrixFree::loop()</a>) 和反质量矩阵步骤（使用 <a class="el" href="classMatrixFree.html#abc204ec41ead1b5060f47ef3a5a066d7">MatrixFree::cell_loop()</a>) ），而是在 <a class="el" href="classMatrixFree.html#a60ebe2e71cfd7602ef9bc612d22385f8">MatrixFree::loop_cell_centric()</a>. 中一次性评估所有内容。 这个函数期望在每个本地拥有的（宏）单元上执行一个单独的函数作为参数，这样我们就需要在该单元的所有面上循环，自行执行需要的积分步骤。</p>
<p>以下函数在很大程度上包含了 <a class="el" href="step_67.html">step-67</a> 中的以下函数的副本，所以这里跳过了与弱形式的评估有关的评论。</p>
<ul>
<li><code>EulerDG::EulerOperator::local_apply_cell</code></li>
<li><code>EulerDG::EulerOperator::local_apply_face</code></li>
<li><code>EulerDG::EulerOperator::local_apply_boundary_face</code></li>
<li><code>EulerDG::EulerOperator::local_apply_inverse_mass_matrix</code></li>
</ul>
<div class="fragment"><div class="line"><span class="keyword">template</span> &lt;<span class="keywordtype">int</span> dim, <span class="keywordtype">int</span> degree, <span class="keywordtype">int</span> n_po<span class="keywordtype">int</span>s_1d&gt; </div><div class="line"><span class="keywordtype">void</span> EulerOperator&lt;dim, degree, n_points_1d&gt;::perform_stage( </div><div class="line">  <span class="keyword">const</span> <span class="keywordtype">unsigned</span> <span class="keywordtype">int</span>                                stage, </div><div class="line">  <span class="keyword">const</span> Number                                      current_time, </div><div class="line">  <span class="keyword">const</span> Number                                      bi, </div><div class="line">  <span class="keyword">const</span> Number                                      ai, </div><div class="line">  <span class="keyword">const</span> <a class="code" href="classLinearAlgebra_1_1distributed_1_1Vector.html">LinearAlgebra::distributed::Vector&lt;Number&gt;</a> &amp;current_ri, </div><div class="line">  <a class="code" href="classLinearAlgebra_1_1distributed_1_1Vector.html">LinearAlgebra::distributed::Vector&lt;Number&gt;</a> &amp;      vec_ki, </div><div class="line">  <a class="code" href="classLinearAlgebra_1_1distributed_1_1Vector.html">LinearAlgebra::distributed::Vector&lt;Number&gt;</a> &amp;      solution)<span class="keyword"> const </span></div><div class="line"><span class="keyword"></span>{ </div><div class="line">  <span class="keywordflow">for</span> (<span class="keyword">auto</span> &amp;i : inflow_boundaries) </div><div class="line">    i.second-&gt;set_time(current_time); </div><div class="line">  <span class="keywordflow">for</span> (<span class="keyword">auto</span> &amp;i : subsonic_outflow_boundaries) </div><div class="line">    i.second-&gt;set_time(current_time); </div></div><!-- fragment --><p>通过调用 <a class="el" href="classMatrixFree.html#a60ebe2e71cfd7602ef9bc612d22385f8">MatrixFree::loop_cell_centric()</a> 并提供一个包含单元、面和边界-面积分效果的lambda来运行以单元为中心的循环。</p>
<div class="fragment"><div class="line">data.template loop_cell_centric&lt;LinearAlgebra::distributed::Vector&lt;Number&gt;, </div><div class="line">                                <a class="code" href="classLinearAlgebra_1_1distributed_1_1Vector.html">LinearAlgebra::distributed::Vector&lt;Number&gt;</a>&gt;( </div><div class="line">  [&amp;](<span class="keyword">const</span> <span class="keyword">auto</span> &amp;data, <span class="keyword">auto</span> &amp;dst, <span class="keyword">const</span> <span class="keyword">auto</span> &amp;src, <span class="keyword">const</span> <span class="keyword">auto</span> cell_range) { </div><div class="line">    <span class="keyword">using</span> FECellIntegral = <a class="code" href="classFEEvaluation.html">FEEvaluation</a>&lt;dim, </div><div class="line">                                        degree, </div><div class="line">                                        n_points_1d, </div><div class="line">                                        dim + 2, </div><div class="line">                                        Number, </div><div class="line">                                        VectorizedArrayType&gt;; </div><div class="line">    <span class="keyword">using</span> FEFaceIntegral = <a class="code" href="classFEFaceEvaluation.html">FEFaceEvaluation</a>&lt;dim, </div><div class="line">                                            degree, </div><div class="line">                                            n_points_1d, </div><div class="line">                                            dim + 2, </div><div class="line">                                            Number, </div><div class="line">                                            VectorizedArrayType&gt;; </div><div class="line"></div><div class="line">    FECellIntegral phi(data); </div><div class="line">    FECellIntegral phi_temp(data); </div><div class="line">    FEFaceIntegral phi_m(data, <span class="keyword">true</span>); </div><div class="line">    FEFaceIntegral phi_p(data, <span class="keyword">false</span>); </div><div class="line"></div><div class="line">    <a class="code" href="classTensor.html">Tensor&lt;1, dim, VectorizedArrayType&gt;</a>     constant_body_force; </div><div class="line">    <span class="keyword">const</span> <a class="code" href="classFunctions_1_1ConstantFunction.html">Functions::ConstantFunction&lt;dim&gt;</a> *constant_function = </div><div class="line">      <span class="keyword">dynamic_cast&lt;</span><a class="code" href="classFunctions_1_1ConstantFunction.html">Functions::ConstantFunction&lt;dim&gt;</a> *<span class="keyword">&gt;</span>(body_force.get()); </div><div class="line"></div><div class="line">    <span class="keywordflow">if</span> (constant_function) </div><div class="line">      constant_body_force = </div><div class="line">        evaluate_function&lt;dim, VectorizedArrayType, dim&gt;( </div><div class="line">          *constant_function, <a class="code" href="classPoint.html">Point&lt;dim, VectorizedArrayType&gt;</a>()); </div><div class="line"></div><div class="line">    const ::internal::EvaluatorTensorProduct&lt; </div><div class="line">      <a class="code" href="group__CUDAWrappers.html#ggac8e56c1f8d3d4947aa030c9d14308a3bab70b25f96672253ddf82a276d3563956">::internal::EvaluatorVariant::evaluate_evenodd</a>, </div><div class="line">      dim, </div><div class="line">      n_points_1d, </div><div class="line">      n_points_1d, </div><div class="line">      VectorizedArrayType&gt; </div><div class="line">      eval(<a class="code" href="classAlignedVector.html">AlignedVector&lt;VectorizedArrayType&gt;</a>(), </div><div class="line">           data.get_shape_info().<a class="code" href="classAlignedVector.html#a60d3ec3ed58e7c10cb66288834220cd3">data</a>[0].shape_gradients_collocation_eo, </div><div class="line">           <a class="code" href="classAlignedVector.html">AlignedVector&lt;VectorizedArrayType&gt;</a>()); </div><div class="line"></div><div class="line">    <a class="code" href="classAlignedVector.html">AlignedVector&lt;VectorizedArrayType&gt;</a> buffer(phi.static_n_q_points * </div><div class="line">                                              phi.n_components); </div></div><!-- fragment --><p>在所有单元格批次上循环。</p>
<div class="fragment"><div class="line"><span class="keywordflow">for</span> (<span class="keywordtype">unsigned</span> <span class="keywordtype">int</span> cell = cell_range.first; cell &lt; cell_range.second; </div><div class="line">     ++cell) </div><div class="line">  { </div><div class="line">    phi.reinit(cell); </div><div class="line"></div><div class="line">    <span class="keywordflow">if</span> (ai != Number()) </div><div class="line">      phi_temp.reinit(cell); </div></div><!-- fragment --><p>从全局矢量中读取数值并计算正交点的数值。</p>
<div class="fragment"><div class="line"><span class="keywordflow">if</span> (ai != Number() &amp;&amp; stage == 0) </div><div class="line">  { </div><div class="line">    phi.read_dof_values(src); </div><div class="line"></div><div class="line">    <span class="keywordflow">for</span> (<span class="keywordtype">unsigned</span> <span class="keywordtype">int</span> i = 0; </div><div class="line">         i &lt; phi.static_dofs_per_component * (dim + 2); </div><div class="line">         ++i) </div><div class="line">      phi_temp.begin_dof_values()[i] = phi.begin_dof_values()[i]; </div><div class="line"></div><div class="line">    phi.evaluate(<a class="code" href="namespaceEvaluationFlags.html#a9b7c6d689cb76386839d0d13640f59aeaf9825c682f693a6a200094641a0d6a58">EvaluationFlags::values</a>); </div><div class="line">  } </div><div class="line"><span class="keywordflow">else</span> </div><div class="line">  { </div><div class="line">    phi.gather_evaluate(src, <a class="code" href="namespaceEvaluationFlags.html#a9b7c6d689cb76386839d0d13640f59aeaf9825c682f693a6a200094641a0d6a58">EvaluationFlags::values</a>); </div><div class="line">  } </div></div><!-- fragment --><p>缓冲正交点的计算值，因为这些值在下一步被 <a class="el" href="classFEEvaluationBase.html#a2c0efc6f70b305c0585001632063c98b">FEEvaluation::submit_value()</a> 所覆盖，但是，在后面的面积分中需要。</p>
<div class="fragment"><div class="line"><span class="keywordflow">for</span> (<span class="keywordtype">unsigned</span> <span class="keywordtype">int</span> i = 0; i &lt; phi.static_n_q_points * (dim + 2); ++i) </div><div class="line">  buffer[i] = phi.begin_values()[i]; </div></div><!-- fragment --><p>在单元格正交点上应用单元格积分。也可参见来自 <a class="el" href="step_67.html">step-67</a> 的函数 <code>EulerOperator::local_apply_cell()</code> 。</p>
<div class="fragment"><div class="line"><span class="keywordflow">for</span> (<span class="keywordtype">unsigned</span> <span class="keywordtype">int</span> q = 0; q &lt; phi.n_q_points; ++q) </div><div class="line">  { </div><div class="line">    <span class="keyword">const</span> <span class="keyword">auto</span> w_q = phi.get_value(q); </div><div class="line">    phi.submit_gradient(euler_flux&lt;dim&gt;(w_q), q); </div><div class="line">    <span class="keywordflow">if</span> (body_force.get() != <span class="keyword">nullptr</span>) </div><div class="line">      { </div><div class="line">        <span class="keyword">const</span> <a class="code" href="classTensor.html">Tensor&lt;1, dim, VectorizedArrayType&gt;</a> force = </div><div class="line">          constant_function ? </div><div class="line">            constant_body_force : </div><div class="line">            evaluate_function&lt;dim, VectorizedArrayType, dim&gt;( </div><div class="line">              *body_force, phi.quadrature_point(q)); </div><div class="line"></div><div class="line">        <a class="code" href="classTensor.html">Tensor&lt;1, dim + 2, VectorizedArrayType&gt;</a> forcing; </div><div class="line">        <span class="keywordflow">for</span> (<span class="keywordtype">unsigned</span> <span class="keywordtype">int</span> d = 0; d &lt; dim; ++<a class="code" href="namespacePhysics_1_1Elasticity_1_1Kinematics.html#a15728437b942dab0b0042eb06a407d2c">d</a>) </div><div class="line">          forcing[d + 1] = w_q[0] * force[d]; </div><div class="line">        <span class="keywordflow">for</span> (<span class="keywordtype">unsigned</span> <span class="keywordtype">int</span> d = 0; d &lt; dim; ++<a class="code" href="namespacePhysics_1_1Elasticity_1_1Kinematics.html#a15728437b942dab0b0042eb06a407d2c">d</a>) </div><div class="line">          forcing[dim + 1] += force[d] * w_q[d + 1]; </div><div class="line"></div><div class="line">        phi.submit_value(forcing, q); </div><div class="line">      } </div><div class="line">  } </div></div><!-- fragment --><p>用正交点中的测试函数的梯度进行测试。我们跳过插值回到元素的支持点，因为我们首先收集单元格正交点的所有贡献，只在最后一步进行插值。</p>
<div class="fragment"><div class="line">{ </div><div class="line">  <span class="keyword">auto</span> *values_ptr   = phi.begin_values(); </div><div class="line">  <span class="keyword">auto</span> *gradient_ptr = phi.begin_gradients(); </div><div class="line"></div><div class="line">  <span class="keywordflow">for</span> (<span class="keywordtype">unsigned</span> <span class="keywordtype">int</span> c = 0; c &lt; dim + 2; ++c) </div><div class="line">    { </div><div class="line">      <span class="keywordflow">if</span> (dim &gt;= 1 &amp;&amp; body_force.get() == <span class="keyword">nullptr</span>) </div><div class="line">        eval.template gradients&lt;0, false, false&gt;( </div><div class="line">          gradient_ptr + phi.static_n_q_points * 0, values_ptr); </div><div class="line">      <span class="keywordflow">else</span> <span class="keywordflow">if</span> (dim &gt;= 1) </div><div class="line">        eval.template gradients&lt;0, false, true&gt;( </div><div class="line">          gradient_ptr + phi.static_n_q_points * 0, values_ptr); </div><div class="line">      <span class="keywordflow">if</span> (dim &gt;= 2) </div><div class="line">        eval.template gradients&lt;1, false, true&gt;( </div><div class="line">          gradient_ptr + phi.static_n_q_points * 1, values_ptr); </div><div class="line">      <span class="keywordflow">if</span> (dim &gt;= 3) </div><div class="line">        eval.template gradients&lt;2, false, true&gt;( </div><div class="line">          gradient_ptr + phi.static_n_q_points * 2, values_ptr); </div><div class="line"></div><div class="line">      values_ptr += phi.static_n_q_points; </div><div class="line">      gradient_ptr += phi.static_n_q_points * dim; </div><div class="line">    } </div><div class="line">} </div></div><!-- fragment --><p>在当前单元格的所有面上进行循环。</p>
<div class="fragment"><div class="line"><span class="keywordflow">for</span> (<span class="keywordtype">unsigned</span> <span class="keywordtype">int</span> face = 0; </div><div class="line">     face &lt; GeometryInfo&lt;dim&gt;::faces_per_cell; </div><div class="line">     ++face) </div><div class="line">  { </div></div><!-- fragment --><p>确定当前面的边界ID。由于我们在设置MatrixFree时，保证了所有填充的车道都有相同的边界ID，我们可以选择第一个车道的边界ID。</p>
<div class="fragment"><div class="line"><span class="keyword">const</span> <span class="keyword">auto</span> boundary_ids = </div><div class="line">  data.get_faces_by_cells_boundary_id(cell, face); </div><div class="line"></div><div class="line"><a class="code" href="group__Exceptions.html#ga70a0bb353656e704acf927945277bbc6">Assert</a>(std::equal(boundary_ids.begin(), </div><div class="line">                  boundary_ids.begin() + </div><div class="line">                    data.n_active_entries_per_cell_batch(cell), </div><div class="line">                  boundary_ids.begin()), </div><div class="line">       <a class="code" href="group__Exceptions.html#gae9a45f517af1401c50811a11083f9114">ExcMessage</a>(<span class="stringliteral">&quot;Boundary IDs of lanes differ.&quot;</span>)); </div><div class="line"></div><div class="line"><span class="keyword">const</span> <span class="keyword">auto</span> boundary_id = boundary_ids[0]; </div><div class="line"></div><div class="line">phi_m.reinit(cell, face); </div></div><!-- fragment --><p>通过简单的一维插值，将单元格正交点的值插到当前面的正交点上。</p>
<div class="fragment"><div class="line"><a class="code" href="structinternal_1_1FEFaceNormalEvaluationImpl.html">internal::FEFaceNormalEvaluationImpl</a>&lt;dim, </div><div class="line">                                     n_points_1d - 1, </div><div class="line">                                     VectorizedArrayType&gt;:: </div><div class="line">  template interpolate_quadrature&lt;true, false&gt;( </div><div class="line">    dim + 2, </div><div class="line">    data.get_shape_info(), </div><div class="line">    buffer.data(), </div><div class="line">    phi_m.begin_values(), </div><div class="line">    <span class="keyword">false</span>, </div><div class="line">    face); </div></div><!-- fragment --><p>检查该面是内部面还是边界面，并根据这一信息选择不同的代码路径。</p>
<div class="fragment"><div class="line"><span class="keywordflow">if</span> (boundary_id == <a class="code" href="namespacenumbers.html#a4e5d3fa25689151c833ba46dcc96fa5b">numbers::internal_face_boundary_id</a>) </div><div class="line">  { </div></div><!-- fragment --><p>处理和内部面。以下几行代码是对 <a class="el" href="step_67.html">step-67</a> 中 <code>EulerDG::EulerOperator::local_apply_face</code> 函数的复制。</p>
<div class="fragment"><div class="line">    phi_p.reinit(cell, face); </div><div class="line">    phi_p.gather_evaluate(src, <a class="code" href="namespaceEvaluationFlags.html#a9b7c6d689cb76386839d0d13640f59aeaf9825c682f693a6a200094641a0d6a58">EvaluationFlags::values</a>); </div><div class="line"></div><div class="line">    <span class="keywordflow">for</span> (<span class="keywordtype">unsigned</span> <span class="keywordtype">int</span> q = 0; q &lt; phi_m.n_q_points; ++q) </div><div class="line">      { </div><div class="line">        <span class="keyword">const</span> <span class="keyword">auto</span> numerical_flux = </div><div class="line">          euler_numerical_flux&lt;dim&gt;(phi_m.get_value(q), </div><div class="line">                                    phi_p.get_value(q), </div><div class="line">                                    phi_m.get_normal_vector(q)); </div><div class="line">        phi_m.submit_value(-numerical_flux, q); </div><div class="line">      } </div><div class="line">  } </div><div class="line"><span class="keywordflow">else</span> </div><div class="line">  { </div></div><!-- fragment --><p>处理一个边界面。下面这几行代码是对 <a class="el" href="step_67.html">step-67</a> 中 <code>EulerDG::EulerOperator::local_apply_boundary_face</code> 函数的复制。</p>
<div class="fragment"><div class="line">  <span class="keywordflow">for</span> (<span class="keywordtype">unsigned</span> <span class="keywordtype">int</span> q = 0; q &lt; phi_m.n_q_points; ++q) </div><div class="line">    { </div><div class="line">      <span class="keyword">const</span> <span class="keyword">auto</span> w_m    = phi_m.get_value(q); </div><div class="line">      <span class="keyword">const</span> <span class="keyword">auto</span> normal = phi_m.get_normal_vector(q); </div><div class="line"></div><div class="line">      <span class="keyword">auto</span> rho_u_dot_n = w_m[1] * normal[0]; </div><div class="line">      <span class="keywordflow">for</span> (<span class="keywordtype">unsigned</span> <span class="keywordtype">int</span> d = 1; d &lt; dim; ++<a class="code" href="namespacePhysics_1_1Elasticity_1_1Kinematics.html#a15728437b942dab0b0042eb06a407d2c">d</a>) </div><div class="line">        rho_u_dot_n += w_m[1 + d] * normal[d]; </div><div class="line"></div><div class="line">      <span class="keywordtype">bool</span> at_outflow = <span class="keyword">false</span>; </div><div class="line"></div><div class="line">      <a class="code" href="classTensor.html">Tensor&lt;1, dim + 2, VectorizedArrayType&gt;</a> w_p; </div><div class="line"></div><div class="line">      <span class="keywordflow">if</span> (wall_boundaries.find(boundary_id) != </div><div class="line">          wall_boundaries.end()) </div><div class="line">        { </div><div class="line">          w_p[0] = w_m[0]; </div><div class="line">          <span class="keywordflow">for</span> (<span class="keywordtype">unsigned</span> <span class="keywordtype">int</span> d = 0; d &lt; dim; ++<a class="code" href="namespacePhysics_1_1Elasticity_1_1Kinematics.html#a15728437b942dab0b0042eb06a407d2c">d</a>) </div><div class="line">            w_p[d + 1] = </div><div class="line">              w_m[d + 1] - 2. * rho_u_dot_n * normal[d]; </div><div class="line">          w_p[dim + 1] = w_m[dim + 1]; </div><div class="line">        } </div><div class="line">      <span class="keywordflow">else</span> <span class="keywordflow">if</span> (inflow_boundaries.find(boundary_id) != </div><div class="line">               inflow_boundaries.end()) </div><div class="line">        w_p = evaluate_function( </div><div class="line">          *inflow_boundaries.find(boundary_id)-&gt;second, </div><div class="line">          phi_m.quadrature_point(q)); </div><div class="line">      <span class="keywordflow">else</span> <span class="keywordflow">if</span> (subsonic_outflow_boundaries.find( </div><div class="line">                 boundary_id) != </div><div class="line">               subsonic_outflow_boundaries.end()) </div><div class="line">        { </div><div class="line">          w_p = w_m; </div><div class="line">          w_p[dim + 1] = </div><div class="line">            evaluate_function(*subsonic_outflow_boundaries </div><div class="line">                                 .find(boundary_id) </div><div class="line">                                 -&gt;<a class="code" href="grid__out_8cc.html#a2cc229a4f1ffc75e83ed269d5f725729">second</a>, </div><div class="line">                              phi_m.quadrature_point(q), </div><div class="line">                              dim + 1); </div><div class="line">          at_outflow = <span class="keyword">true</span>; </div><div class="line">        } </div><div class="line">      <span class="keywordflow">else</span> </div><div class="line">        <a class="code" href="group__Exceptions.html#gafc0ca7ad85b3ebd64e8e51689ac85caf">AssertThrow</a>(<span class="keyword">false</span>, </div><div class="line">                    <a class="code" href="group__Exceptions.html#gae9a45f517af1401c50811a11083f9114">ExcMessage</a>( </div><div class="line">                      <span class="stringliteral">&quot;Unknown boundary id, did &quot;</span> </div><div class="line">                      <span class="stringliteral">&quot;you set a boundary condition for &quot;</span> </div><div class="line">                      <span class="stringliteral">&quot;this part of the domain boundary?&quot;</span>)); </div><div class="line"></div><div class="line">      <span class="keyword">auto</span> flux = euler_numerical_flux&lt;dim&gt;(w_m, w_p, normal); </div><div class="line"></div><div class="line">      <span class="keywordflow">if</span> (at_outflow) </div><div class="line">        <span class="keywordflow">for</span> (<span class="keywordtype">unsigned</span> <span class="keywordtype">int</span> v = 0; </div><div class="line">             v &lt; VectorizedArrayType::size(); </div><div class="line">             ++v) </div><div class="line">          { </div><div class="line">            <span class="keywordflow">if</span> (rho_u_dot_n[v] &lt; -1e-12) </div><div class="line">              <span class="keywordflow">for</span> (<span class="keywordtype">unsigned</span> <span class="keywordtype">int</span> d = 0; d &lt; dim; ++<a class="code" href="namespacePhysics_1_1Elasticity_1_1Kinematics.html#a15728437b942dab0b0042eb06a407d2c">d</a>) </div><div class="line">                flux[d + 1][v] = 0.; </div><div class="line">          } </div><div class="line"></div><div class="line">      phi_m.submit_value(-flux, q); </div><div class="line">    } </div><div class="line">} </div></div><!-- fragment --><p>通过正交评估与单元相关的局部积分，并通过简单的一维插值加入到单元贡献中。</p>
<div class="fragment"><div class="line">  <a class="code" href="structinternal_1_1FEFaceNormalEvaluationImpl.html">internal::FEFaceNormalEvaluationImpl</a>&lt;dim, </div><div class="line">                                       n_points_1d - 1, </div><div class="line">                                       VectorizedArrayType&gt;:: </div><div class="line">    template interpolate_quadrature&lt;false, true&gt;( </div><div class="line">      dim + 2, </div><div class="line">      data.get_shape_info(), </div><div class="line">      phi_m.begin_values(), </div><div class="line">      phi.begin_values(), </div><div class="line">      <span class="keyword">false</span>, </div><div class="line">      face); </div><div class="line">} </div></div><!-- fragment --><p>在单元格正交点中应用反质量矩阵。也请参见来自 <code>EulerDG::EulerOperator::local_apply_inverse_mass_matrix()</code> 的函数 <a class="el" href="step_67.html">step-67</a> 。</p>
<div class="fragment"><div class="line"><span class="keywordflow">for</span> (<span class="keywordtype">unsigned</span> <span class="keywordtype">int</span> q = 0; q &lt; phi.static_n_q_points; ++q) </div><div class="line">  { </div><div class="line">    <span class="keyword">const</span> <span class="keyword">auto</span> factor = VectorizedArrayType(1.0) / phi.<a class="code" href="classFEEvaluationBaseData.html#a56ed5a4e84edf92e69f1474d5f035a92">JxW</a>(q); </div><div class="line">    <span class="keywordflow">for</span> (<span class="keywordtype">unsigned</span> <span class="keywordtype">int</span> c = 0; c &lt; dim + 2; ++c) </div><div class="line">      phi.begin_values()[c * phi.static_n_q_points + q] = </div><div class="line">        phi.begin_values()[c * phi.static_n_q_points + q] * factor; </div><div class="line">  } </div></div><!-- fragment --><p>将数值从配位空间转换到原始高斯-洛巴托空间。</p>
<div class="fragment"><div class="line"><a class="code" href="structinternal_1_1FEEvaluationImplBasisChange.html">internal::FEEvaluationImplBasisChange</a>&lt; </div><div class="line">  <a class="code" href="group__CUDAWrappers.html#ggac8e56c1f8d3d4947aa030c9d14308a3bab70b25f96672253ddf82a276d3563956">::internal::EvaluatorVariant::evaluate_evenodd</a>, </div><div class="line">  <a class="code" href="namespaceinternal.html#aa5bef221c94bc6b9c5441c306a72cdbaa13fcf221bed4879f9b319347525f703b">internal::EvaluatorQuantity::hessian</a>, </div><div class="line">  dim, </div><div class="line">  degree + 1, </div><div class="line">  n_points_1d, </div><div class="line">  VectorizedArrayType, </div><div class="line">  VectorizedArrayType&gt;::do_backward(dim + 2, </div><div class="line">                                    data.get_shape_info() </div><div class="line">                                      .data[0] </div><div class="line">                                      .inverse_shape_values_eo, </div><div class="line">                                    <span class="keyword">false</span>, </div><div class="line">                                    phi.begin_values(), </div><div class="line">                                    phi.begin_dof_values()); </div></div><!-- fragment --><p>执行Runge-Kutta更新并将结果写回全局向量。</p>
<div class="fragment"><div class="line">          <span class="keywordflow">if</span> (ai == Number()) </div><div class="line">            { </div><div class="line">              <span class="keywordflow">for</span> (<span class="keywordtype">unsigned</span> <span class="keywordtype">int</span> q = 0; q &lt; phi.static_dofs_per_cell; ++q) </div><div class="line">                phi.begin_dof_values()[q] = bi * phi.begin_dof_values()[q]; </div><div class="line">              phi.distribute_local_to_global(solution); </div><div class="line">            } </div><div class="line">          <span class="keywordflow">else</span> </div><div class="line">            { </div><div class="line">              <span class="keywordflow">if</span> (stage != 0) </div><div class="line">                phi_temp.read_dof_values(solution); </div><div class="line"></div><div class="line">              <span class="keywordflow">for</span> (<span class="keywordtype">unsigned</span> <span class="keywordtype">int</span> q = 0; q &lt; phi.static_dofs_per_cell; ++q) </div><div class="line">                { </div><div class="line">                  <span class="keyword">const</span> <span class="keyword">auto</span> K_i = phi.begin_dof_values()[q]; </div><div class="line"></div><div class="line">                  phi.begin_dof_values()[q] = </div><div class="line">                    phi_temp.begin_dof_values()[q] + (ai * K_i); </div><div class="line"></div><div class="line">                  phi_temp.begin_dof_values()[q] += bi * K_i; </div><div class="line">                } </div><div class="line">              phi.set_dof_values(dst); </div><div class="line">              phi_temp.set_dof_values(solution); </div><div class="line">            } </div><div class="line">        } </div><div class="line">    }, </div><div class="line">    vec_ki, </div><div class="line">    current_ri, </div><div class="line">    <span class="keyword">true</span>, </div><div class="line">    <a class="code" href="classMatrixFree.html">MatrixFree&lt;dim, Number, VectorizedArrayType&gt;::DataAccessOnFaces::values</a>); </div><div class="line">} </div></div><!-- fragment --><p>从这里开始， <a class="el" href="step_67.html">step-67</a> 的代码没有改变。</p>
<div class="fragment"><div class="line">  <span class="keyword">template</span> &lt;<span class="keywordtype">int</span> dim, <span class="keywordtype">int</span> degree, <span class="keywordtype">int</span> n_po<span class="keywordtype">int</span>s_1d&gt; </div><div class="line">  <span class="keywordtype">void</span> EulerOperator&lt;dim, degree, n_points_1d&gt;::initialize_vector( </div><div class="line">    <a class="code" href="classLinearAlgebra_1_1distributed_1_1Vector.html">LinearAlgebra::distributed::Vector&lt;Number&gt;</a> &amp;vector)<span class="keyword"> const </span></div><div class="line"><span class="keyword">  </span>{ </div><div class="line">    data.initialize_dof_vector(vector); </div><div class="line">  } </div><div class="line"></div><div class="line">  <span class="keyword">template</span> &lt;<span class="keywordtype">int</span> dim, <span class="keywordtype">int</span> degree, <span class="keywordtype">int</span> n_po<span class="keywordtype">int</span>s_1d&gt; </div><div class="line">  <span class="keywordtype">void</span> EulerOperator&lt;dim, degree, n_points_1d&gt;::set_inflow_boundary( </div><div class="line">    <span class="keyword">const</span> <a class="code" href="classunsigned_01int.html">types::boundary_id</a>       boundary_id, </div><div class="line">    std::unique_ptr&lt;<a class="code" href="classFunction.html">Function&lt;dim&gt;</a>&gt; inflow_function) </div><div class="line">  { </div><div class="line">    <a class="code" href="group__Exceptions.html#gafc0ca7ad85b3ebd64e8e51689ac85caf">AssertThrow</a>(subsonic_outflow_boundaries.find(boundary_id) == </div><div class="line">                    subsonic_outflow_boundaries.end() &amp;&amp; </div><div class="line">                  wall_boundaries.find(boundary_id) == wall_boundaries.end(), </div><div class="line">                <a class="code" href="group__Exceptions.html#gae9a45f517af1401c50811a11083f9114">ExcMessage</a>(<span class="stringliteral">&quot;You already set the boundary with id &quot;</span> + </div><div class="line">                           <a class="code" href="namespacePatterns_1_1Tools.html#a72743302dcb1a0fb1f2f8dc5122d299e">std::to_string</a>(static_cast&lt;int&gt;(boundary_id)) + </div><div class="line">                           <span class="stringliteral">&quot; to another type of boundary before now setting &quot;</span> + </div><div class="line">                           <span class="stringliteral">&quot;it as inflow&quot;</span>)); </div><div class="line">    <a class="code" href="group__Exceptions.html#gafc0ca7ad85b3ebd64e8e51689ac85caf">AssertThrow</a>(inflow_function-&gt;n_components == dim + 2, </div><div class="line">                <a class="code" href="group__Exceptions.html#gae9a45f517af1401c50811a11083f9114">ExcMessage</a>(<span class="stringliteral">&quot;Expected function with dim+2 components&quot;</span>)); </div><div class="line"></div><div class="line">    inflow_boundaries[<a class="code" href="namespacetypes.html#aed8813fee8c8a2edcc6005e6a48c321a">boundary_id</a>] = std::move(inflow_function); </div><div class="line">  } </div><div class="line"></div><div class="line">  <span class="keyword">template</span> &lt;<span class="keywordtype">int</span> dim, <span class="keywordtype">int</span> degree, <span class="keywordtype">int</span> n_po<span class="keywordtype">int</span>s_1d&gt; </div><div class="line">  <span class="keywordtype">void</span> EulerOperator&lt;dim, degree, n_points_1d&gt;::set_subsonic_outflow_boundary( </div><div class="line">    <span class="keyword">const</span> <a class="code" href="classunsigned_01int.html">types::boundary_id</a>       boundary_id, </div><div class="line">    std::unique_ptr&lt;<a class="code" href="classFunction.html">Function&lt;dim&gt;</a>&gt; outflow_function) </div><div class="line">  { </div><div class="line">    <a class="code" href="group__Exceptions.html#gafc0ca7ad85b3ebd64e8e51689ac85caf">AssertThrow</a>(inflow_boundaries.find(boundary_id) == </div><div class="line">                    inflow_boundaries.end() &amp;&amp; </div><div class="line">                  wall_boundaries.find(boundary_id) == wall_boundaries.end(), </div><div class="line">                <a class="code" href="group__Exceptions.html#gae9a45f517af1401c50811a11083f9114">ExcMessage</a>(<span class="stringliteral">&quot;You already set the boundary with id &quot;</span> + </div><div class="line">                           <a class="code" href="namespacePatterns_1_1Tools.html#a72743302dcb1a0fb1f2f8dc5122d299e">std::to_string</a>(static_cast&lt;int&gt;(boundary_id)) + </div><div class="line">                           <span class="stringliteral">&quot; to another type of boundary before now setting &quot;</span> + </div><div class="line">                           <span class="stringliteral">&quot;it as subsonic outflow&quot;</span>)); </div><div class="line">    <a class="code" href="group__Exceptions.html#gafc0ca7ad85b3ebd64e8e51689ac85caf">AssertThrow</a>(outflow_function-&gt;n_components == dim + 2, </div><div class="line">                <a class="code" href="group__Exceptions.html#gae9a45f517af1401c50811a11083f9114">ExcMessage</a>(<span class="stringliteral">&quot;Expected function with dim+2 components&quot;</span>)); </div><div class="line"></div><div class="line">    subsonic_outflow_boundaries[<a class="code" href="namespacetypes.html#aed8813fee8c8a2edcc6005e6a48c321a">boundary_id</a>] = std::move(outflow_function); </div><div class="line">  } </div><div class="line"></div><div class="line">  <span class="keyword">template</span> &lt;<span class="keywordtype">int</span> dim, <span class="keywordtype">int</span> degree, <span class="keywordtype">int</span> n_po<span class="keywordtype">int</span>s_1d&gt; </div><div class="line">  <span class="keywordtype">void</span> EulerOperator&lt;dim, degree, n_points_1d&gt;::set_wall_boundary( </div><div class="line">    <span class="keyword">const</span> <a class="code" href="classunsigned_01int.html">types::boundary_id</a> boundary_id) </div><div class="line">  { </div><div class="line">    <a class="code" href="group__Exceptions.html#gafc0ca7ad85b3ebd64e8e51689ac85caf">AssertThrow</a>(inflow_boundaries.find(boundary_id) == </div><div class="line">                    inflow_boundaries.end() &amp;&amp; </div><div class="line">                  subsonic_outflow_boundaries.find(boundary_id) == </div><div class="line">                    subsonic_outflow_boundaries.end(), </div><div class="line">                <a class="code" href="group__Exceptions.html#gae9a45f517af1401c50811a11083f9114">ExcMessage</a>(<span class="stringliteral">&quot;You already set the boundary with id &quot;</span> + </div><div class="line">                           <a class="code" href="namespacePatterns_1_1Tools.html#a72743302dcb1a0fb1f2f8dc5122d299e">std::to_string</a>(static_cast&lt;int&gt;(boundary_id)) + </div><div class="line">                           <span class="stringliteral">&quot; to another type of boundary before now setting &quot;</span> + </div><div class="line">                           <span class="stringliteral">&quot;it as wall boundary&quot;</span>)); </div><div class="line"></div><div class="line">    wall_boundaries.insert(boundary_id); </div><div class="line">  } </div><div class="line"></div><div class="line">  <span class="keyword">template</span> &lt;<span class="keywordtype">int</span> dim, <span class="keywordtype">int</span> degree, <span class="keywordtype">int</span> n_po<span class="keywordtype">int</span>s_1d&gt; </div><div class="line">  <span class="keywordtype">void</span> EulerOperator&lt;dim, degree, n_points_1d&gt;::set_body_force( </div><div class="line">    std::unique_ptr&lt;<a class="code" href="classFunction.html">Function&lt;dim&gt;</a>&gt; body_force) </div><div class="line">  { </div><div class="line">    <a class="code" href="group__Exceptions.html#ga9442b63275c9ef3fab29bc222831c49c">AssertDimension</a>(body_force-&gt;n_components, dim); </div><div class="line"></div><div class="line">    this-&gt;body_force = std::move(body_force); </div><div class="line">  } </div><div class="line"></div><div class="line">  <span class="keyword">template</span> &lt;<span class="keywordtype">int</span> dim, <span class="keywordtype">int</span> degree, <span class="keywordtype">int</span> n_po<span class="keywordtype">int</span>s_1d&gt; </div><div class="line">  <span class="keywordtype">void</span> <a class="code" href="namespaceVectorTools.html#ac6b404bf03cb2a742b290421cc2789fe">EulerOperator&lt;dim, degree, n_points_1d&gt;::project</a>( </div><div class="line">    <span class="keyword">const</span> <a class="code" href="classFunction.html">Function&lt;dim&gt;</a> &amp;                       <span class="keyword">function</span>, </div><div class="line">    <a class="code" href="classLinearAlgebra_1_1distributed_1_1Vector.html">LinearAlgebra::distributed::Vector&lt;Number&gt;</a> &amp;solution)<span class="keyword"> const </span></div><div class="line"><span class="keyword">  </span>{ </div><div class="line">    <a class="code" href="classFEEvaluation.html">FEEvaluation&lt;dim, degree, degree + 1, dim + 2, Number, VectorizedArrayType&gt;</a> </div><div class="line">      phi(data, 0, 1); </div><div class="line">    <a class="code" href="classMatrixFreeOperators_1_1CellwiseInverseMassMatrix.html">MatrixFreeOperators::CellwiseInverseMassMatrix</a>&lt;dim, </div><div class="line">                                                   degree, </div><div class="line">                                                   dim + 2, </div><div class="line">                                                   Number, </div><div class="line">                                                   VectorizedArrayType&gt; </div><div class="line">      inverse(phi); </div><div class="line">    solution.<a class="code" href="classLinearAlgebra_1_1distributed_1_1Vector.html#a0242ed0c3e3664e6b4204d28a726a0b7">zero_out_ghost_values</a>(); </div><div class="line">    <span class="keywordflow">for</span> (<span class="keywordtype">unsigned</span> <span class="keywordtype">int</span> cell = 0; cell &lt; data.n_cell_batches(); ++cell) </div><div class="line">      { </div><div class="line">        phi.reinit(cell); </div><div class="line">        <span class="keywordflow">for</span> (<span class="keywordtype">unsigned</span> <span class="keywordtype">int</span> q = 0; q &lt; phi.n_q_points; ++q) </div><div class="line">          phi.submit_dof_value(evaluate_function(<span class="keyword">function</span>, </div><div class="line">                                                 phi.quadrature_point(q)), </div><div class="line">                               q); </div><div class="line">        inverse.transform_from_q_points_to_basis(dim + 2, </div><div class="line">                                                 phi.begin_dof_values(), </div><div class="line">                                                 phi.begin_dof_values()); </div><div class="line">        phi.set_dof_values(solution); </div><div class="line">      } </div><div class="line">  } </div><div class="line"></div><div class="line">  <span class="keyword">template</span> &lt;<span class="keywordtype">int</span> dim, <span class="keywordtype">int</span> degree, <span class="keywordtype">int</span> n_po<span class="keywordtype">int</span>s_1d&gt; </div><div class="line">  std::array&lt;double, 3&gt; EulerOperator&lt;dim, degree, n_points_1d&gt;::compute_errors( </div><div class="line">    <span class="keyword">const</span> <a class="code" href="classFunction.html">Function&lt;dim&gt;</a> &amp;                             <span class="keyword">function</span>, </div><div class="line">    <span class="keyword">const</span> <a class="code" href="classLinearAlgebra_1_1distributed_1_1Vector.html">LinearAlgebra::distributed::Vector&lt;Number&gt;</a> &amp;solution)<span class="keyword"> const </span></div><div class="line"><span class="keyword">  </span>{ </div><div class="line">    <a class="code" href="classTimerOutput_1_1Scope.html">TimerOutput::Scope</a> t(timer, <span class="stringliteral">&quot;compute errors&quot;</span>); </div><div class="line">    <span class="keywordtype">double</span>             errors_squared[3] = {}; </div><div class="line">    <a class="code" href="classFEEvaluation.html">FEEvaluation&lt;dim, degree, n_points_1d, dim + 2, Number, VectorizedArrayType&gt;</a> </div><div class="line">      phi(data, 0, 0); </div><div class="line"></div><div class="line">    <span class="keywordflow">for</span> (<span class="keywordtype">unsigned</span> <span class="keywordtype">int</span> cell = 0; cell &lt; data.n_cell_batches(); ++cell) </div><div class="line">      { </div><div class="line">        phi.reinit(cell); </div><div class="line">        phi.gather_evaluate(solution, <a class="code" href="namespaceEvaluationFlags.html#a9b7c6d689cb76386839d0d13640f59aeaf9825c682f693a6a200094641a0d6a58">EvaluationFlags::values</a>); </div><div class="line">        VectorizedArrayType local_errors_squared[3] = {}; </div><div class="line">        <span class="keywordflow">for</span> (<span class="keywordtype">unsigned</span> <span class="keywordtype">int</span> q = 0; q &lt; phi.n_q_points; ++q) </div><div class="line">          { </div><div class="line">            <span class="keyword">const</span> <span class="keyword">auto</span> error = </div><div class="line">              evaluate_function(<span class="keyword">function</span>, phi.quadrature_point(q)) - </div><div class="line">              phi.get_value(q); </div><div class="line">            <span class="keyword">const</span> <span class="keyword">auto</span> JxW = phi.JxW(q); </div><div class="line"></div><div class="line">            local_errors_squared[0] += error[0] * error[0] * JxW; </div><div class="line">            <span class="keywordflow">for</span> (<span class="keywordtype">unsigned</span> <span class="keywordtype">int</span> d = 0; d &lt; dim; ++<a class="code" href="namespacePhysics_1_1Elasticity_1_1Kinematics.html#a15728437b942dab0b0042eb06a407d2c">d</a>) </div><div class="line">              local_errors_squared[1] += (error[d + 1] * error[d + 1]) * JxW; </div><div class="line">            local_errors_squared[2] += (error[dim + 1] * error[dim + 1]) * JxW; </div><div class="line">          } </div><div class="line">        <span class="keywordflow">for</span> (<span class="keywordtype">unsigned</span> <span class="keywordtype">int</span> v = 0; v &lt; data.n_active_entries_per_cell_batch(cell); </div><div class="line">             ++v) </div><div class="line">          <span class="keywordflow">for</span> (<span class="keywordtype">unsigned</span> <span class="keywordtype">int</span> d = 0; d &lt; 3; ++<a class="code" href="namespacePhysics_1_1Elasticity_1_1Kinematics.html#a15728437b942dab0b0042eb06a407d2c">d</a>) </div><div class="line">            errors_squared[d] += local_errors_squared[d][v]; </div><div class="line">      } </div><div class="line"></div><div class="line">    <a class="code" href="namespaceUtilities_1_1MPI.html#ab544a3bf3301a6dd3e705ee352c5551b">Utilities::MPI::sum</a>(errors_squared, MPI_COMM_WORLD, errors_squared); </div><div class="line"></div><div class="line">    std::array&lt;double, 3&gt; errors; </div><div class="line">    <span class="keywordflow">for</span> (<span class="keywordtype">unsigned</span> <span class="keywordtype">int</span> d = 0; d &lt; 3; ++<a class="code" href="namespacePhysics_1_1Elasticity_1_1Kinematics.html#a15728437b942dab0b0042eb06a407d2c">d</a>) </div><div class="line">      errors[d] = std::sqrt(errors_squared[d]); </div><div class="line"></div><div class="line">    <span class="keywordflow">return</span> errors; </div><div class="line">  } </div><div class="line"></div><div class="line">  <span class="keyword">template</span> &lt;<span class="keywordtype">int</span> dim, <span class="keywordtype">int</span> degree, <span class="keywordtype">int</span> n_po<span class="keywordtype">int</span>s_1d&gt; </div><div class="line">  <span class="keywordtype">double</span> EulerOperator&lt;dim, degree, n_points_1d&gt;::compute_cell_transport_speed( </div><div class="line">    <span class="keyword">const</span> <a class="code" href="classLinearAlgebra_1_1distributed_1_1Vector.html">LinearAlgebra::distributed::Vector&lt;Number&gt;</a> &amp;solution)<span class="keyword"> const </span></div><div class="line"><span class="keyword">  </span>{ </div><div class="line">    <a class="code" href="classTimerOutput_1_1Scope.html">TimerOutput::Scope</a> t(timer, <span class="stringliteral">&quot;compute transport speed&quot;</span>); </div><div class="line">    Number             max_transport = 0; </div><div class="line">    <a class="code" href="classFEEvaluation.html">FEEvaluation&lt;dim, degree, degree + 1, dim + 2, Number, VectorizedArrayType&gt;</a> </div><div class="line">      phi(data, 0, 1); </div><div class="line"></div><div class="line">    <span class="keywordflow">for</span> (<span class="keywordtype">unsigned</span> <span class="keywordtype">int</span> cell = 0; cell &lt; data.n_cell_batches(); ++cell) </div><div class="line">      { </div><div class="line">        phi.reinit(cell); </div><div class="line">        phi.gather_evaluate(solution, <a class="code" href="namespaceEvaluationFlags.html#a9b7c6d689cb76386839d0d13640f59aeaf9825c682f693a6a200094641a0d6a58">EvaluationFlags::values</a>); </div><div class="line">        VectorizedArrayType local_max = 0.; </div><div class="line">        <span class="keywordflow">for</span> (<span class="keywordtype">unsigned</span> <span class="keywordtype">int</span> q = 0; q &lt; phi.n_q_points; ++q) </div><div class="line">          { </div><div class="line">            <span class="keyword">const</span> <span class="keyword">auto</span> solution = phi.get_value(q); </div><div class="line">            <span class="keyword">const</span> <span class="keyword">auto</span> velocity = euler_velocity&lt;dim&gt;(solution); </div><div class="line">            <span class="keyword">const</span> <span class="keyword">auto</span> pressure = euler_pressure&lt;dim&gt;(solution); </div><div class="line"></div><div class="line">            <span class="keyword">const</span> <span class="keyword">auto</span>          inverse_jacobian = phi.inverse_jacobian(q); </div><div class="line">            <span class="keyword">const</span> <span class="keyword">auto</span>          convective_speed = inverse_jacobian * velocity; </div><div class="line">            VectorizedArrayType convective_limit = 0.; </div><div class="line">            <span class="keywordflow">for</span> (<span class="keywordtype">unsigned</span> <span class="keywordtype">int</span> d = 0; d &lt; dim; ++<a class="code" href="namespacePhysics_1_1Elasticity_1_1Kinematics.html#a15728437b942dab0b0042eb06a407d2c">d</a>) </div><div class="line">              convective_limit = </div><div class="line">                <a class="code" href="namespaceVectorTools_1_1EvaluationFlags.html#ac6721740e24732d6afabcf28ddfc1ffda8e7f5b8545162dccd5ed717792bdf420">std::max</a>(convective_limit, std::abs(convective_speed[d])); </div><div class="line"></div><div class="line">            <span class="keyword">const</span> <span class="keyword">auto</span> speed_of_sound = </div><div class="line">              <a class="code" href="vectorization_8h.html#a303f564e3c189251976da401ee2e44fa">std::sqrt</a>(gamma * pressure * (1. / solution[0])); </div><div class="line"></div><div class="line">            <a class="code" href="classTensor.html">Tensor&lt;1, dim, VectorizedArrayType&gt;</a> eigenvector; </div><div class="line">            <span class="keywordflow">for</span> (<span class="keywordtype">unsigned</span> <span class="keywordtype">int</span> d = 0; d &lt; dim; ++<a class="code" href="namespacePhysics_1_1Elasticity_1_1Kinematics.html#a15728437b942dab0b0042eb06a407d2c">d</a>) </div><div class="line">              eigenvector[d] = 1.; </div><div class="line">            <span class="keywordflow">for</span> (<span class="keywordtype">unsigned</span> <span class="keywordtype">int</span> i = 0; i &lt; 5; ++i) </div><div class="line">              { </div><div class="line">                eigenvector = <a class="code" href="classDerivativeForm.html#a3c201452e8dd28e4f5be4a316cb9305f">transpose</a>(inverse_jacobian) * </div><div class="line">                              (inverse_jacobian * eigenvector); </div><div class="line">                VectorizedArrayType eigenvector_norm = 0.; </div><div class="line">                <span class="keywordflow">for</span> (<span class="keywordtype">unsigned</span> <span class="keywordtype">int</span> d = 0; d &lt; dim; ++<a class="code" href="namespacePhysics_1_1Elasticity_1_1Kinematics.html#a15728437b942dab0b0042eb06a407d2c">d</a>) </div><div class="line">                  eigenvector_norm = </div><div class="line">                    <a class="code" href="namespaceVectorTools_1_1EvaluationFlags.html#ac6721740e24732d6afabcf28ddfc1ffda8e7f5b8545162dccd5ed717792bdf420">std::max</a>(eigenvector_norm, std::abs(eigenvector[d])); </div><div class="line">                eigenvector /= eigenvector_norm; </div><div class="line">              } </div><div class="line">            <span class="keyword">const</span> <span class="keyword">auto</span> jac_times_ev   = inverse_jacobian * eigenvector; </div><div class="line">            <span class="keyword">const</span> <span class="keyword">auto</span> max_eigenvalue = <a class="code" href="vectorization_8h.html#a303f564e3c189251976da401ee2e44fa">std::sqrt</a>( </div><div class="line">              (jac_times_ev * jac_times_ev) / (eigenvector * eigenvector)); </div><div class="line">            local_max = </div><div class="line">              <a class="code" href="namespaceVectorTools_1_1EvaluationFlags.html#ac6721740e24732d6afabcf28ddfc1ffda8e7f5b8545162dccd5ed717792bdf420">std::max</a>(local_max, </div><div class="line">                       max_eigenvalue * speed_of_sound + convective_limit); </div><div class="line">          } </div><div class="line"></div><div class="line">        <span class="keywordflow">for</span> (<span class="keywordtype">unsigned</span> <span class="keywordtype">int</span> v = 0; v &lt; data.n_active_entries_per_cell_batch(cell); </div><div class="line">             ++v) </div><div class="line">          <span class="keywordflow">for</span> (<span class="keywordtype">unsigned</span> <span class="keywordtype">int</span> d = 0; d &lt; 3; ++<a class="code" href="namespacePhysics_1_1Elasticity_1_1Kinematics.html#a15728437b942dab0b0042eb06a407d2c">d</a>) </div><div class="line">            max_transport = <a class="code" href="namespaceVectorTools_1_1EvaluationFlags.html#ac6721740e24732d6afabcf28ddfc1ffda8e7f5b8545162dccd5ed717792bdf420">std::max</a>(max_transport, local_max[v]); </div><div class="line">      } </div><div class="line"></div><div class="line">    max_transport = <a class="code" href="namespaceUtilities_1_1MPI.html#ad2f716b789abe53715d6659f38aa7815">Utilities::MPI::max</a>(max_transport, MPI_COMM_WORLD); </div><div class="line"></div><div class="line">    <span class="keywordflow">return</span> max_transport; </div><div class="line">  } </div><div class="line"></div><div class="line">  <span class="keyword">template</span> &lt;<span class="keywordtype">int</span> dim&gt;</div><div class="line">  <span class="keyword">class </span>EulerProblem </div><div class="line">  { </div><div class="line">  <span class="keyword">public</span>: </div><div class="line">    EulerProblem(); </div><div class="line"></div><div class="line">    <span class="keywordtype">void</span> <a class="code" href="namespaceWorkStream_1_1internal_1_1tbb__no__coloring.html#a8673698a405bf47aa24002aeb6d76d70">run</a>(); </div><div class="line"></div><div class="line">  <span class="keyword">private</span>: </div><div class="line">    <span class="keywordtype">void</span> make_grid_and_dofs(); </div><div class="line"></div><div class="line">    <span class="keywordtype">void</span> output_results(<span class="keyword">const</span> <span class="keywordtype">unsigned</span> <span class="keywordtype">int</span> result_number); </div><div class="line"></div><div class="line">    <a class="code" href="classLinearAlgebra_1_1distributed_1_1Vector.html">LinearAlgebra::distributed::Vector&lt;Number&gt;</a> solution; </div><div class="line"></div><div class="line">    <a class="code" href="classConditionalOStream.html">ConditionalOStream</a> pcout;</div><div class="line"></div><div class="line"></div><div class="line"><span class="preprocessor">#ifdef DEAL_II_WITH_P4EST </span></div><div class="line">    <a class="code" href="classparallel_1_1distributed_1_1Triangulation.html">parallel::distributed::Triangulation&lt;dim&gt;</a> <a class="code" href="p4est__wrappers_8cc.html#ace00f2f80d9780ef9aa1007e1c22c6a4">triangulation</a>; </div><div class="line"><span class="preprocessor">#else </span></div><div class="line">    <a class="code" href="classTriangulation.html">Triangulation&lt;dim&gt;</a> <a class="code" href="p4est__wrappers_8cc.html#ace00f2f80d9780ef9aa1007e1c22c6a4">triangulation</a>; </div><div class="line"><span class="preprocessor">#endif </span></div><div class="line"></div><div class="line">    <a class="code" href="classFESystem.html">FESystem&lt;dim&gt;</a>        fe; </div><div class="line">    <a class="code" href="classMappingQGeneric.html">MappingQGeneric&lt;dim&gt;</a> mapping; </div><div class="line">    <a class="code" href="classDoFHandler.html">DoFHandler&lt;dim&gt;</a>      dof_handler; </div><div class="line"></div><div class="line">    <a class="code" href="classTimerOutput.html">TimerOutput</a> timer; </div><div class="line"></div><div class="line">    EulerOperator&lt;dim, fe_degree, n_q_points_1d&gt; euler_operator; </div><div class="line"></div><div class="line">    <span class="keywordtype">double</span> time, time_step; </div><div class="line"></div><div class="line">    <span class="keyword">class </span>Postprocessor : <span class="keyword">public</span> <a class="code" href="classDataPostprocessor.html">DataPostprocessor</a>&lt;dim&gt; </div><div class="line">    { </div><div class="line">    <span class="keyword">public</span>: </div><div class="line">      Postprocessor(); </div><div class="line"></div><div class="line">      <span class="keyword">virtual</span> <span class="keywordtype">void</span> evaluate_vector_field( </div><div class="line">        <span class="keyword">const</span> <a class="code" href="structDataPostprocessorInputs_1_1Vector.html">DataPostprocessorInputs::Vector&lt;dim&gt;</a> &amp;inputs, </div><div class="line">        std::vector&lt;Vector&lt;double&gt;&gt; &amp;computed_quantities) <span class="keyword">const override</span>; </div><div class="line"></div><div class="line">      <span class="keyword">virtual</span> std::vector&lt;std::string&gt; get_names() <span class="keyword">const override</span>; </div><div class="line"></div><div class="line">      <span class="keyword">virtual</span> std::vector&lt; </div><div class="line">        <a class="code" href="namespaceDataComponentInterpretation.html#a0cd2da3afe902f9004c23a73dbcc8ab0">DataComponentInterpretation::DataComponentInterpretation</a>&gt; </div><div class="line">      get_data_component_interpretation() <span class="keyword">const override</span>; </div><div class="line"></div><div class="line">      <span class="keyword">virtual</span> <a class="code" href="group__feaccess.html#gaa94b67d2fdcc390690c523f28019e52f">UpdateFlags</a> get_needed_update_flags() <span class="keyword">const override</span>; </div><div class="line"></div><div class="line">    <span class="keyword">private</span>: </div><div class="line">      <span class="keyword">const</span> <span class="keywordtype">bool</span> do_schlieren_plot; </div><div class="line">    }; </div><div class="line">  }; </div><div class="line"></div><div class="line">  <span class="keyword">template</span> &lt;<span class="keywordtype">int</span> dim&gt; </div><div class="line">  EulerProblem&lt;dim&gt;::Postprocessor::Postprocessor() </div><div class="line">    : do_schlieren_plot(dim == 2) </div><div class="line">  {} </div><div class="line"></div><div class="line">  <span class="keyword">template</span> &lt;<span class="keywordtype">int</span> dim&gt; </div><div class="line">  <span class="keywordtype">void</span> EulerProblem&lt;dim&gt;::Postprocessor::evaluate_vector_field( </div><div class="line">    <span class="keyword">const</span> <a class="code" href="structDataPostprocessorInputs_1_1Vector.html">DataPostprocessorInputs::Vector&lt;dim&gt;</a> &amp;inputs, </div><div class="line">    std::vector&lt;Vector&lt;double&gt;&gt; &amp;               computed_quantities)<span class="keyword"> const </span></div><div class="line"><span class="keyword">  </span>{ </div><div class="line">    <span class="keyword">const</span> <span class="keywordtype">unsigned</span> <span class="keywordtype">int</span> n_evaluation_points = inputs.<a class="code" href="structDataPostprocessorInputs_1_1Vector.html#a8e034ae97f0447fb541bdb8ad0a4f599">solution_values</a>.size(); </div><div class="line"></div><div class="line">    <span class="keywordflow">if</span> (do_schlieren_plot == <span class="keyword">true</span>) </div><div class="line">      <a class="code" href="group__Exceptions.html#ga70a0bb353656e704acf927945277bbc6">Assert</a>(inputs.<a class="code" href="structDataPostprocessorInputs_1_1Vector.html#ac96fb295c3c807f96021bae734e8c3c3">solution_gradients</a>.size() == n_evaluation_points, </div><div class="line">             <a class="code" href="group__Exceptions.html#ga31978c026b8b6b5116df30b8e748f6b7">ExcInternalError</a>()); </div><div class="line"></div><div class="line">    <a class="code" href="group__Exceptions.html#ga70a0bb353656e704acf927945277bbc6">Assert</a>(computed_quantities.size() == n_evaluation_points, </div><div class="line">           <a class="code" href="group__Exceptions.html#ga31978c026b8b6b5116df30b8e748f6b7">ExcInternalError</a>()); </div><div class="line">    <a class="code" href="group__Exceptions.html#ga70a0bb353656e704acf927945277bbc6">Assert</a>(inputs.<a class="code" href="structDataPostprocessorInputs_1_1Vector.html#a8e034ae97f0447fb541bdb8ad0a4f599">solution_values</a>[0].size() == dim + 2, <a class="code" href="group__Exceptions.html#ga31978c026b8b6b5116df30b8e748f6b7">ExcInternalError</a>()); </div><div class="line">    <a class="code" href="group__Exceptions.html#ga70a0bb353656e704acf927945277bbc6">Assert</a>(computed_quantities[0].size() == </div><div class="line">             dim + 2 + (do_schlieren_plot == <span class="keyword">true</span> ? 1 : 0), </div><div class="line">           <a class="code" href="group__Exceptions.html#ga31978c026b8b6b5116df30b8e748f6b7">ExcInternalError</a>()); </div><div class="line"></div><div class="line">    <span class="keywordflow">for</span> (<span class="keywordtype">unsigned</span> <span class="keywordtype">int</span> q = 0; q &lt; n_evaluation_points; ++q) </div><div class="line">      { </div><div class="line">        <a class="code" href="classTensor.html">Tensor&lt;1, dim + 2&gt;</a> solution; </div><div class="line">        <span class="keywordflow">for</span> (<span class="keywordtype">unsigned</span> <span class="keywordtype">int</span> d = 0; d &lt; dim + 2; ++<a class="code" href="namespacePhysics_1_1Elasticity_1_1Kinematics.html#a15728437b942dab0b0042eb06a407d2c">d</a>) </div><div class="line">          solution[d] = inputs.<a class="code" href="structDataPostprocessorInputs_1_1Vector.html#a8e034ae97f0447fb541bdb8ad0a4f599">solution_values</a>[q](d); </div><div class="line"></div><div class="line">        <span class="keyword">const</span> <span class="keywordtype">double</span>         density  = solution[0]; </div><div class="line">        <span class="keyword">const</span> <a class="code" href="classTensor.html">Tensor&lt;1, dim&gt;</a> velocity = euler_velocity&lt;dim&gt;(solution); </div><div class="line">        <span class="keyword">const</span> <span class="keywordtype">double</span>         pressure = euler_pressure&lt;dim&gt;(solution); </div><div class="line"></div><div class="line">        <span class="keywordflow">for</span> (<span class="keywordtype">unsigned</span> <span class="keywordtype">int</span> d = 0; d &lt; dim; ++<a class="code" href="namespacePhysics_1_1Elasticity_1_1Kinematics.html#a15728437b942dab0b0042eb06a407d2c">d</a>) </div><div class="line">          computed_quantities[q](d) = velocity[<a class="code" href="namespacePhysics_1_1Elasticity_1_1Kinematics.html#a15728437b942dab0b0042eb06a407d2c">d</a>]; </div><div class="line">        computed_quantities[q](dim)     = pressure; </div><div class="line">        computed_quantities[q](dim + 1) = std::sqrt(gamma * pressure / density); </div><div class="line"></div><div class="line">        <span class="keywordflow">if</span> (do_schlieren_plot == <span class="keyword">true</span>) </div><div class="line">          computed_quantities[q](dim + 2) = </div><div class="line">            inputs.<a class="code" href="structDataPostprocessorInputs_1_1Vector.html#ac96fb295c3c807f96021bae734e8c3c3">solution_gradients</a>[q][0] * inputs.<a class="code" href="structDataPostprocessorInputs_1_1Vector.html#ac96fb295c3c807f96021bae734e8c3c3">solution_gradients</a>[q][0]; </div><div class="line">      } </div><div class="line">  } </div><div class="line"></div><div class="line">  <span class="keyword">template</span> &lt;<span class="keywordtype">int</span> dim&gt; </div><div class="line">  std::vector&lt;std::string&gt; EulerProblem&lt;dim&gt;::Postprocessor::get_names()<span class="keyword"> const </span></div><div class="line"><span class="keyword">  </span>{ </div><div class="line">    std::vector&lt;std::string&gt; names; </div><div class="line">    <span class="keywordflow">for</span> (<span class="keywordtype">unsigned</span> <span class="keywordtype">int</span> d = 0; d &lt; dim; ++<a class="code" href="namespacePhysics_1_1Elasticity_1_1Kinematics.html#a15728437b942dab0b0042eb06a407d2c">d</a>) </div><div class="line">      names.emplace_back(<span class="stringliteral">&quot;velocity&quot;</span>); </div><div class="line">    names.emplace_back(<span class="stringliteral">&quot;pressure&quot;</span>); </div><div class="line">    names.emplace_back(<span class="stringliteral">&quot;speed_of_sound&quot;</span>); </div><div class="line"></div><div class="line">    <span class="keywordflow">if</span> (do_schlieren_plot == <span class="keyword">true</span>) </div><div class="line">      names.emplace_back(<span class="stringliteral">&quot;schlieren_plot&quot;</span>); </div><div class="line"></div><div class="line">    <span class="keywordflow">return</span> names; </div><div class="line">  } </div><div class="line"></div><div class="line">  <span class="keyword">template</span> &lt;<span class="keywordtype">int</span> dim&gt; </div><div class="line">  std::vector&lt;DataComponentInterpretation::DataComponentInterpretation&gt; </div><div class="line">  EulerProblem&lt;dim&gt;::Postprocessor::get_data_component_interpretation()<span class="keyword"> const </span></div><div class="line"><span class="keyword">  </span>{ </div><div class="line">    std::vector&lt;DataComponentInterpretation::DataComponentInterpretation&gt; </div><div class="line">      interpretation; </div><div class="line">    <span class="keywordflow">for</span> (<span class="keywordtype">unsigned</span> <span class="keywordtype">int</span> d = 0; d &lt; dim; ++<a class="code" href="namespacePhysics_1_1Elasticity_1_1Kinematics.html#a15728437b942dab0b0042eb06a407d2c">d</a>) </div><div class="line">      interpretation.push_back( </div><div class="line">        <a class="code" href="namespaceDataComponentInterpretation.html#a0cd2da3afe902f9004c23a73dbcc8ab0aa783915dbc182d5a49e111815fd23fe0">DataComponentInterpretation::component_is_part_of_vector</a>); </div><div class="line">    interpretation.push_back(<a class="code" href="namespaceDataComponentInterpretation.html#a0cd2da3afe902f9004c23a73dbcc8ab0a1f3cd50135818a6458f1d3ff7ea4bb51">DataComponentInterpretation::component_is_scalar</a>); </div><div class="line">    interpretation.push_back(<a class="code" href="namespaceDataComponentInterpretation.html#a0cd2da3afe902f9004c23a73dbcc8ab0a1f3cd50135818a6458f1d3ff7ea4bb51">DataComponentInterpretation::component_is_scalar</a>); </div><div class="line"></div><div class="line">    <span class="keywordflow">if</span> (do_schlieren_plot == <span class="keyword">true</span>) </div><div class="line">      interpretation.push_back( </div><div class="line">        <a class="code" href="namespaceDataComponentInterpretation.html#a0cd2da3afe902f9004c23a73dbcc8ab0a1f3cd50135818a6458f1d3ff7ea4bb51">DataComponentInterpretation::component_is_scalar</a>); </div><div class="line"></div><div class="line">    <span class="keywordflow">return</span> interpretation; </div><div class="line">  } </div><div class="line"></div><div class="line">  <span class="keyword">template</span> &lt;<span class="keywordtype">int</span> dim&gt; </div><div class="line">  <a class="code" href="group__feaccess.html#gaa94b67d2fdcc390690c523f28019e52f">UpdateFlags</a> EulerProblem&lt;dim&gt;::Postprocessor::get_needed_update_flags()<span class="keyword"> const </span></div><div class="line"><span class="keyword">  </span>{ </div><div class="line">    <span class="keywordflow">if</span> (do_schlieren_plot == <span class="keyword">true</span>) </div><div class="line">      <span class="keywordflow">return</span> <a class="code" href="group__feaccess.html#ggaa94b67d2fdcc390690c523f28019e52fa4057ca2f127aa619c65886a9d3ad4aea">update_values</a> | <a class="code" href="group__feaccess.html#ggaa94b67d2fdcc390690c523f28019e52facbcc430975fa6af05f75ca786dc6fe20">update_gradients</a>; </div><div class="line">    <span class="keywordflow">else</span> </div><div class="line">      <span class="keywordflow">return</span> <a class="code" href="group__feaccess.html#ggaa94b67d2fdcc390690c523f28019e52fa4057ca2f127aa619c65886a9d3ad4aea">update_values</a>; </div><div class="line">  } </div><div class="line"></div><div class="line">  <span class="keyword">template</span> &lt;<span class="keywordtype">int</span> dim&gt; </div><div class="line">  EulerProblem&lt;dim&gt;::EulerProblem() </div><div class="line">    : pcout(<a class="code" href="namespacestd.html">std</a>::cout, <a class="code" href="namespaceUtilities.html">Utilities</a>::MPI::<a class="code" href="namespaceUtilities_1_1MPI.html#a895dcd8223a0ee6f0e6a80b80e2d5982">this_mpi_process</a>(MPI_COMM_WORLD) == 0) </div><div class="line">#ifdef DEAL_II_WITH_P4EST </div><div class="line">    , triangulation(MPI_COMM_WORLD) </div><div class="line">#endif </div><div class="line">    , fe(<a class="code" href="classFE__DGQ.html">FE_DGQ</a>&lt;dim&gt;(fe_degree), dim + 2) </div><div class="line">    , mapping(fe_degree) </div><div class="line">    , dof_handler(triangulation) </div><div class="line">    , timer(pcout, <a class="code" href="classTimerOutput.html">TimerOutput</a>::never, <a class="code" href="classTimerOutput.html">TimerOutput</a>::wall_times) </div><div class="line">    , euler_operator(timer) </div><div class="line">    , time(0) </div><div class="line">    , time_step(0) </div><div class="line">  {} </div><div class="line"></div><div class="line">  <span class="keyword">template</span> &lt;<span class="keywordtype">int</span> dim&gt; </div><div class="line">  <span class="keywordtype">void</span> EulerProblem&lt;dim&gt;::make_grid_and_dofs() </div><div class="line">  { </div><div class="line">    <span class="keywordflow">switch</span> (testcase) </div><div class="line">      { </div><div class="line">        <span class="keywordflow">case</span> 0: </div><div class="line">          { </div><div class="line">            <a class="code" href="classPoint.html">Point&lt;dim&gt;</a> lower_left; </div><div class="line">            <span class="keywordflow">for</span> (<span class="keywordtype">unsigned</span> <span class="keywordtype">int</span> d = 1; d &lt; dim; ++<a class="code" href="namespacePhysics_1_1Elasticity_1_1Kinematics.html#a15728437b942dab0b0042eb06a407d2c">d</a>) </div><div class="line">              lower_left[d] = -5; </div><div class="line"></div><div class="line">            <a class="code" href="classPoint.html">Point&lt;dim&gt;</a> upper_right; </div><div class="line">            upper_right[0] = 10; </div><div class="line">            <span class="keywordflow">for</span> (<span class="keywordtype">unsigned</span> <span class="keywordtype">int</span> d = 1; d &lt; dim; ++<a class="code" href="namespacePhysics_1_1Elasticity_1_1Kinematics.html#a15728437b942dab0b0042eb06a407d2c">d</a>) </div><div class="line">              upper_right[d] = 5; </div><div class="line"></div><div class="line">            <a class="code" href="namespaceGridGenerator.html#a56019d263ae45708302d5d7599f0d458">GridGenerator::hyper_rectangle</a>(triangulation, </div><div class="line">                                           lower_left, </div><div class="line">                                           upper_right); </div><div class="line">            triangulation.refine_global(2); </div><div class="line"></div><div class="line">            euler_operator.set_inflow_boundary( </div><div class="line">              0, std::make_unique&lt;ExactSolution&lt;dim&gt;&gt;(0)); </div><div class="line"></div><div class="line">            <span class="keywordflow">break</span>; </div><div class="line">          } </div><div class="line"></div><div class="line">        <span class="keywordflow">case</span> 1: </div><div class="line">          { </div><div class="line">            <a class="code" href="namespaceGridGenerator.html#a9d0b8a34fe5ca58425aa1fcf0d6132f1">GridGenerator::channel_with_cylinder</a>( </div><div class="line">              triangulation, 0.03, 1, 0, <span class="keyword">true</span>); </div><div class="line"></div><div class="line">            euler_operator.set_inflow_boundary( </div><div class="line">              0, std::make_unique&lt;ExactSolution&lt;dim&gt;&gt;(0)); </div><div class="line">            euler_operator.set_subsonic_outflow_boundary( </div><div class="line">              1, std::make_unique&lt;ExactSolution&lt;dim&gt;&gt;(0)); </div><div class="line"></div><div class="line">            euler_operator.set_wall_boundary(2); </div><div class="line">            euler_operator.set_wall_boundary(3); </div><div class="line"></div><div class="line">            <span class="keywordflow">if</span> (dim == 3) </div><div class="line">              euler_operator.set_body_force( </div><div class="line">                std::make_unique&lt;<a class="code" href="classFunctions_1_1ConstantFunction.html">Functions::ConstantFunction&lt;dim&gt;</a>&gt;( </div><div class="line">                  std::vector&lt;double&gt;({0., 0., -0.2}))); </div><div class="line"></div><div class="line">            <span class="keywordflow">break</span>; </div><div class="line">          } </div><div class="line"></div><div class="line">        <span class="keywordflow">default</span>: </div><div class="line">          <a class="code" href="group__Exceptions.html#ga70a0bb353656e704acf927945277bbc6">Assert</a>(<span class="keyword">false</span>, <a class="code" href="group__Exceptions.html#ga7b52b286796c23ef9ff178faf7a4b68f">ExcNotImplemented</a>()); </div><div class="line">      } </div><div class="line"></div><div class="line">    triangulation.refine_global(n_global_refinements); </div><div class="line"></div><div class="line">    dof_handler.<a class="code" href="classDoFHandler.html#a553ca864aaf70330d9be86bc78f36d1e">distribute_dofs</a>(fe); </div><div class="line"></div><div class="line">    euler_operator.reinit(mapping, dof_handler); </div><div class="line">    euler_operator.initialize_vector(solution); </div><div class="line"></div><div class="line">    std::locale s = pcout.<a class="code" href="classConditionalOStream.html#a1f3eaad6ae78462bf20c05fe95cb710f">get_stream</a>().getloc(); </div><div class="line">    pcout.<a class="code" href="classConditionalOStream.html#a1f3eaad6ae78462bf20c05fe95cb710f">get_stream</a>().imbue(std::locale(<span class="stringliteral">&quot;&quot;</span>)); </div><div class="line">    pcout &lt;&lt; <span class="stringliteral">&quot;Number of degrees of freedom: &quot;</span> &lt;&lt; dof_handler.<a class="code" href="classDoFHandler.html#aa5b8d3c4b9deb0774dde5c2851e07e1e">n_dofs</a>() </div><div class="line">          &lt;&lt; <span class="stringliteral">&quot; ( = &quot;</span> &lt;&lt; (dim + 2) &lt;&lt; <span class="stringliteral">&quot; [vars] x &quot;</span> </div><div class="line">          &lt;&lt; triangulation.n_global_active_cells() &lt;&lt; <span class="stringliteral">&quot; [cells] x &quot;</span> </div><div class="line">          &lt;&lt; <a class="code" href="namespaceUtilities.html#a0900f35b37ee122e73fb2c80bba9beb9">Utilities::pow</a>(fe_degree + 1, dim) &lt;&lt; <span class="stringliteral">&quot; [dofs/cell/var] )&quot;</span> </div><div class="line">          &lt;&lt; std::endl; </div><div class="line">    pcout.<a class="code" href="classConditionalOStream.html#a1f3eaad6ae78462bf20c05fe95cb710f">get_stream</a>().imbue(s); </div><div class="line">  } </div><div class="line"></div><div class="line">  <span class="keyword">template</span> &lt;<span class="keywordtype">int</span> dim&gt; </div><div class="line">  <span class="keywordtype">void</span> EulerProblem&lt;dim&gt;::output_results(<span class="keyword">const</span> <span class="keywordtype">unsigned</span> <span class="keywordtype">int</span> result_number) </div><div class="line">  { </div><div class="line">    <span class="keyword">const</span> std::array&lt;double, 3&gt; errors = </div><div class="line">      euler_operator.compute_errors(ExactSolution&lt;dim&gt;(time), solution); </div><div class="line">    <span class="keyword">const</span> std::string quantity_name = testcase == 0 ? <span class="stringliteral">&quot;error&quot;</span> : <span class="stringliteral">&quot;norm&quot;</span>; </div><div class="line"></div><div class="line">    pcout &lt;&lt; <span class="stringliteral">&quot;Time:&quot;</span> &lt;&lt; std::setw(8) &lt;&lt; std::setprecision(3) &lt;&lt; time </div><div class="line">          &lt;&lt; <span class="stringliteral">&quot;, dt: &quot;</span> &lt;&lt; std::setw(8) &lt;&lt; std::setprecision(2) &lt;&lt; time_step </div><div class="line">          &lt;&lt; <span class="stringliteral">&quot;, &quot;</span> &lt;&lt; quantity_name &lt;&lt; <span class="stringliteral">&quot; rho: &quot;</span> &lt;&lt; std::setprecision(4) </div><div class="line">          &lt;&lt; std::setw(10) &lt;&lt; errors[0] &lt;&lt; <span class="stringliteral">&quot;, rho * u: &quot;</span> &lt;&lt; std::setprecision(4) </div><div class="line">          &lt;&lt; std::setw(10) &lt;&lt; errors[1] &lt;&lt; <span class="stringliteral">&quot;, energy:&quot;</span> &lt;&lt; std::setprecision(4) </div><div class="line">          &lt;&lt; std::setw(10) &lt;&lt; errors[2] &lt;&lt; std::endl; </div><div class="line"></div><div class="line">    { </div><div class="line">      <a class="code" href="classTimerOutput_1_1Scope.html">TimerOutput::Scope</a> t(timer, <span class="stringliteral">&quot;output&quot;</span>); </div><div class="line"></div><div class="line">      Postprocessor postprocessor; </div><div class="line">      <a class="code" href="classDataOut.html">DataOut&lt;dim&gt;</a>  data_out; </div><div class="line"></div><div class="line">      <a class="code" href="structDataOutBase_1_1VtkFlags.html">DataOutBase::VtkFlags</a> flags; </div><div class="line">      flags.<a class="code" href="structDataOutBase_1_1VtkFlags.html#aa9dd1830c0ff35a2431704c4d45453eb">write_higher_order_cells</a> = <span class="keyword">true</span>; </div><div class="line">      data_out.<a class="code" href="classDataOutInterface.html#ac7280a24690b117454acfb0fa058299c">set_flags</a>(flags); </div><div class="line"></div><div class="line">      data_out.<a class="code" href="classDataOut__DoFData.html#a6ed7c846331069f406b8c9933c37fda4">attach_dof_handler</a>(dof_handler); </div><div class="line">      { </div><div class="line">        std::vector&lt;std::string&gt; names; </div><div class="line">        names.emplace_back(<span class="stringliteral">&quot;density&quot;</span>); </div><div class="line">        <span class="keywordflow">for</span> (<span class="keywordtype">unsigned</span> <span class="keywordtype">int</span> d = 0; d &lt; dim; ++<a class="code" href="namespacePhysics_1_1Elasticity_1_1Kinematics.html#a15728437b942dab0b0042eb06a407d2c">d</a>) </div><div class="line">          names.emplace_back(<span class="stringliteral">&quot;momentum&quot;</span>); </div><div class="line">        names.emplace_back(<span class="stringliteral">&quot;energy&quot;</span>); </div><div class="line"></div><div class="line">        std::vector&lt;DataComponentInterpretation::DataComponentInterpretation&gt; </div><div class="line">          interpretation; </div><div class="line">        interpretation.push_back( </div><div class="line">          <a class="code" href="namespaceDataComponentInterpretation.html#a0cd2da3afe902f9004c23a73dbcc8ab0a1f3cd50135818a6458f1d3ff7ea4bb51">DataComponentInterpretation::component_is_scalar</a>); </div><div class="line">        <span class="keywordflow">for</span> (<span class="keywordtype">unsigned</span> <span class="keywordtype">int</span> d = 0; d &lt; dim; ++<a class="code" href="namespacePhysics_1_1Elasticity_1_1Kinematics.html#a15728437b942dab0b0042eb06a407d2c">d</a>) </div><div class="line">          interpretation.push_back( </div><div class="line">            <a class="code" href="namespaceDataComponentInterpretation.html#a0cd2da3afe902f9004c23a73dbcc8ab0aa783915dbc182d5a49e111815fd23fe0">DataComponentInterpretation::component_is_part_of_vector</a>); </div><div class="line">        interpretation.push_back( </div><div class="line">          <a class="code" href="namespaceDataComponentInterpretation.html#a0cd2da3afe902f9004c23a73dbcc8ab0a1f3cd50135818a6458f1d3ff7ea4bb51">DataComponentInterpretation::component_is_scalar</a>); </div><div class="line"></div><div class="line">        data_out.<a class="code" href="classDataOut__DoFData.html#a79cbe2f02f8dfb85026c71d783dbb703">add_data_vector</a>(dof_handler, solution, names, interpretation); </div><div class="line">      } </div><div class="line">      data_out.<a class="code" href="classDataOut__DoFData.html#a79cbe2f02f8dfb85026c71d783dbb703">add_data_vector</a>(solution, postprocessor); </div><div class="line"></div><div class="line">      <a class="code" href="classLinearAlgebra_1_1distributed_1_1Vector.html">LinearAlgebra::distributed::Vector&lt;Number&gt;</a> reference; </div><div class="line">      <span class="keywordflow">if</span> (testcase == 0 &amp;&amp; dim == 2) </div><div class="line">        { </div><div class="line">          reference.<a class="code" href="classLinearAlgebra_1_1distributed_1_1Vector.html#ace027311492ed2f6e07fbd74d723e3a9">reinit</a>(solution); </div><div class="line">          euler_operator.project(ExactSolution&lt;dim&gt;(time), reference); </div><div class="line">          reference.<a class="code" href="classLinearAlgebra_1_1distributed_1_1Vector.html#aa6376a098589519491fc452d1529f57b">sadd</a>(-1., 1, solution); </div><div class="line">          std::vector&lt;std::string&gt; names; </div><div class="line">          names.emplace_back(<span class="stringliteral">&quot;error_density&quot;</span>); </div><div class="line">          <span class="keywordflow">for</span> (<span class="keywordtype">unsigned</span> <span class="keywordtype">int</span> d = 0; d &lt; dim; ++<a class="code" href="namespacePhysics_1_1Elasticity_1_1Kinematics.html#a15728437b942dab0b0042eb06a407d2c">d</a>) </div><div class="line">            names.emplace_back(<span class="stringliteral">&quot;error_momentum&quot;</span>); </div><div class="line">          names.emplace_back(<span class="stringliteral">&quot;error_energy&quot;</span>); </div><div class="line"></div><div class="line">          std::vector&lt;DataComponentInterpretation::DataComponentInterpretation&gt; </div><div class="line">            interpretation; </div><div class="line">          interpretation.push_back( </div><div class="line">            <a class="code" href="namespaceDataComponentInterpretation.html#a0cd2da3afe902f9004c23a73dbcc8ab0a1f3cd50135818a6458f1d3ff7ea4bb51">DataComponentInterpretation::component_is_scalar</a>); </div><div class="line">          <span class="keywordflow">for</span> (<span class="keywordtype">unsigned</span> <span class="keywordtype">int</span> d = 0; d &lt; dim; ++<a class="code" href="namespacePhysics_1_1Elasticity_1_1Kinematics.html#a15728437b942dab0b0042eb06a407d2c">d</a>) </div><div class="line">            interpretation.push_back( </div><div class="line">              <a class="code" href="namespaceDataComponentInterpretation.html#a0cd2da3afe902f9004c23a73dbcc8ab0aa783915dbc182d5a49e111815fd23fe0">DataComponentInterpretation::component_is_part_of_vector</a>); </div><div class="line">          interpretation.push_back( </div><div class="line">            <a class="code" href="namespaceDataComponentInterpretation.html#a0cd2da3afe902f9004c23a73dbcc8ab0a1f3cd50135818a6458f1d3ff7ea4bb51">DataComponentInterpretation::component_is_scalar</a>); </div><div class="line"></div><div class="line">          data_out.<a class="code" href="classDataOut__DoFData.html#a79cbe2f02f8dfb85026c71d783dbb703">add_data_vector</a>(dof_handler, </div><div class="line">                                   reference, </div><div class="line">                                   names, </div><div class="line">                                   interpretation); </div><div class="line">        } </div><div class="line"></div><div class="line">      Vector&lt;double&gt; mpi_owner(triangulation.n_active_cells()); </div><div class="line">      mpi_owner = <a class="code" href="namespaceUtilities_1_1MPI.html#a895dcd8223a0ee6f0e6a80b80e2d5982">Utilities::MPI::this_mpi_process</a>(MPI_COMM_WORLD); </div><div class="line">      data_out.<a class="code" href="classDataOut__DoFData.html#a79cbe2f02f8dfb85026c71d783dbb703">add_data_vector</a>(mpi_owner, <span class="stringliteral">&quot;owner&quot;</span>); </div><div class="line"></div><div class="line">      data_out.<a class="code" href="classDataOut.html#a087f63e22f0614bca326dbdca288c646">build_patches</a>(mapping, </div><div class="line">                             fe.degree, </div><div class="line">                             <a class="code" href="classDataOut.html">DataOut&lt;dim&gt;::curved_inner_cells</a>); </div><div class="line"></div><div class="line">      <span class="keyword">const</span> std::string filename = </div><div class="line">        <span class="stringliteral">&quot;solution_&quot;</span> + <a class="code" href="namespaceUtilities.html#a6195c5f009ea8c7c536c6ffdf108c32f">Utilities::int_to_string</a>(result_number, 3) + <span class="stringliteral">&quot;.vtu&quot;</span>; </div><div class="line">      data_out.<a class="code" href="classDataOutInterface.html#a5df488dad82b811ceb08cb1adf9eafcd">write_vtu_in_parallel</a>(filename, MPI_COMM_WORLD); </div><div class="line">    } </div><div class="line">  } </div><div class="line"></div><div class="line">  <span class="keyword">template</span> &lt;<span class="keywordtype">int</span> dim&gt; </div><div class="line">  <span class="keywordtype">void</span> <a class="code" href="namespaceWorkStream_1_1internal_1_1tbb__no__coloring.html#a8673698a405bf47aa24002aeb6d76d70">EulerProblem&lt;dim&gt;::run</a>() </div><div class="line">  { </div><div class="line">    { </div><div class="line">      <span class="keyword">const</span> <span class="keywordtype">unsigned</span> <span class="keywordtype">int</span> n_vect_number = VectorizedArrayType::size(); </div><div class="line">      <span class="keyword">const</span> <span class="keywordtype">unsigned</span> <span class="keywordtype">int</span> n_vect_bits   = 8 * <span class="keyword">sizeof</span>(Number) * n_vect_number; </div><div class="line"></div><div class="line">      pcout &lt;&lt; <span class="stringliteral">&quot;Running with &quot;</span> </div><div class="line">            &lt;&lt; <a class="code" href="namespaceUtilities_1_1MPI.html#ac26de0c059200523177bb1d92cc25d00">Utilities::MPI::n_mpi_processes</a>(MPI_COMM_WORLD) </div><div class="line">            &lt;&lt; <span class="stringliteral">&quot; MPI processes&quot;</span> &lt;&lt; std::endl; </div><div class="line">      pcout &lt;&lt; <span class="stringliteral">&quot;Vectorization over &quot;</span> &lt;&lt; n_vect_number &lt;&lt; <span class="stringliteral">&quot; &quot;</span> </div><div class="line">            &lt;&lt; (std::is_same&lt;Number, double&gt;::value ? <span class="stringliteral">&quot;doubles&quot;</span> : <span class="stringliteral">&quot;floats&quot;</span>) </div><div class="line">            &lt;&lt; <span class="stringliteral">&quot; = &quot;</span> &lt;&lt; n_vect_bits &lt;&lt; <span class="stringliteral">&quot; bits (&quot;</span> </div><div class="line">            &lt;&lt; <a class="code" href="namespaceUtilities_1_1System.html#ade631a789101336840371e3b2e2851e0">Utilities::System::get_current_vectorization_level</a>() &lt;&lt; <span class="stringliteral">&quot;)&quot;</span> </div><div class="line">            &lt;&lt; std::endl; </div><div class="line">    } </div><div class="line"></div><div class="line">    make_grid_and_dofs(); </div><div class="line"></div><div class="line">    <span class="keyword">const</span> LowStorageRungeKuttaIntegrator integrator(lsrk_scheme); </div><div class="line"></div><div class="line">    <a class="code" href="classLinearAlgebra_1_1distributed_1_1Vector.html">LinearAlgebra::distributed::Vector&lt;Number&gt;</a> rk_register_1; </div><div class="line">    <a class="code" href="classLinearAlgebra_1_1distributed_1_1Vector.html">LinearAlgebra::distributed::Vector&lt;Number&gt;</a> rk_register_2; </div><div class="line">    rk_register_1.<a class="code" href="classLinearAlgebra_1_1distributed_1_1Vector.html#ace027311492ed2f6e07fbd74d723e3a9">reinit</a>(solution); </div><div class="line">    rk_register_2.<a class="code" href="classLinearAlgebra_1_1distributed_1_1Vector.html#ace027311492ed2f6e07fbd74d723e3a9">reinit</a>(solution); </div><div class="line"></div><div class="line">    euler_operator.project(ExactSolution&lt;dim&gt;(time), solution); </div><div class="line"></div><div class="line">    <span class="keywordtype">double</span> min_vertex_distance = <a class="code" href="namespaceVectorTools_1_1EvaluationFlags.html#ac6721740e24732d6afabcf28ddfc1ffda8e7f5b8545162dccd5ed717792bdf420">std::numeric_limits&lt;double&gt;::max</a>(); </div><div class="line">    <span class="keywordflow">for</span> (<span class="keyword">const</span> <span class="keyword">auto</span> &amp;cell : triangulation.active_cell_iterators()) </div><div class="line">      <span class="keywordflow">if</span> (cell-&gt;is_locally_owned()) </div><div class="line">        min_vertex_distance = </div><div class="line">          <a class="code" href="namespaceVectorTools_1_1EvaluationFlags.html#ac6721740e24732d6afabcf28ddfc1ffdaeb244a97c0c9e9e7ca4765e096f0badc">std::min</a>(min_vertex_distance, cell-&gt;minimum_vertex_distance()); </div><div class="line">    min_vertex_distance = </div><div class="line">      <a class="code" href="namespaceUtilities_1_1MPI.html#a9ac5275c3c74902f8a9d6e7bdb514179">Utilities::MPI::min</a>(min_vertex_distance, MPI_COMM_WORLD); </div><div class="line"></div><div class="line">    time_step = courant_number * integrator.n_stages() / </div><div class="line">                euler_operator.compute_cell_transport_speed(solution); </div><div class="line">    pcout &lt;&lt; <span class="stringliteral">&quot;Time step size: &quot;</span> &lt;&lt; time_step </div><div class="line">          &lt;&lt; <span class="stringliteral">&quot;, minimal h: &quot;</span> &lt;&lt; min_vertex_distance </div><div class="line">          &lt;&lt; <span class="stringliteral">&quot;, initial transport scaling: &quot;</span> </div><div class="line">          &lt;&lt; 1. / euler_operator.compute_cell_transport_speed(solution) </div><div class="line">          &lt;&lt; std::endl </div><div class="line">          &lt;&lt; std::endl; </div><div class="line"></div><div class="line">    output_results(0); </div><div class="line"></div><div class="line">    <span class="keywordtype">unsigned</span> <span class="keywordtype">int</span> timestep_number = 0; </div><div class="line"></div><div class="line">    <span class="keywordflow">while</span> (time &lt; final_time - 1e-12 &amp;&amp; timestep_number &lt; max_time_steps) </div><div class="line">      { </div><div class="line">        ++timestep_number; </div><div class="line">        <span class="keywordflow">if</span> (timestep_number % 5 == 0) </div><div class="line">          time_step = </div><div class="line">            courant_number * integrator.n_stages() / </div><div class="line">            <a class="code" href="namespaceUtilities.html#a17955af7a4bc8771d430e622f9e732b3">Utilities::truncate_to_n_digits</a>( </div><div class="line">              euler_operator.compute_cell_transport_speed(solution), 3); </div><div class="line"></div><div class="line">        { </div><div class="line">          <a class="code" href="classTimerOutput_1_1Scope.html">TimerOutput::Scope</a> t(timer, <span class="stringliteral">&quot;rk time stepping total&quot;</span>); </div><div class="line">          integrator.perform_time_step(euler_operator, </div><div class="line">                                       time, </div><div class="line">                                       time_step, </div><div class="line">                                       solution, </div><div class="line">                                       rk_register_1, </div><div class="line">                                       rk_register_2); </div><div class="line">        } </div><div class="line"></div><div class="line">        time += time_step; </div><div class="line"></div><div class="line">        <span class="keywordflow">if</span> (static_cast&lt;int&gt;(time / output_tick) != </div><div class="line">              static_cast&lt;int&gt;((time - time_step) / output_tick) || </div><div class="line">            time &gt;= final_time - 1e-12) </div><div class="line">          output_results( </div><div class="line">            static_cast&lt;unsigned int&gt;(std::round(time / output_tick))); </div><div class="line">      } </div><div class="line"></div><div class="line">    timer.<a class="code" href="classTimerOutput.html#ae7673798226de7731e3ecdf7c0fb7568">print_wall_time_statistics</a>(MPI_COMM_WORLD); </div><div class="line">    pcout &lt;&lt; std::endl; </div><div class="line">  } </div><div class="line"></div><div class="line">} <span class="comment">// namespace Euler_DG </span></div><div class="line"></div><div class="line"><span class="keywordtype">int</span> main(<span class="keywordtype">int</span> argc, <span class="keywordtype">char</span> **argv) </div><div class="line">{ </div><div class="line">  <span class="keyword">using namespace </span>Euler_DG; </div><div class="line">  <span class="keyword">using namespace </span><a class="code" href="namespacedealii.html">dealii</a>; </div><div class="line"></div><div class="line">  <a class="code" href="classUtilities_1_1MPI_1_1MPI__InitFinalize.html">Utilities::MPI::MPI_InitFinalize</a> mpi_initialization(argc, argv, 1); </div><div class="line"></div><div class="line">  <span class="keywordflow">try</span> </div><div class="line">    { </div><div class="line">      <a class="code" href="logstream_8h.html#ac643e79bd992f1a9bd0dca5b9f2859fb">deallog</a>.<a class="code" href="classLogStream.html#a8028e970ad8388596d625ed463894e98">depth_console</a>(0); </div><div class="line"></div><div class="line">      EulerProblem&lt;dimension&gt; euler_problem; </div><div class="line">      euler_problem.run(); </div><div class="line">    } </div><div class="line">  <span class="keywordflow">catch</span> (std::exception &amp;exc) </div><div class="line">    { </div><div class="line">      std::cerr &lt;&lt; std::endl </div><div class="line">                &lt;&lt; std::endl </div><div class="line">                &lt;&lt; <span class="stringliteral">&quot;----------------------------------------------------&quot;</span> </div><div class="line">                &lt;&lt; std::endl; </div><div class="line">      std::cerr &lt;&lt; <span class="stringliteral">&quot;Exception on processing: &quot;</span> &lt;&lt; std::endl </div><div class="line">                &lt;&lt; exc.what() &lt;&lt; std::endl </div><div class="line">                &lt;&lt; <span class="stringliteral">&quot;Aborting!&quot;</span> &lt;&lt; std::endl </div><div class="line">                &lt;&lt; <span class="stringliteral">&quot;----------------------------------------------------&quot;</span> </div><div class="line">                &lt;&lt; std::endl; </div><div class="line"></div><div class="line">      <span class="keywordflow">return</span> 1; </div><div class="line">    } </div><div class="line">  <span class="keywordflow">catch</span> (...) </div><div class="line">    { </div><div class="line">      std::cerr &lt;&lt; std::endl </div><div class="line">                &lt;&lt; std::endl </div><div class="line">                &lt;&lt; <span class="stringliteral">&quot;----------------------------------------------------&quot;</span> </div><div class="line">                &lt;&lt; std::endl; </div><div class="line">      std::cerr &lt;&lt; <span class="stringliteral">&quot;Unknown exception!&quot;</span> &lt;&lt; std::endl </div><div class="line">                &lt;&lt; <span class="stringliteral">&quot;Aborting!&quot;</span> &lt;&lt; std::endl </div><div class="line">                &lt;&lt; <span class="stringliteral">&quot;----------------------------------------------------&quot;</span> </div><div class="line">                &lt;&lt; std::endl; </div><div class="line">      <span class="keywordflow">return</span> 1; </div><div class="line">    } </div><div class="line"></div><div class="line">  <span class="keywordflow">return</span> 0; </div><div class="line">} </div></div><!-- fragment --><p> examples/step-76/doc/results.dox</p>
<p><a class="anchor" id="Results"></a></p><h1>Results</h1>
<p>在一台有40个进程的机器上以默认设置运行该程序，会产生以下输出。</p>
<div class="fragment"><div class="line">Running with 40 MPI processes</div><div class="line">Vectorization over 8 doubles = 512 bits (AVX512)</div><div class="line">Number of degrees of freedom: 27.648.000 ( = 5 [vars] x 25.600 [cells] x 216 [dofs/cell/var] )</div><div class="line">Time step size: 0.000295952, minimal h: 0.0075, <a class="code" href="namespaceAlgorithms_1_1Events.html#a15a12dfdadd39a026d192ad96cb6207b">initial</a> transport scaling: 0.00441179</div><div class="line">Time:       0, dt:   0.0003, norm rho:  5.385e-16, rho * u:  1.916e-16, energy: 1.547e-15</div><div class="line">+--------------------------------------+------------------+------------+------------------+</div><div class="line">| Total wallclock time elapsed         |     17.52s    10 |     17.52s |     17.52s    11 |</div><div class="line">|                                      |                  |                               |</div><div class="line">| Section                  | no. calls |   <a class="code" href="classVectorizedArray.html#a8402043a938d7bb8af59713a5c0cc73e">min</a> time  rank |   <a class="code" href="namespaceVectorTools_1_1EvaluationFlags.html#ac6721740e24732d6afabcf28ddfc1ffdacc8b05748569f308550a239dc5b14396">avg</a> time |   max time  rank |</div><div class="line">+--------------------------------------+------------------+------------+------------------+</div><div class="line">| compute errors           |         1 |  0.009594s    16 |  0.009705s |  0.009819s     8 |</div><div class="line">| compute transport speed  |        22 |    0.1366s     0 |    0.1367s |    0.1368s    18 |</div><div class="line">| output                   |         1 |     1.233s     0 |     1.233s |     1.233s    32 |</div><div class="line">| rk time stepping total   |       100 |     8.746s    35 |     8.746s |     8.746s     0 |</div><div class="line">| rk_stage - integrals L_h |       500 |     8.742s    36 |     8.742s |     8.743s     2 |</div><div class="line">+--------------------------------------+------------------+------------+------------------+</div></div><!-- fragment --><p>和以下视觉输出。</p>
<table align="center" class="doxtable" style="width:85%">
<tr>
<td><div class="image">
<img src="https://www.dealii.org/images/steps/developer/step-67.pressure_010.png" width="100%"/>
</div>
  </td><td><div class="image">
<img src="https://www.dealii.org/images/steps/developer/step-67.pressure_025.png" width="100%"/>
</div>
   </td></tr>
<tr>
<td><div class="image">
<img src="https://www.dealii.org/images/steps/developer/step-67.pressure_050.png" width="100%"/>
</div>
  </td><td><div class="image">
<img src="https://www.dealii.org/images/steps/developer/step-67.pressure_100.png" width="100%"/>
</div>
   </td></tr>
</table>
<p>作为参考，使用FCL的步骤-67的结果是。</p>
<div class="fragment"><div class="line">Running with 40 MPI processes</div><div class="line">Vectorization over 8 doubles = 512 bits (AVX512)</div><div class="line">Number of degrees of freedom: 27.648.000 ( = 5 [vars] x 25.600 [cells] x 216 [dofs/cell/var] )</div><div class="line">Time step size: 0.000295952, minimal h: 0.0075, <a class="code" href="namespaceAlgorithms_1_1Events.html#a15a12dfdadd39a026d192ad96cb6207b">initial</a> transport scaling: 0.00441179</div><div class="line">Time:       0, dt:   0.0003, norm rho:  5.385e-16, rho * u:  1.916e-16, energy: 1.547e-15</div><div class="line">+-------------------------------------------+------------------+------------+------------------+</div><div class="line">| Total wallclock time elapsed              |     13.33s     0 |     13.34s |     13.35s    34 |</div><div class="line">|                                           |                  |                               |</div><div class="line">| Section                       | no. calls |   <a class="code" href="classVectorizedArray.html#a8402043a938d7bb8af59713a5c0cc73e">min</a> time  rank |   <a class="code" href="namespaceVectorTools_1_1EvaluationFlags.html#ac6721740e24732d6afabcf28ddfc1ffdacc8b05748569f308550a239dc5b14396">avg</a> time |   max time  rank |</div><div class="line">+-------------------------------------------+------------------+------------+------------------+</div><div class="line">| compute errors                |         1 |  0.007977s    10 |  0.008053s |  0.008161s    30 |</div><div class="line">| compute transport speed       |        22 |    0.1228s    34 |    0.2227s |    0.3845s     0 |</div><div class="line">| output                        |         1 |     1.255s     3 |     1.257s |     1.259s    27 |</div><div class="line">| rk time stepping total        |       100 |     11.15s     0 |     11.32s |     11.42s    34 |</div><div class="line">| rk_stage - integrals L_h      |       500 |     8.719s    10 |     8.932s |     9.196s     0 |</div><div class="line">| rk_stage - inv mass + vec upd |       500 |     1.944s     0 |     2.377s |      2.55s    10 |</div><div class="line">+-------------------------------------------+------------------+------------+------------------+</div></div><!-- fragment --><p>通过本教程中的修改，我们能够使Runge-Kutta阶段的速度提高27。</p>
<p><a class="anchor" id="Possibilitiesforextensions"></a></p><h3>Possibilities for extensions</h3>
<p>这些算法很容易扩展到更高的维度：高维的<a href="https://github.com/hyperdeal/hyperdeal/blob/a9e67b4e625ff1dde2fed93ad91cdfacfaa3acdf/include/hyper.deal/operators/advection/advection_operation.h#L219-L569">advection operator based on cell-centric loops</a>是hyper.deal库的一部分。以单元为中心的循环扩展到局部细化的网格则涉及更多。</p>
<p><a class="anchor" id="ExtensiontothecompressibleNavierStokesequations"></a></p><h4>Extension to the compressible Navier-Stokes equations</h4>
<p>本教程中提出的求解器也可以通过增加粘性项来扩展到可压缩的Navier-Stokes方程，这也是步骤67中的建议。为了尽量保持这里获得的性能，尽管有额外的椭圆项的成本，例如通过内部惩罚方法，该教程建议将基础从FE_DGQ切换到FE_DGQHermite，就像步骤59的教程程序一样。这种转换背后的原因是，在FE_DGQ的情况下，需要相邻单元的所有值（即 \(k+1\) 层），而在FE_DGQHermite的情况下，只需要2层，这使得后者明显更适合于高度数。额外的层一方面要在通量计算过程中从主内存加载，另一方面要进行通信。利用本教程介绍的共享内存能力，第二点可以在单个计算节点上消除，或者在混合环境下减少其影响。</p>
<p><a class="anchor" id="BlockGaussSeidellikepreconditioners"></a></p><h4>Block Gauss-Seidel-like preconditioners</h4>
<p>以单元为中心的循环可用于创建块状高斯-赛德尔预处理，在一个过程中是乘法的，在整个过程中是加法的。这些类型的预处理器在通量计算过程中使用，与雅可比型预处理器相反，已经从相邻的单元中更新了数值。下面的伪代码直观地说明了这在原则上是如何实现的。</p>
<div class="fragment"><div class="line"><span class="comment">// vector monitor if cells have been updated or not</span></div><div class="line"><a class="code" href="classVector.html">Vector&lt;Number&gt;</a> visit_flags(data.n_cell_batches () + data.n_ghost_cell_batches ());</div><div class="line"></div><div class="line"></div><div class="line"><span class="comment">// element centric loop with a modified kernel</span></div><div class="line">data.template loop_cell_centric&lt;VectorType, VectorType&gt;(</div><div class="line">  [&amp;](<span class="keyword">const</span> <span class="keyword">auto</span> &amp;data, <span class="keyword">auto</span> &amp;dst, <span class="keyword">const</span> <span class="keyword">auto</span> &amp;src, <span class="keyword">const</span> <span class="keyword">auto</span> cell_range) {</div><div class="line"></div><div class="line"></div><div class="line">    <span class="keywordflow">for</span> (<span class="keywordtype">unsigned</span> <span class="keywordtype">int</span> cell = cell_range.first; cell &lt; cell_range.second; ++cell)</div><div class="line">      {</div><div class="line">        <span class="comment">// cell integral as usual (not shown)</span></div><div class="line"></div><div class="line"></div><div class="line">        <span class="keywordflow">for</span> (<span class="keywordtype">unsigned</span> <span class="keywordtype">int</span> face = 0; face &lt; GeometryInfo&lt;dim&gt;::faces_per_cell; ++face)</div><div class="line">          {</div><div class="line">            <span class="keyword">const</span> <span class="keyword">auto</span> boundary_id = data.get_faces_by_cells_boundary_id(cell, face)[0];</div><div class="line"></div><div class="line"></div><div class="line">            <span class="keywordflow">if</span> (boundary_id == <a class="code" href="namespacenumbers.html#a4e5d3fa25689151c833ba46dcc96fa5b">numbers::internal_face_boundary_id</a>)</div><div class="line">              {</div><div class="line">                phi_p.reinit(cell, face);</div><div class="line"></div><div class="line"></div><div class="line">                <span class="keyword">const</span> <span class="keyword">auto</span> flags = phi_p.read_cell_data(visit_flags);</div><div class="line">                <span class="keyword">const</span> <span class="keyword">auto</span> all_neighbors_have_been_updated =</div><div class="line">                  <a class="code" href="namespaceVectorTools_1_1EvaluationFlags.html#ac6721740e24732d6afabcf28ddfc1ffdaeb244a97c0c9e9e7ca4765e096f0badc">std::min</a>(flags.begin(),</div><div class="line">                           flags().begin() + data.n_active_entries_per_cell_batch(cell) == 1;</div><div class="line"></div><div class="line"></div><div class="line">                <span class="keywordflow">if</span>(all_neighbors_have_been_updated)</div><div class="line">                  phi_p.gather_evaluate(dst, <a class="code" href="namespaceEvaluationFlags.html#a9b7c6d689cb76386839d0d13640f59aeaf9825c682f693a6a200094641a0d6a58">EvaluationFlags::values</a>);</div><div class="line">                <span class="keywordflow">else</span></div><div class="line">                  phi_p.gather_evaluate(src, <a class="code" href="namespaceEvaluationFlags.html#a9b7c6d689cb76386839d0d13640f59aeaf9825c682f693a6a200094641a0d6a58">EvaluationFlags::values</a>);</div><div class="line"></div><div class="line"></div><div class="line">                <span class="comment">// continue as usual (not shown)</span></div><div class="line">              }</div><div class="line">            <span class="keywordflow">else</span></div><div class="line">              {</div><div class="line">                <span class="comment">// boundary integral as usual (not shown)</span></div><div class="line">              }</div><div class="line">          }</div><div class="line"></div><div class="line"></div><div class="line">        <span class="comment">// continue as above and apply your favorite algorithm to invert</span></div><div class="line">        <span class="comment">// the cell-local operator (not shown)</span></div><div class="line"></div><div class="line"></div><div class="line">        <span class="comment">// make cells as updated</span></div><div class="line">        phi.set_cell_data(visit_flags, VectorizedArrayType(1.0));</div><div class="line">      }</div><div class="line">  },</div><div class="line">  dst,</div><div class="line">  src,</div><div class="line">  <span class="keyword">true</span>,</div><div class="line">  <a class="code" href="classMatrixFree.html">MatrixFree&lt;dim, Number, VectorizedArrayType&gt;::DataAccessOnFaces::values</a>);</div></div><!-- fragment --><p>为此，我们可以利用MatrixFree的单元数据向量能力和VectorizedArray的基于范围的迭代能力。</p>
<p>请注意，在给定的例子中，我们处理 <code>VectorizedArrayType::size()</code> 个块，因为每个通道对应一个块。如果一个矢量寄存器处理的所有块都被更新了，我们就认为块被更新了。在笛卡尔网格的情况下，这是一个合理的方法，然而，对于一般的非结构化网格，这种保守的方法可能会导致预处理程序的效率下降。通过明确减少 <code>VectorizedArrayType</code> 使用的通道数量来减少并行处理的单元可能会提高预处理器的质量，但代价是每次迭代可能会更昂贵。这种两难境地把我们引向另一种 "扩展的可能性"：元素内的矢量化。</p>
<p><a class="anchor" id="PlainProg"></a> </p><h1>The plain program</h1>
<div class="fragment"><div class="line"></div><div class="line"></div><div class="line"><span class="comment">/* --------------------------------------------------------------------- </span></div><div class="line"><span class="comment"> * </span></div><div class="line"><span class="comment"> * Copyright (C) 2020 - 2021 by the deal.II authors </span></div><div class="line"><span class="comment"> * </span></div><div class="line"><span class="comment"> * This file is part of the deal.II library. </span></div><div class="line"><span class="comment"> * </span></div><div class="line"><span class="comment"> * The deal.II library is free software; you can use it, redistribute </span></div><div class="line"><span class="comment"> * it, and/or modify it under the terms of the GNU Lesser General </span></div><div class="line"><span class="comment"> * Public License as published by the Free Software Foundation; either </span></div><div class="line"><span class="comment"> * version 2.1 of the License, or (at your option) any later version. </span></div><div class="line"><span class="comment"> * The full text of the license can be found in the file LICENSE.md at </span></div><div class="line"><span class="comment"> * the top level directory of deal.II. </span></div><div class="line"><span class="comment"> * </span></div><div class="line"><span class="comment"> * --------------------------------------------------------------------- </span></div><div class="line"><span class="comment"> * </span></div><div class="line"><span class="comment"> * Author: Martin Kronbichler, Peter Munch, David Schneider, 2020 </span></div><div class="line"><span class="comment"> */</span> </div><div class="line"></div><div class="line"></div><div class="line"></div><div class="line"></div><div class="line"><span class="preprocessor">#include &lt;<a class="code" href="conditional__ostream_8h.html">deal.II/base/conditional_ostream.h</a>&gt;</span> </div><div class="line"><span class="preprocessor">#include &lt;<a class="code" href="function_8h.html">deal.II/base/function.h</a>&gt;</span> </div><div class="line"><span class="preprocessor">#include &lt;<a class="code" href="logstream_8h.html">deal.II/base/logstream.h</a>&gt;</span> </div><div class="line"><span class="preprocessor">#include &lt;<a class="code" href="time__stepping_8h.html">deal.II/base/time_stepping.h</a>&gt;</span> </div><div class="line"><span class="preprocessor">#include &lt;<a class="code" href="timer_8h.html">deal.II/base/timer.h</a>&gt;</span> </div><div class="line"><span class="preprocessor">#include &lt;<a class="code" href="include_2deal_8II_2base_2utilities_8h.html">deal.II/base/utilities.h</a>&gt;</span> </div><div class="line"><span class="preprocessor">#include &lt;<a class="code" href="vectorization_8h.html">deal.II/base/vectorization.h</a>&gt;</span> </div><div class="line"></div><div class="line"><span class="preprocessor">#include &lt;<a class="code" href="distributed_2tria_8h.html">deal.II/distributed/tria.h</a>&gt;</span> </div><div class="line"></div><div class="line"><span class="preprocessor">#include &lt;<a class="code" href="dofs_2dof__handler_8h.html">deal.II/dofs/dof_handler.h</a>&gt;</span> </div><div class="line"></div><div class="line"><span class="preprocessor">#include &lt;<a class="code" href="fe__dgq_8h.html">deal.II/fe/fe_dgq.h</a>&gt;</span></div><div class="line"><span class="preprocessor">#include &lt;<a class="code" href="fe__system_8h.html">deal.II/fe/fe_system.h</a>&gt;</span> </div><div class="line"></div><div class="line"><span class="preprocessor">#include &lt;<a class="code" href="grid__generator_8h.html">deal.II/grid/grid_generator.h</a>&gt;</span> </div><div class="line"><span class="preprocessor">#include &lt;<a class="code" href="grid_2tria_8h.html">deal.II/grid/tria.h</a>&gt;</span> </div><div class="line"><span class="preprocessor">#include &lt;<a class="code" href="tria__accessor_8h.html">deal.II/grid/tria_accessor.h</a>&gt;</span> </div><div class="line"><span class="preprocessor">#include &lt;<a class="code" href="tria__iterator_8h.html">deal.II/grid/tria_iterator.h</a>&gt;</span> </div><div class="line"></div><div class="line"><span class="preprocessor">#include &lt;<a class="code" href="affine__constraints_8h.html">deal.II/lac/affine_constraints.h</a>&gt;</span> </div><div class="line"><span class="preprocessor">#include &lt;<a class="code" href="la__parallel__vector_8h.html">deal.II/lac/la_parallel_vector.h</a>&gt;</span> </div><div class="line"></div><div class="line"><span class="preprocessor">#include &lt;<a class="code" href="fe__evaluation_8h.html">deal.II/matrix_free/fe_evaluation.h</a>&gt;</span> </div><div class="line"><span class="preprocessor">#include &lt;<a class="code" href="matrix__free_8h.html">deal.II/matrix_free/matrix_free.h</a>&gt;</span> </div><div class="line"><span class="preprocessor">#include &lt;<a class="code" href="operators_8h.html">deal.II/matrix_free/operators.h</a>&gt;</span> </div><div class="line"></div><div class="line"><span class="preprocessor">#include &lt;<a class="code" href="numerics_2data__out_8h.html">deal.II/numerics/data_out.h</a>&gt;</span> </div><div class="line"></div><div class="line"><span class="preprocessor">#include &lt;fstream&gt;</span> </div><div class="line"><span class="preprocessor">#include &lt;iomanip&gt;</span> </div><div class="line"><span class="preprocessor">#include &lt;iostream&gt;</span> </div><div class="line"></div><div class="line"></div><div class="line"><span class="preprocessor">#include &lt;<a class="code" href="tools_8h.html">deal.II/matrix_free/tools.h</a>&gt;</span> </div><div class="line"></div><div class="line"><span class="keyword">namespace </span>Euler_DG </div><div class="line">{ </div><div class="line">  <span class="keyword">using namespace </span><a class="code" href="namespacedealii.html">dealii</a>; </div><div class="line"></div><div class="line"></div><div class="line">  constexpr <span class="keywordtype">unsigned</span> <span class="keywordtype">int</span> testcase             = 1; </div><div class="line">  constexpr <span class="keywordtype">unsigned</span> <span class="keywordtype">int</span> dimension            = 2; </div><div class="line">  constexpr <span class="keywordtype">unsigned</span> <span class="keywordtype">int</span> n_global_refinements = 2; </div><div class="line">  constexpr <span class="keywordtype">unsigned</span> <span class="keywordtype">int</span> fe_degree            = 5; </div><div class="line">  constexpr <span class="keywordtype">unsigned</span> <span class="keywordtype">int</span> n_q_points_1d        = fe_degree + 2; </div><div class="line"></div><div class="line"></div><div class="line">  constexpr <span class="keywordtype">unsigned</span> <span class="keywordtype">int</span> group_size = <a class="code" href="namespacenumbers.html#a8ae36952c7e0cc778b47b5371b3aeff1">numbers::invalid_unsigned_int</a>; </div><div class="line"></div><div class="line">  <span class="keyword">using</span> Number = double; </div><div class="line"></div><div class="line"></div><div class="line">  <span class="keyword">using</span> VectorizedArrayType = <a class="code" href="classVectorizedArray.html">VectorizedArray&lt;Number&gt;</a>; </div><div class="line"></div><div class="line"></div><div class="line">  constexpr <span class="keywordtype">double</span> gamma       = 1.4; </div><div class="line">  constexpr <span class="keywordtype">double</span> final_time  = testcase == 0 ? 10 : 2.0; </div><div class="line">  constexpr <span class="keywordtype">double</span> output_tick = testcase == 0 ? 1 : 0.05; </div><div class="line"></div><div class="line">  <span class="keyword">const</span> <span class="keywordtype">double</span> courant_number = 0.15 / <a class="code" href="vectorization_8h.html#ae5c8b2cd70b2640bab8f1ee4ccb7f4cc">std::pow</a>(fe_degree, 1.5); </div><div class="line"></div><div class="line"></div><div class="line">  constexpr <span class="keywordtype">unsigned</span> <span class="keywordtype">int</span> max_time_steps = <a class="code" href="namespacenumbers.html#a8ae36952c7e0cc778b47b5371b3aeff1">numbers::invalid_unsigned_int</a>; </div><div class="line"></div><div class="line"></div><div class="line">  <span class="keyword">enum</span> LowStorageRungeKuttaScheme </div><div class="line">  { </div><div class="line">    stage_3_order_3, </div><div class="line">    stage_5_order_4, </div><div class="line">    stage_7_order_4, </div><div class="line">    stage_9_order_5, </div><div class="line">  }; </div><div class="line">  constexpr LowStorageRungeKuttaScheme lsrk_scheme = stage_5_order_4; </div><div class="line"></div><div class="line">  <span class="keyword">class </span>LowStorageRungeKuttaIntegrator </div><div class="line">  { </div><div class="line">  <span class="keyword">public</span>: </div><div class="line">    LowStorageRungeKuttaIntegrator(<span class="keyword">const</span> LowStorageRungeKuttaScheme scheme) </div><div class="line">    { </div><div class="line">      <a class="code" href="namespaceTimeStepping.html#abff97b5326e452552f108a379dd6cff4">TimeStepping::runge_kutta_method</a> lsrk; </div><div class="line">      <span class="keywordflow">switch</span> (scheme) </div><div class="line">        { </div><div class="line">          <span class="keywordflow">case</span> stage_3_order_3: </div><div class="line">            lsrk = <a class="code" href="namespaceTimeStepping.html#abff97b5326e452552f108a379dd6cff4aba5c997ffa7c63d0c0f6b046a53d63bf">TimeStepping::LOW_STORAGE_RK_STAGE3_ORDER3</a>; </div><div class="line">            <span class="keywordflow">break</span>; </div><div class="line">          <span class="keywordflow">case</span> stage_5_order_4: </div><div class="line">            lsrk = <a class="code" href="namespaceTimeStepping.html#abff97b5326e452552f108a379dd6cff4af4a68ccb74e043ac956cddf23fa57e48">TimeStepping::LOW_STORAGE_RK_STAGE5_ORDER4</a>; </div><div class="line">            <span class="keywordflow">break</span>; </div><div class="line">          <span class="keywordflow">case</span> stage_7_order_4: </div><div class="line">            lsrk = <a class="code" href="namespaceTimeStepping.html#abff97b5326e452552f108a379dd6cff4af34241e1b27c2f0f2f90715ee9f97bdb">TimeStepping::LOW_STORAGE_RK_STAGE7_ORDER4</a>; </div><div class="line">            <span class="keywordflow">break</span>; </div><div class="line">          <span class="keywordflow">case</span> stage_9_order_5: </div><div class="line">            lsrk = <a class="code" href="namespaceTimeStepping.html#abff97b5326e452552f108a379dd6cff4a6a1cbeb6dd2a5ed5ac2e3efe3293e941">TimeStepping::LOW_STORAGE_RK_STAGE9_ORDER5</a>; </div><div class="line">            <span class="keywordflow">break</span>; </div><div class="line"></div><div class="line">          <span class="keywordflow">default</span>: </div><div class="line">            <a class="code" href="group__Exceptions.html#gafc0ca7ad85b3ebd64e8e51689ac85caf">AssertThrow</a>(<span class="keyword">false</span>, <a class="code" href="group__Exceptions.html#ga7b52b286796c23ef9ff178faf7a4b68f">ExcNotImplemented</a>()); </div><div class="line">        } </div><div class="line">      <a class="code" href="classTimeStepping_1_1LowStorageRungeKutta.html">TimeStepping::LowStorageRungeKutta</a>&lt; </div><div class="line">        <a class="code" href="classLinearAlgebra_1_1distributed_1_1Vector.html">LinearAlgebra::distributed::Vector&lt;Number&gt;</a>&gt; </div><div class="line">                          rk_integrator(lsrk); </div><div class="line">      std::vector&lt;double&gt; ci; <span class="comment">// not used </span></div><div class="line">      rk_integrator.get_coefficients(ai, bi, ci); </div><div class="line">    } </div><div class="line"></div><div class="line">    <span class="keywordtype">unsigned</span> <span class="keywordtype">int</span> n_stages()<span class="keyword"> const </span></div><div class="line"><span class="keyword">    </span>{ </div><div class="line">      <span class="keywordflow">return</span> bi.size(); </div><div class="line">    } </div><div class="line"></div><div class="line">    <span class="keyword">template</span> &lt;<span class="keyword">typename</span> VectorType, <span class="keyword">typename</span> Operator&gt; </div><div class="line">    <span class="keywordtype">void</span> perform_time_step(<span class="keyword">const</span> Operator &amp;pde_operator, </div><div class="line">                           <span class="keyword">const</span> <span class="keywordtype">double</span>    current_time, </div><div class="line">                           <span class="keyword">const</span> <span class="keywordtype">double</span>    time_step, </div><div class="line">                           VectorType &amp;    solution, </div><div class="line">                           VectorType &amp;    vec_ri, </div><div class="line">                           VectorType &amp;    vec_ki)<span class="keyword"> const </span></div><div class="line"><span class="keyword">    </span>{ </div><div class="line">      <a class="code" href="group__Exceptions.html#ga9442b63275c9ef3fab29bc222831c49c">AssertDimension</a>(ai.size() + 1, bi.size()); </div><div class="line"></div><div class="line">      vec_ki.swap(solution); </div><div class="line"></div><div class="line">      <span class="keywordtype">double</span> sum_previous_bi = 0; </div><div class="line">      <span class="keywordflow">for</span> (<span class="keywordtype">unsigned</span> <span class="keywordtype">int</span> stage = 0; stage &lt; bi.size(); ++stage) </div><div class="line">        { </div><div class="line">          <span class="keyword">const</span> <span class="keywordtype">double</span> c_i = stage == 0 ? 0 : sum_previous_bi + ai[stage - 1]; </div><div class="line"></div><div class="line">          pde_operator.perform_stage(stage, </div><div class="line">                                     current_time + c_i * time_step, </div><div class="line">                                     bi[stage] * time_step, </div><div class="line">                                     (stage == bi.size() - 1 ? </div><div class="line">                                        0 : </div><div class="line">                                        ai[stage] * time_step), </div><div class="line">                                     (stage % 2 == 0 ? vec_ki : vec_ri), </div><div class="line">                                     (stage % 2 == 0 ? vec_ri : vec_ki), </div><div class="line">                                     solution); </div><div class="line"></div><div class="line">          <span class="keywordflow">if</span> (stage &gt; 0) </div><div class="line">            sum_previous_bi += bi[stage - 1]; </div><div class="line">        } </div><div class="line">    } </div><div class="line"></div><div class="line">  <span class="keyword">private</span>: </div><div class="line">    std::vector&lt;double&gt; bi; </div><div class="line">    std::vector&lt;double&gt; ai; </div><div class="line">  }; </div><div class="line"></div><div class="line"></div><div class="line">  <span class="keyword">enum</span> EulerNumericalFlux </div><div class="line">  { </div><div class="line">    lax_friedrichs_modified, </div><div class="line">    harten_lax_vanleer, </div><div class="line">  }; </div><div class="line">  constexpr EulerNumericalFlux numerical_flux_type = lax_friedrichs_modified; </div><div class="line"></div><div class="line">  <span class="keyword">template</span> &lt;<span class="keywordtype">int</span> dim&gt; </div><div class="line">  <span class="keyword">class </span>ExactSolution : <span class="keyword">public</span> <a class="code" href="classFunction.html">Function</a>&lt;dim&gt; </div><div class="line">  { </div><div class="line">  <span class="keyword">public</span>: </div><div class="line">    ExactSolution(<span class="keyword">const</span> <span class="keywordtype">double</span> time) </div><div class="line">      : <a class="code" href="classFunction.html">Function</a>&lt;dim&gt;(dim + 2, time) </div><div class="line">    {} </div><div class="line"></div><div class="line">    <span class="keyword">virtual</span> <span class="keywordtype">double</span> value(<span class="keyword">const</span> <a class="code" href="classPoint.html">Point&lt;dim&gt;</a> &amp; p, </div><div class="line">                         <span class="keyword">const</span> <span class="keywordtype">unsigned</span> <span class="keywordtype">int</span> component = 0) <span class="keyword">const override</span>; </div><div class="line">  }; </div><div class="line"></div><div class="line">  <span class="keyword">template</span> &lt;<span class="keywordtype">int</span> dim&gt; </div><div class="line">  <span class="keywordtype">double</span> ExactSolution&lt;dim&gt;::value(<span class="keyword">const</span> <a class="code" href="classPoint.html">Point&lt;dim&gt;</a> &amp; x, </div><div class="line">                                   <span class="keyword">const</span> <span class="keywordtype">unsigned</span> <span class="keywordtype">int</span> component)<span class="keyword"> const </span></div><div class="line"><span class="keyword">  </span>{ </div><div class="line">    <span class="keyword">const</span> <span class="keywordtype">double</span> t = this-&gt;<a class="code" href="namespaceUtilities_1_1System.html#a76bc1cc7649cc416723f450d24fdd91d">get_time</a>(); </div><div class="line"></div><div class="line">    <span class="keywordflow">switch</span> (testcase) </div><div class="line">      { </div><div class="line">        <span class="keywordflow">case</span> 0: </div><div class="line">          { </div><div class="line">            <a class="code" href="group__Exceptions.html#ga70a0bb353656e704acf927945277bbc6">Assert</a>(dim == 2, <a class="code" href="group__Exceptions.html#ga7b52b286796c23ef9ff178faf7a4b68f">ExcNotImplemented</a>()); </div><div class="line">            <span class="keyword">const</span> <span class="keywordtype">double</span> beta = 5; </div><div class="line"></div><div class="line">            <a class="code" href="classPoint.html">Point&lt;dim&gt;</a> x0; </div><div class="line">            x0[0] = 5.; </div><div class="line">            <span class="keyword">const</span> <span class="keywordtype">double</span> radius_sqr = </div><div class="line">              (x - x0).norm_square() - 2. * (x[0] - x0[0]) * t + t * t; </div><div class="line">            <span class="keyword">const</span> <span class="keywordtype">double</span> factor = </div><div class="line">              beta / (numbers::PI * 2) * std::exp(1. - radius_sqr); </div><div class="line">            <span class="keyword">const</span> <span class="keywordtype">double</span> density_log = std::log2( </div><div class="line">              std::abs(1. - (gamma - 1.) / gamma * 0.25 * factor * factor)); </div><div class="line">            <span class="keyword">const</span> <span class="keywordtype">double</span> density = std::exp2(density_log * (1. / (gamma - 1.))); </div><div class="line">            <span class="keyword">const</span> <span class="keywordtype">double</span> u       = 1. - factor * (x[1] - x0[1]); </div><div class="line">            <span class="keyword">const</span> <span class="keywordtype">double</span> v       = factor * (x[0] - t - x0[0]); </div><div class="line"></div><div class="line">            <span class="keywordflow">if</span> (component == 0) </div><div class="line">              <span class="keywordflow">return</span> density; </div><div class="line">            <span class="keywordflow">else</span> <span class="keywordflow">if</span> (component == 1) </div><div class="line">              <span class="keywordflow">return</span> density * u; </div><div class="line">            <span class="keywordflow">else</span> <span class="keywordflow">if</span> (component == 2) </div><div class="line">              <span class="keywordflow">return</span> density * v; </div><div class="line">            <span class="keywordflow">else</span> </div><div class="line">              { </div><div class="line">                <span class="keyword">const</span> <span class="keywordtype">double</span> pressure = </div><div class="line">                  std::exp2(density_log * (gamma / (gamma - 1.))); </div><div class="line">                <span class="keywordflow">return</span> pressure / (gamma - 1.) + </div><div class="line">                       0.5 * (density * u * u + density * v * v); </div><div class="line">              } </div><div class="line">          } </div><div class="line"></div><div class="line">        <span class="keywordflow">case</span> 1: </div><div class="line">          { </div><div class="line">            <span class="keywordflow">if</span> (component == 0) </div><div class="line">              <span class="keywordflow">return</span> 1.; </div><div class="line">            <span class="keywordflow">else</span> <span class="keywordflow">if</span> (component == 1) </div><div class="line">              <span class="keywordflow">return</span> 0.4; </div><div class="line">            <span class="keywordflow">else</span> <span class="keywordflow">if</span> (component == dim + 1) </div><div class="line">              <span class="keywordflow">return</span> 3.097857142857143; </div><div class="line">            <span class="keywordflow">else</span> </div><div class="line">              <span class="keywordflow">return</span> 0.; </div><div class="line">          } </div><div class="line"></div><div class="line">        <span class="keywordflow">default</span>: </div><div class="line">          <a class="code" href="group__Exceptions.html#ga70a0bb353656e704acf927945277bbc6">Assert</a>(<span class="keyword">false</span>, <a class="code" href="group__Exceptions.html#ga7b52b286796c23ef9ff178faf7a4b68f">ExcNotImplemented</a>()); </div><div class="line">          <span class="keywordflow">return</span> 0.; </div><div class="line">      } </div><div class="line">  } </div><div class="line"></div><div class="line">  <span class="keyword">template</span> &lt;<span class="keywordtype">int</span> dim, <span class="keyword">typename</span> Number&gt; </div><div class="line">  <span class="keyword">inline</span> <a class="code" href="config_8h.html#a1d1d58e8be15e5c4285f6892e5f33136">DEAL_II_ALWAYS_INLINE</a> <span class="comment">// </span></div><div class="line">    <a class="code" href="classTensor.html">Tensor&lt;1, dim, Number&gt;</a> </div><div class="line">    euler_velocity(<span class="keyword">const</span> <a class="code" href="classTensor.html">Tensor&lt;1, dim + 2, Number&gt;</a> &amp;conserved_variables) </div><div class="line">  { </div><div class="line">    <span class="keyword">const</span> Number inverse_density = Number(1.) / conserved_variables[0]; </div><div class="line"></div><div class="line">    <a class="code" href="classTensor.html">Tensor&lt;1, dim, Number&gt;</a> velocity; </div><div class="line">    <span class="keywordflow">for</span> (<span class="keywordtype">unsigned</span> <span class="keywordtype">int</span> d = 0; d &lt; dim; ++<a class="code" href="namespacePhysics_1_1Elasticity_1_1Kinematics.html#a15728437b942dab0b0042eb06a407d2c">d</a>) </div><div class="line">      velocity[d] = conserved_variables[1 + d] * inverse_density; </div><div class="line"></div><div class="line">    <span class="keywordflow">return</span> velocity; </div><div class="line">  } </div><div class="line"></div><div class="line">  <span class="keyword">template</span> &lt;<span class="keywordtype">int</span> dim, <span class="keyword">typename</span> Number&gt; </div><div class="line">  <span class="keyword">inline</span> <a class="code" href="config_8h.html#a1d1d58e8be15e5c4285f6892e5f33136">DEAL_II_ALWAYS_INLINE</a> <span class="comment">// </span></div><div class="line">    Number </div><div class="line">    euler_pressure(<span class="keyword">const</span> <a class="code" href="classTensor.html">Tensor&lt;1, dim + 2, Number&gt;</a> &amp;conserved_variables) </div><div class="line">  { </div><div class="line">    <span class="keyword">const</span> <a class="code" href="classTensor.html">Tensor&lt;1, dim, Number&gt;</a> velocity = </div><div class="line">      euler_velocity&lt;dim&gt;(conserved_variables); </div><div class="line"></div><div class="line">    Number rho_u_dot_u = conserved_variables[1] * velocity[0]; </div><div class="line">    <span class="keywordflow">for</span> (<span class="keywordtype">unsigned</span> <span class="keywordtype">int</span> d = 1; d &lt; dim; ++<a class="code" href="namespacePhysics_1_1Elasticity_1_1Kinematics.html#a15728437b942dab0b0042eb06a407d2c">d</a>) </div><div class="line">      rho_u_dot_u += conserved_variables[1 + d] * velocity[d]; </div><div class="line"></div><div class="line">    <span class="keywordflow">return</span> (gamma - 1.) * (conserved_variables[dim + 1] - 0.5 * rho_u_dot_u); </div><div class="line">  } </div><div class="line"></div><div class="line">  <span class="keyword">template</span> &lt;<span class="keywordtype">int</span> dim, <span class="keyword">typename</span> Number&gt; </div><div class="line">  <span class="keyword">inline</span> <a class="code" href="config_8h.html#a1d1d58e8be15e5c4285f6892e5f33136">DEAL_II_ALWAYS_INLINE</a> <span class="comment">// </span></div><div class="line">    <a class="code" href="classTensor.html">Tensor&lt;1, dim + 2, Tensor&lt;1, dim, Number&gt;</a>&gt; </div><div class="line">    euler_flux(<span class="keyword">const</span> <a class="code" href="classTensor.html">Tensor&lt;1, dim + 2, Number&gt;</a> &amp;conserved_variables) </div><div class="line">  { </div><div class="line">    <span class="keyword">const</span> <a class="code" href="classTensor.html">Tensor&lt;1, dim, Number&gt;</a> velocity = </div><div class="line">      euler_velocity&lt;dim&gt;(conserved_variables); </div><div class="line">    <span class="keyword">const</span> Number pressure = euler_pressure&lt;dim&gt;(conserved_variables); </div><div class="line"></div><div class="line">    <a class="code" href="classTensor.html">Tensor&lt;1, dim + 2, Tensor&lt;1, dim, Number&gt;</a>&gt; flux; </div><div class="line">    <span class="keywordflow">for</span> (<span class="keywordtype">unsigned</span> <span class="keywordtype">int</span> d = 0; d &lt; dim; ++<a class="code" href="namespacePhysics_1_1Elasticity_1_1Kinematics.html#a15728437b942dab0b0042eb06a407d2c">d</a>) </div><div class="line">      { </div><div class="line">        flux[0][<a class="code" href="namespacePhysics_1_1Elasticity_1_1Kinematics.html#a15728437b942dab0b0042eb06a407d2c">d</a>] = conserved_variables[1 + <a class="code" href="namespacePhysics_1_1Elasticity_1_1Kinematics.html#a15728437b942dab0b0042eb06a407d2c">d</a>]; </div><div class="line">        <span class="keywordflow">for</span> (<span class="keywordtype">unsigned</span> <span class="keywordtype">int</span> e = 0; e &lt; dim; ++<a class="code" href="namespacePhysics_1_1Elasticity_1_1Kinematics.html#a9587d5229555daa5b1fa1ba2f8a40adb">e</a>) </div><div class="line">          flux[e + 1][d] = conserved_variables[e + 1] * velocity[d]; </div><div class="line">        flux[d + 1][<a class="code" href="namespacePhysics_1_1Elasticity_1_1Kinematics.html#a15728437b942dab0b0042eb06a407d2c">d</a>] += pressure; </div><div class="line">        flux[dim + 1][<a class="code" href="namespacePhysics_1_1Elasticity_1_1Kinematics.html#a15728437b942dab0b0042eb06a407d2c">d</a>] = </div><div class="line">          velocity[<a class="code" href="namespacePhysics_1_1Elasticity_1_1Kinematics.html#a15728437b942dab0b0042eb06a407d2c">d</a>] * (conserved_variables[dim + 1] + pressure); </div><div class="line">      } </div><div class="line"></div><div class="line">    <span class="keywordflow">return</span> flux; </div><div class="line">  } </div><div class="line"></div><div class="line">  <span class="keyword">template</span> &lt;<span class="keywordtype">int</span> n_components, <span class="keywordtype">int</span> dim, <span class="keyword">typename</span> Number&gt; </div><div class="line">  <span class="keyword">inline</span> <a class="code" href="config_8h.html#a1d1d58e8be15e5c4285f6892e5f33136">DEAL_II_ALWAYS_INLINE</a> <span class="comment">// </span></div><div class="line">    <a class="code" href="classTensor.html">Tensor&lt;1, n_components, Number&gt;</a> </div><div class="line">    <a class="code" href="complex__overloads_8h.html#a285c79b547d28de482e34d02cee71bb2">operator*</a>(<span class="keyword">const</span> <a class="code" href="classTensor.html">Tensor</a>&lt;1, n_components, <a class="code" href="classTensor.html">Tensor&lt;1, dim, Number&gt;</a>&gt; &amp;matrix, </div><div class="line">              <span class="keyword">const</span> <a class="code" href="classTensor.html">Tensor&lt;1, dim, Number&gt;</a> &amp;                         vector) </div><div class="line">  { </div><div class="line">    <a class="code" href="classTensor.html">Tensor&lt;1, n_components, Number&gt;</a> result; </div><div class="line">    <span class="keywordflow">for</span> (<span class="keywordtype">unsigned</span> <span class="keywordtype">int</span> d = 0; d &lt; n_components; ++<a class="code" href="namespacePhysics_1_1Elasticity_1_1Kinematics.html#a15728437b942dab0b0042eb06a407d2c">d</a>) </div><div class="line">      result[d] = matrix[d] * vector; </div><div class="line">    <span class="keywordflow">return</span> result; </div><div class="line">  } </div><div class="line"></div><div class="line">  <span class="keyword">template</span> &lt;<span class="keywordtype">int</span> dim, <span class="keyword">typename</span> Number&gt; </div><div class="line">  <span class="keyword">inline</span> <a class="code" href="config_8h.html#a1d1d58e8be15e5c4285f6892e5f33136">DEAL_II_ALWAYS_INLINE</a> <span class="comment">// </span></div><div class="line">    <a class="code" href="classTensor.html">Tensor&lt;1, dim + 2, Number&gt;</a> </div><div class="line">    euler_numerical_flux(<span class="keyword">const</span> <a class="code" href="classTensor.html">Tensor&lt;1, dim + 2, Number&gt;</a> &amp;u_m, </div><div class="line">                         <span class="keyword">const</span> <a class="code" href="classTensor.html">Tensor&lt;1, dim + 2, Number&gt;</a> &amp;u_p, </div><div class="line">                         <span class="keyword">const</span> <a class="code" href="classTensor.html">Tensor&lt;1, dim, Number&gt;</a> &amp;    normal) </div><div class="line">  { </div><div class="line">    <span class="keyword">const</span> <span class="keyword">auto</span> velocity_m = euler_velocity&lt;dim&gt;(u_m); </div><div class="line">    <span class="keyword">const</span> <span class="keyword">auto</span> velocity_p = euler_velocity&lt;dim&gt;(u_p); </div><div class="line"></div><div class="line">    <span class="keyword">const</span> <span class="keyword">auto</span> pressure_m = euler_pressure&lt;dim&gt;(u_m); </div><div class="line">    <span class="keyword">const</span> <span class="keyword">auto</span> pressure_p = euler_pressure&lt;dim&gt;(u_p); </div><div class="line"></div><div class="line">    <span class="keyword">const</span> <span class="keyword">auto</span> flux_m = euler_flux&lt;dim&gt;(u_m); </div><div class="line">    <span class="keyword">const</span> <span class="keyword">auto</span> flux_p = euler_flux&lt;dim&gt;(u_p); </div><div class="line"></div><div class="line">    <span class="keywordflow">switch</span> (numerical_flux_type) </div><div class="line">      { </div><div class="line">        <span class="keywordflow">case</span> lax_friedrichs_modified: </div><div class="line">          { </div><div class="line">            <span class="keyword">const</span> <span class="keyword">auto</span> lambda = </div><div class="line">              0.5 * <a class="code" href="vectorization_8h.html#a303f564e3c189251976da401ee2e44fa">std::sqrt</a>(<a class="code" href="namespaceVectorTools_1_1EvaluationFlags.html#ac6721740e24732d6afabcf28ddfc1ffda8e7f5b8545162dccd5ed717792bdf420">std::max</a>(velocity_p.norm_square() + </div><div class="line">                                         gamma * pressure_p * (1. / u_p[0]), </div><div class="line">                                       velocity_m.norm_square() + </div><div class="line">                                         gamma * pressure_m * (1. / u_m[0]))); </div><div class="line"></div><div class="line">            <span class="keywordflow">return</span> 0.5 * (flux_m * normal + flux_p * normal) + </div><div class="line">                   0.5 * lambda * (u_m - u_p); </div><div class="line">          } </div><div class="line"></div><div class="line">        <span class="keywordflow">case</span> harten_lax_vanleer: </div><div class="line">          { </div><div class="line">            <span class="keyword">const</span> <span class="keyword">auto</span> avg_velocity_normal = </div><div class="line">              0.5 * ((velocity_m + velocity_p) * normal); </div><div class="line">            <span class="keyword">const</span> <span class="keyword">auto</span>   avg_c = <a class="code" href="vectorization_8h.html#a303f564e3c189251976da401ee2e44fa">std::sqrt</a>(std::abs( </div><div class="line">              0.5 * gamma * </div><div class="line">              (pressure_p * (1. / u_p[0]) + pressure_m * (1. / u_m[0])))); </div><div class="line">            <span class="keyword">const</span> Number s_pos = </div><div class="line">              <a class="code" href="namespaceVectorTools_1_1EvaluationFlags.html#ac6721740e24732d6afabcf28ddfc1ffda8e7f5b8545162dccd5ed717792bdf420">std::max</a>(Number(), avg_velocity_normal + avg_c); </div><div class="line">            <span class="keyword">const</span> Number s_neg = </div><div class="line">              <a class="code" href="namespaceVectorTools_1_1EvaluationFlags.html#ac6721740e24732d6afabcf28ddfc1ffdaeb244a97c0c9e9e7ca4765e096f0badc">std::min</a>(Number(), avg_velocity_normal - avg_c); </div><div class="line">            <span class="keyword">const</span> Number inverse_s = Number(1.) / (s_pos - s_neg); </div><div class="line"></div><div class="line">            <span class="keywordflow">return</span> inverse_s * </div><div class="line">                   ((s_pos * (flux_m * normal) - s_neg * (flux_p * normal)) - </div><div class="line">                    s_pos * s_neg * (u_m - u_p)); </div><div class="line">          } </div><div class="line"></div><div class="line">        <span class="keywordflow">default</span>: </div><div class="line">          { </div><div class="line">            <a class="code" href="group__Exceptions.html#ga70a0bb353656e704acf927945277bbc6">Assert</a>(<span class="keyword">false</span>, <a class="code" href="group__Exceptions.html#ga7b52b286796c23ef9ff178faf7a4b68f">ExcNotImplemented</a>()); </div><div class="line">            <span class="keywordflow">return</span> {}; </div><div class="line">          } </div><div class="line">      } </div><div class="line">  } </div><div class="line"></div><div class="line"></div><div class="line">  <span class="keyword">template</span> &lt;<span class="keywordtype">int</span> dim, <span class="keyword">typename</span> VectorizedArrayType&gt; </div><div class="line">  VectorizedArrayType </div><div class="line">  evaluate_function(<span class="keyword">const</span> <a class="code" href="classFunction.html">Function&lt;dim&gt;</a> &amp;                  <span class="keyword">function</span>, </div><div class="line">                    <span class="keyword">const</span> <a class="code" href="classPoint.html">Point&lt;dim, VectorizedArrayType&gt;</a> &amp;p_vectorized, </div><div class="line">                    <span class="keyword">const</span> <span class="keywordtype">unsigned</span> <span class="keywordtype">int</span>                     component) </div><div class="line">  { </div><div class="line">    VectorizedArrayType result; </div><div class="line">    <span class="keywordflow">for</span> (<span class="keywordtype">unsigned</span> <span class="keywordtype">int</span> v = 0; v &lt; VectorizedArrayType::size(); ++v) </div><div class="line">      { </div><div class="line">        <a class="code" href="classPoint.html">Point&lt;dim&gt;</a> p; </div><div class="line">        <span class="keywordflow">for</span> (<span class="keywordtype">unsigned</span> <span class="keywordtype">int</span> d = 0; d &lt; dim; ++<a class="code" href="namespacePhysics_1_1Elasticity_1_1Kinematics.html#a15728437b942dab0b0042eb06a407d2c">d</a>) </div><div class="line">          p[d] = p_vectorized[d][v]; </div><div class="line">        result[v] = <span class="keyword">function</span>.value(p, component); </div><div class="line">      } </div><div class="line">    <span class="keywordflow">return</span> result; </div><div class="line">  } </div><div class="line"></div><div class="line">  <span class="keyword">template</span> &lt;<span class="keywordtype">int</span> dim, <span class="keyword">typename</span> VectorizedArrayType, <span class="keywordtype">int</span> n_components = dim + 2&gt; </div><div class="line">  <a class="code" href="classTensor.html">Tensor&lt;1, n_components, VectorizedArrayType&gt;</a> </div><div class="line">  evaluate_function(<span class="keyword">const</span> <a class="code" href="classFunction.html">Function&lt;dim&gt;</a> &amp;                  <span class="keyword">function</span>, </div><div class="line">                    <span class="keyword">const</span> <a class="code" href="classPoint.html">Point&lt;dim, VectorizedArrayType&gt;</a> &amp;p_vectorized) </div><div class="line">  { </div><div class="line">    <a class="code" href="group__Exceptions.html#ga9442b63275c9ef3fab29bc222831c49c">AssertDimension</a>(<span class="keyword">function</span>.n_components, n_components); </div><div class="line">    <a class="code" href="classTensor.html">Tensor&lt;1, n_components, VectorizedArrayType&gt;</a> result; </div><div class="line">    <span class="keywordflow">for</span> (<span class="keywordtype">unsigned</span> <span class="keywordtype">int</span> v = 0; v &lt; VectorizedArrayType::size(); ++v) </div><div class="line">      { </div><div class="line">        <a class="code" href="classPoint.html">Point&lt;dim&gt;</a> p; </div><div class="line">        <span class="keywordflow">for</span> (<span class="keywordtype">unsigned</span> <span class="keywordtype">int</span> d = 0; d &lt; dim; ++<a class="code" href="namespacePhysics_1_1Elasticity_1_1Kinematics.html#a15728437b942dab0b0042eb06a407d2c">d</a>) </div><div class="line">          p[d] = p_vectorized[d][v]; </div><div class="line">        <span class="keywordflow">for</span> (<span class="keywordtype">unsigned</span> <span class="keywordtype">int</span> d = 0; d &lt; n_components; ++<a class="code" href="namespacePhysics_1_1Elasticity_1_1Kinematics.html#a15728437b942dab0b0042eb06a407d2c">d</a>) </div><div class="line">          result[d][v] = <span class="keyword">function</span>.value(p, d); </div><div class="line">      } </div><div class="line">    <span class="keywordflow">return</span> result; </div><div class="line">  } </div><div class="line"></div><div class="line"></div><div class="line">  <span class="keyword">template</span> &lt;<span class="keywordtype">int</span> dim, <span class="keywordtype">int</span> degree, <span class="keywordtype">int</span> n_po<span class="keywordtype">int</span>s_1d&gt; </div><div class="line">  <span class="keyword">class </span>EulerOperator </div><div class="line">  { </div><div class="line">  <span class="keyword">public</span>: </div><div class="line">    <span class="keyword">static</span> constexpr <span class="keywordtype">unsigned</span> <span class="keywordtype">int</span> n_quadrature_points_1d = n_points_1d; </div><div class="line"></div><div class="line">    EulerOperator(<a class="code" href="classTimerOutput.html">TimerOutput</a> &amp;timer_output); </div><div class="line"></div><div class="line">    ~EulerOperator(); </div><div class="line"></div><div class="line">    <span class="keywordtype">void</span> <a class="code" href="namespaceinternal.html#a38181f4582ff69679bda7d8e31c37291">reinit</a>(<span class="keyword">const</span> <a class="code" href="classMapping.html">Mapping&lt;dim&gt;</a> &amp;   mapping, </div><div class="line">                <span class="keyword">const</span> <a class="code" href="classDoFHandler.html">DoFHandler&lt;dim&gt;</a> &amp;dof_handler); </div><div class="line"></div><div class="line">    <span class="keywordtype">void</span> set_inflow_boundary(<span class="keyword">const</span> <a class="code" href="classunsigned_01int.html">types::boundary_id</a>       boundary_id, </div><div class="line">                             std::unique_ptr&lt;<a class="code" href="classFunction.html">Function&lt;dim&gt;</a>&gt; inflow_function); </div><div class="line"></div><div class="line">    <span class="keywordtype">void</span> set_subsonic_outflow_boundary( </div><div class="line">      <span class="keyword">const</span> <a class="code" href="classunsigned_01int.html">types::boundary_id</a>       boundary_id, </div><div class="line">      std::unique_ptr&lt;<a class="code" href="classFunction.html">Function&lt;dim&gt;</a>&gt; outflow_energy); </div><div class="line"></div><div class="line">    <span class="keywordtype">void</span> set_wall_boundary(<span class="keyword">const</span> <a class="code" href="classunsigned_01int.html">types::boundary_id</a> boundary_id); </div><div class="line"></div><div class="line">    <span class="keywordtype">void</span> set_body_force(std::unique_ptr&lt;<a class="code" href="classFunction.html">Function&lt;dim&gt;</a>&gt; body_force); </div><div class="line"></div><div class="line">    <span class="keywordtype">void</span> </div><div class="line">    perform_stage(<span class="keyword">const</span> <span class="keywordtype">unsigned</span> <span class="keywordtype">int</span>                                stage, </div><div class="line">                  <span class="keyword">const</span> Number                                      cur_time, </div><div class="line">                  <span class="keyword">const</span> Number                                      bi, </div><div class="line">                  <span class="keyword">const</span> Number                                      ai, </div><div class="line">                  <span class="keyword">const</span> <a class="code" href="classLinearAlgebra_1_1distributed_1_1Vector.html">LinearAlgebra::distributed::Vector&lt;Number&gt;</a> &amp;current_ri, </div><div class="line">                  <a class="code" href="classLinearAlgebra_1_1distributed_1_1Vector.html">LinearAlgebra::distributed::Vector&lt;Number&gt;</a> &amp;      vec_ki, </div><div class="line">                  <a class="code" href="classLinearAlgebra_1_1distributed_1_1Vector.html">LinearAlgebra::distributed::Vector&lt;Number&gt;</a> &amp;solution) <span class="keyword">const</span>; </div><div class="line"></div><div class="line">    <span class="keywordtype">void</span> <a class="code" href="namespaceVectorTools.html#ac6b404bf03cb2a742b290421cc2789fe">project</a>(<span class="keyword">const</span> <a class="code" href="classFunction.html">Function&lt;dim&gt;</a> &amp;                       <span class="keyword">function</span>, </div><div class="line">                 <a class="code" href="classLinearAlgebra_1_1distributed_1_1Vector.html">LinearAlgebra::distributed::Vector&lt;Number&gt;</a> &amp;solution) <span class="keyword">const</span>; </div><div class="line"></div><div class="line">    std::array&lt;double, 3&gt; compute_errors( </div><div class="line">      <span class="keyword">const</span> <a class="code" href="classFunction.html">Function&lt;dim&gt;</a> &amp;                             <span class="keyword">function</span>, </div><div class="line">      <span class="keyword">const</span> <a class="code" href="classLinearAlgebra_1_1distributed_1_1Vector.html">LinearAlgebra::distributed::Vector&lt;Number&gt;</a> &amp;solution) <span class="keyword">const</span>; </div><div class="line"></div><div class="line">    <span class="keywordtype">double</span> compute_cell_transport_speed( </div><div class="line">      <span class="keyword">const</span> <a class="code" href="classLinearAlgebra_1_1distributed_1_1Vector.html">LinearAlgebra::distributed::Vector&lt;Number&gt;</a> &amp;solution) <span class="keyword">const</span>; </div><div class="line"></div><div class="line">    <span class="keywordtype">void</span> </div><div class="line">    initialize_vector(<a class="code" href="classLinearAlgebra_1_1distributed_1_1Vector.html">LinearAlgebra::distributed::Vector&lt;Number&gt;</a> &amp;vector) <span class="keyword">const</span>; </div><div class="line"></div><div class="line">  <span class="keyword">private</span>: </div><div class="line"></div><div class="line"></div><div class="line">    <a class="code" href="classMPI__Comm.html">MPI_Comm</a> subcommunicator; </div><div class="line"></div><div class="line">    <a class="code" href="classMatrixFree.html">MatrixFree&lt;dim, Number, VectorizedArrayType&gt;</a> data; </div><div class="line"></div><div class="line">    <a class="code" href="classTimerOutput.html">TimerOutput</a> &amp;timer; </div><div class="line"></div><div class="line">    std::map&lt;types::boundary_id, std::unique_ptr&lt;Function&lt;dim&gt;&gt;&gt; </div><div class="line">      inflow_boundaries; </div><div class="line">    std::map&lt;types::boundary_id, std::unique_ptr&lt;Function&lt;dim&gt;&gt;&gt; </div><div class="line">                                   subsonic_outflow_boundaries; </div><div class="line">    std::set&lt;types::boundary_id&gt;   wall_boundaries; </div><div class="line">    std::unique_ptr&lt;Function&lt;dim&gt;&gt; body_force; </div><div class="line">  }; </div><div class="line"></div><div class="line"></div><div class="line">  <span class="keyword">template</span> &lt;<span class="keywordtype">int</span> dim, <span class="keywordtype">int</span> degree, <span class="keywordtype">int</span> n_po<span class="keywordtype">int</span>s_1d&gt; </div><div class="line">  EulerOperator&lt;dim, degree, n_points_1d&gt;::EulerOperator(<a class="code" href="classTimerOutput.html">TimerOutput</a> &amp;timer) </div><div class="line">    : timer(timer) </div><div class="line">  { </div><div class="line"><span class="preprocessor">#if DEAL_II_MPI_VERSION_GTE(3, 0) </span></div><div class="line">    <span class="keywordflow">if</span> (group_size == 1) </div><div class="line">      { </div><div class="line">        this-&gt;subcommunicator = MPI_COMM_SELF; </div><div class="line">      } </div><div class="line">    <span class="keywordflow">else</span> <span class="keywordflow">if</span> (group_size == <a class="code" href="namespacenumbers.html#a8ae36952c7e0cc778b47b5371b3aeff1">numbers::invalid_unsigned_int</a>) </div><div class="line">      { </div><div class="line">        <span class="keyword">const</span> <span class="keyword">auto</span> rank = <a class="code" href="namespaceUtilities_1_1MPI.html#a895dcd8223a0ee6f0e6a80b80e2d5982">Utilities::MPI::this_mpi_process</a>(MPI_COMM_WORLD); </div><div class="line"></div><div class="line">        MPI_Comm_split_type(MPI_COMM_WORLD, </div><div class="line">                            MPI_COMM_TYPE_SHARED, </div><div class="line">                            rank, </div><div class="line">                            MPI_INFO_NULL, </div><div class="line">                            &amp;subcommunicator); </div><div class="line">      } </div><div class="line">    <span class="keywordflow">else</span> </div><div class="line">      { </div><div class="line">        <a class="code" href="group__Exceptions.html#ga70a0bb353656e704acf927945277bbc6">Assert</a>(<span class="keyword">false</span>, <a class="code" href="group__Exceptions.html#ga7b52b286796c23ef9ff178faf7a4b68f">ExcNotImplemented</a>()); </div><div class="line">      } </div><div class="line"><span class="preprocessor">#else </span></div><div class="line">    (void)subcommunicator; </div><div class="line">    (void)group_size; </div><div class="line">    this-&gt;subcommunicator = MPI_COMM_SELF; </div><div class="line"><span class="preprocessor">#endif </span></div><div class="line">  } </div><div class="line"></div><div class="line"></div><div class="line">  <span class="keyword">template</span> &lt;<span class="keywordtype">int</span> dim, <span class="keywordtype">int</span> degree, <span class="keywordtype">int</span> n_po<span class="keywordtype">int</span>s_1d&gt; </div><div class="line">  EulerOperator&lt;dim, degree, n_points_1d&gt;::~EulerOperator() </div><div class="line">  { </div><div class="line"><span class="preprocessor">#ifdef DEAL_II_WITH_MPI </span></div><div class="line">    <span class="keywordflow">if</span> (this-&gt;subcommunicator != MPI_COMM_SELF) </div><div class="line">      MPI_Comm_free(&amp;subcommunicator); </div><div class="line"><span class="preprocessor">#endif </span></div><div class="line">  } </div><div class="line"></div><div class="line"></div><div class="line">  <span class="keyword">template</span> &lt;<span class="keywordtype">int</span> dim, <span class="keywordtype">int</span> degree, <span class="keywordtype">int</span> n_po<span class="keywordtype">int</span>s_1d&gt; </div><div class="line">  <span class="keywordtype">void</span> <a class="code" href="namespaceinternal.html#a38181f4582ff69679bda7d8e31c37291">EulerOperator&lt;dim, degree, n_points_1d&gt;::reinit</a>( </div><div class="line">    <span class="keyword">const</span> <a class="code" href="classMapping.html">Mapping&lt;dim&gt;</a> &amp;   mapping, </div><div class="line">    <span class="keyword">const</span> <a class="code" href="classDoFHandler.html">DoFHandler&lt;dim&gt;</a> &amp;dof_handler) </div><div class="line">  { </div><div class="line">    <span class="keyword">const</span> std::vector&lt;const DoFHandler&lt;dim&gt; *&gt; dof_handlers = {&amp;dof_handler}; </div><div class="line">    <span class="keyword">const</span> <a class="code" href="classAffineConstraints.html">AffineConstraints&lt;double&gt;</a>            dummy; </div><div class="line">    <span class="keyword">const</span> std::vector&lt;const AffineConstraints&lt;double&gt; *&gt; constraints = {&amp;dummy}; </div><div class="line">    <span class="keyword">const</span> std::vector&lt;Quadrature&lt;1&gt;&gt; quadratures = {<a class="code" href="classQGauss.html">QGauss&lt;1&gt;</a>(n_q_points_1d), </div><div class="line">                                                    <a class="code" href="classQGauss.html">QGauss&lt;1&gt;</a>(fe_degree + 1)}; </div><div class="line"></div><div class="line">    <span class="keyword">typename</span> <a class="code" href="structMatrixFree_1_1AdditionalData.html">MatrixFree&lt;dim, Number, VectorizedArrayType&gt;::AdditionalData</a> </div><div class="line">      additional_data; </div><div class="line">    additional_data.<a class="code" href="structMatrixFree_1_1AdditionalData.html#aa5d597e6c4441d273f4100b6139a2552">mapping_update_flags</a> = </div><div class="line">      (<a class="code" href="group__feaccess.html#ggaa94b67d2fdcc390690c523f28019e52facbcc430975fa6af05f75ca786dc6fe20">update_gradients</a> | <a class="code" href="group__feaccess.html#ggaa94b67d2fdcc390690c523f28019e52fa714204722e9eeb43aadbd0d5ddc48c85">update_JxW_values</a> | <a class="code" href="group__feaccess.html#ggaa94b67d2fdcc390690c523f28019e52fad5c9ff886b9615349a5d04a6c782df4a">update_quadrature_points</a> | </div><div class="line">       <a class="code" href="group__feaccess.html#ggaa94b67d2fdcc390690c523f28019e52fa4057ca2f127aa619c65886a9d3ad4aea">update_values</a>); </div><div class="line">    additional_data.<a class="code" href="structMatrixFree_1_1AdditionalData.html#a5c25759917955940e0b2b74a6704012c">mapping_update_flags_inner_faces</a> = </div><div class="line">      (<a class="code" href="group__feaccess.html#ggaa94b67d2fdcc390690c523f28019e52fa714204722e9eeb43aadbd0d5ddc48c85">update_JxW_values</a> | <a class="code" href="group__feaccess.html#ggaa94b67d2fdcc390690c523f28019e52fad5c9ff886b9615349a5d04a6c782df4a">update_quadrature_points</a> | <a class="code" href="group__feaccess.html#ggaa94b67d2fdcc390690c523f28019e52fa5e7366a91c84a50ca4e7dbd43ca6369f">update_normal_vectors</a> | </div><div class="line">       <a class="code" href="group__feaccess.html#ggaa94b67d2fdcc390690c523f28019e52fa4057ca2f127aa619c65886a9d3ad4aea">update_values</a>); </div><div class="line">    additional_data.<a class="code" href="structMatrixFree_1_1AdditionalData.html#aa326b1a098e1c037334cc05bdc2decc6">mapping_update_flags_boundary_faces</a> = </div><div class="line">      (<a class="code" href="group__feaccess.html#ggaa94b67d2fdcc390690c523f28019e52fa714204722e9eeb43aadbd0d5ddc48c85">update_JxW_values</a> | <a class="code" href="group__feaccess.html#ggaa94b67d2fdcc390690c523f28019e52fad5c9ff886b9615349a5d04a6c782df4a">update_quadrature_points</a> | <a class="code" href="group__feaccess.html#ggaa94b67d2fdcc390690c523f28019e52fa5e7366a91c84a50ca4e7dbd43ca6369f">update_normal_vectors</a> | </div><div class="line">       <a class="code" href="group__feaccess.html#ggaa94b67d2fdcc390690c523f28019e52fa4057ca2f127aa619c65886a9d3ad4aea">update_values</a>); </div><div class="line">    additional_data.<a class="code" href="structMatrixFree_1_1AdditionalData.html#a0bcce2facca91b925d3e1a5a00c7704b">tasks_parallel_scheme</a> = </div><div class="line">      <a class="code" href="classMatrixFree.html">MatrixFree&lt;dim, Number, VectorizedArrayType&gt;::AdditionalData::none</a>; </div><div class="line"></div><div class="line"></div><div class="line">    <a class="code" href="namespaceMatrixFreeTools.html#ae034b98c0db11285fae23a08ef3f197f">MatrixFreeTools::categorize_by_boundary_ids</a>(dof_handler.<a class="code" href="classDoFHandler.html#a7797f796c0be511fbc7f230ccc22532e">get_triangulation</a>(), </div><div class="line">                                                additional_data); </div><div class="line"></div><div class="line"></div><div class="line">    additional_data.<a class="code" href="structMatrixFree_1_1AdditionalData.html#afdca3541da950e50d2e8dca2de4ceb90">communicator_sm</a> = subcommunicator; </div><div class="line"></div><div class="line">    data.reinit( </div><div class="line">      mapping, dof_handlers, constraints, quadratures, additional_data); </div><div class="line">  } </div><div class="line"></div><div class="line"></div><div class="line"></div><div class="line"></div><div class="line"></div><div class="line"></div><div class="line"></div><div class="line"></div><div class="line">  <span class="keyword">template</span> &lt;<span class="keywordtype">int</span> dim, <span class="keywordtype">int</span> degree, <span class="keywordtype">int</span> n_po<span class="keywordtype">int</span>s_1d&gt; </div><div class="line">  <span class="keywordtype">void</span> EulerOperator&lt;dim, degree, n_points_1d&gt;::perform_stage( </div><div class="line">    <span class="keyword">const</span> <span class="keywordtype">unsigned</span> <span class="keywordtype">int</span>                                stage, </div><div class="line">    <span class="keyword">const</span> Number                                      current_time, </div><div class="line">    <span class="keyword">const</span> Number                                      bi, </div><div class="line">    <span class="keyword">const</span> Number                                      ai, </div><div class="line">    <span class="keyword">const</span> <a class="code" href="classLinearAlgebra_1_1distributed_1_1Vector.html">LinearAlgebra::distributed::Vector&lt;Number&gt;</a> &amp;current_ri, </div><div class="line">    <a class="code" href="classLinearAlgebra_1_1distributed_1_1Vector.html">LinearAlgebra::distributed::Vector&lt;Number&gt;</a> &amp;      vec_ki, </div><div class="line">    <a class="code" href="classLinearAlgebra_1_1distributed_1_1Vector.html">LinearAlgebra::distributed::Vector&lt;Number&gt;</a> &amp;      solution)<span class="keyword"> const </span></div><div class="line"><span class="keyword">  </span>{ </div><div class="line">    <span class="keywordflow">for</span> (<span class="keyword">auto</span> &amp;i : inflow_boundaries) </div><div class="line">      i.second-&gt;set_time(current_time); </div><div class="line">    <span class="keywordflow">for</span> (<span class="keyword">auto</span> &amp;i : subsonic_outflow_boundaries) </div><div class="line">      i.second-&gt;set_time(current_time); </div><div class="line"></div><div class="line"></div><div class="line">    data.template loop_cell_centric&lt;LinearAlgebra::distributed::Vector&lt;Number&gt;, </div><div class="line">                                    <a class="code" href="classLinearAlgebra_1_1distributed_1_1Vector.html">LinearAlgebra::distributed::Vector&lt;Number&gt;</a>&gt;( </div><div class="line">      [&amp;](<span class="keyword">const</span> <span class="keyword">auto</span> &amp;data, <span class="keyword">auto</span> &amp;dst, <span class="keyword">const</span> <span class="keyword">auto</span> &amp;src, <span class="keyword">const</span> <span class="keyword">auto</span> cell_range) { </div><div class="line">        <span class="keyword">using</span> FECellIntegral = <a class="code" href="classFEEvaluation.html">FEEvaluation</a>&lt;dim, </div><div class="line">                                            degree, </div><div class="line">                                            n_points_1d, </div><div class="line">                                            dim + 2, </div><div class="line">                                            Number, </div><div class="line">                                            VectorizedArrayType&gt;; </div><div class="line">        <span class="keyword">using</span> FEFaceIntegral = <a class="code" href="classFEFaceEvaluation.html">FEFaceEvaluation</a>&lt;dim, </div><div class="line">                                                degree, </div><div class="line">                                                n_points_1d, </div><div class="line">                                                dim + 2, </div><div class="line">                                                Number, </div><div class="line">                                                VectorizedArrayType&gt;; </div><div class="line"></div><div class="line">        FECellIntegral phi(data); </div><div class="line">        FECellIntegral phi_temp(data); </div><div class="line">        FEFaceIntegral phi_m(data, <span class="keyword">true</span>); </div><div class="line">        FEFaceIntegral phi_p(data, <span class="keyword">false</span>); </div><div class="line"></div><div class="line">        <a class="code" href="classTensor.html">Tensor&lt;1, dim, VectorizedArrayType&gt;</a>     constant_body_force; </div><div class="line">        <span class="keyword">const</span> <a class="code" href="classFunctions_1_1ConstantFunction.html">Functions::ConstantFunction&lt;dim&gt;</a> *constant_function = </div><div class="line">          <span class="keyword">dynamic_cast&lt;</span><a class="code" href="classFunctions_1_1ConstantFunction.html">Functions::ConstantFunction&lt;dim&gt;</a> *<span class="keyword">&gt;</span>(body_force.get()); </div><div class="line"></div><div class="line">        <span class="keywordflow">if</span> (constant_function) </div><div class="line">          constant_body_force = </div><div class="line">            evaluate_function&lt;dim, VectorizedArrayType, dim&gt;( </div><div class="line">              *constant_function, <a class="code" href="classPoint.html">Point&lt;dim, VectorizedArrayType&gt;</a>()); </div><div class="line"></div><div class="line">        const ::internal::EvaluatorTensorProduct&lt; </div><div class="line">          <a class="code" href="group__CUDAWrappers.html#ggac8e56c1f8d3d4947aa030c9d14308a3bab70b25f96672253ddf82a276d3563956">::internal::EvaluatorVariant::evaluate_evenodd</a>, </div><div class="line">          dim, </div><div class="line">          n_points_1d, </div><div class="line">          n_points_1d, </div><div class="line">          VectorizedArrayType&gt; </div><div class="line">          eval(<a class="code" href="classAlignedVector.html">AlignedVector&lt;VectorizedArrayType&gt;</a>(), </div><div class="line">               data.get_shape_info().<a class="code" href="classAlignedVector.html#a60d3ec3ed58e7c10cb66288834220cd3">data</a>[0].shape_gradients_collocation_eo, </div><div class="line">               <a class="code" href="classAlignedVector.html">AlignedVector&lt;VectorizedArrayType&gt;</a>()); </div><div class="line"></div><div class="line">        <a class="code" href="classAlignedVector.html">AlignedVector&lt;VectorizedArrayType&gt;</a> buffer(phi.static_n_q_points * </div><div class="line">                                                  phi.n_components); </div><div class="line"></div><div class="line"></div><div class="line">        <span class="keywordflow">for</span> (<span class="keywordtype">unsigned</span> <span class="keywordtype">int</span> cell = cell_range.first; cell &lt; cell_range.second; </div><div class="line">             ++cell) </div><div class="line">          { </div><div class="line">            phi.reinit(cell); </div><div class="line"></div><div class="line">            <span class="keywordflow">if</span> (ai != Number()) </div><div class="line">              phi_temp.reinit(cell); </div><div class="line"></div><div class="line"></div><div class="line">            <span class="keywordflow">if</span> (ai != Number() &amp;&amp; stage == 0) </div><div class="line">              { </div><div class="line">                phi.read_dof_values(src); </div><div class="line"></div><div class="line">                <span class="keywordflow">for</span> (<span class="keywordtype">unsigned</span> <span class="keywordtype">int</span> i = 0; </div><div class="line">                     i &lt; phi.static_dofs_per_component * (dim + 2); </div><div class="line">                     ++i) </div><div class="line">                  phi_temp.begin_dof_values()[i] = phi.begin_dof_values()[i]; </div><div class="line"></div><div class="line">                phi.evaluate(<a class="code" href="namespaceEvaluationFlags.html#a9b7c6d689cb76386839d0d13640f59aeaf9825c682f693a6a200094641a0d6a58">EvaluationFlags::values</a>); </div><div class="line">              } </div><div class="line">            <span class="keywordflow">else</span> </div><div class="line">              { </div><div class="line">                phi.gather_evaluate(src, <a class="code" href="namespaceEvaluationFlags.html#a9b7c6d689cb76386839d0d13640f59aeaf9825c682f693a6a200094641a0d6a58">EvaluationFlags::values</a>); </div><div class="line">              } </div><div class="line"></div><div class="line"></div><div class="line">            <span class="keywordflow">for</span> (<span class="keywordtype">unsigned</span> <span class="keywordtype">int</span> i = 0; i &lt; phi.static_n_q_points * (dim + 2); ++i) </div><div class="line">              buffer[i] = phi.begin_values()[i]; </div><div class="line"></div><div class="line"></div><div class="line">            <span class="keywordflow">for</span> (<span class="keywordtype">unsigned</span> <span class="keywordtype">int</span> q = 0; q &lt; phi.n_q_points; ++q) </div><div class="line">              { </div><div class="line">                <span class="keyword">const</span> <span class="keyword">auto</span> w_q = phi.get_value(q); </div><div class="line">                phi.submit_gradient(euler_flux&lt;dim&gt;(w_q), q); </div><div class="line">                <span class="keywordflow">if</span> (body_force.get() != <span class="keyword">nullptr</span>) </div><div class="line">                  { </div><div class="line">                    <span class="keyword">const</span> <a class="code" href="classTensor.html">Tensor&lt;1, dim, VectorizedArrayType&gt;</a> force = </div><div class="line">                      constant_function ? </div><div class="line">                        constant_body_force : </div><div class="line">                        evaluate_function&lt;dim, VectorizedArrayType, dim&gt;( </div><div class="line">                          *body_force, phi.quadrature_point(q)); </div><div class="line"></div><div class="line">                    <a class="code" href="classTensor.html">Tensor&lt;1, dim + 2, VectorizedArrayType&gt;</a> forcing; </div><div class="line">                    <span class="keywordflow">for</span> (<span class="keywordtype">unsigned</span> <span class="keywordtype">int</span> d = 0; d &lt; dim; ++<a class="code" href="namespacePhysics_1_1Elasticity_1_1Kinematics.html#a15728437b942dab0b0042eb06a407d2c">d</a>) </div><div class="line">                      forcing[d + 1] = w_q[0] * force[d]; </div><div class="line">                    <span class="keywordflow">for</span> (<span class="keywordtype">unsigned</span> <span class="keywordtype">int</span> d = 0; d &lt; dim; ++<a class="code" href="namespacePhysics_1_1Elasticity_1_1Kinematics.html#a15728437b942dab0b0042eb06a407d2c">d</a>) </div><div class="line">                      forcing[dim + 1] += force[d] * w_q[d + 1]; </div><div class="line"></div><div class="line">                    phi.submit_value(forcing, q); </div><div class="line">                  } </div><div class="line">              } </div><div class="line"></div><div class="line"></div><div class="line">            { </div><div class="line">              <span class="keyword">auto</span> *values_ptr   = phi.begin_values(); </div><div class="line">              <span class="keyword">auto</span> *gradient_ptr = phi.begin_gradients(); </div><div class="line"></div><div class="line">              <span class="keywordflow">for</span> (<span class="keywordtype">unsigned</span> <span class="keywordtype">int</span> c = 0; c &lt; dim + 2; ++c) </div><div class="line">                { </div><div class="line">                  <span class="keywordflow">if</span> (dim &gt;= 1 &amp;&amp; body_force.get() == <span class="keyword">nullptr</span>) </div><div class="line">                    eval.template gradients&lt;0, false, false&gt;( </div><div class="line">                      gradient_ptr + phi.static_n_q_points * 0, values_ptr); </div><div class="line">                  <span class="keywordflow">else</span> <span class="keywordflow">if</span> (dim &gt;= 1) </div><div class="line">                    eval.template gradients&lt;0, false, true&gt;( </div><div class="line">                      gradient_ptr + phi.static_n_q_points * 0, values_ptr); </div><div class="line">                  <span class="keywordflow">if</span> (dim &gt;= 2) </div><div class="line">                    eval.template gradients&lt;1, false, true&gt;( </div><div class="line">                      gradient_ptr + phi.static_n_q_points * 1, values_ptr); </div><div class="line">                  <span class="keywordflow">if</span> (dim &gt;= 3) </div><div class="line">                    eval.template gradients&lt;2, false, true&gt;( </div><div class="line">                      gradient_ptr + phi.static_n_q_points * 2, values_ptr); </div><div class="line"></div><div class="line">                  values_ptr += phi.static_n_q_points; </div><div class="line">                  gradient_ptr += phi.static_n_q_points * dim; </div><div class="line">                } </div><div class="line">            } </div><div class="line"></div><div class="line"></div><div class="line">            <span class="keywordflow">for</span> (<span class="keywordtype">unsigned</span> <span class="keywordtype">int</span> face = 0; </div><div class="line">                 face &lt; GeometryInfo&lt;dim&gt;::faces_per_cell; </div><div class="line">                 ++face) </div><div class="line">              { </div><div class="line"></div><div class="line"></div><div class="line">                <span class="keyword">const</span> <span class="keyword">auto</span> boundary_ids = </div><div class="line">                  data.get_faces_by_cells_boundary_id(cell, face); </div><div class="line"></div><div class="line">                <a class="code" href="group__Exceptions.html#ga70a0bb353656e704acf927945277bbc6">Assert</a>(std::equal(boundary_ids.begin(), </div><div class="line">                                  boundary_ids.begin() + </div><div class="line">                                    data.n_active_entries_per_cell_batch(cell), </div><div class="line">                                  boundary_ids.begin()), </div><div class="line">                       <a class="code" href="group__Exceptions.html#gae9a45f517af1401c50811a11083f9114">ExcMessage</a>(<span class="stringliteral">&quot;Boundary IDs of lanes differ.&quot;</span>)); </div><div class="line"></div><div class="line">                <span class="keyword">const</span> <span class="keyword">auto</span> boundary_id = boundary_ids[0]; </div><div class="line"></div><div class="line">                phi_m.reinit(cell, face); </div><div class="line"></div><div class="line"></div><div class="line">                <a class="code" href="structinternal_1_1FEFaceNormalEvaluationImpl.html">internal::FEFaceNormalEvaluationImpl</a>&lt;dim, </div><div class="line">                                                     n_points_1d - 1, </div><div class="line">                                                     VectorizedArrayType&gt;:: </div><div class="line">                  template interpolate_quadrature&lt;true, false&gt;( </div><div class="line">                    dim + 2, </div><div class="line">                    data.get_shape_info(), </div><div class="line">                    buffer.data(), </div><div class="line">                    phi_m.begin_values(), </div><div class="line">                    <span class="keyword">false</span>, </div><div class="line">                    face); </div><div class="line"></div><div class="line"></div><div class="line">                <span class="keywordflow">if</span> (boundary_id == <a class="code" href="namespacenumbers.html#a4e5d3fa25689151c833ba46dcc96fa5b">numbers::internal_face_boundary_id</a>) </div><div class="line">                  { </div><div class="line"></div><div class="line"></div><div class="line">                    phi_p.<a class="code" href="classFEFaceEvaluation.html#a45172115b15c8139f34216ceee323d5b">reinit</a>(cell, face); </div><div class="line">                    phi_p.gather_evaluate(src, <a class="code" href="namespaceEvaluationFlags.html#a9b7c6d689cb76386839d0d13640f59aeaf9825c682f693a6a200094641a0d6a58">EvaluationFlags::values</a>); </div><div class="line"></div><div class="line">                    <span class="keywordflow">for</span> (<span class="keywordtype">unsigned</span> <span class="keywordtype">int</span> q = 0; q &lt; phi_m.n_q_points; ++q) </div><div class="line">                      { </div><div class="line">                        <span class="keyword">const</span> <span class="keyword">auto</span> numerical_flux = </div><div class="line">                          euler_numerical_flux&lt;dim&gt;(phi_m.get_value(q), </div><div class="line">                                                    phi_p.get_value(q), </div><div class="line">                                                    phi_m.get_normal_vector(q)); </div><div class="line">                        phi_m.submit_value(-numerical_flux, q); </div><div class="line">                      } </div><div class="line">                  } </div><div class="line">                <span class="keywordflow">else</span> </div><div class="line">                  { </div><div class="line"></div><div class="line"></div><div class="line">                    <span class="keywordflow">for</span> (<span class="keywordtype">unsigned</span> <span class="keywordtype">int</span> q = 0; q &lt; phi_m.n_q_points; ++q) </div><div class="line">                      { </div><div class="line">                        <span class="keyword">const</span> <span class="keyword">auto</span> w_m    = phi_m.get_value(q); </div><div class="line">                        <span class="keyword">const</span> <span class="keyword">auto</span> normal = phi_m.get_normal_vector(q); </div><div class="line"></div><div class="line">                        <span class="keyword">auto</span> rho_u_dot_n = w_m[1] * normal[0]; </div><div class="line">                        <span class="keywordflow">for</span> (<span class="keywordtype">unsigned</span> <span class="keywordtype">int</span> d = 1; d &lt; dim; ++<a class="code" href="namespacePhysics_1_1Elasticity_1_1Kinematics.html#a15728437b942dab0b0042eb06a407d2c">d</a>) </div><div class="line">                          rho_u_dot_n += w_m[1 + d] * normal[d]; </div><div class="line"></div><div class="line">                        <span class="keywordtype">bool</span> at_outflow = <span class="keyword">false</span>; </div><div class="line"></div><div class="line">                        <a class="code" href="classTensor.html">Tensor&lt;1, dim + 2, VectorizedArrayType&gt;</a> w_p; </div><div class="line"></div><div class="line">                        <span class="keywordflow">if</span> (wall_boundaries.find(boundary_id) != </div><div class="line">                            wall_boundaries.end()) </div><div class="line">                          { </div><div class="line">                            w_p[0] = w_m[0]; </div><div class="line">                            <span class="keywordflow">for</span> (<span class="keywordtype">unsigned</span> <span class="keywordtype">int</span> d = 0; d &lt; dim; ++<a class="code" href="namespacePhysics_1_1Elasticity_1_1Kinematics.html#a15728437b942dab0b0042eb06a407d2c">d</a>) </div><div class="line">                              w_p[d + 1] = </div><div class="line">                                w_m[d + 1] - 2. * rho_u_dot_n * normal[d]; </div><div class="line">                            w_p[dim + 1] = w_m[dim + 1]; </div><div class="line">                          } </div><div class="line">                        <span class="keywordflow">else</span> <span class="keywordflow">if</span> (inflow_boundaries.find(boundary_id) != </div><div class="line">                                 inflow_boundaries.end()) </div><div class="line">                          w_p = evaluate_function( </div><div class="line">                            *inflow_boundaries.find(boundary_id)-&gt;second, </div><div class="line">                            phi_m.quadrature_point(q)); </div><div class="line">                        <span class="keywordflow">else</span> <span class="keywordflow">if</span> (subsonic_outflow_boundaries.find( </div><div class="line">                                   boundary_id) != </div><div class="line">                                 subsonic_outflow_boundaries.end()) </div><div class="line">                          { </div><div class="line">                            w_p = w_m; </div><div class="line">                            w_p[dim + 1] = </div><div class="line">                              evaluate_function(*subsonic_outflow_boundaries </div><div class="line">                                                   .find(boundary_id) </div><div class="line">                                                   -&gt;<a class="code" href="grid__out_8cc.html#a2cc229a4f1ffc75e83ed269d5f725729">second</a>, </div><div class="line">                                                phi_m.quadrature_point(q), </div><div class="line">                                                dim + 1); </div><div class="line">                            at_outflow = <span class="keyword">true</span>; </div><div class="line">                          } </div><div class="line">                        <span class="keywordflow">else</span> </div><div class="line">                          <a class="code" href="group__Exceptions.html#gafc0ca7ad85b3ebd64e8e51689ac85caf">AssertThrow</a>(<span class="keyword">false</span>, </div><div class="line">                                      <a class="code" href="group__Exceptions.html#gae9a45f517af1401c50811a11083f9114">ExcMessage</a>( </div><div class="line">                                        <span class="stringliteral">&quot;Unknown boundary id, did &quot;</span> </div><div class="line">                                        <span class="stringliteral">&quot;you set a boundary condition for &quot;</span> </div><div class="line">                                        <span class="stringliteral">&quot;this part of the domain boundary?&quot;</span>)); </div><div class="line"></div><div class="line">                        <span class="keyword">auto</span> flux = euler_numerical_flux&lt;dim&gt;(w_m, w_p, normal); </div><div class="line"></div><div class="line">                        <span class="keywordflow">if</span> (at_outflow) </div><div class="line">                          <span class="keywordflow">for</span> (<span class="keywordtype">unsigned</span> <span class="keywordtype">int</span> v = 0; </div><div class="line">                               v &lt; VectorizedArrayType::size(); </div><div class="line">                               ++v) </div><div class="line">                            { </div><div class="line">                              <span class="keywordflow">if</span> (rho_u_dot_n[v] &lt; -1e-12) </div><div class="line">                                <span class="keywordflow">for</span> (<span class="keywordtype">unsigned</span> <span class="keywordtype">int</span> d = 0; d &lt; dim; ++<a class="code" href="namespacePhysics_1_1Elasticity_1_1Kinematics.html#a15728437b942dab0b0042eb06a407d2c">d</a>) </div><div class="line">                                  flux[d + 1][v] = 0.; </div><div class="line">                            } </div><div class="line"></div><div class="line">                        phi_m.submit_value(-flux, q); </div><div class="line">                      } </div><div class="line">                  } </div><div class="line"></div><div class="line"></div><div class="line">                <a class="code" href="structinternal_1_1FEFaceNormalEvaluationImpl.html">internal::FEFaceNormalEvaluationImpl</a>&lt;dim, </div><div class="line">                                                     n_points_1d - 1, </div><div class="line">                                                     VectorizedArrayType&gt;:: </div><div class="line">                  template interpolate_quadrature&lt;false, true&gt;( </div><div class="line">                    dim + 2, </div><div class="line">                    data.get_shape_info(), </div><div class="line">                    phi_m.begin_values(), </div><div class="line">                    phi.begin_values(), </div><div class="line">                    <span class="keyword">false</span>, </div><div class="line">                    face); </div><div class="line">              } </div><div class="line"></div><div class="line"></div><div class="line">            <span class="keywordflow">for</span> (<span class="keywordtype">unsigned</span> <span class="keywordtype">int</span> q = 0; q &lt; phi.static_n_q_points; ++q) </div><div class="line">              { </div><div class="line">                <span class="keyword">const</span> <span class="keyword">auto</span> factor = VectorizedArrayType(1.0) / phi.<a class="code" href="classFEEvaluationBaseData.html#a56ed5a4e84edf92e69f1474d5f035a92">JxW</a>(q); </div><div class="line">                <span class="keywordflow">for</span> (<span class="keywordtype">unsigned</span> <span class="keywordtype">int</span> c = 0; c &lt; dim + 2; ++c) </div><div class="line">                  phi.begin_values()[c * phi.static_n_q_points + q] = </div><div class="line">                    phi.begin_values()[c * phi.static_n_q_points + q] * factor; </div><div class="line">              } </div><div class="line"></div><div class="line"></div><div class="line">            <a class="code" href="structinternal_1_1FEEvaluationImplBasisChange.html">internal::FEEvaluationImplBasisChange</a>&lt; </div><div class="line">              <a class="code" href="group__CUDAWrappers.html#ggac8e56c1f8d3d4947aa030c9d14308a3bab70b25f96672253ddf82a276d3563956">::internal::EvaluatorVariant::evaluate_evenodd</a>, </div><div class="line">              <a class="code" href="namespaceinternal.html#aa5bef221c94bc6b9c5441c306a72cdbaa13fcf221bed4879f9b319347525f703b">internal::EvaluatorQuantity::hessian</a>, </div><div class="line">              dim, </div><div class="line">              degree + 1, </div><div class="line">              n_points_1d, </div><div class="line">              VectorizedArrayType, </div><div class="line">              VectorizedArrayType&gt;::do_backward(dim + 2, </div><div class="line">                                                data.get_shape_info() </div><div class="line">                                                  .data[0] </div><div class="line">                                                  .inverse_shape_values_eo, </div><div class="line">                                                <span class="keyword">false</span>, </div><div class="line">                                                phi.begin_values(), </div><div class="line">                                                phi.begin_dof_values()); </div><div class="line"></div><div class="line"></div><div class="line">            <span class="keywordflow">if</span> (ai == Number()) </div><div class="line">              { </div><div class="line">                <span class="keywordflow">for</span> (<span class="keywordtype">unsigned</span> <span class="keywordtype">int</span> q = 0; q &lt; phi.static_dofs_per_cell; ++q) </div><div class="line">                  phi.begin_dof_values()[q] = bi * phi.begin_dof_values()[q]; </div><div class="line">                phi.distribute_local_to_global(solution); </div><div class="line">              } </div><div class="line">            <span class="keywordflow">else</span> </div><div class="line">              { </div><div class="line">                <span class="keywordflow">if</span> (stage != 0) </div><div class="line">                  phi_temp.read_dof_values(solution); </div><div class="line"></div><div class="line">                <span class="keywordflow">for</span> (<span class="keywordtype">unsigned</span> <span class="keywordtype">int</span> q = 0; q &lt; phi.static_dofs_per_cell; ++q) </div><div class="line">                  { </div><div class="line">                    <span class="keyword">const</span> <span class="keyword">auto</span> K_i = phi.begin_dof_values()[q]; </div><div class="line"></div><div class="line">                    phi.begin_dof_values()[q] = </div><div class="line">                      phi_temp.begin_dof_values()[q] + (ai * K_i); </div><div class="line"></div><div class="line">                    phi_temp.begin_dof_values()[q] += bi * K_i; </div><div class="line">                  } </div><div class="line">                phi.set_dof_values(dst); </div><div class="line">                phi_temp.set_dof_values(solution); </div><div class="line">              } </div><div class="line">          } </div><div class="line">      }, </div><div class="line">      vec_ki, </div><div class="line">      current_ri, </div><div class="line">      <span class="keyword">true</span>, </div><div class="line">      <a class="code" href="classMatrixFree.html">MatrixFree&lt;dim, Number, VectorizedArrayType&gt;::DataAccessOnFaces::values</a>); </div><div class="line">  } </div><div class="line"></div><div class="line"></div><div class="line">  <span class="keyword">template</span> &lt;<span class="keywordtype">int</span> dim, <span class="keywordtype">int</span> degree, <span class="keywordtype">int</span> n_po<span class="keywordtype">int</span>s_1d&gt; </div><div class="line">  <span class="keywordtype">void</span> EulerOperator&lt;dim, degree, n_points_1d&gt;::initialize_vector( </div><div class="line">    <a class="code" href="classLinearAlgebra_1_1distributed_1_1Vector.html">LinearAlgebra::distributed::Vector&lt;Number&gt;</a> &amp;vector)<span class="keyword"> const </span></div><div class="line"><span class="keyword">  </span>{ </div><div class="line">    data.initialize_dof_vector(vector); </div><div class="line">  } </div><div class="line"></div><div class="line">  <span class="keyword">template</span> &lt;<span class="keywordtype">int</span> dim, <span class="keywordtype">int</span> degree, <span class="keywordtype">int</span> n_po<span class="keywordtype">int</span>s_1d&gt; </div><div class="line">  <span class="keywordtype">void</span> EulerOperator&lt;dim, degree, n_points_1d&gt;::set_inflow_boundary( </div><div class="line">    <span class="keyword">const</span> <a class="code" href="classunsigned_01int.html">types::boundary_id</a>       boundary_id, </div><div class="line">    std::unique_ptr&lt;<a class="code" href="classFunction.html">Function&lt;dim&gt;</a>&gt; inflow_function) </div><div class="line">  { </div><div class="line">    <a class="code" href="group__Exceptions.html#gafc0ca7ad85b3ebd64e8e51689ac85caf">AssertThrow</a>(subsonic_outflow_boundaries.find(boundary_id) == </div><div class="line">                    subsonic_outflow_boundaries.end() &amp;&amp; </div><div class="line">                  wall_boundaries.find(boundary_id) == wall_boundaries.end(), </div><div class="line">                <a class="code" href="group__Exceptions.html#gae9a45f517af1401c50811a11083f9114">ExcMessage</a>(<span class="stringliteral">&quot;You already set the boundary with id &quot;</span> + </div><div class="line">                           <a class="code" href="namespacePatterns_1_1Tools.html#a72743302dcb1a0fb1f2f8dc5122d299e">std::to_string</a>(static_cast&lt;int&gt;(boundary_id)) + </div><div class="line">                           <span class="stringliteral">&quot; to another type of boundary before now setting &quot;</span> + </div><div class="line">                           <span class="stringliteral">&quot;it as inflow&quot;</span>)); </div><div class="line">    <a class="code" href="group__Exceptions.html#gafc0ca7ad85b3ebd64e8e51689ac85caf">AssertThrow</a>(inflow_function-&gt;n_components == dim + 2, </div><div class="line">                <a class="code" href="group__Exceptions.html#gae9a45f517af1401c50811a11083f9114">ExcMessage</a>(<span class="stringliteral">&quot;Expected function with dim+2 components&quot;</span>)); </div><div class="line"></div><div class="line">    inflow_boundaries[<a class="code" href="namespacetypes.html#aed8813fee8c8a2edcc6005e6a48c321a">boundary_id</a>] = std::move(inflow_function); </div><div class="line">  } </div><div class="line"></div><div class="line">  <span class="keyword">template</span> &lt;<span class="keywordtype">int</span> dim, <span class="keywordtype">int</span> degree, <span class="keywordtype">int</span> n_po<span class="keywordtype">int</span>s_1d&gt; </div><div class="line">  <span class="keywordtype">void</span> EulerOperator&lt;dim, degree, n_points_1d&gt;::set_subsonic_outflow_boundary( </div><div class="line">    <span class="keyword">const</span> <a class="code" href="classunsigned_01int.html">types::boundary_id</a>       boundary_id, </div><div class="line">    std::unique_ptr&lt;<a class="code" href="classFunction.html">Function&lt;dim&gt;</a>&gt; outflow_function) </div><div class="line">  { </div><div class="line">    <a class="code" href="group__Exceptions.html#gafc0ca7ad85b3ebd64e8e51689ac85caf">AssertThrow</a>(inflow_boundaries.find(boundary_id) == </div><div class="line">                    inflow_boundaries.end() &amp;&amp; </div><div class="line">                  wall_boundaries.find(boundary_id) == wall_boundaries.end(), </div><div class="line">                <a class="code" href="group__Exceptions.html#gae9a45f517af1401c50811a11083f9114">ExcMessage</a>(<span class="stringliteral">&quot;You already set the boundary with id &quot;</span> + </div><div class="line">                           <a class="code" href="namespacePatterns_1_1Tools.html#a72743302dcb1a0fb1f2f8dc5122d299e">std::to_string</a>(static_cast&lt;int&gt;(boundary_id)) + </div><div class="line">                           <span class="stringliteral">&quot; to another type of boundary before now setting &quot;</span> + </div><div class="line">                           <span class="stringliteral">&quot;it as subsonic outflow&quot;</span>)); </div><div class="line">    <a class="code" href="group__Exceptions.html#gafc0ca7ad85b3ebd64e8e51689ac85caf">AssertThrow</a>(outflow_function-&gt;n_components == dim + 2, </div><div class="line">                <a class="code" href="group__Exceptions.html#gae9a45f517af1401c50811a11083f9114">ExcMessage</a>(<span class="stringliteral">&quot;Expected function with dim+2 components&quot;</span>)); </div><div class="line"></div><div class="line">    subsonic_outflow_boundaries[<a class="code" href="namespacetypes.html#aed8813fee8c8a2edcc6005e6a48c321a">boundary_id</a>] = std::move(outflow_function); </div><div class="line">  } </div><div class="line"></div><div class="line">  <span class="keyword">template</span> &lt;<span class="keywordtype">int</span> dim, <span class="keywordtype">int</span> degree, <span class="keywordtype">int</span> n_po<span class="keywordtype">int</span>s_1d&gt; </div><div class="line">  <span class="keywordtype">void</span> EulerOperator&lt;dim, degree, n_points_1d&gt;::set_wall_boundary( </div><div class="line">    <span class="keyword">const</span> <a class="code" href="classunsigned_01int.html">types::boundary_id</a> boundary_id) </div><div class="line">  { </div><div class="line">    <a class="code" href="group__Exceptions.html#gafc0ca7ad85b3ebd64e8e51689ac85caf">AssertThrow</a>(inflow_boundaries.find(boundary_id) == </div><div class="line">                    inflow_boundaries.end() &amp;&amp; </div><div class="line">                  subsonic_outflow_boundaries.find(boundary_id) == </div><div class="line">                    subsonic_outflow_boundaries.end(), </div><div class="line">                <a class="code" href="group__Exceptions.html#gae9a45f517af1401c50811a11083f9114">ExcMessage</a>(<span class="stringliteral">&quot;You already set the boundary with id &quot;</span> + </div><div class="line">                           <a class="code" href="namespacePatterns_1_1Tools.html#a72743302dcb1a0fb1f2f8dc5122d299e">std::to_string</a>(static_cast&lt;int&gt;(boundary_id)) + </div><div class="line">                           <span class="stringliteral">&quot; to another type of boundary before now setting &quot;</span> + </div><div class="line">                           <span class="stringliteral">&quot;it as wall boundary&quot;</span>)); </div><div class="line"></div><div class="line">    wall_boundaries.insert(boundary_id); </div><div class="line">  } </div><div class="line"></div><div class="line">  <span class="keyword">template</span> &lt;<span class="keywordtype">int</span> dim, <span class="keywordtype">int</span> degree, <span class="keywordtype">int</span> n_po<span class="keywordtype">int</span>s_1d&gt; </div><div class="line">  <span class="keywordtype">void</span> EulerOperator&lt;dim, degree, n_points_1d&gt;::set_body_force( </div><div class="line">    std::unique_ptr&lt;<a class="code" href="classFunction.html">Function&lt;dim&gt;</a>&gt; body_force) </div><div class="line">  { </div><div class="line">    <a class="code" href="group__Exceptions.html#ga9442b63275c9ef3fab29bc222831c49c">AssertDimension</a>(body_force-&gt;n_components, dim); </div><div class="line"></div><div class="line">    this-&gt;body_force = std::move(body_force); </div><div class="line">  } </div><div class="line"></div><div class="line">  <span class="keyword">template</span> &lt;<span class="keywordtype">int</span> dim, <span class="keywordtype">int</span> degree, <span class="keywordtype">int</span> n_po<span class="keywordtype">int</span>s_1d&gt; </div><div class="line">  <span class="keywordtype">void</span> <a class="code" href="namespaceVectorTools.html#ac6b404bf03cb2a742b290421cc2789fe">EulerOperator&lt;dim, degree, n_points_1d&gt;::project</a>( </div><div class="line">    <span class="keyword">const</span> <a class="code" href="classFunction.html">Function&lt;dim&gt;</a> &amp;                       <span class="keyword">function</span>, </div><div class="line">    <a class="code" href="classLinearAlgebra_1_1distributed_1_1Vector.html">LinearAlgebra::distributed::Vector&lt;Number&gt;</a> &amp;solution)<span class="keyword"> const </span></div><div class="line"><span class="keyword">  </span>{ </div><div class="line">    <a class="code" href="classFEEvaluation.html">FEEvaluation&lt;dim, degree, degree + 1, dim + 2, Number, VectorizedArrayType&gt;</a> </div><div class="line">      phi(data, 0, 1); </div><div class="line">    <a class="code" href="classMatrixFreeOperators_1_1CellwiseInverseMassMatrix.html">MatrixFreeOperators::CellwiseInverseMassMatrix</a>&lt;dim, </div><div class="line">                                                   degree, </div><div class="line">                                                   dim + 2, </div><div class="line">                                                   Number, </div><div class="line">                                                   VectorizedArrayType&gt; </div><div class="line">      inverse(phi); </div><div class="line">    solution.<a class="code" href="classLinearAlgebra_1_1distributed_1_1Vector.html#a0242ed0c3e3664e6b4204d28a726a0b7">zero_out_ghost_values</a>(); </div><div class="line">    <span class="keywordflow">for</span> (<span class="keywordtype">unsigned</span> <span class="keywordtype">int</span> cell = 0; cell &lt; data.n_cell_batches(); ++cell) </div><div class="line">      { </div><div class="line">        phi.reinit(cell); </div><div class="line">        <span class="keywordflow">for</span> (<span class="keywordtype">unsigned</span> <span class="keywordtype">int</span> q = 0; q &lt; phi.n_q_points; ++q) </div><div class="line">          phi.submit_dof_value(evaluate_function(<span class="keyword">function</span>, </div><div class="line">                                                 phi.quadrature_point(q)), </div><div class="line">                               q); </div><div class="line">        inverse.transform_from_q_points_to_basis(dim + 2, </div><div class="line">                                                 phi.begin_dof_values(), </div><div class="line">                                                 phi.begin_dof_values()); </div><div class="line">        phi.set_dof_values(solution); </div><div class="line">      } </div><div class="line">  } </div><div class="line"></div><div class="line">  <span class="keyword">template</span> &lt;<span class="keywordtype">int</span> dim, <span class="keywordtype">int</span> degree, <span class="keywordtype">int</span> n_po<span class="keywordtype">int</span>s_1d&gt; </div><div class="line">  std::array&lt;double, 3&gt; EulerOperator&lt;dim, degree, n_points_1d&gt;::compute_errors( </div><div class="line">    <span class="keyword">const</span> <a class="code" href="classFunction.html">Function&lt;dim&gt;</a> &amp;                             <span class="keyword">function</span>, </div><div class="line">    <span class="keyword">const</span> <a class="code" href="classLinearAlgebra_1_1distributed_1_1Vector.html">LinearAlgebra::distributed::Vector&lt;Number&gt;</a> &amp;solution)<span class="keyword"> const </span></div><div class="line"><span class="keyword">  </span>{ </div><div class="line">    <a class="code" href="classTimerOutput_1_1Scope.html">TimerOutput::Scope</a> t(timer, <span class="stringliteral">&quot;compute errors&quot;</span>); </div><div class="line">    <span class="keywordtype">double</span>             errors_squared[3] = {}; </div><div class="line">    <a class="code" href="classFEEvaluation.html">FEEvaluation&lt;dim, degree, n_points_1d, dim + 2, Number, VectorizedArrayType&gt;</a> </div><div class="line">      phi(data, 0, 0); </div><div class="line"></div><div class="line">    <span class="keywordflow">for</span> (<span class="keywordtype">unsigned</span> <span class="keywordtype">int</span> cell = 0; cell &lt; data.n_cell_batches(); ++cell) </div><div class="line">      { </div><div class="line">        phi.reinit(cell); </div><div class="line">        phi.gather_evaluate(solution, <a class="code" href="namespaceEvaluationFlags.html#a9b7c6d689cb76386839d0d13640f59aeaf9825c682f693a6a200094641a0d6a58">EvaluationFlags::values</a>); </div><div class="line">        VectorizedArrayType local_errors_squared[3] = {}; </div><div class="line">        <span class="keywordflow">for</span> (<span class="keywordtype">unsigned</span> <span class="keywordtype">int</span> q = 0; q &lt; phi.n_q_points; ++q) </div><div class="line">          { </div><div class="line">            <span class="keyword">const</span> <span class="keyword">auto</span> error = </div><div class="line">              evaluate_function(<span class="keyword">function</span>, phi.quadrature_point(q)) - </div><div class="line">              phi.get_value(q); </div><div class="line">            <span class="keyword">const</span> <span class="keyword">auto</span> JxW = phi.JxW(q); </div><div class="line"></div><div class="line">            local_errors_squared[0] += error[0] * error[0] * JxW; </div><div class="line">            <span class="keywordflow">for</span> (<span class="keywordtype">unsigned</span> <span class="keywordtype">int</span> d = 0; d &lt; dim; ++<a class="code" href="namespacePhysics_1_1Elasticity_1_1Kinematics.html#a15728437b942dab0b0042eb06a407d2c">d</a>) </div><div class="line">              local_errors_squared[1] += (error[d + 1] * error[d + 1]) * JxW; </div><div class="line">            local_errors_squared[2] += (error[dim + 1] * error[dim + 1]) * JxW; </div><div class="line">          } </div><div class="line">        <span class="keywordflow">for</span> (<span class="keywordtype">unsigned</span> <span class="keywordtype">int</span> v = 0; v &lt; data.n_active_entries_per_cell_batch(cell); </div><div class="line">             ++v) </div><div class="line">          <span class="keywordflow">for</span> (<span class="keywordtype">unsigned</span> <span class="keywordtype">int</span> d = 0; d &lt; 3; ++<a class="code" href="namespacePhysics_1_1Elasticity_1_1Kinematics.html#a15728437b942dab0b0042eb06a407d2c">d</a>) </div><div class="line">            errors_squared[d] += local_errors_squared[d][v]; </div><div class="line">      } </div><div class="line"></div><div class="line">    <a class="code" href="namespaceUtilities_1_1MPI.html#ab544a3bf3301a6dd3e705ee352c5551b">Utilities::MPI::sum</a>(errors_squared, MPI_COMM_WORLD, errors_squared); </div><div class="line"></div><div class="line">    std::array&lt;double, 3&gt; errors; </div><div class="line">    <span class="keywordflow">for</span> (<span class="keywordtype">unsigned</span> <span class="keywordtype">int</span> d = 0; d &lt; 3; ++<a class="code" href="namespacePhysics_1_1Elasticity_1_1Kinematics.html#a15728437b942dab0b0042eb06a407d2c">d</a>) </div><div class="line">      errors[d] = std::sqrt(errors_squared[d]); </div><div class="line"></div><div class="line">    <span class="keywordflow">return</span> errors; </div><div class="line">  } </div><div class="line"></div><div class="line">  <span class="keyword">template</span> &lt;<span class="keywordtype">int</span> dim, <span class="keywordtype">int</span> degree, <span class="keywordtype">int</span> n_po<span class="keywordtype">int</span>s_1d&gt; </div><div class="line">  <span class="keywordtype">double</span> EulerOperator&lt;dim, degree, n_points_1d&gt;::compute_cell_transport_speed( </div><div class="line">    <span class="keyword">const</span> <a class="code" href="classLinearAlgebra_1_1distributed_1_1Vector.html">LinearAlgebra::distributed::Vector&lt;Number&gt;</a> &amp;solution)<span class="keyword"> const </span></div><div class="line"><span class="keyword">  </span>{ </div><div class="line">    <a class="code" href="classTimerOutput_1_1Scope.html">TimerOutput::Scope</a> t(timer, <span class="stringliteral">&quot;compute transport speed&quot;</span>); </div><div class="line">    Number             max_transport = 0; </div><div class="line">    <a class="code" href="classFEEvaluation.html">FEEvaluation&lt;dim, degree, degree + 1, dim + 2, Number, VectorizedArrayType&gt;</a> </div><div class="line">      phi(data, 0, 1); </div><div class="line"></div><div class="line">    <span class="keywordflow">for</span> (<span class="keywordtype">unsigned</span> <span class="keywordtype">int</span> cell = 0; cell &lt; data.n_cell_batches(); ++cell) </div><div class="line">      { </div><div class="line">        phi.reinit(cell); </div><div class="line">        phi.gather_evaluate(solution, <a class="code" href="namespaceEvaluationFlags.html#a9b7c6d689cb76386839d0d13640f59aeaf9825c682f693a6a200094641a0d6a58">EvaluationFlags::values</a>); </div><div class="line">        VectorizedArrayType local_max = 0.; </div><div class="line">        <span class="keywordflow">for</span> (<span class="keywordtype">unsigned</span> <span class="keywordtype">int</span> q = 0; q &lt; phi.n_q_points; ++q) </div><div class="line">          { </div><div class="line">            <span class="keyword">const</span> <span class="keyword">auto</span> solution = phi.get_value(q); </div><div class="line">            <span class="keyword">const</span> <span class="keyword">auto</span> velocity = euler_velocity&lt;dim&gt;(solution); </div><div class="line">            <span class="keyword">const</span> <span class="keyword">auto</span> pressure = euler_pressure&lt;dim&gt;(solution); </div><div class="line"></div><div class="line">            <span class="keyword">const</span> <span class="keyword">auto</span>          inverse_jacobian = phi.inverse_jacobian(q); </div><div class="line">            <span class="keyword">const</span> <span class="keyword">auto</span>          convective_speed = inverse_jacobian * velocity; </div><div class="line">            VectorizedArrayType convective_limit = 0.; </div><div class="line">            <span class="keywordflow">for</span> (<span class="keywordtype">unsigned</span> <span class="keywordtype">int</span> d = 0; d &lt; dim; ++<a class="code" href="namespacePhysics_1_1Elasticity_1_1Kinematics.html#a15728437b942dab0b0042eb06a407d2c">d</a>) </div><div class="line">              convective_limit = </div><div class="line">                <a class="code" href="namespaceVectorTools_1_1EvaluationFlags.html#ac6721740e24732d6afabcf28ddfc1ffda8e7f5b8545162dccd5ed717792bdf420">std::max</a>(convective_limit, std::abs(convective_speed[d])); </div><div class="line"></div><div class="line">            <span class="keyword">const</span> <span class="keyword">auto</span> speed_of_sound = </div><div class="line">              <a class="code" href="vectorization_8h.html#a303f564e3c189251976da401ee2e44fa">std::sqrt</a>(gamma * pressure * (1. / solution[0])); </div><div class="line"></div><div class="line">            <a class="code" href="classTensor.html">Tensor&lt;1, dim, VectorizedArrayType&gt;</a> eigenvector; </div><div class="line">            <span class="keywordflow">for</span> (<span class="keywordtype">unsigned</span> <span class="keywordtype">int</span> d = 0; d &lt; dim; ++<a class="code" href="namespacePhysics_1_1Elasticity_1_1Kinematics.html#a15728437b942dab0b0042eb06a407d2c">d</a>) </div><div class="line">              eigenvector[d] = 1.; </div><div class="line">            <span class="keywordflow">for</span> (<span class="keywordtype">unsigned</span> <span class="keywordtype">int</span> i = 0; i &lt; 5; ++i) </div><div class="line">              { </div><div class="line">                eigenvector = <a class="code" href="derivative__form_8h.html#a3c201452e8dd28e4f5be4a316cb9305f">transpose</a>(inverse_jacobian) * </div><div class="line">                              (inverse_jacobian * eigenvector); </div><div class="line">                VectorizedArrayType eigenvector_norm = 0.; </div><div class="line">                <span class="keywordflow">for</span> (<span class="keywordtype">unsigned</span> <span class="keywordtype">int</span> d = 0; d &lt; dim; ++<a class="code" href="namespacePhysics_1_1Elasticity_1_1Kinematics.html#a15728437b942dab0b0042eb06a407d2c">d</a>) </div><div class="line">                  eigenvector_norm = </div><div class="line">                    <a class="code" href="namespaceVectorTools_1_1EvaluationFlags.html#ac6721740e24732d6afabcf28ddfc1ffda8e7f5b8545162dccd5ed717792bdf420">std::max</a>(eigenvector_norm, std::abs(eigenvector[d])); </div><div class="line">                eigenvector /= eigenvector_norm; </div><div class="line">              } </div><div class="line">            <span class="keyword">const</span> <span class="keyword">auto</span> jac_times_ev   = inverse_jacobian * eigenvector; </div><div class="line">            <span class="keyword">const</span> <span class="keyword">auto</span> max_eigenvalue = <a class="code" href="vectorization_8h.html#a303f564e3c189251976da401ee2e44fa">std::sqrt</a>( </div><div class="line">              (jac_times_ev * jac_times_ev) / (eigenvector * eigenvector)); </div><div class="line">            local_max = </div><div class="line">              <a class="code" href="namespaceVectorTools_1_1EvaluationFlags.html#ac6721740e24732d6afabcf28ddfc1ffda8e7f5b8545162dccd5ed717792bdf420">std::max</a>(local_max, </div><div class="line">                       max_eigenvalue * speed_of_sound + convective_limit); </div><div class="line">          } </div><div class="line"></div><div class="line">        <span class="keywordflow">for</span> (<span class="keywordtype">unsigned</span> <span class="keywordtype">int</span> v = 0; v &lt; data.n_active_entries_per_cell_batch(cell); </div><div class="line">             ++v) </div><div class="line">          <span class="keywordflow">for</span> (<span class="keywordtype">unsigned</span> <span class="keywordtype">int</span> d = 0; d &lt; 3; ++<a class="code" href="namespacePhysics_1_1Elasticity_1_1Kinematics.html#a15728437b942dab0b0042eb06a407d2c">d</a>) </div><div class="line">            max_transport = <a class="code" href="namespaceVectorTools_1_1EvaluationFlags.html#ac6721740e24732d6afabcf28ddfc1ffda8e7f5b8545162dccd5ed717792bdf420">std::max</a>(max_transport, local_max[v]); </div><div class="line">      } </div><div class="line"></div><div class="line">    max_transport = <a class="code" href="namespaceUtilities_1_1MPI.html#ad2f716b789abe53715d6659f38aa7815">Utilities::MPI::max</a>(max_transport, MPI_COMM_WORLD); </div><div class="line"></div><div class="line">    <span class="keywordflow">return</span> max_transport; </div><div class="line">  } </div><div class="line"></div><div class="line">  <span class="keyword">template</span> &lt;<span class="keywordtype">int</span> dim&gt;</div><div class="line">  <span class="keyword">class </span>EulerProblem </div><div class="line">  { </div><div class="line">  <span class="keyword">public</span>: </div><div class="line">    EulerProblem(); </div><div class="line"></div><div class="line">    <span class="keywordtype">void</span> <a class="code" href="namespaceWorkStream_1_1internal_1_1tbb__no__coloring.html#a8673698a405bf47aa24002aeb6d76d70">run</a>(); </div><div class="line"></div><div class="line">  <span class="keyword">private</span>: </div><div class="line">    <span class="keywordtype">void</span> make_grid_and_dofs(); </div><div class="line"></div><div class="line">    <span class="keywordtype">void</span> output_results(<span class="keyword">const</span> <span class="keywordtype">unsigned</span> <span class="keywordtype">int</span> result_number); </div><div class="line"></div><div class="line">    <a class="code" href="classLinearAlgebra_1_1distributed_1_1Vector.html">LinearAlgebra::distributed::Vector&lt;Number&gt;</a> solution; </div><div class="line"></div><div class="line">    <a class="code" href="classConditionalOStream.html">ConditionalOStream</a> pcout;</div><div class="line"></div><div class="line"></div><div class="line"><span class="preprocessor">#ifdef DEAL_II_WITH_P4EST </span></div><div class="line">    <a class="code" href="classparallel_1_1distributed_1_1Triangulation.html">parallel::distributed::Triangulation&lt;dim&gt;</a> <a class="code" href="p4est__wrappers_8cc.html#ace00f2f80d9780ef9aa1007e1c22c6a4">triangulation</a>; </div><div class="line"><span class="preprocessor">#else </span></div><div class="line">    <a class="code" href="classTriangulation.html">Triangulation&lt;dim&gt;</a> <a class="code" href="p4est__wrappers_8cc.html#ace00f2f80d9780ef9aa1007e1c22c6a4">triangulation</a>; </div><div class="line"><span class="preprocessor">#endif </span></div><div class="line"></div><div class="line">    <a class="code" href="classFESystem.html">FESystem&lt;dim&gt;</a>        fe; </div><div class="line">    <a class="code" href="classMappingQGeneric.html">MappingQGeneric&lt;dim&gt;</a> mapping; </div><div class="line">    <a class="code" href="classDoFHandler.html">DoFHandler&lt;dim&gt;</a>      dof_handler; </div><div class="line"></div><div class="line">    <a class="code" href="classTimerOutput.html">TimerOutput</a> timer; </div><div class="line"></div><div class="line">    EulerOperator&lt;dim, fe_degree, n_q_points_1d&gt; euler_operator; </div><div class="line"></div><div class="line">    <span class="keywordtype">double</span> time, time_step; </div><div class="line"></div><div class="line">    <span class="keyword">class </span>Postprocessor : <span class="keyword">public</span> <a class="code" href="classDataPostprocessor.html">DataPostprocessor</a>&lt;dim&gt; </div><div class="line">    { </div><div class="line">    <span class="keyword">public</span>: </div><div class="line">      Postprocessor(); </div><div class="line"></div><div class="line">      <span class="keyword">virtual</span> <span class="keywordtype">void</span> evaluate_vector_field( </div><div class="line">        <span class="keyword">const</span> <a class="code" href="structDataPostprocessorInputs_1_1Vector.html">DataPostprocessorInputs::Vector&lt;dim&gt;</a> &amp;inputs, </div><div class="line">        std::vector&lt;Vector&lt;double&gt;&gt; &amp;computed_quantities) <span class="keyword">const override</span>; </div><div class="line"></div><div class="line">      <span class="keyword">virtual</span> std::vector&lt;std::string&gt; get_names() <span class="keyword">const override</span>; </div><div class="line"></div><div class="line">      <span class="keyword">virtual</span> std::vector&lt; </div><div class="line">        <a class="code" href="namespaceDataComponentInterpretation.html#a0cd2da3afe902f9004c23a73dbcc8ab0">DataComponentInterpretation::DataComponentInterpretation</a>&gt; </div><div class="line">      get_data_component_interpretation() <span class="keyword">const override</span>; </div><div class="line"></div><div class="line">      <span class="keyword">virtual</span> <a class="code" href="group__feaccess.html#gaa94b67d2fdcc390690c523f28019e52f">UpdateFlags</a> get_needed_update_flags() <span class="keyword">const override</span>; </div><div class="line"></div><div class="line">    <span class="keyword">private</span>: </div><div class="line">      <span class="keyword">const</span> <span class="keywordtype">bool</span> do_schlieren_plot; </div><div class="line">    }; </div><div class="line">  }; </div><div class="line"></div><div class="line">  <span class="keyword">template</span> &lt;<span class="keywordtype">int</span> dim&gt; </div><div class="line">  EulerProblem&lt;dim&gt;::Postprocessor::Postprocessor() </div><div class="line">    : do_schlieren_plot(dim == 2) </div><div class="line">  {} </div><div class="line"></div><div class="line">  <span class="keyword">template</span> &lt;<span class="keywordtype">int</span> dim&gt; </div><div class="line">  <span class="keywordtype">void</span> EulerProblem&lt;dim&gt;::Postprocessor::evaluate_vector_field( </div><div class="line">    <span class="keyword">const</span> <a class="code" href="structDataPostprocessorInputs_1_1Vector.html">DataPostprocessorInputs::Vector&lt;dim&gt;</a> &amp;inputs, </div><div class="line">    std::vector&lt;Vector&lt;double&gt;&gt; &amp;               computed_quantities)<span class="keyword"> const </span></div><div class="line"><span class="keyword">  </span>{ </div><div class="line">    <span class="keyword">const</span> <span class="keywordtype">unsigned</span> <span class="keywordtype">int</span> n_evaluation_points = inputs.<a class="code" href="structDataPostprocessorInputs_1_1Vector.html#a8e034ae97f0447fb541bdb8ad0a4f599">solution_values</a>.size(); </div><div class="line"></div><div class="line">    <span class="keywordflow">if</span> (do_schlieren_plot == <span class="keyword">true</span>) </div><div class="line">      <a class="code" href="group__Exceptions.html#ga70a0bb353656e704acf927945277bbc6">Assert</a>(inputs.<a class="code" href="structDataPostprocessorInputs_1_1Vector.html#ac96fb295c3c807f96021bae734e8c3c3">solution_gradients</a>.size() == n_evaluation_points, </div><div class="line">             <a class="code" href="group__Exceptions.html#ga31978c026b8b6b5116df30b8e748f6b7">ExcInternalError</a>()); </div><div class="line"></div><div class="line">    <a class="code" href="group__Exceptions.html#ga70a0bb353656e704acf927945277bbc6">Assert</a>(computed_quantities.size() == n_evaluation_points, </div><div class="line">           <a class="code" href="group__Exceptions.html#ga31978c026b8b6b5116df30b8e748f6b7">ExcInternalError</a>()); </div><div class="line">    <a class="code" href="group__Exceptions.html#ga70a0bb353656e704acf927945277bbc6">Assert</a>(inputs.<a class="code" href="structDataPostprocessorInputs_1_1Vector.html#a8e034ae97f0447fb541bdb8ad0a4f599">solution_values</a>[0].size() == dim + 2, <a class="code" href="group__Exceptions.html#ga31978c026b8b6b5116df30b8e748f6b7">ExcInternalError</a>()); </div><div class="line">    <a class="code" href="group__Exceptions.html#ga70a0bb353656e704acf927945277bbc6">Assert</a>(computed_quantities[0].size() == </div><div class="line">             dim + 2 + (do_schlieren_plot == <span class="keyword">true</span> ? 1 : 0), </div><div class="line">           <a class="code" href="group__Exceptions.html#ga31978c026b8b6b5116df30b8e748f6b7">ExcInternalError</a>()); </div><div class="line"></div><div class="line">    <span class="keywordflow">for</span> (<span class="keywordtype">unsigned</span> <span class="keywordtype">int</span> q = 0; q &lt; n_evaluation_points; ++q) </div><div class="line">      { </div><div class="line">        <a class="code" href="classTensor.html">Tensor&lt;1, dim + 2&gt;</a> solution; </div><div class="line">        <span class="keywordflow">for</span> (<span class="keywordtype">unsigned</span> <span class="keywordtype">int</span> d = 0; d &lt; dim + 2; ++<a class="code" href="namespacePhysics_1_1Elasticity_1_1Kinematics.html#a15728437b942dab0b0042eb06a407d2c">d</a>) </div><div class="line">          solution[d] = inputs.<a class="code" href="structDataPostprocessorInputs_1_1Vector.html#a8e034ae97f0447fb541bdb8ad0a4f599">solution_values</a>[q](d); </div><div class="line"></div><div class="line">        <span class="keyword">const</span> <span class="keywordtype">double</span>         density  = solution[0]; </div><div class="line">        <span class="keyword">const</span> <a class="code" href="classTensor.html">Tensor&lt;1, dim&gt;</a> velocity = euler_velocity&lt;dim&gt;(solution); </div><div class="line">        <span class="keyword">const</span> <span class="keywordtype">double</span>         pressure = euler_pressure&lt;dim&gt;(solution); </div><div class="line"></div><div class="line">        <span class="keywordflow">for</span> (<span class="keywordtype">unsigned</span> <span class="keywordtype">int</span> d = 0; d &lt; dim; ++<a class="code" href="namespacePhysics_1_1Elasticity_1_1Kinematics.html#a15728437b942dab0b0042eb06a407d2c">d</a>) </div><div class="line">          computed_quantities[q](d) = velocity[<a class="code" href="namespacePhysics_1_1Elasticity_1_1Kinematics.html#a15728437b942dab0b0042eb06a407d2c">d</a>]; </div><div class="line">        computed_quantities[q](dim)     = pressure; </div><div class="line">        computed_quantities[q](dim + 1) = std::sqrt(gamma * pressure / density); </div><div class="line"></div><div class="line">        <span class="keywordflow">if</span> (do_schlieren_plot == <span class="keyword">true</span>) </div><div class="line">          computed_quantities[q](dim + 2) = </div><div class="line">            inputs.<a class="code" href="structDataPostprocessorInputs_1_1Vector.html#ac96fb295c3c807f96021bae734e8c3c3">solution_gradients</a>[q][0] * inputs.<a class="code" href="structDataPostprocessorInputs_1_1Vector.html#ac96fb295c3c807f96021bae734e8c3c3">solution_gradients</a>[q][0]; </div><div class="line">      } </div><div class="line">  } </div><div class="line"></div><div class="line">  <span class="keyword">template</span> &lt;<span class="keywordtype">int</span> dim&gt; </div><div class="line">  std::vector&lt;std::string&gt; EulerProblem&lt;dim&gt;::Postprocessor::get_names()<span class="keyword"> const </span></div><div class="line"><span class="keyword">  </span>{ </div><div class="line">    std::vector&lt;std::string&gt; names; </div><div class="line">    <span class="keywordflow">for</span> (<span class="keywordtype">unsigned</span> <span class="keywordtype">int</span> d = 0; d &lt; dim; ++<a class="code" href="namespacePhysics_1_1Elasticity_1_1Kinematics.html#a15728437b942dab0b0042eb06a407d2c">d</a>) </div><div class="line">      names.emplace_back(<span class="stringliteral">&quot;velocity&quot;</span>); </div><div class="line">    names.emplace_back(<span class="stringliteral">&quot;pressure&quot;</span>); </div><div class="line">    names.emplace_back(<span class="stringliteral">&quot;speed_of_sound&quot;</span>); </div><div class="line"></div><div class="line">    <span class="keywordflow">if</span> (do_schlieren_plot == <span class="keyword">true</span>) </div><div class="line">      names.emplace_back(<span class="stringliteral">&quot;schlieren_plot&quot;</span>); </div><div class="line"></div><div class="line">    <span class="keywordflow">return</span> names; </div><div class="line">  } </div><div class="line"></div><div class="line">  <span class="keyword">template</span> &lt;<span class="keywordtype">int</span> dim&gt; </div><div class="line">  std::vector&lt;DataComponentInterpretation::DataComponentInterpretation&gt; </div><div class="line">  EulerProblem&lt;dim&gt;::Postprocessor::get_data_component_interpretation()<span class="keyword"> const </span></div><div class="line"><span class="keyword">  </span>{ </div><div class="line">    std::vector&lt;DataComponentInterpretation::DataComponentInterpretation&gt; </div><div class="line">      interpretation; </div><div class="line">    <span class="keywordflow">for</span> (<span class="keywordtype">unsigned</span> <span class="keywordtype">int</span> d = 0; d &lt; dim; ++<a class="code" href="namespacePhysics_1_1Elasticity_1_1Kinematics.html#a15728437b942dab0b0042eb06a407d2c">d</a>) </div><div class="line">      interpretation.push_back( </div><div class="line">        <a class="code" href="namespaceDataComponentInterpretation.html#a0cd2da3afe902f9004c23a73dbcc8ab0aa783915dbc182d5a49e111815fd23fe0">DataComponentInterpretation::component_is_part_of_vector</a>); </div><div class="line">    interpretation.push_back(<a class="code" href="namespaceDataComponentInterpretation.html#a0cd2da3afe902f9004c23a73dbcc8ab0a1f3cd50135818a6458f1d3ff7ea4bb51">DataComponentInterpretation::component_is_scalar</a>); </div><div class="line">    interpretation.push_back(<a class="code" href="namespaceDataComponentInterpretation.html#a0cd2da3afe902f9004c23a73dbcc8ab0a1f3cd50135818a6458f1d3ff7ea4bb51">DataComponentInterpretation::component_is_scalar</a>); </div><div class="line"></div><div class="line">    <span class="keywordflow">if</span> (do_schlieren_plot == <span class="keyword">true</span>) </div><div class="line">      interpretation.push_back( </div><div class="line">        <a class="code" href="namespaceDataComponentInterpretation.html#a0cd2da3afe902f9004c23a73dbcc8ab0a1f3cd50135818a6458f1d3ff7ea4bb51">DataComponentInterpretation::component_is_scalar</a>); </div><div class="line"></div><div class="line">    <span class="keywordflow">return</span> interpretation; </div><div class="line">  } </div><div class="line"></div><div class="line">  <span class="keyword">template</span> &lt;<span class="keywordtype">int</span> dim&gt; </div><div class="line">  <a class="code" href="group__feaccess.html#gaa94b67d2fdcc390690c523f28019e52f">UpdateFlags</a> EulerProblem&lt;dim&gt;::Postprocessor::get_needed_update_flags()<span class="keyword"> const </span></div><div class="line"><span class="keyword">  </span>{ </div><div class="line">    <span class="keywordflow">if</span> (do_schlieren_plot == <span class="keyword">true</span>) </div><div class="line">      <span class="keywordflow">return</span> <a class="code" href="group__feaccess.html#ggaa94b67d2fdcc390690c523f28019e52fa4057ca2f127aa619c65886a9d3ad4aea">update_values</a> | <a class="code" href="group__feaccess.html#ggaa94b67d2fdcc390690c523f28019e52facbcc430975fa6af05f75ca786dc6fe20">update_gradients</a>; </div><div class="line">    <span class="keywordflow">else</span> </div><div class="line">      <span class="keywordflow">return</span> <a class="code" href="group__feaccess.html#ggaa94b67d2fdcc390690c523f28019e52fa4057ca2f127aa619c65886a9d3ad4aea">update_values</a>; </div><div class="line">  } </div><div class="line"></div><div class="line">  <span class="keyword">template</span> &lt;<span class="keywordtype">int</span> dim&gt; </div><div class="line">  EulerProblem&lt;dim&gt;::EulerProblem() </div><div class="line">    : pcout(<a class="code" href="namespacestd.html">std</a>::cout, <a class="code" href="namespaceUtilities.html">Utilities</a>::MPI::<a class="code" href="namespaceUtilities_1_1MPI.html#a895dcd8223a0ee6f0e6a80b80e2d5982">this_mpi_process</a>(MPI_COMM_WORLD) == 0) </div><div class="line">#ifdef DEAL_II_WITH_P4EST </div><div class="line">    , triangulation(MPI_COMM_WORLD) </div><div class="line">#endif </div><div class="line">    , fe(<a class="code" href="classFE__DGQ.html">FE_DGQ</a>&lt;dim&gt;(fe_degree), dim + 2) </div><div class="line">    , mapping(fe_degree) </div><div class="line">    , dof_handler(triangulation) </div><div class="line">    , timer(pcout, <a class="code" href="classTimerOutput.html">TimerOutput</a>::never, <a class="code" href="classTimerOutput.html">TimerOutput</a>::wall_times) </div><div class="line">    , euler_operator(timer) </div><div class="line">    , time(0) </div><div class="line">    , time_step(0) </div><div class="line">  {} </div><div class="line"></div><div class="line">  <span class="keyword">template</span> &lt;<span class="keywordtype">int</span> dim&gt; </div><div class="line">  <span class="keywordtype">void</span> EulerProblem&lt;dim&gt;::make_grid_and_dofs() </div><div class="line">  { </div><div class="line">    <span class="keywordflow">switch</span> (testcase) </div><div class="line">      { </div><div class="line">        <span class="keywordflow">case</span> 0: </div><div class="line">          { </div><div class="line">            <a class="code" href="classPoint.html">Point&lt;dim&gt;</a> lower_left; </div><div class="line">            <span class="keywordflow">for</span> (<span class="keywordtype">unsigned</span> <span class="keywordtype">int</span> d = 1; d &lt; dim; ++<a class="code" href="namespacePhysics_1_1Elasticity_1_1Kinematics.html#a15728437b942dab0b0042eb06a407d2c">d</a>) </div><div class="line">              lower_left[d] = -5; </div><div class="line"></div><div class="line">            <a class="code" href="classPoint.html">Point&lt;dim&gt;</a> upper_right; </div><div class="line">            upper_right[0] = 10; </div><div class="line">            <span class="keywordflow">for</span> (<span class="keywordtype">unsigned</span> <span class="keywordtype">int</span> d = 1; d &lt; dim; ++<a class="code" href="namespacePhysics_1_1Elasticity_1_1Kinematics.html#a15728437b942dab0b0042eb06a407d2c">d</a>) </div><div class="line">              upper_right[d] = 5; </div><div class="line"></div><div class="line">            <a class="code" href="namespaceGridGenerator.html#a56019d263ae45708302d5d7599f0d458">GridGenerator::hyper_rectangle</a>(triangulation, </div><div class="line">                                           lower_left, </div><div class="line">                                           upper_right); </div><div class="line">            triangulation.refine_global(2); </div><div class="line"></div><div class="line">            euler_operator.set_inflow_boundary( </div><div class="line">              0, std::make_unique&lt;ExactSolution&lt;dim&gt;&gt;(0)); </div><div class="line"></div><div class="line">            <span class="keywordflow">break</span>; </div><div class="line">          } </div><div class="line"></div><div class="line">        <span class="keywordflow">case</span> 1: </div><div class="line">          { </div><div class="line">            <a class="code" href="namespaceGridGenerator.html#a9d0b8a34fe5ca58425aa1fcf0d6132f1">GridGenerator::channel_with_cylinder</a>( </div><div class="line">              triangulation, 0.03, 1, 0, <span class="keyword">true</span>); </div><div class="line"></div><div class="line">            euler_operator.set_inflow_boundary( </div><div class="line">              0, std::make_unique&lt;ExactSolution&lt;dim&gt;&gt;(0)); </div><div class="line">            euler_operator.set_subsonic_outflow_boundary( </div><div class="line">              1, std::make_unique&lt;ExactSolution&lt;dim&gt;&gt;(0)); </div><div class="line"></div><div class="line">            euler_operator.set_wall_boundary(2); </div><div class="line">            euler_operator.set_wall_boundary(3); </div><div class="line"></div><div class="line">            <span class="keywordflow">if</span> (dim == 3) </div><div class="line">              euler_operator.set_body_force( </div><div class="line">                std::make_unique&lt;<a class="code" href="classFunctions_1_1ConstantFunction.html">Functions::ConstantFunction&lt;dim&gt;</a>&gt;( </div><div class="line">                  std::vector&lt;double&gt;({0., 0., -0.2}))); </div><div class="line"></div><div class="line">            <span class="keywordflow">break</span>; </div><div class="line">          } </div><div class="line"></div><div class="line">        <span class="keywordflow">default</span>: </div><div class="line">          <a class="code" href="group__Exceptions.html#ga70a0bb353656e704acf927945277bbc6">Assert</a>(<span class="keyword">false</span>, <a class="code" href="group__Exceptions.html#ga7b52b286796c23ef9ff178faf7a4b68f">ExcNotImplemented</a>()); </div><div class="line">      } </div><div class="line"></div><div class="line">    triangulation.refine_global(n_global_refinements); </div><div class="line"></div><div class="line">    dof_handler.<a class="code" href="classDoFHandler.html#a553ca864aaf70330d9be86bc78f36d1e">distribute_dofs</a>(fe); </div><div class="line"></div><div class="line">    euler_operator.reinit(mapping, dof_handler); </div><div class="line">    euler_operator.initialize_vector(solution); </div><div class="line"></div><div class="line">    std::locale s = pcout.<a class="code" href="classConditionalOStream.html#a1f3eaad6ae78462bf20c05fe95cb710f">get_stream</a>().getloc(); </div><div class="line">    pcout.<a class="code" href="classConditionalOStream.html#a1f3eaad6ae78462bf20c05fe95cb710f">get_stream</a>().imbue(std::locale(<span class="stringliteral">&quot;&quot;</span>)); </div><div class="line">    pcout &lt;&lt; <span class="stringliteral">&quot;Number of degrees of freedom: &quot;</span> &lt;&lt; dof_handler.<a class="code" href="classDoFHandler.html#aa5b8d3c4b9deb0774dde5c2851e07e1e">n_dofs</a>() </div><div class="line">          &lt;&lt; <span class="stringliteral">&quot; ( = &quot;</span> &lt;&lt; (dim + 2) &lt;&lt; <span class="stringliteral">&quot; [vars] x &quot;</span> </div><div class="line">          &lt;&lt; triangulation.n_global_active_cells() &lt;&lt; <span class="stringliteral">&quot; [cells] x &quot;</span> </div><div class="line">          &lt;&lt; <a class="code" href="namespaceUtilities.html#a0900f35b37ee122e73fb2c80bba9beb9">Utilities::pow</a>(fe_degree + 1, dim) &lt;&lt; <span class="stringliteral">&quot; [dofs/cell/var] )&quot;</span> </div><div class="line">          &lt;&lt; std::endl; </div><div class="line">    pcout.<a class="code" href="classConditionalOStream.html#a1f3eaad6ae78462bf20c05fe95cb710f">get_stream</a>().imbue(s); </div><div class="line">  } </div><div class="line"></div><div class="line">  <span class="keyword">template</span> &lt;<span class="keywordtype">int</span> dim&gt; </div><div class="line">  <span class="keywordtype">void</span> EulerProblem&lt;dim&gt;::output_results(<span class="keyword">const</span> <span class="keywordtype">unsigned</span> <span class="keywordtype">int</span> result_number) </div><div class="line">  { </div><div class="line">    <span class="keyword">const</span> std::array&lt;double, 3&gt; errors = </div><div class="line">      euler_operator.compute_errors(ExactSolution&lt;dim&gt;(time), solution); </div><div class="line">    <span class="keyword">const</span> std::string quantity_name = testcase == 0 ? <span class="stringliteral">&quot;error&quot;</span> : <span class="stringliteral">&quot;norm&quot;</span>; </div><div class="line"></div><div class="line">    pcout &lt;&lt; <span class="stringliteral">&quot;Time:&quot;</span> &lt;&lt; std::setw(8) &lt;&lt; std::setprecision(3) &lt;&lt; time </div><div class="line">          &lt;&lt; <span class="stringliteral">&quot;, dt: &quot;</span> &lt;&lt; std::setw(8) &lt;&lt; std::setprecision(2) &lt;&lt; time_step </div><div class="line">          &lt;&lt; <span class="stringliteral">&quot;, &quot;</span> &lt;&lt; quantity_name &lt;&lt; <span class="stringliteral">&quot; rho: &quot;</span> &lt;&lt; std::setprecision(4) </div><div class="line">          &lt;&lt; std::setw(10) &lt;&lt; errors[0] &lt;&lt; <span class="stringliteral">&quot;, rho * u: &quot;</span> &lt;&lt; std::setprecision(4) </div><div class="line">          &lt;&lt; std::setw(10) &lt;&lt; errors[1] &lt;&lt; <span class="stringliteral">&quot;, energy:&quot;</span> &lt;&lt; std::setprecision(4) </div><div class="line">          &lt;&lt; std::setw(10) &lt;&lt; errors[2] &lt;&lt; std::endl; </div><div class="line"></div><div class="line">    { </div><div class="line">      <a class="code" href="classTimerOutput_1_1Scope.html">TimerOutput::Scope</a> t(timer, <span class="stringliteral">&quot;output&quot;</span>); </div><div class="line"></div><div class="line">      Postprocessor postprocessor; </div><div class="line">      <a class="code" href="classDataOut.html">DataOut&lt;dim&gt;</a>  data_out; </div><div class="line"></div><div class="line">      <a class="code" href="structDataOutBase_1_1VtkFlags.html">DataOutBase::VtkFlags</a> flags; </div><div class="line">      flags.<a class="code" href="structDataOutBase_1_1VtkFlags.html#aa9dd1830c0ff35a2431704c4d45453eb">write_higher_order_cells</a> = <span class="keyword">true</span>; </div><div class="line">      data_out.<a class="code" href="classDataOutInterface.html#ac7280a24690b117454acfb0fa058299c">set_flags</a>(flags); </div><div class="line"></div><div class="line">      data_out.<a class="code" href="classDataOut__DoFData.html#a6ed7c846331069f406b8c9933c37fda4">attach_dof_handler</a>(dof_handler); </div><div class="line">      { </div><div class="line">        std::vector&lt;std::string&gt; names; </div><div class="line">        names.emplace_back(<span class="stringliteral">&quot;density&quot;</span>); </div><div class="line">        <span class="keywordflow">for</span> (<span class="keywordtype">unsigned</span> <span class="keywordtype">int</span> d = 0; d &lt; dim; ++<a class="code" href="namespacePhysics_1_1Elasticity_1_1Kinematics.html#a15728437b942dab0b0042eb06a407d2c">d</a>) </div><div class="line">          names.emplace_back(<span class="stringliteral">&quot;momentum&quot;</span>); </div><div class="line">        names.emplace_back(<span class="stringliteral">&quot;energy&quot;</span>); </div><div class="line"></div><div class="line">        std::vector&lt;DataComponentInterpretation::DataComponentInterpretation&gt; </div><div class="line">          interpretation; </div><div class="line">        interpretation.push_back( </div><div class="line">          <a class="code" href="namespaceDataComponentInterpretation.html#a0cd2da3afe902f9004c23a73dbcc8ab0a1f3cd50135818a6458f1d3ff7ea4bb51">DataComponentInterpretation::component_is_scalar</a>); </div><div class="line">        <span class="keywordflow">for</span> (<span class="keywordtype">unsigned</span> <span class="keywordtype">int</span> d = 0; d &lt; dim; ++<a class="code" href="namespacePhysics_1_1Elasticity_1_1Kinematics.html#a15728437b942dab0b0042eb06a407d2c">d</a>) </div><div class="line">          interpretation.push_back( </div><div class="line">            <a class="code" href="namespaceDataComponentInterpretation.html#a0cd2da3afe902f9004c23a73dbcc8ab0aa783915dbc182d5a49e111815fd23fe0">DataComponentInterpretation::component_is_part_of_vector</a>); </div><div class="line">        interpretation.push_back( </div><div class="line">          <a class="code" href="namespaceDataComponentInterpretation.html#a0cd2da3afe902f9004c23a73dbcc8ab0a1f3cd50135818a6458f1d3ff7ea4bb51">DataComponentInterpretation::component_is_scalar</a>); </div><div class="line"></div><div class="line">        data_out.<a class="code" href="classDataOut__DoFData.html#a79cbe2f02f8dfb85026c71d783dbb703">add_data_vector</a>(dof_handler, solution, names, interpretation); </div><div class="line">      } </div><div class="line">      data_out.<a class="code" href="classDataOut__DoFData.html#a79cbe2f02f8dfb85026c71d783dbb703">add_data_vector</a>(solution, postprocessor); </div><div class="line"></div><div class="line">      <a class="code" href="classLinearAlgebra_1_1distributed_1_1Vector.html">LinearAlgebra::distributed::Vector&lt;Number&gt;</a> reference; </div><div class="line">      <span class="keywordflow">if</span> (testcase == 0 &amp;&amp; dim == 2) </div><div class="line">        { </div><div class="line">          reference.<a class="code" href="classLinearAlgebra_1_1distributed_1_1Vector.html#ace027311492ed2f6e07fbd74d723e3a9">reinit</a>(solution); </div><div class="line">          euler_operator.project(ExactSolution&lt;dim&gt;(time), reference); </div><div class="line">          reference.<a class="code" href="classLinearAlgebra_1_1distributed_1_1Vector.html#aa6376a098589519491fc452d1529f57b">sadd</a>(-1., 1, solution); </div><div class="line">          std::vector&lt;std::string&gt; names; </div><div class="line">          names.emplace_back(<span class="stringliteral">&quot;error_density&quot;</span>); </div><div class="line">          <span class="keywordflow">for</span> (<span class="keywordtype">unsigned</span> <span class="keywordtype">int</span> d = 0; d &lt; dim; ++<a class="code" href="namespacePhysics_1_1Elasticity_1_1Kinematics.html#a15728437b942dab0b0042eb06a407d2c">d</a>) </div><div class="line">            names.emplace_back(<span class="stringliteral">&quot;error_momentum&quot;</span>); </div><div class="line">          names.emplace_back(<span class="stringliteral">&quot;error_energy&quot;</span>); </div><div class="line"></div><div class="line">          std::vector&lt;DataComponentInterpretation::DataComponentInterpretation&gt; </div><div class="line">            interpretation; </div><div class="line">          interpretation.push_back( </div><div class="line">            <a class="code" href="namespaceDataComponentInterpretation.html#a0cd2da3afe902f9004c23a73dbcc8ab0a1f3cd50135818a6458f1d3ff7ea4bb51">DataComponentInterpretation::component_is_scalar</a>); </div><div class="line">          <span class="keywordflow">for</span> (<span class="keywordtype">unsigned</span> <span class="keywordtype">int</span> d = 0; d &lt; dim; ++<a class="code" href="namespacePhysics_1_1Elasticity_1_1Kinematics.html#a15728437b942dab0b0042eb06a407d2c">d</a>) </div><div class="line">            interpretation.push_back( </div><div class="line">              <a class="code" href="namespaceDataComponentInterpretation.html#a0cd2da3afe902f9004c23a73dbcc8ab0aa783915dbc182d5a49e111815fd23fe0">DataComponentInterpretation::component_is_part_of_vector</a>); </div><div class="line">          interpretation.push_back( </div><div class="line">            <a class="code" href="namespaceDataComponentInterpretation.html#a0cd2da3afe902f9004c23a73dbcc8ab0a1f3cd50135818a6458f1d3ff7ea4bb51">DataComponentInterpretation::component_is_scalar</a>); </div><div class="line"></div><div class="line">          data_out.<a class="code" href="classDataOut__DoFData.html#a79cbe2f02f8dfb85026c71d783dbb703">add_data_vector</a>(dof_handler, </div><div class="line">                                   reference, </div><div class="line">                                   names, </div><div class="line">                                   interpretation); </div><div class="line">        } </div><div class="line"></div><div class="line">      Vector&lt;double&gt; mpi_owner(triangulation.n_active_cells()); </div><div class="line">      mpi_owner = <a class="code" href="namespaceUtilities_1_1MPI.html#a895dcd8223a0ee6f0e6a80b80e2d5982">Utilities::MPI::this_mpi_process</a>(MPI_COMM_WORLD); </div><div class="line">      data_out.<a class="code" href="classDataOut__DoFData.html#a79cbe2f02f8dfb85026c71d783dbb703">add_data_vector</a>(mpi_owner, <span class="stringliteral">&quot;owner&quot;</span>); </div><div class="line"></div><div class="line">      data_out.<a class="code" href="classDataOut.html#a087f63e22f0614bca326dbdca288c646">build_patches</a>(mapping, </div><div class="line">                             fe.degree, </div><div class="line">                             <a class="code" href="classDataOut.html">DataOut&lt;dim&gt;::curved_inner_cells</a>); </div><div class="line"></div><div class="line">      <span class="keyword">const</span> std::string filename = </div><div class="line">        <span class="stringliteral">&quot;solution_&quot;</span> + <a class="code" href="namespaceUtilities.html#a6195c5f009ea8c7c536c6ffdf108c32f">Utilities::int_to_string</a>(result_number, 3) + <span class="stringliteral">&quot;.vtu&quot;</span>; </div><div class="line">      data_out.<a class="code" href="classDataOutInterface.html#a5df488dad82b811ceb08cb1adf9eafcd">write_vtu_in_parallel</a>(filename, MPI_COMM_WORLD); </div><div class="line">    } </div><div class="line">  } </div><div class="line"></div><div class="line">  <span class="keyword">template</span> &lt;<span class="keywordtype">int</span> dim&gt; </div><div class="line">  <span class="keywordtype">void</span> <a class="code" href="namespaceWorkStream_1_1internal_1_1tbb__no__coloring.html#a8673698a405bf47aa24002aeb6d76d70">EulerProblem&lt;dim&gt;::run</a>() </div><div class="line">  { </div><div class="line">    { </div><div class="line">      <span class="keyword">const</span> <span class="keywordtype">unsigned</span> <span class="keywordtype">int</span> n_vect_number = VectorizedArrayType::size(); </div><div class="line">      <span class="keyword">const</span> <span class="keywordtype">unsigned</span> <span class="keywordtype">int</span> n_vect_bits   = 8 * <span class="keyword">sizeof</span>(Number) * n_vect_number; </div><div class="line"></div><div class="line">      pcout &lt;&lt; <span class="stringliteral">&quot;Running with &quot;</span> </div><div class="line">            &lt;&lt; <a class="code" href="namespaceUtilities_1_1MPI.html#ac26de0c059200523177bb1d92cc25d00">Utilities::MPI::n_mpi_processes</a>(MPI_COMM_WORLD) </div><div class="line">            &lt;&lt; <span class="stringliteral">&quot; MPI processes&quot;</span> &lt;&lt; std::endl; </div><div class="line">      pcout &lt;&lt; <span class="stringliteral">&quot;Vectorization over &quot;</span> &lt;&lt; n_vect_number &lt;&lt; <span class="stringliteral">&quot; &quot;</span> </div><div class="line">            &lt;&lt; (std::is_same&lt;Number, double&gt;::value ? <span class="stringliteral">&quot;doubles&quot;</span> : <span class="stringliteral">&quot;floats&quot;</span>) </div><div class="line">            &lt;&lt; <span class="stringliteral">&quot; = &quot;</span> &lt;&lt; n_vect_bits &lt;&lt; <span class="stringliteral">&quot; bits (&quot;</span> </div><div class="line">            &lt;&lt; <a class="code" href="namespaceUtilities_1_1System.html#ade631a789101336840371e3b2e2851e0">Utilities::System::get_current_vectorization_level</a>() &lt;&lt; <span class="stringliteral">&quot;)&quot;</span> </div><div class="line">            &lt;&lt; std::endl; </div><div class="line">    } </div><div class="line"></div><div class="line">    make_grid_and_dofs(); </div><div class="line"></div><div class="line">    <span class="keyword">const</span> LowStorageRungeKuttaIntegrator integrator(lsrk_scheme); </div><div class="line"></div><div class="line">    <a class="code" href="classLinearAlgebra_1_1distributed_1_1Vector.html">LinearAlgebra::distributed::Vector&lt;Number&gt;</a> rk_register_1; </div><div class="line">    <a class="code" href="classLinearAlgebra_1_1distributed_1_1Vector.html">LinearAlgebra::distributed::Vector&lt;Number&gt;</a> rk_register_2; </div><div class="line">    rk_register_1.<a class="code" href="classLinearAlgebra_1_1distributed_1_1Vector.html#ace027311492ed2f6e07fbd74d723e3a9">reinit</a>(solution); </div><div class="line">    rk_register_2.<a class="code" href="classLinearAlgebra_1_1distributed_1_1Vector.html#ace027311492ed2f6e07fbd74d723e3a9">reinit</a>(solution); </div><div class="line"></div><div class="line">    euler_operator.project(ExactSolution&lt;dim&gt;(time), solution); </div><div class="line"></div><div class="line">    <span class="keywordtype">double</span> min_vertex_distance = <a class="code" href="namespaceVectorTools_1_1EvaluationFlags.html#ac6721740e24732d6afabcf28ddfc1ffda8e7f5b8545162dccd5ed717792bdf420">std::numeric_limits&lt;double&gt;::max</a>(); </div><div class="line">    <span class="keywordflow">for</span> (<span class="keyword">const</span> <span class="keyword">auto</span> &amp;cell : triangulation.active_cell_iterators()) </div><div class="line">      <span class="keywordflow">if</span> (cell-&gt;is_locally_owned()) </div><div class="line">        min_vertex_distance = </div><div class="line">          <a class="code" href="namespaceVectorTools_1_1EvaluationFlags.html#ac6721740e24732d6afabcf28ddfc1ffdaeb244a97c0c9e9e7ca4765e096f0badc">std::min</a>(min_vertex_distance, cell-&gt;minimum_vertex_distance()); </div><div class="line">    min_vertex_distance = </div><div class="line">      <a class="code" href="namespaceUtilities_1_1MPI.html#a9ac5275c3c74902f8a9d6e7bdb514179">Utilities::MPI::min</a>(min_vertex_distance, MPI_COMM_WORLD); </div><div class="line"></div><div class="line">    time_step = courant_number * integrator.n_stages() / </div><div class="line">                euler_operator.compute_cell_transport_speed(solution); </div><div class="line">    pcout &lt;&lt; <span class="stringliteral">&quot;Time step size: &quot;</span> &lt;&lt; time_step </div><div class="line">          &lt;&lt; <span class="stringliteral">&quot;, minimal h: &quot;</span> &lt;&lt; min_vertex_distance </div><div class="line">          &lt;&lt; <span class="stringliteral">&quot;, initial transport scaling: &quot;</span> </div><div class="line">          &lt;&lt; 1. / euler_operator.compute_cell_transport_speed(solution) </div><div class="line">          &lt;&lt; std::endl </div><div class="line">          &lt;&lt; std::endl; </div><div class="line"></div><div class="line">    output_results(0); </div><div class="line"></div><div class="line">    <span class="keywordtype">unsigned</span> <span class="keywordtype">int</span> timestep_number = 0; </div><div class="line"></div><div class="line">    <span class="keywordflow">while</span> (time &lt; final_time - 1e-12 &amp;&amp; timestep_number &lt; max_time_steps) </div><div class="line">      { </div><div class="line">        ++timestep_number; </div><div class="line">        <span class="keywordflow">if</span> (timestep_number % 5 == 0) </div><div class="line">          time_step = </div><div class="line">            courant_number * integrator.n_stages() / </div><div class="line">            <a class="code" href="namespaceUtilities.html#a17955af7a4bc8771d430e622f9e732b3">Utilities::truncate_to_n_digits</a>( </div><div class="line">              euler_operator.compute_cell_transport_speed(solution), 3); </div><div class="line"></div><div class="line">        { </div><div class="line">          <a class="code" href="classTimerOutput_1_1Scope.html">TimerOutput::Scope</a> t(timer, <span class="stringliteral">&quot;rk time stepping total&quot;</span>); </div><div class="line">          integrator.perform_time_step(euler_operator, </div><div class="line">                                       time, </div><div class="line">                                       time_step, </div><div class="line">                                       solution, </div><div class="line">                                       rk_register_1, </div><div class="line">                                       rk_register_2); </div><div class="line">        } </div><div class="line"></div><div class="line">        time += time_step; </div><div class="line"></div><div class="line">        <span class="keywordflow">if</span> (static_cast&lt;int&gt;(time / output_tick) != </div><div class="line">              static_cast&lt;int&gt;((time - time_step) / output_tick) || </div><div class="line">            time &gt;= final_time - 1e-12) </div><div class="line">          output_results( </div><div class="line">            static_cast&lt;unsigned int&gt;(std::round(time / output_tick))); </div><div class="line">      } </div><div class="line"></div><div class="line">    timer.<a class="code" href="classTimerOutput.html#ae7673798226de7731e3ecdf7c0fb7568">print_wall_time_statistics</a>(MPI_COMM_WORLD); </div><div class="line">    pcout &lt;&lt; std::endl; </div><div class="line">  } </div><div class="line"></div><div class="line">} <span class="comment">// namespace Euler_DG </span></div><div class="line"></div><div class="line"><span class="keywordtype">int</span> main(<span class="keywordtype">int</span> argc, <span class="keywordtype">char</span> **argv) </div><div class="line">{ </div><div class="line">  <span class="keyword">using namespace </span>Euler_DG; </div><div class="line">  <span class="keyword">using namespace </span><a class="code" href="namespacedealii.html">dealii</a>; </div><div class="line"></div><div class="line">  <a class="code" href="classUtilities_1_1MPI_1_1MPI__InitFinalize.html">Utilities::MPI::MPI_InitFinalize</a> mpi_initialization(argc, argv, 1); </div><div class="line"></div><div class="line">  <span class="keywordflow">try</span> </div><div class="line">    { </div><div class="line">      <a class="code" href="logstream_8h.html#ac643e79bd992f1a9bd0dca5b9f2859fb">deallog</a>.<a class="code" href="classLogStream.html#a8028e970ad8388596d625ed463894e98">depth_console</a>(0); </div><div class="line"></div><div class="line">      EulerProblem&lt;dimension&gt; euler_problem; </div><div class="line">      euler_problem.run(); </div><div class="line">    } </div><div class="line">  <span class="keywordflow">catch</span> (std::exception &amp;exc) </div><div class="line">    { </div><div class="line">      std::cerr &lt;&lt; std::endl </div><div class="line">                &lt;&lt; std::endl </div><div class="line">                &lt;&lt; <span class="stringliteral">&quot;----------------------------------------------------&quot;</span> </div><div class="line">                &lt;&lt; std::endl; </div><div class="line">      std::cerr &lt;&lt; <span class="stringliteral">&quot;Exception on processing: &quot;</span> &lt;&lt; std::endl </div><div class="line">                &lt;&lt; exc.what() &lt;&lt; std::endl </div><div class="line">                &lt;&lt; <span class="stringliteral">&quot;Aborting!&quot;</span> &lt;&lt; std::endl </div><div class="line">                &lt;&lt; <span class="stringliteral">&quot;----------------------------------------------------&quot;</span> </div><div class="line">                &lt;&lt; std::endl; </div><div class="line"></div><div class="line">      <span class="keywordflow">return</span> 1; </div><div class="line">    } </div><div class="line">  <span class="keywordflow">catch</span> (...) </div><div class="line">    { </div><div class="line">      std::cerr &lt;&lt; std::endl </div><div class="line">                &lt;&lt; std::endl </div><div class="line">                &lt;&lt; <span class="stringliteral">&quot;----------------------------------------------------&quot;</span> </div><div class="line">                &lt;&lt; std::endl; </div><div class="line">      std::cerr &lt;&lt; <span class="stringliteral">&quot;Unknown exception!&quot;</span> &lt;&lt; std::endl </div><div class="line">                &lt;&lt; <span class="stringliteral">&quot;Aborting!&quot;</span> &lt;&lt; std::endl </div><div class="line">                &lt;&lt; <span class="stringliteral">&quot;----------------------------------------------------&quot;</span> </div><div class="line">                &lt;&lt; std::endl; </div><div class="line">      <span class="keywordflow">return</span> 1; </div><div class="line">    } </div><div class="line"></div><div class="line">  <span class="keywordflow">return</span> 0; </div><div class="line">} </div><div class="line"></div></div><!-- fragment --> </div></div><!-- contents -->
<!-- HTML footer for doxygen 1.8.13-->
<!-- start footer part -->
<hr class="footer"/><address class="footer"><small>
Generated by &#160;<a href="http://www.doxygen.org/index.html">
<img class="footer" src="doxygen.png" alt="doxygen"/>
</a> 1.8.13
</small></address>
</body>
</html>
