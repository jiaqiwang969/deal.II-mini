<!-- HTML header for doxygen 1.8.13-->
<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml">
<head>
<link rel="canonical" href="https://www.dealii.org/current/doxygen/deal.II/step_35.html" />
<meta http-equiv="Content-Type" content="text/xhtml;charset=UTF-8"/>
<meta http-equiv="X-UA-Compatible" content="IE=9"/>
<meta name="generator" content="Doxygen 1.8.13"/>
<meta name="viewport" content="width=device-width, initial-scale=1"/>
<title>The deal.II Library: The step-35 tutorial program</title>
<link href="tabs.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="jquery.js"></script>
<script type="text/javascript" src="dynsections.js"></script>
<link href="search/search.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="search/searchdata.js"></script>
<script type="text/javascript" src="search/search.js"></script>
<script type="text/x-mathjax-config">
  MathJax.Hub.Config({
    extensions: ["tex2jax.js", "TeX/AMSmath.js", "TeX/AMSsymbols.js"],
    jax: ["input/TeX","output/HTML-CSS"],
});
</script><script type="text/javascript" src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.0/MathJax.js"></script>
<link href="doxygen.css" rel="stylesheet" type="text/css" />
<link href="stylesheet.css" rel="stylesheet" type="text/css"/>
<link rel="SHORTCUT ICON" href="deal.ico"></link>
<script type="text/javascript" src="custom.js"></script>
<meta name="author" content="The deal.II Authors <authors@dealii.org>"></meta>
<meta name="copyright" content="Copyright (C) 1998 - 2021 by the deal.II authors"></meta>
<meta name="deal.II-version" content="10.0.0-pre"></meta>
</head>
<body>
<div id="top"><!-- do not remove this div, it is closed by doxygen! -->
<div id="titlearea">
<table cellspacing="0" cellpadding="0">
 <tbody>
 <tr style="height: 56px;">
  <td id="projectlogo"><img alt="Logo" src="logo200.png"/></td>
  <td id="projectalign" style="padding-left: 0.5em;">
   <div id="projectname">
   &#160;<span id="projectnumber">Reference documentation for deal.II version 10.0.0-pre</span>
   </div>
  </td>
 </tr>
 </tbody>
</table>
</div>
<!--Extra macros for MathJax:-->
<div style="display:none">
\(\newcommand{\dealvcentcolon}{\mathrel{\mathop{:}}}\)
\(\newcommand{\dealcoloneq}{\dealvcentcolon\mathrel{\mkern-1.2mu}=}\)
\(\newcommand{\jump}[1]{\left[\!\left[ #1 \right]\!\right]}\)
\(\newcommand{\average}[1]{\left\{\!\left\{ #1 \right\}\!\right\}}\)
</div>
<!-- end header part -->
<!-- Generated by Doxygen 1.8.13 -->
<script type="text/javascript">
var searchBox = new SearchBox("searchBox", "search",false,'Search');
</script>
<script type="text/javascript" src="menudata.js"></script>
<script type="text/javascript" src="menu.js"></script>
<script type="text/javascript">
$(function() {
  initMenu('',true,false,'search.php','Search');
  $(document).ready(function() { init_search(); });
});
</script>
<div id="main-nav"></div>
<!-- window showing the filter options -->
<div id="MSearchSelectWindow"
     onmouseover="return searchBox.OnSearchSelectShow()"
     onmouseout="return searchBox.OnSearchSelectHide()"
     onkeydown="return searchBox.OnSearchSelectKey(event)">
</div>

<!-- iframe showing the search results (closed by default) -->
<div id="MSearchResultsWindow">
<iframe src="javascript:void(0)" frameborder="0" 
        name="MSearchResults" id="MSearchResults">
</iframe>
</div>

</div><!-- top -->
<div class="header">
  <div class="headertitle">
<div class="title">The step-35 tutorial program </div>  </div>
</div><!--header-->
<div class="contents">
<div class="textblock"><p>This tutorial depends on <a class="el" href="step_22.html">step-22</a>.</p>
<p> 
<table class="tutorial" width="50%">
<tr><th colspan="2"><b><small>Table of contents</small></b></th></tr>
<tr><td width="50%" valign="top">
<ol>
  <li> <a href="#Intro" class=bold>Introduction</a>
    <ul>
        <li><a href="#Motivation"> Motivation </a>
        <li><a href="#Projectionmethods"> Projection methods </a>
        <li><a href="#TheFullyDiscreteSetting"> The Fully Discrete Setting </a>
        <li><a href="#Implementation"> Implementation </a>
        <li><a href="#TheTestcase"> The Testcase </a>
    </ul>
  <li> <a href="#CommProg" class=bold>The commented program</a>
    <ul>
        <li><a href="#Includefiles">Include files</a>
        <li><a href="#Runtimeparameters">Run time parameters</a>
        <li><a href="#Equationdata">Equation data</a>
        <li><a href="#ThecodeNavierStokesProjectioncodeclass">The <code>NavierStokesProjection</code> class</a>
      <ul>
        <li><a href="#codeNavierStokesProjectionNavierStokesProjectioncode"> <code>NavierStokesProjection::NavierStokesProjection</code> </a>
        <li><a href="#codeNavierStokesProjectioncreate_triangulation_and_dofscode"><code>NavierStokesProjection::create_triangulation_and_dofs</code></a>
        <li><a href="#codeNavierStokesProjectioninitializecode"> <code>NavierStokesProjection::initialize</code> </a>
        <li><a href="#codeNavierStokesProjectioninitialize__matricescode"> <code>NavierStokesProjection::initialize_*_matrices</code> </a>
        <li><a href="#codeNavierStokesProjectionruncode"> <code>NavierStokesProjection::run</code> </a>
        <li><a href="#codeNavierStokesProjectiondiffusion_stepcode"><code>NavierStokesProjection::diffusion_step</code></a>
        <li><a href="#codeNavierStokesProjectionassemble_advection_termcode"> <code>NavierStokesProjection::assemble_advection_term</code> </a>
        <li><a href="#codeNavierStokesProjectionprojection_stepcode"><code>NavierStokesProjection::projection_step</code></a>
        <li><a href="#codeNavierStokesProjectionupdate_pressurecode"> <code>NavierStokesProjection::update_pressure</code> </a>
        <li><a href="#codeNavierStokesProjectionoutput_resultscode"> <code>NavierStokesProjection::output_results</code> </a>
      </ul>
        <li><a href="#Themainfunction"> The main function </a>
      </ul>
</ol></td><td width="50%" valign="top"><ol>
  <li value="3"> <a href="#Results" class=bold>Results</a>
    <ul>
        <li><a href="#Re100"> Re = 100 </a>
        <li><a href="#Re500"> Re = 500 </a>
        <li><a href="#Possibilitiesforextensions"> Possibilities for extensions </a>
    </ul>
  <li> <a href="#PlainProg" class=bold>The plain program</a>
</ol> </td> </tr> </table>
 examples/step-35/doc/intro.dox</p>
<p><br />
</p>
<p><em> This program grew out of a student project by Abner Salgado at Texas A&amp;M University. Most of the work for this program is by him. </em></p>
<p><a class="anchor" id="Intro"></a></p>
<p><a class="anchor" id="Introduction"></a></p><h1>Introduction </h1>
<p><a class="anchor" id="Motivation"></a></p>
<p><a class="anchor" id="Motivation"></a></p><h3>Motivation </h3>
<p>本程序的目的是展示如何有效地解决不可压缩的时间依赖性纳维-斯托克斯方程。这些方程描述了粘性不可压缩流体的流动，读作</p>
<p class="formulaDsp">
\begin{align*} u_t + u \cdot \nabla u - \nu \Delta u + \nabla p = f, \\ \nabla \cdot u = 0, \end{align*}
</p>
<p>其中 \(u\) 表示流速， \(p\) 表示压力。这个方程组由初始条件来补充</p>
<p class="formulaDsp">
\[ u |_{t=0} = u_0, \]
</p>
<p>与 \(u_0\) 足够光滑和螺线管，以及合适的边界条件。例如，一个可接受的边界条件，是</p>
<p class="formulaDsp">
\[ u|_{\partial\Omega} = u_b. \]
</p>
<p>也可以规定其他边界条件。在我们这里解决的测试案例中，边界被划分为两个不相交的子集 \(\partial\Omega = \Gamma_1 \cup \Gamma_2\) ，我们有</p>
<p class="formulaDsp">
\[ u|_{\Gamma_1} = u_b, \]
</p>
<p>和</p>
<p class="formulaDsp">
\[ u\times n|_{\Gamma_2} = 0, \quad p|_{\Gamma_2} = 0 \]
</p>
<p>其中 \(n\) 是外部单位法线。 \(\Gamma_2\) 上的边界条件经常被用来模拟外流条件。</p>
<p>在以前的教程中（例如参见第20步和第22步），我们已经看到了如何使用Schur补数方法来解决与时间无关的斯托克斯方程。对于随时间变化的情况，在时间离散化之后，我们将得到一个类似于以下的系统</p>
<p class="formulaDsp">
\begin{align*} \frac1\tau u^k - \nu \Delta u^k + \nabla p^k = F^k, \\ \nabla \cdot u^k = 0, \end{align*}
</p>
<p>其中 \(\tau\) 是时间步长。虽然这个系统的结构与斯托克斯系统相似，因此可以用Schur补数的方法来解决，但事实证明，Schur补数的条件数与 \(\tau^{-2}\) 成正比。这使得该系统非常难解，也意味着对于纳维-斯托克斯方程来说，这不是一个有用的求解途径。</p>
<p><a class="anchor" id="Projection"></a></p>
<p><a class="anchor" id="Projectionmethods"></a></p><h3>Projection methods </h3>
<p>相反，我们需要想出一个不同的方法来解决与时间有关的纳维-斯托克斯方程。解决这些问题的困难来自于速度和压力是通过约束条件耦合在一起的事实</p>
<p class="formulaDsp">
\[ \nabla \cdot u = 0, \]
</p>
<p>对其而言，压力是拉格朗日乘数。投影方法旨在将这一约束与扩散（拉普拉斯）算子脱钩。</p>
<p>让我们简短地描述一下投影方法在半离散情况下的样子。我们的目标是获得一个速度 \(\{u^k\}\) 和压力 \(\{p^k\}\) 序列。我们还将得到一个辅助变量的序列 \(\{\phi^k\}\) 。假设从初始条件和一阶方法的应用中我们已经找到了 \((u^0,p^0,\phi^0=0)\) 和 \((u^1,p^1,\phi^1=p^1-p^0)\) 。那么投影法包括以下步骤。 </p><ul>
<li>
<p class="startli"><b>Step 0</b> 。外推法。定义一下。 </p><p class="formulaDsp">
\[ u^\star = 2u^k - u^{k-1}, \quad p^\sharp = p^k + \frac43 \phi^k - \frac13 \phi^{k-1}. \]
</p>
 <pre class="fragment">&lt;li&gt;  &lt;b&gt;Step 1&lt;/b&gt;:扩散步骤。我们发现 \form#4180 可以解决单一线性方程 \form#4181@_fakenl@_fakenl@_fakenl@_fakenl@_fakenl@_fakenl@_fakenl@_fakenl@_fakenl@_fakenl@_fakenl。



&lt;li&gt;  &lt;b&gt;Step 2&lt;/b&gt;:投影。找到能解决 \form#4182@_fakenl@_fakenl@_fakenl@_fakenl@_fakenl@_fakenl的 \form#4183 。

&lt;li&gt;  &lt;b&gt;Step 3&lt;/b&gt;:压力校正。这里我们有两个选项。       &lt;ul&gt;   &lt;li&gt;  &lt;i&gt;Incremental Method in Standard Form&lt;/i&gt;。压力的更新方式是。 \form#4184@_fakenl@_fakenl

    &lt;li&gt;  &lt;i&gt;Incremental Method in Rotational Form&lt;/i&gt;。在这种情况下， \form#4185@_fakenl@_fakenl 。

  &lt;/ul&gt;  &lt;/ul&gt;  。
</pre><p>在不详细说明的情况下，让我们对我们刚刚描述的投影方法做一些说明。 </p><ul>
<li>
<p class="startli">平流项 \(u\cdot\nabla u\) 被其<em>skew symmetric form</em> </p><p class="formulaDsp">
\[ u \cdot \nabla u + \frac12 \left( \nabla\cdot u \right) u. \]
</p>
<p>取代。</p>
<p class="endli">这与连续方程是一致的（因为 \(\nabla\cdot u = 0\) ，尽管对于离散解来说，这在点上是不正确的），它需要保证时间步进方案的无条件稳定性。此外，为了使该术语线性化，我们使用 \(u^\star\) 的二阶外推 \(u^{k+1}\) 。 </p>
</li>
<li>
<p class="startli">投影步骤是亥姆霍兹分解的实现 </p><p class="formulaDsp">
\[ L^2(\Omega)^d = H \oplus \nabla H^1_{\Gamma_2}(\Omega), \]
</p>
<p> 。</p>
<p>其中 </p><p class="formulaDsp">
\[ H = \left\{ v \in L^2(\Omega)^d:\ \nabla\cdot v =0, \ v\cdot n|_{\Gamma_1} = 0 \right\}, \]
</p>
<p>和 </p><p class="formulaDsp">
\[ H^1_{\Gamma_2}(\Omega) = \left\{ q \in H^1(\Omega):\ q|_{\Gamma_2} = 0 \right\}. \]
</p>
<p>事实上，如果我们在 \(u^{k+1}\) 上使用这种分解，我们可以得到 </p><p class="formulaDsp">
\[ u^{k+1} = v^{k+1} + \nabla \left( \frac{2\tau}{3} \phi^{k+1} \right), \]
</p>
<p class="endli">与 \(v^{k+1}\in H\) 。取这个方程的发散，我们得出了投影方程。 </p>
</li>
<li>
上面概述的两种变体中更准确的是旋转变体。然而，下面的程序同时实现了两种变体。此外，根据作者的经验，如果粘度 \(\nu\) 是可变的，应该使用标准形式。 </li>
</ul>
<p></p>
<p>van Kan在 </p><ul>
<li>
J. van Kan, "A second-order accurate pressure-correction scheme for viscous incompressible flow", SIAM Journal on Scientific and Statistical Computing, Vol. 7, no.3, pp. 870-891, 1986 </li>
</ul>
<p>并由Guermond在 </p><ul>
<li>
J.-L. Guermond分析。L. Guermond, "Un résultat de convergence d'ordre deux en temps pour l'approximation des équations de Navier-Stokes par une technique de projection incrémentale", ESAIM: Mathematical Modelling and Numer Analysis, vol. 33, no. 1, pp. 169-189, 1999 </li>
</ul>
<p>。事实证明，这种技术受到运动压力的非物理边界条件的影响，导致收敛率降低。为了防止这种情况，Timmermans等人在 </p><ul>
<li>
L. Timmermans, P. Minev, and F. Van De Vosse, "An approximate projection scheme for incompressible flow using spectral elements", International Journal for Numerical Methods in Fluids, vol. 22, no. 7, pp.673-688, 1996 </li>
</ul>
<p>旋转压力校正投影方法，使用运动压力的分歧校正。 </p><ul>
<li>
J.-L. Guermond和J. Shen, "On the error estimates for the rotational pressure-correction projection methods", Mathematics of Computation, vol. 73, no. 248, pp.1719-1737, 2004 </li>
</ul>
<p>对Stokes问题进行了全面分析。 </p>
<p></p>
<p><a class="anchor" id="fullydiscrete"></a></p>
<p><a class="anchor" id="TheFullyDiscreteSetting"></a></p><h3>The Fully Discrete Setting </h3>
<p>为了获得该方法的完全离散设置，我们一如既往地需要一个变分公式。鉴于边界条件的性质，这里有一个微妙的问题。当我们把方程乘以一个合适的测试函数时，出现的一个项是</p>
<p class="formulaDsp">
\[ -\nu \int_\Omega \Delta u \cdot v. \]
</p>
<p>如果我们，比如说，在整个边界上有迪里希特的边界条件，那么经过部分积分，我们将得到</p>
<p class="formulaDsp">
\[ -\nu \int_\Omega \Delta u \cdot v = \nu \int_\Omega \nabla u : \nabla v - \int_{\partial\Omega} \partial_n u \cdot v = \nu \int_\Omega \nabla u : \nabla v. \]
</p>
<p>这种表述的优点之一是，它完全解耦了速度的各个组成部分。此外，它们都共享同一个系统矩阵。这可以在程序中加以利用。</p>
<p>然而，考虑到非标准的边界条件，为了能够考虑到这些条件，我们需要使用以下的特征</p>
<p class="formulaDsp">
\[ \Delta u = \nabla\nabla\cdot u - \nabla\times\nabla\times u, \]
</p>
<p>因此，当我们通过部分积分并考虑到边界条件时，我们可以得到</p>
<p class="formulaDsp">
\[ -\nu \int_\Omega \Delta u \cdot v = \nu \int_\Omega \left[ \nabla \cdot u \nabla \cdot v + \nabla \times u \nabla \times v \right], \]
</p>
<p>这就是我们必须使用的形式。请注意，这是对速度分量的耦合。此外，为了强制执行压力的边界条件，我们需要重写</p>
<p class="formulaDsp">
\[ \int_\Omega \nabla p \cdot v = -\int_\Omega p \nabla \cdot v + \int_{\Gamma_1} p v\cdot n + \int_{\Gamma_2} p v\cdot n = -\int_\Omega p \nabla \cdot v, \]
</p>
<p>其中 \(\Gamma_1\) 中的边界积分在速度的边界条件下等于零， \(\Gamma_2\) 中的积分在压力的边界条件下等于零。</p>
<p>在简化的情况下，边界 \(\Gamma_2\) 与坐标轴平行，这在我们下面进行的测试案例中成立，实际上可以表明</p>
<p class="formulaDsp">
\[ \nu \int_\Omega \nabla u : \nabla v = \nu \int_\Omega \left[ \nabla \cdot u \nabla \cdot v + \nabla \times u \nabla \times v \right]. \]
</p>
<p>这个问题在文献中并不经常涉及。更多信息，读者可以参考，例如， </p><ul>
<li>
J.-L. GUERMOND, L. QUARTAPELLE, On the approximation of the unsteady Navier-Stokes equations by finite element projection methods, Numer.Math., 80 (1998) 207-238 </li>
<li>
J.-L. GUERMOND, P. MINEV, J. SHEN, Error analysis of pressure-correction schemes for the Navier-Stokes equations with open boundary conditions, SIAM J. Numer.Anal., 43 1 (2005) 239-258. </li>
</ul>
<p><a class="anchor" id="implementation"></a></p>
<p><a class="anchor" id="Implementation"></a></p><h3>Implementation </h3>
<p></p>
<p>我们对投影方法的实现遵循<em>verbatim</em>上面的描述。然而，我们必须注意到，与其他大多数有多个解分量的问题不同，我们没有使用矢量值的有限元。相反，我们对速度和压力的分量分别使用单独的有限元，并对这些分量使用不同的 <code><a class="el" href="classDoFHandler.html">DoFHandler</a></code> 's。这样做的主要原因是，正如我们从方案的描述中看到的，速度和压力的 <code>dim</code> 分量是解耦的。因此，所有速度分量的方程看起来都是一样的，具有相同的系统矩阵，并能以的速度平行求解。很明显，这种方法也有其缺点。例如，在集合矩阵和右手边时，我们需要保持几个 <code><a class="el" href="classDoFHandler.html">DoFHandler</a></code> s和迭代器的同步；获得矢量值函数的固有量（如发散）变得有点尴尬，以及其他。</p>
<p><a class="anchor" id="testcase"></a></p>
<p><a class="anchor" id="TheTestcase"></a></p><h3>The Testcase </h3>
<p></p>
<p>我们在这个程序中使用的测试案例包括围绕一个方形障碍物的流动。其几何形状如下。</p>
<div class="image">
<img src="https://www.dealii.org/images/steps/developer/step-35.geometry.png"/>
</div>
<p>与 \(H=4.1\) ，使几何形状略微不对称。</p>
<p>我们在顶壁、底壁和障碍物上都施加了无滑动的边界条件。在左边，我们有流入的边界条件</p>
<p class="formulaDsp">
\[ u = \left( \begin{array}{c} 4 U_m y (H-y)/H^2 \\ 0 \end{array} \right), \]
</p>
<p>与 \(U_m = 1.5\) ，即流入的边界条件对应于这个配置的Poiseuille流。最后，在右边的垂直壁上，我们规定速度的垂直分量和压力都应该是零。最后的时间 \(T=10\) 。</p>
<p><a class="anchor" id="CommProg"></a> </p><h1>The commented program</h1>
<p></p>
<p><a class="anchor" id="Includefiles"></a> </p><h3>Include files</h3>
<p></p>
<p>我们首先包括所有必要的deal.II头文件和一些C++相关的文件。它们中的每一个都已经在以前的教程程序中讨论过了，所以我们在这里就不做详细介绍了。</p>
<div class="fragment"><div class="line"><span class="preprocessor">#include &lt;<a class="code" href="parameter__handler_8h.html">deal.II/base/parameter_handler.h</a>&gt;</span> </div><div class="line"><span class="preprocessor">#include &lt;<a class="code" href="base_2point_8h.html">deal.II/base/point.h</a>&gt;</span> </div><div class="line"><span class="preprocessor">#include &lt;<a class="code" href="function_8h.html">deal.II/base/function.h</a>&gt;</span> </div><div class="line"><span class="preprocessor">#include &lt;<a class="code" href="quadrature__lib_8h.html">deal.II/base/quadrature_lib.h</a>&gt;</span> </div><div class="line"><span class="preprocessor">#include &lt;<a class="code" href="multithread__info_8h.html">deal.II/base/multithread_info.h</a>&gt;</span> </div><div class="line"><span class="preprocessor">#include &lt;<a class="code" href="thread__management_8h.html">deal.II/base/thread_management.h</a>&gt;</span> </div><div class="line"><span class="preprocessor">#include &lt;<a class="code" href="work__stream_8h.html">deal.II/base/work_stream.h</a>&gt;</span> </div><div class="line"><span class="preprocessor">#include &lt;<a class="code" href="include_2deal_8II_2base_2parallel_8h.html">deal.II/base/parallel.h</a>&gt;</span> </div><div class="line"><span class="preprocessor">#include &lt;<a class="code" href="include_2deal_8II_2base_2utilities_8h.html">deal.II/base/utilities.h</a>&gt;</span> </div><div class="line"><span class="preprocessor">#include &lt;<a class="code" href="conditional__ostream_8h.html">deal.II/base/conditional_ostream.h</a>&gt;</span> </div><div class="line"></div><div class="line"><span class="preprocessor">#include &lt;<a class="code" href="vector_8h.html">deal.II/lac/vector.h</a>&gt;</span> </div><div class="line"><span class="preprocessor">#include &lt;<a class="code" href="sparse__matrix_8h.html">deal.II/lac/sparse_matrix.h</a>&gt;</span> </div><div class="line"><span class="preprocessor">#include &lt;<a class="code" href="dynamic__sparsity__pattern_8h.html">deal.II/lac/dynamic_sparsity_pattern.h</a>&gt;</span> </div><div class="line"><span class="preprocessor">#include &lt;<a class="code" href="solver__cg_8h.html">deal.II/lac/solver_cg.h</a>&gt;</span> </div><div class="line"><span class="preprocessor">#include &lt;<a class="code" href="precondition_8h.html">deal.II/lac/precondition.h</a>&gt;</span> </div><div class="line"><span class="preprocessor">#include &lt;<a class="code" href="solver__gmres_8h.html">deal.II/lac/solver_gmres.h</a>&gt;</span> </div><div class="line"><span class="preprocessor">#include &lt;<a class="code" href="sparse__ilu_8h.html">deal.II/lac/sparse_ilu.h</a>&gt;</span> </div><div class="line"><span class="preprocessor">#include &lt;<a class="code" href="sparse__direct_8h.html">deal.II/lac/sparse_direct.h</a>&gt;</span> </div><div class="line"><span class="preprocessor">#include &lt;<a class="code" href="affine__constraints_8h.html">deal.II/lac/affine_constraints.h</a>&gt;</span> </div><div class="line"></div><div class="line"><span class="preprocessor">#include &lt;<a class="code" href="grid_2tria_8h.html">deal.II/grid/tria.h</a>&gt;</span> </div><div class="line"><span class="preprocessor">#include &lt;<a class="code" href="grid__generator_8h.html">deal.II/grid/grid_generator.h</a>&gt;</span> </div><div class="line"><span class="preprocessor">#include &lt;<a class="code" href="grid_2grid__refinement_8h.html">deal.II/grid/grid_refinement.h</a>&gt;</span> </div><div class="line"><span class="preprocessor">#include &lt;<a class="code" href="grid__in_8h.html">deal.II/grid/grid_in.h</a>&gt;</span> </div><div class="line"></div><div class="line"><span class="preprocessor">#include &lt;<a class="code" href="dofs_2dof__handler_8h.html">deal.II/dofs/dof_handler.h</a>&gt;</span> </div><div class="line"><span class="preprocessor">#include &lt;<a class="code" href="dof__tools_8h.html">deal.II/dofs/dof_tools.h</a>&gt;</span> </div><div class="line"><span class="preprocessor">#include &lt;<a class="code" href="dof__renumbering_8h.html">deal.II/dofs/dof_renumbering.h</a>&gt;</span> </div><div class="line"></div><div class="line"><span class="preprocessor">#include &lt;<a class="code" href="fe__q_8h.html">deal.II/fe/fe_q.h</a>&gt;</span> </div><div class="line"><span class="preprocessor">#include &lt;<a class="code" href="fe_2fe__values_8h.html">deal.II/fe/fe_values.h</a>&gt;</span> </div><div class="line"><span class="preprocessor">#include &lt;<a class="code" href="fe__tools_8h.html">deal.II/fe/fe_tools.h</a>&gt;</span> </div><div class="line"><span class="preprocessor">#include &lt;<a class="code" href="fe__system_8h.html">deal.II/fe/fe_system.h</a>&gt;</span> </div><div class="line"></div><div class="line"><span class="preprocessor">#include &lt;<a class="code" href="matrix__tools_8h.html">deal.II/numerics/matrix_tools.h</a>&gt;</span> </div><div class="line"><span class="preprocessor">#include &lt;<a class="code" href="vector__tools_8h.html">deal.II/numerics/vector_tools.h</a>&gt;</span> </div><div class="line"><span class="preprocessor">#include &lt;<a class="code" href="numerics_2data__out_8h.html">deal.II/numerics/data_out.h</a>&gt;</span> </div><div class="line"></div><div class="line"><span class="preprocessor">#include &lt;fstream&gt;</span> </div><div class="line"><span class="preprocessor">#include &lt;cmath&gt;</span> </div><div class="line"><span class="preprocessor">#include &lt;iostream&gt;</span> </div></div><!-- fragment --><p>最后这和以前的所有程序一样。</p>
<div class="fragment"><div class="line"><span class="keyword">namespace </span>Step35 </div><div class="line">{ </div><div class="line">  <span class="keyword">using namespace </span><a class="code" href="namespacedealii.html">dealii</a>; </div></div><!-- fragment --><p><a class="anchor" id="Runtimeparameters"></a> </p><h3>Run time parameters</h3>
<p></p>
<p>由于我们的方法有几个可以微调的参数，我们把它们放到一个外部文件中，这样就可以在运行时确定它们。</p>
<p>这尤其包括辅助变量 \(\phi\) 的方程表述，为此我们声明一个 <code>enum</code> 。接下来，我们声明一个类，它将读取和存储我们的程序运行所需的所有参数。</p>
<div class="fragment"><div class="line"><span class="keyword">namespace </span>RunTimeParameters </div><div class="line">{ </div><div class="line">  <span class="keyword">enum class</span> Method </div><div class="line">  { </div><div class="line">    standard, </div><div class="line">    rotational </div><div class="line">  }; </div><div class="line"></div><div class="line">  <span class="keyword">class </span>Data_Storage </div><div class="line">  { </div><div class="line">  <span class="keyword">public</span>: </div><div class="line">    Data_Storage(); </div><div class="line"></div><div class="line">    <span class="keywordtype">void</span> read_data(<span class="keyword">const</span> std::string &amp;filename); </div><div class="line"></div><div class="line">    Method form; </div><div class="line"></div><div class="line">    <span class="keywordtype">double</span> dt; </div><div class="line">    <span class="keywordtype">double</span> initial_time; </div><div class="line">    <span class="keywordtype">double</span> final_time; </div><div class="line"></div><div class="line">    <span class="keywordtype">double</span> Reynolds; </div><div class="line"></div><div class="line">    <span class="keywordtype">unsigned</span> <span class="keywordtype">int</span> n_global_refines; </div><div class="line"></div><div class="line">    <span class="keywordtype">unsigned</span> <span class="keywordtype">int</span> pressure_degree; </div><div class="line"></div><div class="line">    <span class="keywordtype">unsigned</span> <span class="keywordtype">int</span> vel_max_iterations; </div><div class="line">    <span class="keywordtype">unsigned</span> <span class="keywordtype">int</span> vel_Krylov_size; </div><div class="line">    <span class="keywordtype">unsigned</span> <span class="keywordtype">int</span> vel_off_diagonals; </div><div class="line">    <span class="keywordtype">unsigned</span> <span class="keywordtype">int</span> vel_update_prec; </div><div class="line">    <span class="keywordtype">double</span>       vel_eps; </div><div class="line">    <span class="keywordtype">double</span>       vel_diag_strength; </div><div class="line"></div><div class="line">    <span class="keywordtype">bool</span>         verbose; </div><div class="line">    <span class="keywordtype">unsigned</span> <span class="keywordtype">int</span> output_interval; </div><div class="line"></div><div class="line">  <span class="keyword">protected</span>: </div><div class="line">    <a class="code" href="classParameterHandler.html">ParameterHandler</a> prm; </div><div class="line">  }; </div></div><!-- fragment --><p>在这个类的构造函数中，我们声明所有的参数。这方面的细节已经在其他地方讨论过了，例如在 <a class="el" href="step_29.html">step-29</a> 。</p>
<div class="fragment"><div class="line">  Data_Storage::Data_Storage() </div><div class="line">    : form(Method::rotational) </div><div class="line">    , dt(5e-4) </div><div class="line">    , initial_time(0.) </div><div class="line">    , final_time(1.) </div><div class="line">    , Reynolds(1.) </div><div class="line">    , n_global_refines(0) </div><div class="line">    , pressure_degree(1) </div><div class="line">    , vel_max_iterations(1000) </div><div class="line">    , vel_Krylov_size(30) </div><div class="line">    , vel_off_diagonals(60) </div><div class="line">    , vel_update_prec(15) </div><div class="line">    , vel_eps(1e-12) </div><div class="line">    , vel_diag_strength(0.01) </div><div class="line">    , verbose(true) </div><div class="line">    , output_interval(15) </div><div class="line">  { </div><div class="line">    prm.<a class="code" href="classParameterHandler.html#a6d65f458be69e23a348221cb67fc411d">declare_entry</a>(<span class="stringliteral">&quot;Method_Form&quot;</span>, </div><div class="line">                      <span class="stringliteral">&quot;rotational&quot;</span>, </div><div class="line">                      <a class="code" href="classPatterns_1_1Selection.html">Patterns::Selection</a>(<span class="stringliteral">&quot;rotational|standard&quot;</span>), </div><div class="line">                      <span class="stringliteral">&quot; Used to select the type of method that we are going &quot;</span> </div><div class="line">                      <span class="stringliteral">&quot;to use. &quot;</span>); </div><div class="line">    prm.<a class="code" href="classParameterHandler.html#af29c20cde6d44186806d559beb468696">enter_subsection</a>(<span class="stringliteral">&quot;Physical data&quot;</span>); </div><div class="line">    { </div><div class="line">      prm.<a class="code" href="classParameterHandler.html#a6d65f458be69e23a348221cb67fc411d">declare_entry</a>(<span class="stringliteral">&quot;initial_time&quot;</span>, </div><div class="line">                        <span class="stringliteral">&quot;0.&quot;</span>, </div><div class="line">                        <a class="code" href="classPatterns_1_1Double.html">Patterns::Double</a>(0.), </div><div class="line">                        <span class="stringliteral">&quot; The initial time of the simulation. &quot;</span>); </div><div class="line">      prm.<a class="code" href="classParameterHandler.html#a6d65f458be69e23a348221cb67fc411d">declare_entry</a>(<span class="stringliteral">&quot;final_time&quot;</span>, </div><div class="line">                        <span class="stringliteral">&quot;1.&quot;</span>, </div><div class="line">                        <a class="code" href="classPatterns_1_1Double.html">Patterns::Double</a>(0.), </div><div class="line">                        <span class="stringliteral">&quot; The final time of the simulation. &quot;</span>); </div><div class="line">      prm.<a class="code" href="classParameterHandler.html#a6d65f458be69e23a348221cb67fc411d">declare_entry</a>(<span class="stringliteral">&quot;Reynolds&quot;</span>, </div><div class="line">                        <span class="stringliteral">&quot;1.&quot;</span>, </div><div class="line">                        <a class="code" href="classPatterns_1_1Double.html">Patterns::Double</a>(0.), </div><div class="line">                        <span class="stringliteral">&quot; The Reynolds number. &quot;</span>); </div><div class="line">    } </div><div class="line">    prm.<a class="code" href="classParameterHandler.html#a599462cacd492e2f712bf7369507dcff">leave_subsection</a>(); </div><div class="line"></div><div class="line">    prm.<a class="code" href="classParameterHandler.html#af29c20cde6d44186806d559beb468696">enter_subsection</a>(<span class="stringliteral">&quot;Time step data&quot;</span>); </div><div class="line">    { </div><div class="line">      prm.<a class="code" href="classParameterHandler.html#a6d65f458be69e23a348221cb67fc411d">declare_entry</a>(<span class="stringliteral">&quot;dt&quot;</span>, </div><div class="line">                        <span class="stringliteral">&quot;5e-4&quot;</span>, </div><div class="line">                        <a class="code" href="classPatterns_1_1Double.html">Patterns::Double</a>(0.), </div><div class="line">                        <span class="stringliteral">&quot; The time step size. &quot;</span>); </div><div class="line">    } </div><div class="line">    prm.<a class="code" href="classParameterHandler.html#a599462cacd492e2f712bf7369507dcff">leave_subsection</a>(); </div><div class="line"></div><div class="line">    prm.<a class="code" href="classParameterHandler.html#af29c20cde6d44186806d559beb468696">enter_subsection</a>(<span class="stringliteral">&quot;Space discretization&quot;</span>); </div><div class="line">    { </div><div class="line">      prm.<a class="code" href="classParameterHandler.html#a6d65f458be69e23a348221cb67fc411d">declare_entry</a>(<span class="stringliteral">&quot;n_of_refines&quot;</span>, </div><div class="line">                        <span class="stringliteral">&quot;0&quot;</span>, </div><div class="line">                        <a class="code" href="classPatterns_1_1Integer.html">Patterns::Integer</a>(0, 15), </div><div class="line">                        <span class="stringliteral">&quot; The number of global refines we do on the mesh. &quot;</span>); </div><div class="line">      prm.<a class="code" href="classParameterHandler.html#a6d65f458be69e23a348221cb67fc411d">declare_entry</a>(<span class="stringliteral">&quot;pressure_fe_degree&quot;</span>, </div><div class="line">                        <span class="stringliteral">&quot;1&quot;</span>, </div><div class="line">                        <a class="code" href="classPatterns_1_1Integer.html">Patterns::Integer</a>(1, 5), </div><div class="line">                        <span class="stringliteral">&quot; The polynomial degree for the pressure space. &quot;</span>); </div><div class="line">    } </div><div class="line">    prm.<a class="code" href="classParameterHandler.html#a599462cacd492e2f712bf7369507dcff">leave_subsection</a>(); </div><div class="line"></div><div class="line">    prm.<a class="code" href="classParameterHandler.html#af29c20cde6d44186806d559beb468696">enter_subsection</a>(<span class="stringliteral">&quot;Data solve velocity&quot;</span>); </div><div class="line">    { </div><div class="line">      prm.<a class="code" href="classParameterHandler.html#a6d65f458be69e23a348221cb67fc411d">declare_entry</a>( </div><div class="line">        <span class="stringliteral">&quot;max_iterations&quot;</span>, </div><div class="line">        <span class="stringliteral">&quot;1000&quot;</span>, </div><div class="line">        <a class="code" href="classPatterns_1_1Integer.html">Patterns::Integer</a>(1, 1000), </div><div class="line">        <span class="stringliteral">&quot; The maximal number of iterations GMRES must make. &quot;</span>); </div><div class="line">      prm.<a class="code" href="classParameterHandler.html#a6d65f458be69e23a348221cb67fc411d">declare_entry</a>(<span class="stringliteral">&quot;eps&quot;</span>, </div><div class="line">                        <span class="stringliteral">&quot;1e-12&quot;</span>, </div><div class="line">                        <a class="code" href="classPatterns_1_1Double.html">Patterns::Double</a>(0.), </div><div class="line">                        <span class="stringliteral">&quot; The stopping criterion. &quot;</span>); </div><div class="line">      prm.<a class="code" href="classParameterHandler.html#a6d65f458be69e23a348221cb67fc411d">declare_entry</a>(<span class="stringliteral">&quot;Krylov_size&quot;</span>, </div><div class="line">                        <span class="stringliteral">&quot;30&quot;</span>, </div><div class="line">                        <a class="code" href="classPatterns_1_1Integer.html">Patterns::Integer</a>(1), </div><div class="line">                        <span class="stringliteral">&quot; The size of the Krylov subspace to be used. &quot;</span>); </div><div class="line">      prm.<a class="code" href="classParameterHandler.html#a6d65f458be69e23a348221cb67fc411d">declare_entry</a>(<span class="stringliteral">&quot;off_diagonals&quot;</span>, </div><div class="line">                        <span class="stringliteral">&quot;60&quot;</span>, </div><div class="line">                        <a class="code" href="classPatterns_1_1Integer.html">Patterns::Integer</a>(0), </div><div class="line">                        <span class="stringliteral">&quot; The number of off-diagonal elements ILU must &quot;</span> </div><div class="line">                        <span class="stringliteral">&quot;compute. &quot;</span>); </div><div class="line">      prm.<a class="code" href="classParameterHandler.html#a6d65f458be69e23a348221cb67fc411d">declare_entry</a>(<span class="stringliteral">&quot;diag_strength&quot;</span>, </div><div class="line">                        <span class="stringliteral">&quot;0.01&quot;</span>, </div><div class="line">                        <a class="code" href="classPatterns_1_1Double.html">Patterns::Double</a>(0.), </div><div class="line">                        <span class="stringliteral">&quot; Diagonal strengthening coefficient. &quot;</span>); </div><div class="line">      prm.<a class="code" href="classParameterHandler.html#a6d65f458be69e23a348221cb67fc411d">declare_entry</a>(<span class="stringliteral">&quot;update_prec&quot;</span>, </div><div class="line">                        <span class="stringliteral">&quot;15&quot;</span>, </div><div class="line">                        <a class="code" href="classPatterns_1_1Integer.html">Patterns::Integer</a>(1), </div><div class="line">                        <span class="stringliteral">&quot; This number indicates how often we need to &quot;</span> </div><div class="line">                        <span class="stringliteral">&quot;update the preconditioner&quot;</span>); </div><div class="line">    } </div><div class="line">    prm.<a class="code" href="classParameterHandler.html#a599462cacd492e2f712bf7369507dcff">leave_subsection</a>(); </div><div class="line"></div><div class="line">    prm.<a class="code" href="classParameterHandler.html#a6d65f458be69e23a348221cb67fc411d">declare_entry</a>(<span class="stringliteral">&quot;verbose&quot;</span>, </div><div class="line">                      <span class="stringliteral">&quot;true&quot;</span>, </div><div class="line">                      <a class="code" href="classPatterns_1_1Bool.html">Patterns::Bool</a>(), </div><div class="line">                      <span class="stringliteral">&quot; This indicates whether the output of the solution &quot;</span> </div><div class="line">                      <span class="stringliteral">&quot;process should be verbose. &quot;</span>); </div><div class="line"></div><div class="line">    prm.<a class="code" href="classParameterHandler.html#a6d65f458be69e23a348221cb67fc411d">declare_entry</a>(<span class="stringliteral">&quot;output_interval&quot;</span>, </div><div class="line">                      <span class="stringliteral">&quot;1&quot;</span>, </div><div class="line">                      <a class="code" href="classPatterns_1_1Integer.html">Patterns::Integer</a>(1), </div><div class="line">                      <span class="stringliteral">&quot; This indicates between how many time steps we print &quot;</span> </div><div class="line">                      <span class="stringliteral">&quot;the solution. &quot;</span>); </div><div class="line">  } </div><div class="line"></div><div class="line">  <span class="keywordtype">void</span> Data_Storage::read_data(<span class="keyword">const</span> std::string &amp;filename) </div><div class="line">  { </div><div class="line">    std::ifstream file(filename); </div><div class="line">    <a class="code" href="group__Exceptions.html#gafc0ca7ad85b3ebd64e8e51689ac85caf">AssertThrow</a>(file, <a class="code" href="group__Exceptions.html#ga4c22c86ff89575667de2ca9778aa28e5">ExcFileNotOpen</a>(filename)); </div><div class="line"></div><div class="line">    prm.<a class="code" href="classParameterHandler.html#a0ddaa05c5463c6c0b7701e18005717a9">parse_input</a>(file); </div><div class="line"></div><div class="line">    <span class="keywordflow">if</span> (prm.<a class="code" href="classParameterHandler.html#a91cfbaca954f444047302446a4e87125">get</a>(<span class="stringliteral">&quot;Method_Form&quot;</span>) == std::string(<span class="stringliteral">&quot;rotational&quot;</span>)) </div><div class="line">      form = Method::rotational; </div><div class="line">    <span class="keywordflow">else</span> </div><div class="line">      form = Method::standard; </div><div class="line"></div><div class="line">    prm.<a class="code" href="classParameterHandler.html#af29c20cde6d44186806d559beb468696">enter_subsection</a>(<span class="stringliteral">&quot;Physical data&quot;</span>); </div><div class="line">    { </div><div class="line">      initial_time = prm.<a class="code" href="classParameterHandler.html#aeaf3c7846747695b1f327677e3716ec5">get_double</a>(<span class="stringliteral">&quot;initial_time&quot;</span>); </div><div class="line">      final_time   = prm.<a class="code" href="classParameterHandler.html#aeaf3c7846747695b1f327677e3716ec5">get_double</a>(<span class="stringliteral">&quot;final_time&quot;</span>); </div><div class="line">      Reynolds     = prm.<a class="code" href="classParameterHandler.html#aeaf3c7846747695b1f327677e3716ec5">get_double</a>(<span class="stringliteral">&quot;Reynolds&quot;</span>); </div><div class="line">    } </div><div class="line">    prm.<a class="code" href="classParameterHandler.html#a599462cacd492e2f712bf7369507dcff">leave_subsection</a>(); </div><div class="line"></div><div class="line">    prm.<a class="code" href="classParameterHandler.html#af29c20cde6d44186806d559beb468696">enter_subsection</a>(<span class="stringliteral">&quot;Time step data&quot;</span>); </div><div class="line">    { </div><div class="line">      dt = prm.<a class="code" href="classParameterHandler.html#aeaf3c7846747695b1f327677e3716ec5">get_double</a>(<span class="stringliteral">&quot;dt&quot;</span>); </div><div class="line">    } </div><div class="line">    prm.<a class="code" href="classParameterHandler.html#a599462cacd492e2f712bf7369507dcff">leave_subsection</a>(); </div><div class="line"></div><div class="line">    prm.<a class="code" href="classParameterHandler.html#af29c20cde6d44186806d559beb468696">enter_subsection</a>(<span class="stringliteral">&quot;Space discretization&quot;</span>); </div><div class="line">    { </div><div class="line">      n_global_refines = prm.<a class="code" href="classParameterHandler.html#a61fa98fdc0c52980a5b1de0ee1fc5bb2">get_integer</a>(<span class="stringliteral">&quot;n_of_refines&quot;</span>); </div><div class="line">      pressure_degree  = prm.<a class="code" href="classParameterHandler.html#a61fa98fdc0c52980a5b1de0ee1fc5bb2">get_integer</a>(<span class="stringliteral">&quot;pressure_fe_degree&quot;</span>); </div><div class="line">    } </div><div class="line">    prm.<a class="code" href="classParameterHandler.html#a599462cacd492e2f712bf7369507dcff">leave_subsection</a>(); </div><div class="line"></div><div class="line">    prm.<a class="code" href="classParameterHandler.html#af29c20cde6d44186806d559beb468696">enter_subsection</a>(<span class="stringliteral">&quot;Data solve velocity&quot;</span>); </div><div class="line">    { </div><div class="line">      vel_max_iterations = prm.<a class="code" href="classParameterHandler.html#a61fa98fdc0c52980a5b1de0ee1fc5bb2">get_integer</a>(<span class="stringliteral">&quot;max_iterations&quot;</span>); </div><div class="line">      vel_eps            = prm.<a class="code" href="classParameterHandler.html#aeaf3c7846747695b1f327677e3716ec5">get_double</a>(<span class="stringliteral">&quot;eps&quot;</span>); </div><div class="line">      vel_Krylov_size    = prm.<a class="code" href="classParameterHandler.html#a61fa98fdc0c52980a5b1de0ee1fc5bb2">get_integer</a>(<span class="stringliteral">&quot;Krylov_size&quot;</span>); </div><div class="line">      vel_off_diagonals  = prm.<a class="code" href="classParameterHandler.html#a61fa98fdc0c52980a5b1de0ee1fc5bb2">get_integer</a>(<span class="stringliteral">&quot;off_diagonals&quot;</span>); </div><div class="line">      vel_diag_strength  = prm.<a class="code" href="classParameterHandler.html#aeaf3c7846747695b1f327677e3716ec5">get_double</a>(<span class="stringliteral">&quot;diag_strength&quot;</span>); </div><div class="line">      vel_update_prec    = prm.<a class="code" href="classParameterHandler.html#a61fa98fdc0c52980a5b1de0ee1fc5bb2">get_integer</a>(<span class="stringliteral">&quot;update_prec&quot;</span>); </div><div class="line">    } </div><div class="line">    prm.<a class="code" href="classParameterHandler.html#a599462cacd492e2f712bf7369507dcff">leave_subsection</a>(); </div><div class="line"></div><div class="line">    verbose = prm.<a class="code" href="classParameterHandler.html#a6bb45dc67787e3fab7882461929b5fbe">get_bool</a>(<span class="stringliteral">&quot;verbose&quot;</span>); </div><div class="line"></div><div class="line">    output_interval = prm.<a class="code" href="classParameterHandler.html#a61fa98fdc0c52980a5b1de0ee1fc5bb2">get_integer</a>(<span class="stringliteral">&quot;output_interval&quot;</span>); </div><div class="line">  } </div><div class="line">} <span class="comment">// namespace RunTimeParameters </span></div></div><!-- fragment --><p><a class="anchor" id="Equationdata"></a> </p><h3>Equation data</h3>
<p></p>
<p>在下一个命名空间中，我们声明初始和边界条件。</p>
<div class="fragment"><div class="line"><span class="keyword">namespace </span>EquationData </div><div class="line">{ </div></div><!-- fragment --><p>由于我们选择了一个完全解耦的公式，我们将不利用deal.II处理矢量值问题的能力。然而，我们确实希望为方程数据使用一个独立于维度的接口。为了做到这一点，我们的函数应该能够知道我们目前在哪个空间分量上工作，而且我们应该能够有一个通用的接口来做到这一点。下面的类是在这个方向上的一个尝试。</p>
<div class="fragment"><div class="line"><span class="keyword">template</span> &lt;<span class="keywordtype">int</span> dim&gt; </div><div class="line"><span class="keyword">class </span>MultiComponentFunction : <span class="keyword">public</span> <a class="code" href="classFunction.html">Function</a>&lt;dim&gt; </div><div class="line">{ </div><div class="line"><span class="keyword">public</span>: </div><div class="line">  MultiComponentFunction(<span class="keyword">const</span> <span class="keywordtype">double</span> initial_time = 0.); </div><div class="line">  <span class="keywordtype">void</span> set_component(<span class="keyword">const</span> <span class="keywordtype">unsigned</span> <span class="keywordtype">int</span> d); </div><div class="line"></div><div class="line"><span class="keyword">protected</span>: </div><div class="line">  <span class="keywordtype">unsigned</span> <span class="keywordtype">int</span> comp; </div><div class="line">}; </div><div class="line"></div><div class="line"><span class="keyword">template</span> &lt;<span class="keywordtype">int</span> dim&gt; </div><div class="line">MultiComponentFunction&lt;dim&gt;::MultiComponentFunction( </div><div class="line">  <span class="keyword">const</span> <span class="keywordtype">double</span> initial_time) </div><div class="line">  : <a class="code" href="classFunction.html">Function</a>&lt;dim&gt;(1, initial_time) </div><div class="line">  , comp(0) </div><div class="line">{} </div><div class="line"></div><div class="line"><span class="keyword">template</span> &lt;<span class="keywordtype">int</span> dim&gt; </div><div class="line"><span class="keywordtype">void</span> MultiComponentFunction&lt;dim&gt;::set_component(<span class="keyword">const</span> <span class="keywordtype">unsigned</span> <span class="keywordtype">int</span> d) </div><div class="line">{ </div><div class="line">  <a class="code" href="group__Exceptions.html#ga70a0bb353656e704acf927945277bbc6">Assert</a>(d &lt; dim, <a class="code" href="group__Exceptions.html#ga0d685aad996180f9851183ae3e29019a">ExcIndexRange</a>(d, 0, dim)); </div><div class="line">  comp = <a class="code" href="namespacePhysics_1_1Elasticity_1_1Kinematics.html#a15728437b942dab0b0042eb06a407d2c">d</a>; </div><div class="line">} </div></div><!-- fragment --><p>有了这个类的定义，我们声明描述速度和压力的边界条件的类。</p>
<div class="fragment"><div class="line">  <span class="keyword">template</span> &lt;<span class="keywordtype">int</span> dim&gt; </div><div class="line">  <span class="keyword">class </span>Velocity : <span class="keyword">public</span> MultiComponentFunction&lt;dim&gt; </div><div class="line">  { </div><div class="line">  <span class="keyword">public</span>: </div><div class="line">    Velocity(<span class="keyword">const</span> <span class="keywordtype">double</span> initial_time = 0.0); </div><div class="line"></div><div class="line">    <span class="keyword">virtual</span> <span class="keywordtype">double</span> value(<span class="keyword">const</span> <a class="code" href="classPoint.html">Point&lt;dim&gt;</a> &amp; p, </div><div class="line">                         <span class="keyword">const</span> <span class="keywordtype">unsigned</span> <span class="keywordtype">int</span> component = 0) <span class="keyword">const override</span>; </div><div class="line"></div><div class="line">    <span class="keyword">virtual</span> <span class="keywordtype">void</span> value_list(<span class="keyword">const</span> std::vector&lt;<a class="code" href="classPoint.html">Point&lt;dim&gt;</a>&gt; &amp;points, </div><div class="line">                            std::vector&lt;double&gt; &amp;          values, </div><div class="line">                            <span class="keyword">const</span> <span class="keywordtype">unsigned</span> <span class="keywordtype">int</span> component = 0) <span class="keyword">const override</span>; </div><div class="line">  }; </div><div class="line"></div><div class="line">  <span class="keyword">template</span> &lt;<span class="keywordtype">int</span> dim&gt; </div><div class="line">  Velocity&lt;dim&gt;::Velocity(<span class="keyword">const</span> <span class="keywordtype">double</span> initial_time) </div><div class="line">    : MultiComponentFunction&lt;dim&gt;(initial_time) </div><div class="line">  {} </div><div class="line"></div><div class="line">  <span class="keyword">template</span> &lt;<span class="keywordtype">int</span> dim&gt; </div><div class="line">  <span class="keywordtype">void</span> Velocity&lt;dim&gt;::value_list(<span class="keyword">const</span> std::vector&lt;<a class="code" href="classPoint.html">Point&lt;dim&gt;</a>&gt; &amp;points, </div><div class="line">                                 std::vector&lt;double&gt; &amp;          values, </div><div class="line">                                 <span class="keyword">const</span> <span class="keywordtype">unsigned</span> <span class="keywordtype">int</span>)<span class="keyword"> const </span></div><div class="line"><span class="keyword">  </span>{ </div><div class="line">    <span class="keyword">const</span> <span class="keywordtype">unsigned</span> <span class="keywordtype">int</span> n_points = points.size(); </div><div class="line">    <a class="code" href="group__Exceptions.html#ga70a0bb353656e704acf927945277bbc6">Assert</a>(values.size() == n_points, </div><div class="line">           <a class="code" href="group__Exceptions.html#ga6060b2304b8600f5efa0d31eeda0207d">ExcDimensionMismatch</a>(values.size(), n_points)); </div><div class="line">    <span class="keywordflow">for</span> (<span class="keywordtype">unsigned</span> <span class="keywordtype">int</span> i = 0; i &lt; n_points; ++i) </div><div class="line">      values[i] = Velocity&lt;dim&gt;::value(points[i]); </div><div class="line">  } </div><div class="line"></div><div class="line">  <span class="keyword">template</span> &lt;<span class="keywordtype">int</span> dim&gt; </div><div class="line">  <span class="keywordtype">double</span> Velocity&lt;dim&gt;::value(<span class="keyword">const</span> <a class="code" href="classPoint.html">Point&lt;dim&gt;</a> &amp;p, <span class="keyword">const</span> <span class="keywordtype">unsigned</span> <span class="keywordtype">int</span>)<span class="keyword"> const </span></div><div class="line"><span class="keyword">  </span>{ </div><div class="line">    <span class="keywordflow">if</span> (this-&gt;comp == 0) </div><div class="line">      { </div><div class="line">        <span class="keyword">const</span> <span class="keywordtype">double</span> Um = 1.5; </div><div class="line">        <span class="keyword">const</span> <span class="keywordtype">double</span> H  = 4.1; </div><div class="line">        <span class="keywordflow">return</span> 4. * Um * p(1) * (H - p(1)) / (H * H); </div><div class="line">      } </div><div class="line">    <span class="keywordflow">else</span> </div><div class="line">      <span class="keywordflow">return</span> 0.; </div><div class="line">  } </div><div class="line"></div><div class="line">  <span class="keyword">template</span> &lt;<span class="keywordtype">int</span> dim&gt; </div><div class="line">  <span class="keyword">class </span>Pressure : <span class="keyword">public</span> <a class="code" href="classFunction.html">Function</a>&lt;dim&gt; </div><div class="line">  { </div><div class="line">  <span class="keyword">public</span>: </div><div class="line">    Pressure(<span class="keyword">const</span> <span class="keywordtype">double</span> initial_time = 0.0); </div><div class="line"></div><div class="line">    <span class="keyword">virtual</span> <span class="keywordtype">double</span> value(<span class="keyword">const</span> <a class="code" href="classPoint.html">Point&lt;dim&gt;</a> &amp; p, </div><div class="line">                         <span class="keyword">const</span> <span class="keywordtype">unsigned</span> <span class="keywordtype">int</span> component = 0) <span class="keyword">const override</span>; </div><div class="line"></div><div class="line">    <span class="keyword">virtual</span> <span class="keywordtype">void</span> value_list(<span class="keyword">const</span> std::vector&lt;<a class="code" href="classPoint.html">Point&lt;dim&gt;</a>&gt; &amp;points, </div><div class="line">                            std::vector&lt;double&gt; &amp;          values, </div><div class="line">                            <span class="keyword">const</span> <span class="keywordtype">unsigned</span> <span class="keywordtype">int</span> component = 0) <span class="keyword">const override</span>; </div><div class="line">  }; </div><div class="line"></div><div class="line">  <span class="keyword">template</span> &lt;<span class="keywordtype">int</span> dim&gt; </div><div class="line">  Pressure&lt;dim&gt;::Pressure(<span class="keyword">const</span> <span class="keywordtype">double</span> initial_time) </div><div class="line">    : <a class="code" href="classFunction.html">Function</a>&lt;dim&gt;(1, initial_time) </div><div class="line">  {} </div><div class="line"></div><div class="line">  <span class="keyword">template</span> &lt;<span class="keywordtype">int</span> dim&gt; </div><div class="line">  <span class="keywordtype">double</span> Pressure&lt;dim&gt;::value(<span class="keyword">const</span> <a class="code" href="classPoint.html">Point&lt;dim&gt;</a> &amp; p, </div><div class="line">                              <span class="keyword">const</span> <span class="keywordtype">unsigned</span> <span class="keywordtype">int</span> component)<span class="keyword"> const </span></div><div class="line"><span class="keyword">  </span>{ </div><div class="line">    (void)component; </div><div class="line">    <a class="code" href="group__Exceptions.html#gaafbb69cc2a791ae55880fd8d57d0c1b0">AssertIndexRange</a>(component, 1); </div><div class="line">    <span class="keywordflow">return</span> 25. - p(0); </div><div class="line">  } </div><div class="line"></div><div class="line">  <span class="keyword">template</span> &lt;<span class="keywordtype">int</span> dim&gt; </div><div class="line">  <span class="keywordtype">void</span> Pressure&lt;dim&gt;::value_list(<span class="keyword">const</span> std::vector&lt;<a class="code" href="classPoint.html">Point&lt;dim&gt;</a>&gt; &amp;points, </div><div class="line">                                 std::vector&lt;double&gt; &amp;          values, </div><div class="line">                                 <span class="keyword">const</span> <span class="keywordtype">unsigned</span> <span class="keywordtype">int</span> component)<span class="keyword"> const </span></div><div class="line"><span class="keyword">  </span>{ </div><div class="line">    (void)component; </div><div class="line">    <a class="code" href="group__Exceptions.html#gaafbb69cc2a791ae55880fd8d57d0c1b0">AssertIndexRange</a>(component, 1); </div><div class="line">    <span class="keyword">const</span> <span class="keywordtype">unsigned</span> <span class="keywordtype">int</span> n_points = points.size(); </div><div class="line">    <a class="code" href="group__Exceptions.html#ga70a0bb353656e704acf927945277bbc6">Assert</a>(values.size() == n_points, </div><div class="line">           <a class="code" href="group__Exceptions.html#ga6060b2304b8600f5efa0d31eeda0207d">ExcDimensionMismatch</a>(values.size(), n_points)); </div><div class="line">    <span class="keywordflow">for</span> (<span class="keywordtype">unsigned</span> <span class="keywordtype">int</span> i = 0; i &lt; n_points; ++i) </div><div class="line">      values[i] = Pressure&lt;dim&gt;::value(points[i]); </div><div class="line">  } </div><div class="line">} <span class="comment">// namespace EquationData </span></div></div><!-- fragment --><p><a class="anchor" id="ThecodeNavierStokesProjectioncodeclass"></a> </p><h3>The <code>NavierStokesProjection</code> class</h3>
<p></p>
<p>现在是程序的主类。它实现了纳维-斯托克斯方程的各种版本的投影方法。考虑到介绍中给出的实现细节，所有方法和成员变量的名称应该是不言自明的。</p>
<div class="fragment"><div class="line"><span class="keyword">template</span> &lt;<span class="keywordtype">int</span> dim&gt; </div><div class="line"><span class="keyword">class </span>NavierStokesProjection </div><div class="line">{ </div><div class="line"><span class="keyword">public</span>: </div><div class="line">  NavierStokesProjection(<span class="keyword">const</span> RunTimeParameters::Data_Storage &amp;data); </div><div class="line"></div><div class="line">  <span class="keywordtype">void</span> <a class="code" href="namespaceWorkStream_1_1internal_1_1tbb__no__coloring.html#a8673698a405bf47aa24002aeb6d76d70">run</a>(<span class="keyword">const</span> <span class="keywordtype">bool</span> verbose = <span class="keyword">false</span>, <span class="keyword">const</span> <span class="keywordtype">unsigned</span> <span class="keywordtype">int</span> n_plots = 10); </div><div class="line"></div><div class="line"><span class="keyword">protected</span>: </div><div class="line">  RunTimeParameters::Method type; </div><div class="line"></div><div class="line">  <span class="keyword">const</span> <span class="keywordtype">unsigned</span> <span class="keywordtype">int</span> deg; </div><div class="line">  <span class="keyword">const</span> <span class="keywordtype">double</span>       dt; </div><div class="line">  <span class="keyword">const</span> <span class="keywordtype">double</span>       t_0; </div><div class="line">  <span class="keyword">const</span> <span class="keywordtype">double</span>       <a class="code" href="namespaceLAPACKSupport.html#a8cac1e477eff052db622c8a9a9426ea3">T</a>; </div><div class="line">  <span class="keyword">const</span> <span class="keywordtype">double</span>       Re; </div><div class="line"></div><div class="line">  EquationData::Velocity&lt;dim&gt;               vel_exact; </div><div class="line">  std::map&lt;types::global_dof_index, double&gt; boundary_values; </div><div class="line">  std::vector&lt;types::boundary_id&gt;           boundary_ids; </div><div class="line"></div><div class="line">  <a class="code" href="classTriangulation.html">Triangulation&lt;dim&gt;</a> <a class="code" href="p4est__wrappers_8cc.html#ace00f2f80d9780ef9aa1007e1c22c6a4">triangulation</a>; </div><div class="line"></div><div class="line">  <a class="code" href="classFE__Q.html">FE_Q&lt;dim&gt;</a> fe_velocity; </div><div class="line">  <a class="code" href="classFE__Q.html">FE_Q&lt;dim&gt;</a> fe_pressure; </div><div class="line"></div><div class="line">  <a class="code" href="classDoFHandler.html">DoFHandler&lt;dim&gt;</a> dof_handler_velocity; </div><div class="line">  <a class="code" href="classDoFHandler.html">DoFHandler&lt;dim&gt;</a> dof_handler_pressure; </div><div class="line"></div><div class="line">  <a class="code" href="classQGauss.html">QGauss&lt;dim&gt;</a> quadrature_pressure; </div><div class="line">  <a class="code" href="classQGauss.html">QGauss&lt;dim&gt;</a> quadrature_velocity; </div><div class="line"></div><div class="line">  <a class="code" href="classSparsityPattern.html">SparsityPattern</a> sparsity_pattern_velocity; </div><div class="line">  <a class="code" href="classSparsityPattern.html">SparsityPattern</a> sparsity_pattern_pressure; </div><div class="line">  <a class="code" href="classSparsityPattern.html">SparsityPattern</a> sparsity_pattern_pres_vel; </div><div class="line"></div><div class="line">  <a class="code" href="classSparseMatrix.html">SparseMatrix&lt;double&gt;</a> vel_Laplace_plus_Mass; </div><div class="line">  <a class="code" href="classSparseMatrix.html">SparseMatrix&lt;double&gt;</a> vel_it_matrix[dim]; </div><div class="line">  <a class="code" href="classSparseMatrix.html">SparseMatrix&lt;double&gt;</a> vel_Mass; </div><div class="line">  <a class="code" href="classSparseMatrix.html">SparseMatrix&lt;double&gt;</a> vel_Laplace; </div><div class="line">  <a class="code" href="classSparseMatrix.html">SparseMatrix&lt;double&gt;</a> vel_Advection; </div><div class="line">  <a class="code" href="classSparseMatrix.html">SparseMatrix&lt;double&gt;</a> pres_Laplace; </div><div class="line">  <a class="code" href="classSparseMatrix.html">SparseMatrix&lt;double&gt;</a> pres_Mass; </div><div class="line">  <a class="code" href="classSparseMatrix.html">SparseMatrix&lt;double&gt;</a> pres_Diff[dim]; </div><div class="line">  <a class="code" href="classSparseMatrix.html">SparseMatrix&lt;double&gt;</a> pres_iterative; </div><div class="line"></div><div class="line">  <a class="code" href="classVector.html">Vector&lt;double&gt;</a> pres_n; </div><div class="line">  <a class="code" href="classVector.html">Vector&lt;double&gt;</a> pres_n_minus_1; </div><div class="line">  <a class="code" href="classVector.html">Vector&lt;double&gt;</a> phi_n; </div><div class="line">  <a class="code" href="classVector.html">Vector&lt;double&gt;</a> phi_n_minus_1; </div><div class="line">  <a class="code" href="classVector.html">Vector&lt;double&gt;</a> u_n[dim]; </div><div class="line">  <a class="code" href="classVector.html">Vector&lt;double&gt;</a> u_n_minus_1[dim]; </div><div class="line">  <a class="code" href="classVector.html">Vector&lt;double&gt;</a> u_star[dim]; </div><div class="line">  <a class="code" href="classVector.html">Vector&lt;double&gt;</a> force[dim]; </div><div class="line">  <a class="code" href="classVector.html">Vector&lt;double&gt;</a> v_tmp; </div><div class="line">  <a class="code" href="classVector.html">Vector&lt;double&gt;</a> pres_tmp; </div><div class="line">  <a class="code" href="classVector.html">Vector&lt;double&gt;</a> rot_u; </div><div class="line"></div><div class="line">  <a class="code" href="classSparseILU.html">SparseILU&lt;double&gt;</a>   prec_velocity[dim]; </div><div class="line">  <a class="code" href="classSparseILU.html">SparseILU&lt;double&gt;</a>   prec_pres_Laplace; </div><div class="line">  <a class="code" href="classSparseDirectUMFPACK.html">SparseDirectUMFPACK</a> prec_mass; </div><div class="line">  <a class="code" href="classSparseDirectUMFPACK.html">SparseDirectUMFPACK</a> prec_vel_mass; </div><div class="line"></div><div class="line">  <a class="code" href="group__Exceptions.html#ga90900994a811a22ca7c7a1a8872f8fae">DeclException2</a>(ExcInvalidTimeStep, </div><div class="line">                 <span class="keywordtype">double</span>, </div><div class="line">                 <span class="keywordtype">double</span>, </div><div class="line">                 &lt;&lt; <span class="stringliteral">&quot; The time step &quot;</span> &lt;&lt; arg1 &lt;&lt; <span class="stringliteral">&quot; is out of range.&quot;</span> </div><div class="line">                 &lt;&lt; std::endl </div><div class="line">                 &lt;&lt; <span class="stringliteral">&quot; The permitted range is (0,&quot;</span> &lt;&lt; arg2 &lt;&lt; <span class="stringliteral">&quot;]&quot;</span>); </div><div class="line"></div><div class="line">  <span class="keywordtype">void</span> create_triangulation_and_dofs(<span class="keyword">const</span> <span class="keywordtype">unsigned</span> <span class="keywordtype">int</span> n_refines); </div><div class="line"></div><div class="line">  <span class="keywordtype">void</span> initialize(); </div><div class="line"></div><div class="line">  <span class="keywordtype">void</span> interpolate_velocity(); </div><div class="line"></div><div class="line">  <span class="keywordtype">void</span> diffusion_step(<span class="keyword">const</span> <span class="keywordtype">bool</span> reinit_prec); </div><div class="line"></div><div class="line">  <span class="keywordtype">void</span> projection_step(<span class="keyword">const</span> <span class="keywordtype">bool</span> reinit_prec); </div><div class="line"></div><div class="line">  <span class="keywordtype">void</span> update_pressure(<span class="keyword">const</span> <span class="keywordtype">bool</span> reinit_prec); </div><div class="line"></div><div class="line"><span class="keyword">private</span>: </div><div class="line">  <span class="keywordtype">unsigned</span> <span class="keywordtype">int</span> vel_max_its; </div><div class="line">  <span class="keywordtype">unsigned</span> <span class="keywordtype">int</span> vel_Krylov_size; </div><div class="line">  <span class="keywordtype">unsigned</span> <span class="keywordtype">int</span> vel_off_diagonals; </div><div class="line">  <span class="keywordtype">unsigned</span> <span class="keywordtype">int</span> vel_update_prec; </div><div class="line">  <span class="keywordtype">double</span>       vel_eps; </div><div class="line">  <span class="keywordtype">double</span>       vel_diag_strength; </div><div class="line"></div><div class="line">  <span class="keywordtype">void</span> initialize_velocity_matrices(); </div><div class="line"></div><div class="line">  <span class="keywordtype">void</span> initialize_pressure_matrices(); </div></div><!-- fragment --><p>接下来的几个结构和函数是用来做各种并行的事情。它们遵循 <a class="el" href="group__threads.html">Parallel computing with multiple processors accessing</a> 中规定的方案，使用WorkStream类。正如那里所解释的，这需要我们为每个装配器声明两个结构，一个是每个任务的数据，一个是scratch数据结构。然后，这些结构被移交给组装本地贡献的函数，并将这些本地贡献复制到全局对象上。</p>
<p>这个程序的一个特殊之处在于，我们并不是只有一个DoFHandler对象来代表速度和压力，而是为这两种变量使用单独的DoFHandler对象。当我们想把涉及这两个变量的条款，如速度的发散和压力的梯度，乘以各自的测试函数时，我们要为这种优化付费。在这样做的时候，我们不能只使用一个FEValues对象，而是需要两个，而且需要用单元格迭代器来初始化它们，这些单元格迭代器指向三角形中的同一个单元格，但不同的DoFHandlers。</p>
<p>为了在实践中做到这一点，我们声明一个 "同步 "迭代器&ndash;一个内部由几个（在我们的例子中是两个）迭代器组成的对象，每次同步迭代器向前移动一步，内部存储的每个迭代器也向前移动一步，从而始终保持同步。碰巧的是，有一个deal.II类可以促进这种事情。这里重要的是要知道，建立在同一个三角形上的两个DoFHandler对象将以相同的顺序走过三角形的单元。</p>
<div class="fragment"><div class="line"><span class="keyword">using</span> IteratorTuple = </div><div class="line">  std::tuple&lt;typename DoFHandler&lt;dim&gt;::active_cell_iterator, </div><div class="line">             <span class="keyword">typename</span> <a class="code" href="classDoFHandler.html">DoFHandler&lt;dim&gt;::active_cell_iterator</a>&gt;; </div><div class="line"></div><div class="line"><span class="keyword">using</span> IteratorPair = <a class="code" href="structSynchronousIterators.html">SynchronousIterators&lt;IteratorTuple&gt;</a>; </div><div class="line"></div><div class="line"><span class="keywordtype">void</span> initialize_gradient_operator(); </div><div class="line"></div><div class="line"><span class="keyword">struct </span>InitGradPerTaskData </div><div class="line">{ </div><div class="line">  <span class="keywordtype">unsigned</span> <span class="keywordtype">int</span>                         <a class="code" href="namespacePhysics_1_1Elasticity_1_1Kinematics.html#a15728437b942dab0b0042eb06a407d2c">d</a>; </div><div class="line">  <span class="keywordtype">unsigned</span> <span class="keywordtype">int</span>                         vel_dpc; </div><div class="line">  <span class="keywordtype">unsigned</span> <span class="keywordtype">int</span>                         pres_dpc; </div><div class="line">  <a class="code" href="classFullMatrix.html">FullMatrix&lt;double&gt;</a>                   local_grad; </div><div class="line">  std::vector&lt;types::global_dof_index&gt; vel_local_dof_indices; </div><div class="line">  std::vector&lt;types::global_dof_index&gt; pres_local_dof_indices; </div><div class="line"></div><div class="line">  InitGradPerTaskData(<span class="keyword">const</span> <span class="keywordtype">unsigned</span> <span class="keywordtype">int</span> dd, </div><div class="line">                      <span class="keyword">const</span> <span class="keywordtype">unsigned</span> <span class="keywordtype">int</span> vdpc, </div><div class="line">                      <span class="keyword">const</span> <span class="keywordtype">unsigned</span> <span class="keywordtype">int</span> pdpc) </div><div class="line">    : d(dd) </div><div class="line">    , vel_dpc(vdpc) </div><div class="line">    , pres_dpc(pdpc) </div><div class="line">    , local_grad(vdpc, pdpc) </div><div class="line">    , vel_local_dof_indices(vdpc) </div><div class="line">    , pres_local_dof_indices(pdpc) </div><div class="line">  {} </div><div class="line">}; </div><div class="line"></div><div class="line"><span class="keyword">struct </span>InitGradScratchData </div><div class="line">{ </div><div class="line">  <span class="keywordtype">unsigned</span> <span class="keywordtype">int</span>  nqp; </div><div class="line">  <a class="code" href="classFEValues.html">FEValues&lt;dim&gt;</a> fe_val_vel; </div><div class="line">  <a class="code" href="classFEValues.html">FEValues&lt;dim&gt;</a> fe_val_pres; </div><div class="line">  InitGradScratchData(<span class="keyword">const</span> <a class="code" href="classFE__Q.html">FE_Q&lt;dim&gt;</a> &amp;  fe_v, </div><div class="line">                      <span class="keyword">const</span> <a class="code" href="classFE__Q.html">FE_Q&lt;dim&gt;</a> &amp;  fe_p, </div><div class="line">                      <span class="keyword">const</span> <a class="code" href="classQGauss.html">QGauss&lt;dim&gt;</a> &amp;quad, </div><div class="line">                      <span class="keyword">const</span> <a class="code" href="group__feaccess.html#gaa94b67d2fdcc390690c523f28019e52f">UpdateFlags</a>  flags_v, </div><div class="line">                      <span class="keyword">const</span> <a class="code" href="group__feaccess.html#gaa94b67d2fdcc390690c523f28019e52f">UpdateFlags</a>  flags_p) </div><div class="line">    : nqp(quad.size()) </div><div class="line">    , fe_val_vel(fe_v, quad, flags_v) </div><div class="line">    , fe_val_pres(fe_p, quad, flags_p) </div><div class="line">  {} </div><div class="line">  InitGradScratchData(<span class="keyword">const</span> InitGradScratchData &amp;data) </div><div class="line">    : nqp(data.nqp) </div><div class="line">    , fe_val_vel(data.fe_val_vel.get_fe(), </div><div class="line">                 data.fe_val_vel.get_quadrature(), </div><div class="line">                 data.fe_val_vel.get_update_flags()) </div><div class="line">    , fe_val_pres(data.fe_val_pres.get_fe(), </div><div class="line">                  data.fe_val_pres.get_quadrature(), </div><div class="line">                  data.fe_val_pres.get_update_flags()) </div><div class="line">  {} </div><div class="line">}; </div><div class="line"></div><div class="line"><span class="keywordtype">void</span> assemble_one_cell_of_gradient(<span class="keyword">const</span> IteratorPair &amp; SI, </div><div class="line">                                   InitGradScratchData &amp;scratch, </div><div class="line">                                   InitGradPerTaskData &amp;data); </div><div class="line"></div><div class="line"><span class="keywordtype">void</span> copy_gradient_local_to_global(<span class="keyword">const</span> InitGradPerTaskData &amp;data); </div></div><!-- fragment --><p>同样的一般布局也适用于以下实现平流项组装的类和函数。</p>
<div class="fragment"><div class="line"><span class="keywordtype">void</span> assemble_advection_term(); </div><div class="line"></div><div class="line"><span class="keyword">struct </span>AdvectionPerTaskData </div><div class="line">{ </div><div class="line">  <a class="code" href="classFullMatrix.html">FullMatrix&lt;double&gt;</a>                   local_advection; </div><div class="line">  std::vector&lt;types::global_dof_index&gt; local_dof_indices; </div><div class="line">  AdvectionPerTaskData(<span class="keyword">const</span> <span class="keywordtype">unsigned</span> <span class="keywordtype">int</span> dpc) </div><div class="line">    : local_advection(dpc, dpc) </div><div class="line">    , local_dof_indices(dpc) </div><div class="line">  {} </div><div class="line">}; </div><div class="line"></div><div class="line"><span class="keyword">struct </span>AdvectionScratchData </div><div class="line">{ </div><div class="line">  <span class="keywordtype">unsigned</span> <span class="keywordtype">int</span>                nqp; </div><div class="line">  <span class="keywordtype">unsigned</span> <span class="keywordtype">int</span>                dpc; </div><div class="line">  std::vector&lt;Point&lt;dim&gt;&gt;     u_star_local; </div><div class="line">  std::vector&lt;Tensor&lt;1, dim&gt;&gt; grad_u_star; </div><div class="line">  std::vector&lt;double&gt;         u_star_tmp; </div><div class="line">  <a class="code" href="classFEValues.html">FEValues&lt;dim&gt;</a>               fe_val; </div><div class="line">  AdvectionScratchData(<span class="keyword">const</span> <a class="code" href="classFE__Q.html">FE_Q&lt;dim&gt;</a> &amp;  fe, </div><div class="line">                       <span class="keyword">const</span> <a class="code" href="classQGauss.html">QGauss&lt;dim&gt;</a> &amp;quad, </div><div class="line">                       <span class="keyword">const</span> <a class="code" href="group__feaccess.html#gaa94b67d2fdcc390690c523f28019e52f">UpdateFlags</a>  flags) </div><div class="line">    : nqp(quad.size()) </div><div class="line">    , dpc(fe.n_dofs_per_cell()) </div><div class="line">    , u_star_local(nqp) </div><div class="line">    , grad_u_star(nqp) </div><div class="line">    , u_star_tmp(nqp) </div><div class="line">    , fe_val(fe, quad, flags) </div><div class="line">  {} </div><div class="line"></div><div class="line">  AdvectionScratchData(<span class="keyword">const</span> AdvectionScratchData &amp;data) </div><div class="line">    : nqp(data.nqp) </div><div class="line">    , dpc(data.dpc) </div><div class="line">    , u_star_local(nqp) </div><div class="line">    , grad_u_star(nqp) </div><div class="line">    , u_star_tmp(nqp) </div><div class="line">    , fe_val(data.fe_val.get_fe(), </div><div class="line">             data.fe_val.get_quadrature(), </div><div class="line">             data.fe_val.get_update_flags()) </div><div class="line">  {} </div><div class="line">}; </div><div class="line"></div><div class="line"><span class="keywordtype">void</span> assemble_one_cell_of_advection( </div><div class="line">  <span class="keyword">const</span> <span class="keyword">typename</span> DoFHandler&lt;dim&gt;::active_cell_iterator &amp;cell, </div><div class="line">  AdvectionScratchData &amp;                                scratch, </div><div class="line">  AdvectionPerTaskData &amp;                                data); </div><div class="line"></div><div class="line"><span class="keywordtype">void</span> copy_advection_local_to_global(<span class="keyword">const</span> AdvectionPerTaskData &amp;data); </div></div><!-- fragment --><p>最后几个函数实现了扩散解以及输出的后处理，包括计算速度的曲线。</p>
<div class="fragment"><div class="line">  <span class="keywordtype">void</span> diffusion_component_solve(<span class="keyword">const</span> <span class="keywordtype">unsigned</span> <span class="keywordtype">int</span> d); </div><div class="line"></div><div class="line">  <span class="keywordtype">void</span> output_results(<span class="keyword">const</span> <span class="keywordtype">unsigned</span> <span class="keywordtype">int</span> step); </div><div class="line"></div><div class="line">  <span class="keywordtype">void</span> assemble_vorticity(<span class="keyword">const</span> <span class="keywordtype">bool</span> reinit_prec); </div><div class="line">}; </div></div><!-- fragment --><p><a class="anchor" id="codeNavierStokesProjectionNavierStokesProjectioncode"></a> </p><h4><code>NavierStokesProjection::NavierStokesProjection</code> </h4>
<p></p>
<p>在构造函数中，我们只是从作为参数传递的 <code>Data_Storage</code> 对象中读取所有数据，验证我们读取的数据是否合理，最后，创建三角形并加载初始数据。</p>
<div class="fragment"><div class="line"><span class="keyword">template</span> &lt;<span class="keywordtype">int</span> dim&gt; </div><div class="line">NavierStokesProjection&lt;dim&gt;::NavierStokesProjection( </div><div class="line">  <span class="keyword">const</span> RunTimeParameters::Data_Storage &amp;data) </div><div class="line">  : type(data.form) </div><div class="line">  , deg(data.pressure_degree) </div><div class="line">  , dt(data.dt) </div><div class="line">  , t_0(data.initial_time) </div><div class="line">  , T(data.final_time) </div><div class="line">  , Re(data.Reynolds) </div><div class="line">  , vel_exact(data.initial_time) </div><div class="line">  , fe_velocity(deg + 1) </div><div class="line">  , fe_pressure(deg) </div><div class="line">  , dof_handler_velocity(triangulation) </div><div class="line">  , dof_handler_pressure(triangulation) </div><div class="line">  , quadrature_pressure(deg + 1) </div><div class="line">  , quadrature_velocity(deg + 2) </div><div class="line">  , vel_max_its(data.vel_max_iterations) </div><div class="line">  , vel_Krylov_size(data.vel_Krylov_size) </div><div class="line">  , vel_off_diagonals(data.vel_off_diagonals) </div><div class="line">  , vel_update_prec(data.vel_update_prec) </div><div class="line">  , vel_eps(data.vel_eps) </div><div class="line">  , vel_diag_strength(data.vel_diag_strength) </div><div class="line">{ </div><div class="line">  <span class="keywordflow">if</span> (deg &lt; 1) </div><div class="line">    std::cout </div><div class="line">      &lt;&lt; <span class="stringliteral">&quot; WARNING: The chosen pair of finite element spaces is not stable.&quot;</span> </div><div class="line">      &lt;&lt; std::endl </div><div class="line">      &lt;&lt; <span class="stringliteral">&quot; The obtained results will be nonsense&quot;</span> &lt;&lt; std::endl; </div><div class="line"></div><div class="line">  <a class="code" href="group__Exceptions.html#gafc0ca7ad85b3ebd64e8e51689ac85caf">AssertThrow</a>(!((dt &lt;= 0.) || (dt &gt; .5 * T)), ExcInvalidTimeStep(dt, .5 * T)); </div><div class="line"></div><div class="line">  create_triangulation_and_dofs(data.n_global_refines); </div><div class="line">  initialize(); </div><div class="line">} </div></div><!-- fragment --><p><a class="anchor" id="codeNavierStokesProjectioncreate_triangulation_and_dofscode"></a> </p><h4><code>NavierStokesProjection::create_triangulation_and_dofs</code></h4>
<p></p>
<p>创建三角形的方法，并将其细化到所需的次数。在创建三角形之后，它创建了与网格相关的数据，即分配自由度和重新编号，并初始化我们将使用的矩阵和向量。</p>
<div class="fragment"><div class="line"><span class="keyword">template</span> &lt;<span class="keywordtype">int</span> dim&gt; </div><div class="line"><span class="keywordtype">void</span> NavierStokesProjection&lt;dim&gt;::create_triangulation_and_dofs( </div><div class="line">  <span class="keyword">const</span> <span class="keywordtype">unsigned</span> <span class="keywordtype">int</span> n_refines) </div><div class="line">{ </div><div class="line">  <a class="code" href="classGridIn.html">GridIn&lt;dim&gt;</a> grid_in; </div><div class="line">  grid_in.<a class="code" href="classGridIn.html#a82ac1c03b0efe87204ad45d2f1d87f7e">attach_triangulation</a>(triangulation); </div><div class="line"></div><div class="line">  { </div><div class="line">    std::string   filename = <span class="stringliteral">&quot;nsbench2.inp&quot;</span>; </div><div class="line">    std::ifstream file(filename); </div><div class="line">    <a class="code" href="group__Exceptions.html#ga70a0bb353656e704acf927945277bbc6">Assert</a>(file, <a class="code" href="group__Exceptions.html#ga4c22c86ff89575667de2ca9778aa28e5">ExcFileNotOpen</a>(filename.c_str())); </div><div class="line">    grid_in.<a class="code" href="classGridIn.html#abbb16aa0aa53bfa9231b69278d397616">read_ucd</a>(file); </div><div class="line">  } </div><div class="line"></div><div class="line">  std::cout &lt;&lt; <span class="stringliteral">&quot;Number of refines = &quot;</span> &lt;&lt; n_refines &lt;&lt; std::endl; </div><div class="line">  triangulation.<a class="code" href="classTriangulation.html#a6ad0b3fb24aae17f4668427a433dea19">refine_global</a>(n_refines); </div><div class="line">  std::cout &lt;&lt; <span class="stringliteral">&quot;Number of active cells: &quot;</span> &lt;&lt; triangulation.<a class="code" href="classTriangulation.html#a5ea5c9957dbb566a562bbe2c0f3971e9">n_active_cells</a>() </div><div class="line">            &lt;&lt; std::endl; </div><div class="line"></div><div class="line">  boundary_ids = triangulation.<a class="code" href="classTriangulation.html#a63a0d3cc6653496e5bebf32220ac4160">get_boundary_ids</a>(); </div><div class="line"></div><div class="line"></div><div class="line">  <a class="code" href="namespaceDoFRenumbering_1_1boost.html#a408e819ea167bc557d5789ffe9b3f521">DoFRenumbering::boost::Cuthill_McKee</a>(dof_handler_velocity); </div><div class="line">  dof_handler_pressure.distribute_dofs(fe_pressure); </div><div class="line">  <a class="code" href="namespaceDoFRenumbering_1_1boost.html#a408e819ea167bc557d5789ffe9b3f521">DoFRenumbering::boost::Cuthill_McKee</a>(dof_handler_pressure); </div><div class="line"></div><div class="line">  initialize_velocity_matrices(); </div><div class="line">  initialize_pressure_matrices(); </div><div class="line">  initialize_gradient_operator(); </div><div class="line"></div><div class="line">  pres_n.reinit(dof_handler_pressure.n_dofs()); </div><div class="line">  pres_n_minus_1.reinit(dof_handler_pressure.n_dofs()); </div><div class="line">  phi_n.reinit(dof_handler_pressure.n_dofs()); </div><div class="line">  phi_n_minus_1.reinit(dof_handler_pressure.n_dofs()); </div><div class="line">  pres_tmp.reinit(dof_handler_pressure.n_dofs()); </div><div class="line">  <span class="keywordflow">for</span> (<span class="keywordtype">unsigned</span> <span class="keywordtype">int</span> d = 0; d &lt; dim; ++<a class="code" href="namespacePhysics_1_1Elasticity_1_1Kinematics.html#a15728437b942dab0b0042eb06a407d2c">d</a>) </div><div class="line">    { </div><div class="line">      u_n[<a class="code" href="namespacePhysics_1_1Elasticity_1_1Kinematics.html#a15728437b942dab0b0042eb06a407d2c">d</a>].reinit(dof_handler_velocity.n_dofs()); </div><div class="line">      u_n_minus_1[<a class="code" href="namespacePhysics_1_1Elasticity_1_1Kinematics.html#a15728437b942dab0b0042eb06a407d2c">d</a>].reinit(dof_handler_velocity.n_dofs()); </div><div class="line">      u_star[<a class="code" href="namespacePhysics_1_1Elasticity_1_1Kinematics.html#a15728437b942dab0b0042eb06a407d2c">d</a>].reinit(dof_handler_velocity.n_dofs()); </div><div class="line">      force[<a class="code" href="namespacePhysics_1_1Elasticity_1_1Kinematics.html#a15728437b942dab0b0042eb06a407d2c">d</a>].reinit(dof_handler_velocity.n_dofs()); </div><div class="line">    } </div><div class="line">  v_tmp.reinit(dof_handler_velocity.n_dofs()); </div><div class="line">  rot_u.reinit(dof_handler_velocity.n_dofs()); </div><div class="line"></div><div class="line">  std::cout &lt;&lt; <span class="stringliteral">&quot;dim (X_h) = &quot;</span> &lt;&lt; (dof_handler_velocity.n_dofs() * dim) <span class="comment">// </span></div><div class="line">            &lt;&lt; std::endl                                               <span class="comment">// </span></div><div class="line">            &lt;&lt; <span class="stringliteral">&quot;dim (M_h) = &quot;</span> &lt;&lt; dof_handler_pressure.n_dofs()         <span class="comment">// </span></div><div class="line">            &lt;&lt; std::endl                                               <span class="comment">// </span></div><div class="line">            &lt;&lt; <span class="stringliteral">&quot;Re        = &quot;</span> &lt;&lt; Re &lt;&lt; std::endl                       <span class="comment">// </span></div><div class="line">            &lt;&lt; std::endl; </div><div class="line">} </div></div><!-- fragment --><p><a class="anchor" id="codeNavierStokesProjectioninitializecode"></a> </p><h4><code>NavierStokesProjection::initialize</code> </h4>
<p></p>
<p>该方法创建常数矩阵并加载初始数据。</p>
<div class="fragment"><div class="line"><span class="keyword">template</span> &lt;<span class="keywordtype">int</span> dim&gt; </div><div class="line"><span class="keywordtype">void</span> NavierStokesProjection&lt;dim&gt;::initialize() </div><div class="line">{ </div><div class="line">  vel_Laplace_plus_Mass = 0.; </div><div class="line">  vel_Laplace_plus_Mass.add(1. / Re, vel_Laplace); </div><div class="line">  vel_Laplace_plus_Mass.add(1.5 / dt, vel_Mass); </div><div class="line"></div><div class="line">  EquationData::Pressure&lt;dim&gt; pres(t_0); </div><div class="line">  <a class="code" href="namespaceVectorTools.html#a761f008bdeb7d94a69205ae824deefad">VectorTools::interpolate</a>(dof_handler_pressure, pres, pres_n_minus_1); </div><div class="line">  pres.advance_time(dt); </div><div class="line">  <a class="code" href="namespaceVectorTools.html#a761f008bdeb7d94a69205ae824deefad">VectorTools::interpolate</a>(dof_handler_pressure, pres, pres_n); </div><div class="line">  phi_n         = 0.; </div><div class="line">  phi_n_minus_1 = 0.; </div><div class="line">  <span class="keywordflow">for</span> (<span class="keywordtype">unsigned</span> <span class="keywordtype">int</span> d = 0; d &lt; dim; ++<a class="code" href="namespacePhysics_1_1Elasticity_1_1Kinematics.html#a15728437b942dab0b0042eb06a407d2c">d</a>) </div><div class="line">    { </div><div class="line">      vel_exact.set_time(t_0); </div><div class="line">      vel_exact.set_component(d); </div><div class="line">      <a class="code" href="namespaceVectorTools.html#a761f008bdeb7d94a69205ae824deefad">VectorTools::interpolate</a>(dof_handler_velocity, </div><div class="line">                               vel_exact, </div><div class="line">                               u_n_minus_1[d]); </div><div class="line">      vel_exact.advance_time(dt); </div><div class="line">      <a class="code" href="namespaceVectorTools.html#a761f008bdeb7d94a69205ae824deefad">VectorTools::interpolate</a>(dof_handler_velocity, vel_exact, u_n[d]); </div><div class="line">    } </div><div class="line">} </div></div><!-- fragment --><p><a class="anchor" id="codeNavierStokesProjectioninitialize__matricescode"></a> </p><h4><code>NavierStokesProjection::initialize_*_matrices</code> </h4>
<p></p>
<p>在这组方法中，我们初始化了稀疏模式、约束条件（如果有的话）并组装了不依赖于时间步长的矩阵 <code>dt</code> 。请注意，对于拉普拉斯矩阵和质量矩阵，我们可以使用库中的函数来做这件事。因为这个函数的昂贵操作&ndash;创建两个矩阵&ndash;是完全独立的，我们原则上可以把它们标记为可以使用 <a class="el" href="group__threads.html#ga8c1e15b84e1bb58a8029fc6d6ddf3cbf">Threads::new_task</a> 函数进行并行工作的任务。我们不会在这里这样做，因为这些函数在内部已经被并行化了，特别是由于当前的函数在每个程序运行中只被调用一次，所以在每个时间步长中不会产生费用。然而，必要的修改将是非常直接的。</p>
<div class="fragment"><div class="line"><span class="keyword">template</span> &lt;<span class="keywordtype">int</span> dim&gt; </div><div class="line"><span class="keywordtype">void</span> NavierStokesProjection&lt;dim&gt;::initialize_velocity_matrices() </div><div class="line">{ </div><div class="line">  { </div><div class="line">    <a class="code" href="classDynamicSparsityPattern.html">DynamicSparsityPattern</a> dsp(dof_handler_velocity.n_dofs(), </div><div class="line">                               dof_handler_velocity.n_dofs()); </div><div class="line">    <a class="code" href="group__constraints.html#gaf78e864edbfba7e0a7477457bfb96b26">DoFTools::make_sparsity_pattern</a>(dof_handler_velocity, dsp); </div><div class="line">    sparsity_pattern_velocity.copy_from(dsp); </div><div class="line">  } </div><div class="line">  vel_Laplace_plus_Mass.reinit(sparsity_pattern_velocity); </div><div class="line">  <span class="keywordflow">for</span> (<span class="keywordtype">unsigned</span> <span class="keywordtype">int</span> d = 0; d &lt; dim; ++<a class="code" href="namespacePhysics_1_1Elasticity_1_1Kinematics.html#a15728437b942dab0b0042eb06a407d2c">d</a>) </div><div class="line">    vel_it_matrix[d].<a class="code" href="namespaceinternal.html#a38181f4582ff69679bda7d8e31c37291">reinit</a>(sparsity_pattern_velocity); </div><div class="line">  vel_Mass.reinit(sparsity_pattern_velocity); </div><div class="line">  vel_Laplace.reinit(sparsity_pattern_velocity); </div><div class="line">  vel_Advection.reinit(sparsity_pattern_velocity); </div><div class="line"></div><div class="line">  <a class="code" href="namespaceMatrixCreator.html#aab6397f114af66efd781f7f4daba22be">MatrixCreator::create_mass_matrix</a>(dof_handler_velocity, </div><div class="line">                                    quadrature_velocity, </div><div class="line">                                    vel_Mass); </div><div class="line">  <a class="code" href="namespaceMatrixCreator.html#a7b8157122064151d414dc34a22a3ca9c">MatrixCreator::create_laplace_matrix</a>(dof_handler_velocity, </div><div class="line">                                       quadrature_velocity, </div><div class="line">                                       vel_Laplace); </div><div class="line">} </div></div><!-- fragment --><p>作用于压力空间的矩阵的初始化与作用于速度空间的矩阵相似。</p>
<div class="fragment"><div class="line"><span class="keyword">template</span> &lt;<span class="keywordtype">int</span> dim&gt; </div><div class="line"><span class="keywordtype">void</span> NavierStokesProjection&lt;dim&gt;::initialize_pressure_matrices() </div><div class="line">{ </div><div class="line">  { </div><div class="line">    <a class="code" href="classDynamicSparsityPattern.html">DynamicSparsityPattern</a> dsp(dof_handler_pressure.n_dofs(), </div><div class="line">                               dof_handler_pressure.n_dofs()); </div><div class="line">    <a class="code" href="group__constraints.html#gaf78e864edbfba7e0a7477457bfb96b26">DoFTools::make_sparsity_pattern</a>(dof_handler_pressure, dsp); </div><div class="line">    sparsity_pattern_pressure.copy_from(dsp); </div><div class="line">  } </div><div class="line"></div><div class="line">  pres_Laplace.reinit(sparsity_pattern_pressure); </div><div class="line">  pres_iterative.reinit(sparsity_pattern_pressure); </div><div class="line">  pres_Mass.reinit(sparsity_pattern_pressure); </div><div class="line"></div><div class="line">  <a class="code" href="namespaceMatrixCreator.html#a7b8157122064151d414dc34a22a3ca9c">MatrixCreator::create_laplace_matrix</a>(dof_handler_pressure, </div><div class="line">                                       quadrature_pressure, </div><div class="line">                                       pres_Laplace); </div><div class="line">  <a class="code" href="namespaceMatrixCreator.html#aab6397f114af66efd781f7f4daba22be">MatrixCreator::create_mass_matrix</a>(dof_handler_pressure, </div><div class="line">                                    quadrature_pressure, </div><div class="line">                                    pres_Mass); </div><div class="line">} </div></div><!-- fragment --><p>对于梯度算子，我们从初始化稀疏模式和压缩它开始。这里需要注意的是，梯度算子从压力空间作用到速度空间，所以我们必须处理两个不同的有限元空间。为了保持循环的同步，我们使用之前定义的别名，即 <code>PairedIterators</code> and <code>IteratorPair</code> 。</p>
<div class="fragment"><div class="line"><span class="keyword">template</span> &lt;<span class="keywordtype">int</span> dim&gt; </div><div class="line"><span class="keywordtype">void</span> NavierStokesProjection&lt;dim&gt;::initialize_gradient_operator() </div><div class="line">{ </div><div class="line">  { </div><div class="line">    <a class="code" href="classDynamicSparsityPattern.html">DynamicSparsityPattern</a> dsp(dof_handler_velocity.n_dofs(), </div><div class="line">                               dof_handler_pressure.n_dofs()); </div><div class="line">    <a class="code" href="group__constraints.html#gaf78e864edbfba7e0a7477457bfb96b26">DoFTools::make_sparsity_pattern</a>(dof_handler_velocity, </div><div class="line">                                    dof_handler_pressure, </div><div class="line">                                    dsp); </div><div class="line">    sparsity_pattern_pres_vel.copy_from(dsp); </div><div class="line">  } </div><div class="line"></div><div class="line">  InitGradPerTaskData per_task_data(0, </div><div class="line">                                    fe_velocity.n_dofs_per_cell(), </div><div class="line">                                    fe_pressure.n_dofs_per_cell()); </div><div class="line">  InitGradScratchData scratch_data(fe_velocity, </div><div class="line">                                   fe_pressure, </div><div class="line">                                   quadrature_velocity, </div><div class="line">                                   <a class="code" href="group__feaccess.html#ggaa94b67d2fdcc390690c523f28019e52facbcc430975fa6af05f75ca786dc6fe20">update_gradients</a> | <a class="code" href="group__feaccess.html#ggaa94b67d2fdcc390690c523f28019e52fa714204722e9eeb43aadbd0d5ddc48c85">update_JxW_values</a>, </div><div class="line">                                   <a class="code" href="group__feaccess.html#ggaa94b67d2fdcc390690c523f28019e52fa4057ca2f127aa619c65886a9d3ad4aea">update_values</a>); </div><div class="line"></div><div class="line">  <span class="keywordflow">for</span> (<span class="keywordtype">unsigned</span> <span class="keywordtype">int</span> d = 0; d &lt; dim; ++<a class="code" href="namespacePhysics_1_1Elasticity_1_1Kinematics.html#a15728437b942dab0b0042eb06a407d2c">d</a>) </div><div class="line">    { </div><div class="line">      pres_Diff[<a class="code" href="namespacePhysics_1_1Elasticity_1_1Kinematics.html#a15728437b942dab0b0042eb06a407d2c">d</a>].reinit(sparsity_pattern_pres_vel); </div><div class="line">      per_task_data.d = <a class="code" href="namespacePhysics_1_1Elasticity_1_1Kinematics.html#a15728437b942dab0b0042eb06a407d2c">d</a>; </div><div class="line">      <a class="code" href="namespaceWorkStream.html#ab8ceb010811941c351803b671a19fb73">WorkStream::run</a>( </div><div class="line">        IteratorPair(IteratorTuple(dof_handler_velocity.begin_active(), </div><div class="line">                                   dof_handler_pressure.begin_active())), </div><div class="line">        IteratorPair(IteratorTuple(dof_handler_velocity.end(), </div><div class="line">                                   dof_handler_pressure.end())), </div><div class="line">        *<span class="keyword">this</span>, </div><div class="line">        &amp;NavierStokesProjection&lt;dim&gt;::assemble_one_cell_of_gradient, </div><div class="line">        &amp;NavierStokesProjection&lt;dim&gt;::copy_gradient_local_to_global, </div><div class="line">        scratch_data, </div><div class="line">        per_task_data); </div><div class="line">    } </div><div class="line">} </div><div class="line"></div><div class="line"><span class="keyword">template</span> &lt;<span class="keywordtype">int</span> dim&gt; </div><div class="line"><span class="keywordtype">void</span> NavierStokesProjection&lt;dim&gt;::assemble_one_cell_of_gradient( </div><div class="line">  <span class="keyword">const</span> IteratorPair &amp; SI, </div><div class="line">  InitGradScratchData &amp;scratch, </div><div class="line">  InitGradPerTaskData &amp;data) </div><div class="line">{ </div><div class="line">  scratch.fe_val_vel.reinit(std::get&lt;0&gt;(*SI)); </div><div class="line">  scratch.fe_val_pres.reinit(std::get&lt;1&gt;(*SI)); </div><div class="line"></div><div class="line">  std::get&lt;0&gt;(*SI)-&gt;get_dof_indices(data.vel_local_dof_indices); </div><div class="line">  std::get&lt;1&gt;(*SI)-&gt;get_dof_indices(data.pres_local_dof_indices); </div><div class="line"></div><div class="line">  data.local_grad = 0.; </div><div class="line">  <span class="keywordflow">for</span> (<span class="keywordtype">unsigned</span> <span class="keywordtype">int</span> q = 0; q &lt; scratch.nqp; ++q) </div><div class="line">    { </div><div class="line">      <span class="keywordflow">for</span> (<span class="keywordtype">unsigned</span> <span class="keywordtype">int</span> i = 0; i &lt; data.vel_dpc; ++i) </div><div class="line">        <span class="keywordflow">for</span> (<span class="keywordtype">unsigned</span> <span class="keywordtype">int</span> j = 0; j &lt; data.pres_dpc; ++j) </div><div class="line">          data.local_grad(i, j) += </div><div class="line">            -scratch.fe_val_vel.JxW(q) * </div><div class="line">            scratch.fe_val_vel.shape_grad(i, q)[data.d] * </div><div class="line">            scratch.fe_val_pres.shape_value(j, q); </div><div class="line">    } </div><div class="line">} </div><div class="line"></div><div class="line"><span class="keyword">template</span> &lt;<span class="keywordtype">int</span> dim&gt; </div><div class="line"><span class="keywordtype">void</span> NavierStokesProjection&lt;dim&gt;::copy_gradient_local_to_global( </div><div class="line">  <span class="keyword">const</span> InitGradPerTaskData &amp;data) </div><div class="line">{ </div><div class="line">  <span class="keywordflow">for</span> (<span class="keywordtype">unsigned</span> <span class="keywordtype">int</span> i = 0; i &lt; data.vel_dpc; ++i) </div><div class="line">    <span class="keywordflow">for</span> (<span class="keywordtype">unsigned</span> <span class="keywordtype">int</span> j = 0; j &lt; data.pres_dpc; ++j) </div><div class="line">      pres_Diff[data.d].add(data.vel_local_dof_indices[i], </div><div class="line">                            data.pres_local_dof_indices[j], </div><div class="line">                            data.local_grad(i, j)); </div><div class="line">} </div></div><!-- fragment --><p><a class="anchor" id="codeNavierStokesProjectionruncode"></a> </p><h4><code>NavierStokesProjection::run</code> </h4>
<p></p>
<p>这是时间行进函数，从 <code>t_0</code> 开始，使用时间步长 <code>dt</code> 的投影法在时间上前进，直到 <code>T</code> 。</p>
<p>它的第二个参数 <code>verbose</code> 表示该函数是否应该输出它在任何特定时刻正在做什么的信息：例如，它将说明我们是否正在进行扩散、投影子步骤；更新前置条件器等等。我们没有使用像 </p><div class="CodeFragmentInTutorialComment"> <div class="fragment"><div class="line"><span class="keywordflow">if</span> (verbose) std::cout &lt;&lt; <span class="stringliteral">&quot;something&quot;</span>;</div></div><!-- fragment --> </div><p> 那样的代码来实现这种输出，而是使用ConditionalOStream类来为我们做这个。该类接受一个输出流和一个条件，该条件表明你传递给它的东西是否应该被传递到给定的输出流，或者应该被忽略。这样，上面的代码就变成了 </p><div class="CodeFragmentInTutorialComment"> <div class="fragment"><div class="line">verbose_cout &lt;&lt; <span class="stringliteral">&quot;something&quot;</span>;</div></div><!-- fragment -->，并且在任何情况下都会做正确的事情。 </div><div class="fragment"><div class="line"><span class="keyword">template</span> &lt;<span class="keywordtype">int</span> dim&gt; </div><div class="line"><span class="keywordtype">void</span> <a class="code" href="namespaceWorkStream_1_1internal_1_1tbb__no__coloring.html#a8673698a405bf47aa24002aeb6d76d70">NavierStokesProjection&lt;dim&gt;::run</a>(<span class="keyword">const</span> <span class="keywordtype">bool</span>         verbose, </div><div class="line">                                      <span class="keyword">const</span> <span class="keywordtype">unsigned</span> <span class="keywordtype">int</span> output_interval) </div><div class="line">{ </div><div class="line">  <a class="code" href="classConditionalOStream.html">ConditionalOStream</a> verbose_cout(std::cout, verbose); </div><div class="line"></div><div class="line">  <span class="keyword">const</span> <span class="keyword">auto</span> n_steps = <span class="keyword">static_cast&lt;</span><span class="keywordtype">unsigned</span> <span class="keywordtype">int</span><span class="keyword">&gt;</span>((T - t_0) / dt); </div><div class="line">  vel_exact.set_time(2. * dt); </div><div class="line">  output_results(1); </div><div class="line">  <span class="keywordflow">for</span> (<span class="keywordtype">unsigned</span> <span class="keywordtype">int</span> n = 2; n &lt;= n_steps; ++n) </div><div class="line">    { </div><div class="line">      <span class="keywordflow">if</span> (n % output_interval == 0) </div><div class="line">        { </div><div class="line">          verbose_cout &lt;&lt; <span class="stringliteral">&quot;Plotting Solution&quot;</span> &lt;&lt; std::endl; </div><div class="line">          output_results(n); </div><div class="line">        } </div><div class="line">      std::cout &lt;&lt; <span class="stringliteral">&quot;Step = &quot;</span> &lt;&lt; n &lt;&lt; <span class="stringliteral">&quot; Time = &quot;</span> &lt;&lt; (n * dt) &lt;&lt; std::endl; </div><div class="line">      verbose_cout &lt;&lt; <span class="stringliteral">&quot;  Interpolating the velocity &quot;</span> &lt;&lt; std::endl; </div><div class="line"></div><div class="line">      interpolate_velocity(); </div><div class="line">      verbose_cout &lt;&lt; <span class="stringliteral">&quot;  Diffusion Step&quot;</span> &lt;&lt; std::endl; </div><div class="line">      <span class="keywordflow">if</span> (n % vel_update_prec == 0) </div><div class="line">        verbose_cout &lt;&lt; <span class="stringliteral">&quot;    With reinitialization of the preconditioner&quot;</span> </div><div class="line">                     &lt;&lt; std::endl; </div><div class="line">      diffusion_step((n % vel_update_prec == 0) || (n == 2)); </div><div class="line">      verbose_cout &lt;&lt; <span class="stringliteral">&quot;  Projection Step&quot;</span> &lt;&lt; std::endl; </div><div class="line">      projection_step((n == 2)); </div><div class="line">      verbose_cout &lt;&lt; <span class="stringliteral">&quot;  Updating the Pressure&quot;</span> &lt;&lt; std::endl; </div><div class="line">      update_pressure((n == 2)); </div><div class="line">      vel_exact.advance_time(dt); </div><div class="line">    } </div><div class="line">  output_results(n_steps); </div><div class="line">} </div><div class="line"></div><div class="line"><span class="keyword">template</span> &lt;<span class="keywordtype">int</span> dim&gt; </div><div class="line"><span class="keywordtype">void</span> NavierStokesProjection&lt;dim&gt;::interpolate_velocity() </div><div class="line">{ </div><div class="line">  <span class="keywordflow">for</span> (<span class="keywordtype">unsigned</span> <span class="keywordtype">int</span> d = 0; d &lt; dim; ++<a class="code" href="namespacePhysics_1_1Elasticity_1_1Kinematics.html#a15728437b942dab0b0042eb06a407d2c">d</a>) </div><div class="line">    { </div><div class="line">      u_star[<a class="code" href="namespacePhysics_1_1Elasticity_1_1Kinematics.html#a15728437b942dab0b0042eb06a407d2c">d</a>].equ(2., u_n[d]); </div><div class="line">      u_star[<a class="code" href="namespacePhysics_1_1Elasticity_1_1Kinematics.html#a15728437b942dab0b0042eb06a407d2c">d</a>] -= u_n_minus_1[<a class="code" href="namespacePhysics_1_1Elasticity_1_1Kinematics.html#a15728437b942dab0b0042eb06a407d2c">d</a>]; </div><div class="line">    } </div><div class="line">} </div></div><!-- fragment --><p><a class="anchor" id="codeNavierStokesProjectiondiffusion_stepcode"></a> </p><h4><code>NavierStokesProjection::diffusion_step</code></h4>
<p></p>
<p>扩散步骤的实现。请注意，昂贵的操作是函数末尾的扩散解，我们必须为每个速度分量做一次。为了加快进度，我们允许以并行方式进行，使用 <a class="el" href="group__threads.html#ga8c1e15b84e1bb58a8029fc6d6ddf3cbf">Threads::new_task</a> 函数，确保 <code>dim</code> 的求解都得到处理，并被安排到可用的处理器上：如果你的机器有一个以上的处理器核心，并且这个程序的其他部分目前没有使用资源，那么扩散求解将以并行方式运行。另一方面，如果你的系统只有一个处理器核心，那么以并行方式运行将是低效的（因为它导致了，例如，缓存拥堵），事情将被顺序地执行。</p>
<div class="fragment"><div class="line"><span class="keyword">template</span> &lt;<span class="keywordtype">int</span> dim&gt; </div><div class="line"><span class="keywordtype">void</span> NavierStokesProjection&lt;dim&gt;::diffusion_step(<span class="keyword">const</span> <span class="keywordtype">bool</span> reinit_prec) </div><div class="line">{ </div><div class="line">  pres_tmp.equ(-1., pres_n); </div><div class="line">  pres_tmp.add(-4. / 3., phi_n, 1. / 3., phi_n_minus_1); </div><div class="line"></div><div class="line">  assemble_advection_term(); </div><div class="line"></div><div class="line">  <span class="keywordflow">for</span> (<span class="keywordtype">unsigned</span> <span class="keywordtype">int</span> d = 0; d &lt; dim; ++<a class="code" href="namespacePhysics_1_1Elasticity_1_1Kinematics.html#a15728437b942dab0b0042eb06a407d2c">d</a>) </div><div class="line">    { </div><div class="line">      force[<a class="code" href="namespacePhysics_1_1Elasticity_1_1Kinematics.html#a15728437b942dab0b0042eb06a407d2c">d</a>] = 0.; </div><div class="line">      v_tmp.equ(2. / dt, u_n[d]); </div><div class="line">      v_tmp.add(-.5 / dt, u_n_minus_1[d]); </div><div class="line">      vel_Mass.vmult_add(force[d], v_tmp); </div><div class="line"></div><div class="line">      pres_Diff[<a class="code" href="namespacePhysics_1_1Elasticity_1_1Kinematics.html#a15728437b942dab0b0042eb06a407d2c">d</a>].vmult_add(force[d], pres_tmp); </div><div class="line">      u_n_minus_1[<a class="code" href="namespacePhysics_1_1Elasticity_1_1Kinematics.html#a15728437b942dab0b0042eb06a407d2c">d</a>] = u_n[<a class="code" href="namespacePhysics_1_1Elasticity_1_1Kinematics.html#a15728437b942dab0b0042eb06a407d2c">d</a>]; </div><div class="line"></div><div class="line">      vel_it_matrix[<a class="code" href="namespacePhysics_1_1Elasticity_1_1Kinematics.html#a15728437b942dab0b0042eb06a407d2c">d</a>].copy_from(vel_Laplace_plus_Mass); </div><div class="line">      vel_it_matrix[<a class="code" href="namespacePhysics_1_1Elasticity_1_1Kinematics.html#a15728437b942dab0b0042eb06a407d2c">d</a>].add(1., vel_Advection); </div><div class="line"></div><div class="line">      vel_exact.set_component(d); </div><div class="line">      boundary_values.clear(); </div><div class="line">      <span class="keywordflow">for</span> (<span class="keyword">const</span> <span class="keyword">auto</span> &amp;boundary_id : boundary_ids) </div><div class="line">        { </div><div class="line">          <span class="keywordflow">switch</span> (boundary_id) </div><div class="line">            { </div><div class="line">              <span class="keywordflow">case</span> 1: </div><div class="line">                <a class="code" href="namespaceVectorTools.html#af27ac28c698a9ed0199faed50a204538">VectorTools::interpolate_boundary_values</a>( </div><div class="line">                  dof_handler_velocity, </div><div class="line">                  boundary_id, </div><div class="line">                  <a class="code" href="classFunctions_1_1ZeroFunction.html">Functions::ZeroFunction&lt;dim&gt;</a>(), </div><div class="line">                  boundary_values); </div><div class="line">                <span class="keywordflow">break</span>; </div><div class="line">              <span class="keywordflow">case</span> 2: </div><div class="line">                <a class="code" href="namespaceVectorTools.html#af27ac28c698a9ed0199faed50a204538">VectorTools::interpolate_boundary_values</a>(dof_handler_velocity, </div><div class="line">                                                         boundary_id, </div><div class="line">                                                         vel_exact, </div><div class="line">                                                         boundary_values); </div><div class="line">                <span class="keywordflow">break</span>; </div><div class="line">              <span class="keywordflow">case</span> 3: </div><div class="line">                <span class="keywordflow">if</span> (d != 0) </div><div class="line">                  <a class="code" href="namespaceVectorTools.html#af27ac28c698a9ed0199faed50a204538">VectorTools::interpolate_boundary_values</a>( </div><div class="line">                    dof_handler_velocity, </div><div class="line">                    boundary_id, </div><div class="line">                    <a class="code" href="classFunctions_1_1ZeroFunction.html">Functions::ZeroFunction&lt;dim&gt;</a>(), </div><div class="line">                    boundary_values); </div><div class="line">                <span class="keywordflow">break</span>; </div><div class="line">              <span class="keywordflow">case</span> 4: </div><div class="line">                <a class="code" href="namespaceVectorTools.html#af27ac28c698a9ed0199faed50a204538">VectorTools::interpolate_boundary_values</a>( </div><div class="line">                  dof_handler_velocity, </div><div class="line">                  boundary_id, </div><div class="line">                  <a class="code" href="classFunctions_1_1ZeroFunction.html">Functions::ZeroFunction&lt;dim&gt;</a>(), </div><div class="line">                  boundary_values); </div><div class="line">                <span class="keywordflow">break</span>; </div><div class="line">              <span class="keywordflow">default</span>: </div><div class="line">                <a class="code" href="group__Exceptions.html#ga70a0bb353656e704acf927945277bbc6">Assert</a>(<span class="keyword">false</span>, <a class="code" href="group__Exceptions.html#ga7b52b286796c23ef9ff178faf7a4b68f">ExcNotImplemented</a>()); </div><div class="line">            } </div><div class="line">        } </div><div class="line">      <a class="code" href="namespaceMatrixTools.html#a9ad0eb7a8662628534586716748d62fb">MatrixTools::apply_boundary_values</a>(boundary_values, </div><div class="line">                                         vel_it_matrix[d], </div><div class="line">                                         u_n[d], </div><div class="line">                                         force[d]); </div><div class="line">    } </div><div class="line"></div><div class="line">  <a class="code" href="classThreads_1_1TaskGroup.html">Threads::TaskGroup&lt;void&gt;</a> tasks; </div><div class="line">  <span class="keywordflow">for</span> (<span class="keywordtype">unsigned</span> <span class="keywordtype">int</span> d = 0; d &lt; dim; ++<a class="code" href="namespacePhysics_1_1Elasticity_1_1Kinematics.html#a15728437b942dab0b0042eb06a407d2c">d</a>) </div><div class="line">    { </div><div class="line">      <span class="keywordflow">if</span> (reinit_prec) </div><div class="line">        prec_velocity[<a class="code" href="namespacePhysics_1_1Elasticity_1_1Kinematics.html#a15728437b942dab0b0042eb06a407d2c">d</a>].initialize(vel_it_matrix[d], </div><div class="line">                                    <a class="code" href="classSparseILU.html#ae21347f3202a1186060eac36dcb45817">SparseILU&lt;double&gt;::AdditionalData</a>( </div><div class="line">                                      vel_diag_strength, vel_off_diagonals)); </div><div class="line">      tasks += <a class="code" href="group__threads.html#ga8c1e15b84e1bb58a8029fc6d6ddf3cbf">Threads::new_task</a>( </div><div class="line">        &amp;NavierStokesProjection&lt;dim&gt;::diffusion_component_solve, *<span class="keyword">this</span>, d); </div><div class="line">    } </div><div class="line">  tasks.<a class="code" href="classThreads_1_1TaskGroup.html#a2917c607a567538f8e560c849fa88ac6">join_all</a>(); </div><div class="line">} </div><div class="line"></div><div class="line"><span class="keyword">template</span> &lt;<span class="keywordtype">int</span> dim&gt; </div><div class="line"><span class="keywordtype">void</span> </div><div class="line">NavierStokesProjection&lt;dim&gt;::diffusion_component_solve(<span class="keyword">const</span> <span class="keywordtype">unsigned</span> <span class="keywordtype">int</span> d) </div><div class="line">{ </div><div class="line">  <a class="code" href="classSolverControl.html">SolverControl</a> solver_control(vel_max_its, vel_eps * force[d].<a class="code" href="namespaceAdaptationStrategies_1_1Refinement.html#a629b528b2c9777d26eb9048d50d6c13a">l2_norm</a>()); </div><div class="line">  <a class="code" href="classSolverGMRES.html">SolverGMRES&lt;Vector&lt;double&gt;</a>&gt; gmres( </div><div class="line">    solver_control, </div><div class="line">    <a class="code" href="classSolverGMRES.html">SolverGMRES</a>&lt;<a class="code" href="classVector.html">Vector&lt;double&gt;</a>&gt;::AdditionalData(vel_Krylov_size)); </div><div class="line">  gmres.solve(vel_it_matrix[d], u_n[d], force[d], prec_velocity[d]); </div><div class="line">} </div></div><!-- fragment --><p><a class="anchor" id="codeNavierStokesProjectionassemble_advection_termcode"></a> </p><h4><code>NavierStokesProjection::assemble_advection_term</code> </h4>
<p></p>
<p>下面的几个函数是关于集合平流项的，平流项是扩散步骤的系统矩阵的一部分，在每个时间步骤中都会发生变化。如上所述，我们将使用WorkStream类和文件模块 <a class="el" href="group__threads.html">Parallel computing with multiple processors accessing</a> 中描述的其他设施，在所有单元上平行运行装配循环。</p>
<div class="fragment"><div class="line"><span class="keyword">template</span> &lt;<span class="keywordtype">int</span> dim&gt; </div><div class="line"><span class="keywordtype">void</span> NavierStokesProjection&lt;dim&gt;::assemble_advection_term() </div><div class="line">{ </div><div class="line">  vel_Advection = 0.; </div><div class="line">  AdvectionPerTaskData data(fe_velocity.n_dofs_per_cell()); </div><div class="line">  AdvectionScratchData scratch(fe_velocity, </div><div class="line">                               quadrature_velocity, </div><div class="line">                               <a class="code" href="group__feaccess.html#ggaa94b67d2fdcc390690c523f28019e52fa4057ca2f127aa619c65886a9d3ad4aea">update_values</a> | <a class="code" href="group__feaccess.html#ggaa94b67d2fdcc390690c523f28019e52fa714204722e9eeb43aadbd0d5ddc48c85">update_JxW_values</a> | </div><div class="line">                                 <a class="code" href="group__feaccess.html#ggaa94b67d2fdcc390690c523f28019e52facbcc430975fa6af05f75ca786dc6fe20">update_gradients</a>); </div><div class="line">  <a class="code" href="namespaceWorkStream.html#ab8ceb010811941c351803b671a19fb73">WorkStream::run</a>( </div><div class="line">    dof_handler_velocity.begin_active(), </div><div class="line">    dof_handler_velocity.end(), </div><div class="line">    *<span class="keyword">this</span>, </div><div class="line">    &amp;NavierStokesProjection&lt;dim&gt;::assemble_one_cell_of_advection, </div><div class="line">    &amp;NavierStokesProjection&lt;dim&gt;::copy_advection_local_to_global, </div><div class="line">    scratch, </div><div class="line">    data); </div><div class="line">} </div><div class="line"></div><div class="line"><span class="keyword">template</span> &lt;<span class="keywordtype">int</span> dim&gt; </div><div class="line"><span class="keywordtype">void</span> NavierStokesProjection&lt;dim&gt;::assemble_one_cell_of_advection( </div><div class="line">  <span class="keyword">const</span> <span class="keyword">typename</span> <a class="code" href="classDoFHandler.html">DoFHandler&lt;dim&gt;::active_cell_iterator</a> &amp;cell, </div><div class="line">  AdvectionScratchData &amp;                                scratch, </div><div class="line">  AdvectionPerTaskData &amp;                                data) </div><div class="line">{ </div><div class="line">  scratch.fe_val.reinit(cell); </div><div class="line">  cell-&gt;get_dof_indices(data.local_dof_indices); </div><div class="line">  <span class="keywordflow">for</span> (<span class="keywordtype">unsigned</span> <span class="keywordtype">int</span> d = 0; d &lt; dim; ++<a class="code" href="namespacePhysics_1_1Elasticity_1_1Kinematics.html#a15728437b942dab0b0042eb06a407d2c">d</a>) </div><div class="line">    { </div><div class="line">      scratch.fe_val.get_function_values(u_star[d], scratch.u_star_tmp); </div><div class="line">      <span class="keywordflow">for</span> (<span class="keywordtype">unsigned</span> <span class="keywordtype">int</span> q = 0; q &lt; scratch.nqp; ++q) </div><div class="line">        scratch.u_star_local[q](d) = scratch.u_star_tmp[q]; </div><div class="line">    } </div><div class="line"></div><div class="line">  <span class="keywordflow">for</span> (<span class="keywordtype">unsigned</span> <span class="keywordtype">int</span> d = 0; d &lt; dim; ++<a class="code" href="namespacePhysics_1_1Elasticity_1_1Kinematics.html#a15728437b942dab0b0042eb06a407d2c">d</a>) </div><div class="line">    { </div><div class="line">      scratch.fe_val.get_function_gradients(u_star[d], scratch.grad_u_star); </div><div class="line">      <span class="keywordflow">for</span> (<span class="keywordtype">unsigned</span> <span class="keywordtype">int</span> q = 0; q &lt; scratch.nqp; ++q) </div><div class="line">        { </div><div class="line">          <span class="keywordflow">if</span> (d == 0) </div><div class="line">            scratch.u_star_tmp[q] = 0.; </div><div class="line">          scratch.u_star_tmp[q] += scratch.grad_u_star[q][<a class="code" href="namespacePhysics_1_1Elasticity_1_1Kinematics.html#a15728437b942dab0b0042eb06a407d2c">d</a>]; </div><div class="line">        } </div><div class="line">    } </div><div class="line"></div><div class="line">  data.local_advection = 0.; </div><div class="line">  <span class="keywordflow">for</span> (<span class="keywordtype">unsigned</span> <span class="keywordtype">int</span> q = 0; q &lt; scratch.nqp; ++q) </div><div class="line">    <span class="keywordflow">for</span> (<span class="keywordtype">unsigned</span> <span class="keywordtype">int</span> i = 0; i &lt; scratch.dpc; ++i) </div><div class="line">      <span class="keywordflow">for</span> (<span class="keywordtype">unsigned</span> <span class="keywordtype">int</span> j = 0; j &lt; scratch.dpc; ++j) </div><div class="line">        data.local_advection(i, j) += (scratch.u_star_local[q] *            <span class="comment">// </span></div><div class="line">                                         scratch.fe_val.shape_grad(j, q) *  <span class="comment">// </span></div><div class="line">                                         scratch.fe_val.shape_value(i, q)   <span class="comment">// </span></div><div class="line">                                       +                                    <span class="comment">// </span></div><div class="line">                                       0.5 *                                <span class="comment">// </span></div><div class="line">                                         scratch.u_star_tmp[q] *            <span class="comment">// </span></div><div class="line">                                         scratch.fe_val.shape_value(i, q) * <span class="comment">// </span></div><div class="line">                                         scratch.fe_val.shape_value(j, q))  <span class="comment">// </span></div><div class="line">                                      * scratch.fe_val.JxW(q); </div><div class="line">} </div><div class="line"></div><div class="line"><span class="keyword">template</span> &lt;<span class="keywordtype">int</span> dim&gt; </div><div class="line"><span class="keywordtype">void</span> NavierStokesProjection&lt;dim&gt;::copy_advection_local_to_global( </div><div class="line">  <span class="keyword">const</span> AdvectionPerTaskData &amp;data) </div><div class="line">{ </div><div class="line">  <span class="keywordflow">for</span> (<span class="keywordtype">unsigned</span> <span class="keywordtype">int</span> i = 0; i &lt; fe_velocity.n_dofs_per_cell(); ++i) </div><div class="line">    <span class="keywordflow">for</span> (<span class="keywordtype">unsigned</span> <span class="keywordtype">int</span> j = 0; j &lt; fe_velocity.n_dofs_per_cell(); ++j) </div><div class="line">      vel_Advection.add(data.local_dof_indices[i], </div><div class="line">                        data.local_dof_indices[j], </div><div class="line">                        data.local_advection(i, j)); </div><div class="line">} </div></div><!-- fragment --><p><a class="anchor" id="codeNavierStokesProjectionprojection_stepcode"></a> </p><h4><code>NavierStokesProjection::projection_step</code></h4>
<p></p>
<p>这实现了投影的步骤。</p>
<div class="fragment"><div class="line"><span class="keyword">template</span> &lt;<span class="keywordtype">int</span> dim&gt; </div><div class="line"><span class="keywordtype">void</span> NavierStokesProjection&lt;dim&gt;::projection_step(<span class="keyword">const</span> <span class="keywordtype">bool</span> reinit_prec) </div><div class="line">{ </div><div class="line">  pres_iterative.copy_from(pres_Laplace); </div><div class="line"></div><div class="line">  pres_tmp = 0.; </div><div class="line">  <span class="keywordflow">for</span> (<span class="keywordtype">unsigned</span> d = 0; d &lt; dim; ++<a class="code" href="namespacePhysics_1_1Elasticity_1_1Kinematics.html#a15728437b942dab0b0042eb06a407d2c">d</a>) </div><div class="line">    pres_Diff[d].Tvmult_add(pres_tmp, u_n[d]); </div><div class="line"></div><div class="line">  phi_n_minus_1 = phi_n; </div><div class="line"></div><div class="line">  <span class="keyword">static</span> std::map&lt;types::global_dof_index, double&gt; bval; </div><div class="line">  <span class="keywordflow">if</span> (reinit_prec) </div><div class="line">    <a class="code" href="namespaceVectorTools.html#af27ac28c698a9ed0199faed50a204538">VectorTools::interpolate_boundary_values</a>(dof_handler_pressure, </div><div class="line">                                             3, </div><div class="line">                                             <a class="code" href="classFunctions_1_1ZeroFunction.html">Functions::ZeroFunction&lt;dim&gt;</a>(), </div><div class="line">                                             bval); </div><div class="line"></div><div class="line">  <a class="code" href="namespaceMatrixTools.html#a9ad0eb7a8662628534586716748d62fb">MatrixTools::apply_boundary_values</a>(bval, pres_iterative, phi_n, pres_tmp); </div><div class="line"></div><div class="line">  <span class="keywordflow">if</span> (reinit_prec) </div><div class="line">    prec_pres_Laplace.initialize(pres_iterative, </div><div class="line">                                 <a class="code" href="classSparseILU.html#ae21347f3202a1186060eac36dcb45817">SparseILU&lt;double&gt;::AdditionalData</a>( </div><div class="line">                                   vel_diag_strength, vel_off_diagonals)); </div><div class="line"></div><div class="line">  <a class="code" href="classSolverControl.html">SolverControl</a> solvercontrol(vel_max_its, vel_eps * pres_tmp.l2_norm()); </div><div class="line">  <a class="code" href="classSolverCG.html">SolverCG&lt;Vector&lt;double&gt;</a>&gt; cg(solvercontrol); </div><div class="line">  cg.solve(pres_iterative, phi_n, pres_tmp, prec_pres_Laplace); </div><div class="line"></div><div class="line">  phi_n *= 1.5 / dt; </div><div class="line">} </div></div><!-- fragment --><p><a class="anchor" id="codeNavierStokesProjectionupdate_pressurecode"></a> </p><h4><code>NavierStokesProjection::update_pressure</code> </h4>
<p></p>
<p>这是投影法的压力更新步骤。它实现了该方法的标准表述，即 </p><p class="formulaDsp">
\[ p^{n+1} = p^n + \phi^{n+1}, \]
</p>
<p> 或旋转形式，即 </p><p class="formulaDsp">
\[ p^{n+1} = p^n + \phi^{n+1} - \frac{1}{Re} \nabla\cdot u^{n+1}. \]
</p>
<div class="fragment"><div class="line"><span class="keyword">template</span> &lt;<span class="keywordtype">int</span> dim&gt; </div><div class="line"><span class="keywordtype">void</span> NavierStokesProjection&lt;dim&gt;::update_pressure(<span class="keyword">const</span> <span class="keywordtype">bool</span> reinit_prec) </div><div class="line">{ </div><div class="line">  pres_n_minus_1 = pres_n; </div><div class="line">  <span class="keywordflow">switch</span> (type) </div><div class="line">    { </div><div class="line">      <span class="keywordflow">case</span> RunTimeParameters::Method::standard: </div><div class="line">        pres_n += phi_n; </div><div class="line">        <span class="keywordflow">break</span>; </div><div class="line">      <span class="keywordflow">case</span> RunTimeParameters::Method::rotational: </div><div class="line">        <span class="keywordflow">if</span> (reinit_prec) </div><div class="line">          prec_mass.initialize(pres_Mass); </div><div class="line">        pres_n = pres_tmp; </div><div class="line">        prec_mass.solve(pres_n); </div><div class="line">        pres_n.sadd(1. / Re, 1., pres_n_minus_1); </div><div class="line">        pres_n += phi_n; </div><div class="line">        <span class="keywordflow">break</span>; </div><div class="line">      <span class="keywordflow">default</span>: </div><div class="line">        <a class="code" href="group__Exceptions.html#ga70a0bb353656e704acf927945277bbc6">Assert</a>(<span class="keyword">false</span>, <a class="code" href="group__Exceptions.html#ga7b52b286796c23ef9ff178faf7a4b68f">ExcNotImplemented</a>()); </div><div class="line">    }; </div><div class="line">} </div></div><!-- fragment --><p><a class="anchor" id="codeNavierStokesProjectionoutput_resultscode"></a> </p><h4><code>NavierStokesProjection::output_results</code> </h4>
<p></p>
<p>该方法绘制了当前的解决方案。主要的困难是，我们想创建一个单一的输出文件，其中包含所有的速度分量、压力以及流动的涡度的数据。另一方面，速度和压力存在于不同的DoFHandler对象中，因此不能用一个DataOut对象写入同一个文件。因此，我们必须更努力地把各种数据放到一个DoFHandler对象中，然后用它来驱动图形输出。</p>
<p>我们不会在这里详细说明这个过程，而是参考 <a class="el" href="step_32.html">step-32</a> ，那里使用了一个类似的程序（并有记录），为所有变量创建一个联合的 <a class="el" href="classDoFHandler.html">DoFHandler</a> 对象。</p>
<p>我们还注意到，我们在这里将涡度作为一个单独的函数中的标量来计算，使用 \(L^2\) 量的投影 \(\text{curl} u\) 到用于速度成分的有限元空间。但原则上，我们也可以从速度中计算出一个点状量，并通过 <a class="el" href="step_29.html">step-29</a> 和 <a class="el" href="step_33.html">step-33</a> 中讨论的DataPostprocessor机制实现。</p>
<div class="fragment"><div class="line"><span class="keyword">template</span> &lt;<span class="keywordtype">int</span> dim&gt; </div><div class="line"><span class="keywordtype">void</span> NavierStokesProjection&lt;dim&gt;::output_results(<span class="keyword">const</span> <span class="keywordtype">unsigned</span> <span class="keywordtype">int</span> step) </div><div class="line">{ </div><div class="line">  assemble_vorticity((step == 1)); </div><div class="line">  <span class="keyword">const</span> <a class="code" href="classFESystem.html">FESystem&lt;dim&gt;</a> joint_fe( </div><div class="line">    fe_velocity, dim, fe_pressure, 1, fe_velocity, 1); </div><div class="line">  <a class="code" href="classDoFHandler.html">DoFHandler&lt;dim&gt;</a> joint_dof_handler(triangulation); </div><div class="line">  joint_dof_handler.distribute_dofs(joint_fe); </div><div class="line">  <a class="code" href="group__Exceptions.html#ga70a0bb353656e704acf927945277bbc6">Assert</a>(joint_dof_handler.n_dofs() == </div><div class="line">           ((dim + 1) * dof_handler_velocity.n_dofs() + </div><div class="line">            dof_handler_pressure.n_dofs()), </div><div class="line">         <a class="code" href="group__Exceptions.html#ga31978c026b8b6b5116df30b8e748f6b7">ExcInternalError</a>()); </div><div class="line">  <a class="code" href="classVector.html">Vector&lt;double&gt;</a> joint_solution(joint_dof_handler.n_dofs()); </div><div class="line">  std::vector&lt;types::global_dof_index&gt; loc_joint_dof_indices( </div><div class="line">    joint_fe.n_dofs_per_cell()), </div><div class="line">    loc_vel_dof_indices(fe_velocity.n_dofs_per_cell()), </div><div class="line">    loc_pres_dof_indices(fe_pressure.n_dofs_per_cell()); </div><div class="line">  <span class="keyword">typename</span> <a class="code" href="classDoFHandler.html">DoFHandler&lt;dim&gt;::active_cell_iterator</a> </div><div class="line">    joint_cell = joint_dof_handler.begin_active(), </div><div class="line">    joint_endc = joint_dof_handler.end(), </div><div class="line">    vel_cell   = dof_handler_velocity.begin_active(), </div><div class="line">    pres_cell  = dof_handler_pressure.begin_active(); </div><div class="line">  <span class="keywordflow">for</span> (; joint_cell != joint_endc; ++joint_cell, ++vel_cell, ++pres_cell) </div><div class="line">    { </div><div class="line">      joint_cell-&gt;get_dof_indices(loc_joint_dof_indices); </div><div class="line">      vel_cell-&gt;get_dof_indices(loc_vel_dof_indices); </div><div class="line">      pres_cell-&gt;get_dof_indices(loc_pres_dof_indices); </div><div class="line">      <span class="keywordflow">for</span> (<span class="keywordtype">unsigned</span> <span class="keywordtype">int</span> i = 0; i &lt; joint_fe.n_dofs_per_cell(); ++i) </div><div class="line">        <span class="keywordflow">switch</span> (joint_fe.system_to_base_index(i).first.first) </div><div class="line">          { </div><div class="line">            <span class="keywordflow">case</span> 0: </div><div class="line">              <a class="code" href="group__Exceptions.html#ga70a0bb353656e704acf927945277bbc6">Assert</a>(joint_fe.system_to_base_index(i).first.second &lt; dim, </div><div class="line">                     <a class="code" href="group__Exceptions.html#ga31978c026b8b6b5116df30b8e748f6b7">ExcInternalError</a>()); </div><div class="line">              joint_solution(loc_joint_dof_indices[i]) = </div><div class="line">                u_n[joint_fe.system_to_base_index(i).first.second]( </div><div class="line">                  loc_vel_dof_indices[joint_fe.system_to_base_index(i) </div><div class="line">                                        .second]); </div><div class="line">              <span class="keywordflow">break</span>; </div><div class="line">            <span class="keywordflow">case</span> 1: </div><div class="line">              <a class="code" href="group__Exceptions.html#ga70a0bb353656e704acf927945277bbc6">Assert</a>(joint_fe.system_to_base_index(i).first.second == 0, </div><div class="line">                     <a class="code" href="group__Exceptions.html#ga31978c026b8b6b5116df30b8e748f6b7">ExcInternalError</a>()); </div><div class="line">              joint_solution(loc_joint_dof_indices[i]) = </div><div class="line">                pres_n(loc_pres_dof_indices[joint_fe.system_to_base_index(i) </div><div class="line">                                              .second]); </div><div class="line">              <span class="keywordflow">break</span>; </div><div class="line">            <span class="keywordflow">case</span> 2: </div><div class="line">              <a class="code" href="group__Exceptions.html#ga70a0bb353656e704acf927945277bbc6">Assert</a>(joint_fe.system_to_base_index(i).first.second == 0, </div><div class="line">                     <a class="code" href="group__Exceptions.html#ga31978c026b8b6b5116df30b8e748f6b7">ExcInternalError</a>()); </div><div class="line">              joint_solution(loc_joint_dof_indices[i]) = rot_u( </div><div class="line">                loc_vel_dof_indices[joint_fe.system_to_base_index(i).second]); </div><div class="line">              <span class="keywordflow">break</span>; </div><div class="line">            <span class="keywordflow">default</span>: </div><div class="line">              <a class="code" href="group__Exceptions.html#ga70a0bb353656e704acf927945277bbc6">Assert</a>(<span class="keyword">false</span>, <a class="code" href="group__Exceptions.html#ga31978c026b8b6b5116df30b8e748f6b7">ExcInternalError</a>()); </div><div class="line">          } </div><div class="line">    } </div><div class="line">  std::vector&lt;std::string&gt; joint_solution_names(dim, <span class="stringliteral">&quot;v&quot;</span>); </div><div class="line">  joint_solution_names.emplace_back(<span class="stringliteral">&quot;p&quot;</span>); </div><div class="line">  joint_solution_names.emplace_back(<span class="stringliteral">&quot;rot_u&quot;</span>); </div><div class="line">  <a class="code" href="classDataOut.html">DataOut&lt;dim&gt;</a> data_out; </div><div class="line">  data_out.<a class="code" href="classDataOut__DoFData.html#a6ed7c846331069f406b8c9933c37fda4">attach_dof_handler</a>(joint_dof_handler); </div><div class="line">  std::vector&lt;DataComponentInterpretation::DataComponentInterpretation&gt; </div><div class="line">    component_interpretation( </div><div class="line">      dim + 2, <a class="code" href="namespaceDataComponentInterpretation.html#a0cd2da3afe902f9004c23a73dbcc8ab0aa783915dbc182d5a49e111815fd23fe0">DataComponentInterpretation::component_is_part_of_vector</a>); </div><div class="line">  component_interpretation[dim] = </div><div class="line">    <a class="code" href="namespaceDataComponentInterpretation.html#a0cd2da3afe902f9004c23a73dbcc8ab0a1f3cd50135818a6458f1d3ff7ea4bb51">DataComponentInterpretation::component_is_scalar</a>; </div><div class="line">  component_interpretation[dim + 1] = </div><div class="line">    <a class="code" href="namespaceDataComponentInterpretation.html#a0cd2da3afe902f9004c23a73dbcc8ab0a1f3cd50135818a6458f1d3ff7ea4bb51">DataComponentInterpretation::component_is_scalar</a>; </div><div class="line">  data_out.<a class="code" href="classDataOut__DoFData.html#a79cbe2f02f8dfb85026c71d783dbb703">add_data_vector</a>(joint_solution, </div><div class="line">                           joint_solution_names, </div><div class="line">                           <a class="code" href="classDataOut.html">DataOut&lt;dim&gt;::type_dof_data</a>, </div><div class="line">                           component_interpretation); </div><div class="line">  data_out.<a class="code" href="classDataOut.html#a087f63e22f0614bca326dbdca288c646">build_patches</a>(deg + 1); </div><div class="line">  std::ofstream output(<span class="stringliteral">&quot;solution-&quot;</span> + <a class="code" href="namespaceUtilities.html#a6195c5f009ea8c7c536c6ffdf108c32f">Utilities::int_to_string</a>(step, 5) + </div><div class="line">                       <span class="stringliteral">&quot;.vtk&quot;</span>); </div><div class="line">  data_out.<a class="code" href="classDataOutInterface.html#acad99726038e4fca7f605fdffb3317e4">write_vtk</a>(output); </div><div class="line">} </div></div><!-- fragment --><p>下面是一个辅助函数，通过将 \(\text{curl} u\) 项投影到用于速度分量的有限元空间来计算涡度。这个函数只有在我们生成图形输出时才会被调用，所以不是很频繁，因此我们没有像对待其他装配函数那样，麻烦地使用WorkStream概念来并行化它。不过，如果需要的话，这应该不会太复杂。此外，我们在这里的实现只适用于2D，所以如果不是这种情况，我们就放弃了。</p>
<div class="fragment"><div class="line">  <span class="keyword">template</span> &lt;<span class="keywordtype">int</span> dim&gt; </div><div class="line">  <span class="keywordtype">void</span> NavierStokesProjection&lt;dim&gt;::assemble_vorticity(<span class="keyword">const</span> <span class="keywordtype">bool</span> reinit_prec) </div><div class="line">  { </div><div class="line">    <a class="code" href="group__Exceptions.html#ga70a0bb353656e704acf927945277bbc6">Assert</a>(dim == 2, <a class="code" href="group__Exceptions.html#ga7b52b286796c23ef9ff178faf7a4b68f">ExcNotImplemented</a>()); </div><div class="line">    <span class="keywordflow">if</span> (reinit_prec) </div><div class="line">      prec_vel_mass.initialize(vel_Mass); </div><div class="line"></div><div class="line">    <a class="code" href="classFEValues.html">FEValues&lt;dim&gt;</a>      fe_val_vel(fe_velocity, </div><div class="line">                             quadrature_velocity, </div><div class="line">                             <a class="code" href="group__feaccess.html#ggaa94b67d2fdcc390690c523f28019e52facbcc430975fa6af05f75ca786dc6fe20">update_gradients</a> | <a class="code" href="group__feaccess.html#ggaa94b67d2fdcc390690c523f28019e52fa714204722e9eeb43aadbd0d5ddc48c85">update_JxW_values</a> | </div><div class="line">                               <a class="code" href="group__feaccess.html#ggaa94b67d2fdcc390690c523f28019e52fa4057ca2f127aa619c65886a9d3ad4aea">update_values</a>); </div><div class="line">    <span class="keyword">const</span> <span class="keywordtype">unsigned</span> <span class="keywordtype">int</span> dpc = fe_velocity.n_dofs_per_cell(), </div><div class="line">                       nqp = quadrature_velocity.size(); </div><div class="line">    std::vector&lt;types::global_dof_index&gt; ldi(dpc); </div><div class="line">    <a class="code" href="classVector.html">Vector&lt;double&gt;</a>                       loc_rot(dpc); </div><div class="line"></div><div class="line">    std::vector&lt;Tensor&lt;1, dim&gt;&gt; grad_u1(nqp), grad_u2(nqp); </div><div class="line">    rot_u = 0.; </div><div class="line"></div><div class="line">    <span class="keywordflow">for</span> (<span class="keyword">const</span> <span class="keyword">auto</span> &amp;cell : dof_handler_velocity.<a class="code" href="group__CPP11.html#gacdb6d3adec96a13a7079f6c893e1d3ff">active_cell_iterators</a>()) </div><div class="line">      { </div><div class="line">        fe_val_vel.reinit(cell); </div><div class="line">        cell-&gt;get_dof_indices(ldi); </div><div class="line">        fe_val_vel.get_function_gradients(u_n[0], grad_u1); </div><div class="line">        fe_val_vel.get_function_gradients(u_n[1], grad_u2); </div><div class="line">        loc_rot = 0.; </div><div class="line">        <span class="keywordflow">for</span> (<span class="keywordtype">unsigned</span> <span class="keywordtype">int</span> q = 0; q &lt; nqp; ++q) </div><div class="line">          <span class="keywordflow">for</span> (<span class="keywordtype">unsigned</span> <span class="keywordtype">int</span> i = 0; i &lt; dpc; ++i) </div><div class="line">            loc_rot(i) += (grad_u2[q][0] - grad_u1[q][1]) * <span class="comment">// </span></div><div class="line">                          fe_val_vel.shape_value(i, q) *    <span class="comment">// </span></div><div class="line">                          fe_val_vel.JxW(q); </div><div class="line"></div><div class="line">        <span class="keywordflow">for</span> (<span class="keywordtype">unsigned</span> <span class="keywordtype">int</span> i = 0; i &lt; dpc; ++i) </div><div class="line">          rot_u(ldi[i]) += loc_rot(i); </div><div class="line">      } </div><div class="line"></div><div class="line">    prec_vel_mass.solve(rot_u); </div><div class="line">  } </div><div class="line">} <span class="comment">// namespace Step35 </span></div></div><!-- fragment --><p><a class="anchor" id="Themainfunction"></a> </p><h3>The main function </h3>
<p></p>
<p>主函数看起来和其他所有的教程程序非常相似，所以这里没有什么可评论的。</p>
<div class="fragment"><div class="line"><span class="keywordtype">int</span> main() </div><div class="line">{ </div><div class="line">  <span class="keywordflow">try</span> </div><div class="line">    { </div><div class="line">      <span class="keyword">using namespace </span>Step35; </div><div class="line"></div><div class="line">      RunTimeParameters::Data_Storage data; </div><div class="line">      data.read_data(<span class="stringliteral">&quot;parameter-file.prm&quot;</span>); </div><div class="line"></div><div class="line">      <a class="code" href="logstream_8h.html#ac643e79bd992f1a9bd0dca5b9f2859fb">deallog</a>.<a class="code" href="classLogStream.html#a8028e970ad8388596d625ed463894e98">depth_console</a>(data.verbose ? 2 : 0); </div><div class="line"></div><div class="line">      NavierStokesProjection&lt;2&gt; test(data); </div><div class="line">      test.run(data.verbose, data.output_interval); </div><div class="line">    } </div><div class="line">  <span class="keywordflow">catch</span> (std::exception &amp;exc) </div><div class="line">    { </div><div class="line">      std::cerr &lt;&lt; std::endl </div><div class="line">                &lt;&lt; std::endl </div><div class="line">                &lt;&lt; <span class="stringliteral">&quot;----------------------------------------------------&quot;</span> </div><div class="line">                &lt;&lt; std::endl; </div><div class="line">      std::cerr &lt;&lt; <span class="stringliteral">&quot;Exception on processing: &quot;</span> &lt;&lt; std::endl </div><div class="line">                &lt;&lt; exc.what() &lt;&lt; std::endl </div><div class="line">                &lt;&lt; <span class="stringliteral">&quot;Aborting!&quot;</span> &lt;&lt; std::endl </div><div class="line">                &lt;&lt; <span class="stringliteral">&quot;----------------------------------------------------&quot;</span> </div><div class="line">                &lt;&lt; std::endl; </div><div class="line">      <span class="keywordflow">return</span> 1; </div><div class="line">    } </div><div class="line">  <span class="keywordflow">catch</span> (...) </div><div class="line">    { </div><div class="line">      std::cerr &lt;&lt; std::endl </div><div class="line">                &lt;&lt; std::endl </div><div class="line">                &lt;&lt; <span class="stringliteral">&quot;----------------------------------------------------&quot;</span> </div><div class="line">                &lt;&lt; std::endl; </div><div class="line">      std::cerr &lt;&lt; <span class="stringliteral">&quot;Unknown exception!&quot;</span> &lt;&lt; std::endl </div><div class="line">                &lt;&lt; <span class="stringliteral">&quot;Aborting!&quot;</span> &lt;&lt; std::endl </div><div class="line">                &lt;&lt; <span class="stringliteral">&quot;----------------------------------------------------&quot;</span> </div><div class="line">                &lt;&lt; std::endl; </div><div class="line">      <span class="keywordflow">return</span> 1; </div><div class="line">    } </div><div class="line">  std::cout &lt;&lt; <span class="stringliteral">&quot;----------------------------------------------------&quot;</span> </div><div class="line">            &lt;&lt; std::endl </div><div class="line">            &lt;&lt; <span class="stringliteral">&quot;Apparently everything went fine!&quot;</span> &lt;&lt; std::endl </div><div class="line">            &lt;&lt; <span class="stringliteral">&quot;Don&#39;t forget to brush your teeth :-)&quot;</span> &lt;&lt; std::endl </div><div class="line">            &lt;&lt; std::endl; </div><div class="line">  <span class="keywordflow">return</span> 0; </div><div class="line">} </div></div><!-- fragment --><p> examples/step-35/doc/results.dox</p>
<p><a class="anchor" id="results"></a></p>
<p><a class="anchor" id="Results"></a></p><h1>Results</h1>
<p></p>
<p><a class="anchor" id="Re100"></a></p>
<p><a class="anchor" id="Re100"></a></p><h3>Re = 100 </h3>
<p></p>
<p>我们用下面的 <code>parameter-file.prm</code> 来运行代码，它可以在与源代码相同的目录中找到。</p>
<pre class="fragment">  # First a global definition
  # the type of method we want to use
  set Method_Form = rotational


  subsection Physical data
    # In this subsection we declare the physical data
    # The initial and final time, and the Reynolds number
    set initial_time = 0.
    set final_time   = 25.
    set Reynolds     = 100
  end


  subsection Time step data
    # In this subsection we declare the data that is to be used for time discretization,
    # i.e. the time step dt
    set dt = 5e-3
  end


  subsection Space discretization
    # In this subsection we declare the data that is relevant to the space discretization
    # we set the number of global refines the triangulation must have
    # and the degree k of the pair Q_(k+1)--Q_k of velocity--pressure finite element spaces
    set n_of_refines = 3
    set pressure_fe_degree = 1
  end


  subsection Data solve velocity
    # In this section we declare the parameters that are going to control the solution process
    # for the velocity.
    set max_iterations = 1000  # maximal number of iterations that GMRES must make
    set eps            = 1e-6  # stopping criterion
    set Krylov_size    = 30    # size of the Krylov subspace to be used in GMRES
    set off_diagonals  = 60    # number of off diagonals that ILU must compute
    set diag_strength  = 0.01  # diagonal strengthening value
    set update_prec    = 10    # this number indicates how often the preconditioner must be updated
  end


  #The output frequency
  set output = 50


  #Finally we set the verbosity level
  set verbose = false
</pre><p>由于 <code>verbose</code> parameter is set to <code>false</code> ，除了程序当前工作的时间步数，我们没有得到任何形式的输出。如果我们把它设置为 <code>true</code> ，我们就会得到关于程序正在做什么以及每个迭代过程要做多少步才能收敛等信息。</p>
<p>让我们绘制 \(t=1,5,12,20,25\) （即时间步长200、1000、2400、4000和5000）的所得结果，其中左栏显示涡度，右栏显示速度场。</p>
<table class="doxtable">
<tr>
<td><div class="image">
<img src="https://www.dealii.org/images/steps/developer/step-35.Re_100.vorticity.0.9.3.png" width="400"/>
</div>
  </td><td><div class="image">
<img src="https://www.dealii.org/images/steps/developer/step-35.Re_100.velocity.0.9.3.png" width="400"/>
</div>
   </td></tr>
<tr>
<td><div class="image">
<img src="https://www.dealii.org/images/steps/developer/step-35.Re_100.vorticity.1.9.3.png" width="400"/>
</div>
  </td><td><div class="image">
<img src="https://www.dealii.org/images/steps/developer/step-35.Re_100.velocity.1.9.3.png" width="400"/>
</div>
   </td></tr>
<tr>
<td><div class="image">
<img src="https://www.dealii.org/images/steps/developer/step-35.Re_100.vorticity.2.9.3.png" width="400"/>
</div>
  </td><td><div class="image">
<img src="https://www.dealii.org/images/steps/developer/step-35.Re_100.velocity.2.9.3.png" width="400"/>
</div>
   </td></tr>
<tr>
<td><div class="image">
<img src="https://www.dealii.org/images/steps/developer/step-35.Re_100.vorticity.3.9.3.png" width="400"/>
</div>
  </td><td><div class="image">
<img src="https://www.dealii.org/images/steps/developer/step-35.Re_100.velocity.3.9.3.png" width="400"/>
</div>
   </td></tr>
<tr>
<td><div class="image">
<img src="https://www.dealii.org/images/steps/developer/step-35.Re_100.vorticity.4.9.3.png" width="400"/>
</div>
  </td><td><div class="image">
<img src="https://www.dealii.org/images/steps/developer/step-35.Re_100.velocity.4.9.3.png" width="400"/>
</div>
   </td></tr>
</table>
<p>图像很好地显示了障碍物后面涡流链的发展和延伸，涡度的符号表明这是一个左转或右转的涡流。</p>
<p><a class="anchor" id="Re500"></a></p>
<p><a class="anchor" id="Re500"></a></p><h3>Re = 500 </h3>
<p></p>
<p>我们可以将参数文件中的雷诺数 \(Re\) 改为 \(500\) 。这样做，并在一定程度上减少时间步长，在时间 \(t=20,40\) 时得到以下图像。</p>
<table class="doxtable">
<tr>
<td><div class="image">
<img src="https://www.dealii.org/images/steps/developer/step-35.Re_500.vorticity.0.9.3.png" width="400"/>
</div>
  </td><td><div class="image">
<img src="https://www.dealii.org/images/steps/developer/step-35.Re_500.velocity.0.9.3.png" width="400"/>
</div>
   </td></tr>
<tr>
<td><div class="image">
<img src="https://www.dealii.org/images/steps/developer/step-35.Re_500.vorticity.1.9.3.png" width="400"/>
</div>
  </td><td><div class="image">
<img src="https://www.dealii.org/images/steps/developer/step-35.Re_500.velocity.1.9.3.png" width="400"/>
</div>
   </td></tr>
</table>
<p>对于这个较大的雷诺数，我们观察到不切实际的振荡，特别是涡度的振荡。离散化方案现在很难正确地解决流动问题，而流动应该仍然是层状的和有组织的。这些现象是典型的离散化方案，它们在溶解度不足的情况下缺乏稳健性，其中溶解度不足意味着用网格尺寸而不是几何体的物理尺寸计算的雷诺数很大。我们看一下放大的障碍物后面的区域，以及我们在那里的网格尺寸。</p>
<div class="image">
<img src="https://www.dealii.org/images/steps/developer/step-35.Re_500.zoom.9.3.png" width="400"/>
</div>
<p>我们可以通过在参数文件中多设置一个网格细化来重新运行模拟，从而轻松测试我们的假设。</p>
<div class="image">
<img src="https://www.dealii.org/images/steps/developer/step-35.Re_500.zoom_2.9.3.png" width="400"/>
</div>
<p>事实上，现在的涡度场看起来更加平滑了。虽然我们可以预期进一步细化网格也会抑制剩余的振荡，但我们应该采取措施在粗略分辨率的限制下获得一个强大的方案，如下所述。</p>
<p><a class="anchor" id="extensions"></a></p>
<p><a class="anchor" id="Possibilitiesforextensions"></a></p><h3>Possibilities for extensions </h3>
<p></p>
<p class="endli">这个程序可以在以下方向扩展。 </p><ul>
<li>
<p class="startli">自适应网格细化。正如我们所看到的，我们在一个单一的固定网格上计算了所有的东西。 使用自适应网格细化可以导致精度的提高，同时不会明显增加计算时间。 </p><pre class="fragment">&lt;li&gt;  自适应时间步长。虽然目前显然没有关于可变时间步长的投影方法的理论，但实践表明，它们的表现非常好。

&lt;li&gt;  高雷诺%数。正如我们从结果中看到的，增加雷诺数会大大改变离散化方案的行为。使用众所周知的稳定化技术，我们可以计算这个问题或其他许多问题中的流动，当雷诺数非常大，计算成本要求空间分辨率，而流动只能得到有限的解决，特别是对于三维湍流。

&lt;li&gt;  可变密度的不可压缩流。对于密度可变的不可压缩流的情况，有类似投影的方法。如果不同密度的流体混合在一起，例如淡水和盐水，或者酒精和水，这种流动就会发挥作用。

&lt;li&gt;  可压缩纳维-斯托克斯方程。这些方程适用于这样的情况：速度足够高，以至于流体变得可压缩，但速度不够快，以至于我们进入了一个粘度变得可以忽略的制度，纳维-斯托克斯方程需要被气体动力学的双曲欧拉方程取代。如果速度超过音速的三分之一，可压缩性就开始成为一个因素，所以它对几乎所有的地面交通工具来说都不是一个因素。另一方面，商业喷气式飞机的飞行速度约为音速的85%，机翼上的流动变得明显超音速，在这种情况下，可压缩的纳维尔-斯托克斯方程也不再适用。然而，在这两者之间的范围有重要的应用，如小型飞机或许多欧洲和东亚国家的快速列车。   &lt;/ul&gt; 
</pre><p><a class="anchor" id="PlainProg"></a> </p><h1>The plain program</h1>
<div class="fragment"><div class="line"></div><div class="line"></div><div class="line"><span class="comment">/* --------------------------------------------------------------------- </span></div><div class="line"><span class="comment"> * </span></div><div class="line"><span class="comment"> * Copyright (C) 2009 - 2021 by the deal.II authors </span></div><div class="line"><span class="comment"> * </span></div><div class="line"><span class="comment"> * This file is part of the deal.II library. </span></div><div class="line"><span class="comment"> * </span></div><div class="line"><span class="comment"> * The deal.II library is free software; you can use it, redistribute </span></div><div class="line"><span class="comment"> * it, and/or modify it under the terms of the GNU Lesser General </span></div><div class="line"><span class="comment"> * Public License as published by the Free Software Foundation; either </span></div><div class="line"><span class="comment"> * version 2.1 of the License, or (at your option) any later version. </span></div><div class="line"><span class="comment"> * The full text of the license can be found in the file LICENSE.md at </span></div><div class="line"><span class="comment"> * the top level directory of deal.II. </span></div><div class="line"><span class="comment"> * </span></div><div class="line"><span class="comment"> * --------------------------------------------------------------------- </span></div><div class="line"><span class="comment"> * </span></div><div class="line"><span class="comment"> * Author: Abner Salgado, Texas A&amp;M University 2009 </span></div><div class="line"><span class="comment"> */</span> </div><div class="line"></div><div class="line"></div><div class="line"></div><div class="line"></div><div class="line"><span class="preprocessor">#include &lt;<a class="code" href="parameter__handler_8h.html">deal.II/base/parameter_handler.h</a>&gt;</span> </div><div class="line"><span class="preprocessor">#include &lt;<a class="code" href="base_2point_8h.html">deal.II/base/point.h</a>&gt;</span> </div><div class="line"><span class="preprocessor">#include &lt;<a class="code" href="function_8h.html">deal.II/base/function.h</a>&gt;</span> </div><div class="line"><span class="preprocessor">#include &lt;<a class="code" href="quadrature__lib_8h.html">deal.II/base/quadrature_lib.h</a>&gt;</span> </div><div class="line"><span class="preprocessor">#include &lt;<a class="code" href="multithread__info_8h.html">deal.II/base/multithread_info.h</a>&gt;</span> </div><div class="line"><span class="preprocessor">#include &lt;<a class="code" href="thread__management_8h.html">deal.II/base/thread_management.h</a>&gt;</span> </div><div class="line"><span class="preprocessor">#include &lt;<a class="code" href="work__stream_8h.html">deal.II/base/work_stream.h</a>&gt;</span> </div><div class="line"><span class="preprocessor">#include &lt;<a class="code" href="include_2deal_8II_2base_2parallel_8h.html">deal.II/base/parallel.h</a>&gt;</span> </div><div class="line"><span class="preprocessor">#include &lt;<a class="code" href="include_2deal_8II_2base_2utilities_8h.html">deal.II/base/utilities.h</a>&gt;</span> </div><div class="line"><span class="preprocessor">#include &lt;<a class="code" href="conditional__ostream_8h.html">deal.II/base/conditional_ostream.h</a>&gt;</span> </div><div class="line"></div><div class="line"><span class="preprocessor">#include &lt;<a class="code" href="vector_8h.html">deal.II/lac/vector.h</a>&gt;</span> </div><div class="line"><span class="preprocessor">#include &lt;<a class="code" href="sparse__matrix_8h.html">deal.II/lac/sparse_matrix.h</a>&gt;</span> </div><div class="line"><span class="preprocessor">#include &lt;<a class="code" href="dynamic__sparsity__pattern_8h.html">deal.II/lac/dynamic_sparsity_pattern.h</a>&gt;</span> </div><div class="line"><span class="preprocessor">#include &lt;<a class="code" href="solver__cg_8h.html">deal.II/lac/solver_cg.h</a>&gt;</span> </div><div class="line"><span class="preprocessor">#include &lt;<a class="code" href="precondition_8h.html">deal.II/lac/precondition.h</a>&gt;</span> </div><div class="line"><span class="preprocessor">#include &lt;<a class="code" href="solver__gmres_8h.html">deal.II/lac/solver_gmres.h</a>&gt;</span> </div><div class="line"><span class="preprocessor">#include &lt;<a class="code" href="sparse__ilu_8h.html">deal.II/lac/sparse_ilu.h</a>&gt;</span> </div><div class="line"><span class="preprocessor">#include &lt;<a class="code" href="sparse__direct_8h.html">deal.II/lac/sparse_direct.h</a>&gt;</span> </div><div class="line"><span class="preprocessor">#include &lt;<a class="code" href="affine__constraints_8h.html">deal.II/lac/affine_constraints.h</a>&gt;</span> </div><div class="line"></div><div class="line"><span class="preprocessor">#include &lt;<a class="code" href="grid_2tria_8h.html">deal.II/grid/tria.h</a>&gt;</span> </div><div class="line"><span class="preprocessor">#include &lt;<a class="code" href="grid__generator_8h.html">deal.II/grid/grid_generator.h</a>&gt;</span> </div><div class="line"><span class="preprocessor">#include &lt;<a class="code" href="grid_2grid__refinement_8h.html">deal.II/grid/grid_refinement.h</a>&gt;</span> </div><div class="line"><span class="preprocessor">#include &lt;<a class="code" href="grid__in_8h.html">deal.II/grid/grid_in.h</a>&gt;</span> </div><div class="line"></div><div class="line"><span class="preprocessor">#include &lt;<a class="code" href="dofs_2dof__handler_8h.html">deal.II/dofs/dof_handler.h</a>&gt;</span> </div><div class="line"><span class="preprocessor">#include &lt;<a class="code" href="dof__tools_8h.html">deal.II/dofs/dof_tools.h</a>&gt;</span> </div><div class="line"><span class="preprocessor">#include &lt;<a class="code" href="dof__renumbering_8h.html">deal.II/dofs/dof_renumbering.h</a>&gt;</span> </div><div class="line"></div><div class="line"><span class="preprocessor">#include &lt;<a class="code" href="fe__q_8h.html">deal.II/fe/fe_q.h</a>&gt;</span> </div><div class="line"><span class="preprocessor">#include &lt;<a class="code" href="fe_2fe__values_8h.html">deal.II/fe/fe_values.h</a>&gt;</span> </div><div class="line"><span class="preprocessor">#include &lt;<a class="code" href="fe__tools_8h.html">deal.II/fe/fe_tools.h</a>&gt;</span> </div><div class="line"><span class="preprocessor">#include &lt;<a class="code" href="fe__system_8h.html">deal.II/fe/fe_system.h</a>&gt;</span> </div><div class="line"></div><div class="line"><span class="preprocessor">#include &lt;<a class="code" href="matrix__tools_8h.html">deal.II/numerics/matrix_tools.h</a>&gt;</span> </div><div class="line"><span class="preprocessor">#include &lt;<a class="code" href="vector__tools_8h.html">deal.II/numerics/vector_tools.h</a>&gt;</span> </div><div class="line"><span class="preprocessor">#include &lt;<a class="code" href="numerics_2data__out_8h.html">deal.II/numerics/data_out.h</a>&gt;</span> </div><div class="line"></div><div class="line"><span class="preprocessor">#include &lt;fstream&gt;</span> </div><div class="line"><span class="preprocessor">#include &lt;cmath&gt;</span> </div><div class="line"><span class="preprocessor">#include &lt;iostream&gt;</span> </div><div class="line"></div><div class="line"></div><div class="line"><span class="keyword">namespace </span>Step35 </div><div class="line">{ </div><div class="line">  <span class="keyword">using namespace </span><a class="code" href="namespacedealii.html">dealii</a>; </div><div class="line"></div><div class="line"></div><div class="line"></div><div class="line">  <span class="keyword">namespace </span>RunTimeParameters </div><div class="line">  { </div><div class="line">    <span class="keyword">enum class</span> Method </div><div class="line">    { </div><div class="line">      standard, </div><div class="line">      rotational </div><div class="line">    }; </div><div class="line"></div><div class="line">    <span class="keyword">class </span>Data_Storage </div><div class="line">    { </div><div class="line">    <span class="keyword">public</span>: </div><div class="line">      Data_Storage(); </div><div class="line"></div><div class="line">      <span class="keywordtype">void</span> read_data(<span class="keyword">const</span> std::string &amp;filename); </div><div class="line"></div><div class="line">      Method form; </div><div class="line"></div><div class="line">      <span class="keywordtype">double</span> dt; </div><div class="line">      <span class="keywordtype">double</span> initial_time; </div><div class="line">      <span class="keywordtype">double</span> final_time; </div><div class="line"></div><div class="line">      <span class="keywordtype">double</span> Reynolds; </div><div class="line"></div><div class="line">      <span class="keywordtype">unsigned</span> <span class="keywordtype">int</span> n_global_refines; </div><div class="line"></div><div class="line">      <span class="keywordtype">unsigned</span> <span class="keywordtype">int</span> pressure_degree; </div><div class="line"></div><div class="line">      <span class="keywordtype">unsigned</span> <span class="keywordtype">int</span> vel_max_iterations; </div><div class="line">      <span class="keywordtype">unsigned</span> <span class="keywordtype">int</span> vel_Krylov_size; </div><div class="line">      <span class="keywordtype">unsigned</span> <span class="keywordtype">int</span> vel_off_diagonals; </div><div class="line">      <span class="keywordtype">unsigned</span> <span class="keywordtype">int</span> vel_update_prec; </div><div class="line">      <span class="keywordtype">double</span>       vel_eps; </div><div class="line">      <span class="keywordtype">double</span>       vel_diag_strength; </div><div class="line"></div><div class="line">      <span class="keywordtype">bool</span>         verbose; </div><div class="line">      <span class="keywordtype">unsigned</span> <span class="keywordtype">int</span> output_interval; </div><div class="line"></div><div class="line">    <span class="keyword">protected</span>: </div><div class="line">      <a class="code" href="classParameterHandler.html">ParameterHandler</a> prm; </div><div class="line">    }; </div><div class="line"></div><div class="line"></div><div class="line">    Data_Storage::Data_Storage() </div><div class="line">      : form(Method::rotational) </div><div class="line">      , dt(5e-4) </div><div class="line">      , initial_time(0.) </div><div class="line">      , final_time(1.) </div><div class="line">      , Reynolds(1.) </div><div class="line">      , n_global_refines(0) </div><div class="line">      , pressure_degree(1) </div><div class="line">      , vel_max_iterations(1000) </div><div class="line">      , vel_Krylov_size(30) </div><div class="line">      , vel_off_diagonals(60) </div><div class="line">      , vel_update_prec(15) </div><div class="line">      , vel_eps(1e-12) </div><div class="line">      , vel_diag_strength(0.01) </div><div class="line">      , verbose(true) </div><div class="line">      , output_interval(15) </div><div class="line">    { </div><div class="line">      prm.<a class="code" href="classParameterHandler.html#a6d65f458be69e23a348221cb67fc411d">declare_entry</a>(<span class="stringliteral">&quot;Method_Form&quot;</span>, </div><div class="line">                        <span class="stringliteral">&quot;rotational&quot;</span>, </div><div class="line">                        <a class="code" href="classPatterns_1_1Selection.html">Patterns::Selection</a>(<span class="stringliteral">&quot;rotational|standard&quot;</span>), </div><div class="line">                        <span class="stringliteral">&quot; Used to select the type of method that we are going &quot;</span> </div><div class="line">                        <span class="stringliteral">&quot;to use. &quot;</span>); </div><div class="line">      prm.<a class="code" href="classParameterHandler.html#af29c20cde6d44186806d559beb468696">enter_subsection</a>(<span class="stringliteral">&quot;Physical data&quot;</span>); </div><div class="line">      { </div><div class="line">        prm.<a class="code" href="classParameterHandler.html#a6d65f458be69e23a348221cb67fc411d">declare_entry</a>(<span class="stringliteral">&quot;initial_time&quot;</span>, </div><div class="line">                          <span class="stringliteral">&quot;0.&quot;</span>, </div><div class="line">                          <a class="code" href="classPatterns_1_1Double.html">Patterns::Double</a>(0.), </div><div class="line">                          <span class="stringliteral">&quot; The initial time of the simulation. &quot;</span>); </div><div class="line">        prm.<a class="code" href="classParameterHandler.html#a6d65f458be69e23a348221cb67fc411d">declare_entry</a>(<span class="stringliteral">&quot;final_time&quot;</span>, </div><div class="line">                          <span class="stringliteral">&quot;1.&quot;</span>, </div><div class="line">                          <a class="code" href="classPatterns_1_1Double.html">Patterns::Double</a>(0.), </div><div class="line">                          <span class="stringliteral">&quot; The final time of the simulation. &quot;</span>); </div><div class="line">        prm.<a class="code" href="classParameterHandler.html#a6d65f458be69e23a348221cb67fc411d">declare_entry</a>(<span class="stringliteral">&quot;Reynolds&quot;</span>, </div><div class="line">                          <span class="stringliteral">&quot;1.&quot;</span>, </div><div class="line">                          <a class="code" href="classPatterns_1_1Double.html">Patterns::Double</a>(0.), </div><div class="line">                          <span class="stringliteral">&quot; The Reynolds number. &quot;</span>); </div><div class="line">      } </div><div class="line">      prm.<a class="code" href="classParameterHandler.html#a599462cacd492e2f712bf7369507dcff">leave_subsection</a>(); </div><div class="line"></div><div class="line">      prm.<a class="code" href="classParameterHandler.html#af29c20cde6d44186806d559beb468696">enter_subsection</a>(<span class="stringliteral">&quot;Time step data&quot;</span>); </div><div class="line">      { </div><div class="line">        prm.<a class="code" href="classParameterHandler.html#a6d65f458be69e23a348221cb67fc411d">declare_entry</a>(<span class="stringliteral">&quot;dt&quot;</span>, </div><div class="line">                          <span class="stringliteral">&quot;5e-4&quot;</span>, </div><div class="line">                          <a class="code" href="classPatterns_1_1Double.html">Patterns::Double</a>(0.), </div><div class="line">                          <span class="stringliteral">&quot; The time step size. &quot;</span>); </div><div class="line">      } </div><div class="line">      prm.<a class="code" href="classParameterHandler.html#a599462cacd492e2f712bf7369507dcff">leave_subsection</a>(); </div><div class="line"></div><div class="line">      prm.<a class="code" href="classParameterHandler.html#af29c20cde6d44186806d559beb468696">enter_subsection</a>(<span class="stringliteral">&quot;Space discretization&quot;</span>); </div><div class="line">      { </div><div class="line">        prm.<a class="code" href="classParameterHandler.html#a6d65f458be69e23a348221cb67fc411d">declare_entry</a>(<span class="stringliteral">&quot;n_of_refines&quot;</span>, </div><div class="line">                          <span class="stringliteral">&quot;0&quot;</span>, </div><div class="line">                          <a class="code" href="classPatterns_1_1Integer.html">Patterns::Integer</a>(0, 15), </div><div class="line">                          <span class="stringliteral">&quot; The number of global refines we do on the mesh. &quot;</span>); </div><div class="line">        prm.<a class="code" href="classParameterHandler.html#a6d65f458be69e23a348221cb67fc411d">declare_entry</a>(<span class="stringliteral">&quot;pressure_fe_degree&quot;</span>, </div><div class="line">                          <span class="stringliteral">&quot;1&quot;</span>, </div><div class="line">                          <a class="code" href="classPatterns_1_1Integer.html">Patterns::Integer</a>(1, 5), </div><div class="line">                          <span class="stringliteral">&quot; The polynomial degree for the pressure space. &quot;</span>); </div><div class="line">      } </div><div class="line">      prm.<a class="code" href="classParameterHandler.html#a599462cacd492e2f712bf7369507dcff">leave_subsection</a>(); </div><div class="line"></div><div class="line">      prm.<a class="code" href="classParameterHandler.html#af29c20cde6d44186806d559beb468696">enter_subsection</a>(<span class="stringliteral">&quot;Data solve velocity&quot;</span>); </div><div class="line">      { </div><div class="line">        prm.<a class="code" href="classParameterHandler.html#a6d65f458be69e23a348221cb67fc411d">declare_entry</a>( </div><div class="line">          <span class="stringliteral">&quot;max_iterations&quot;</span>, </div><div class="line">          <span class="stringliteral">&quot;1000&quot;</span>, </div><div class="line">          <a class="code" href="classPatterns_1_1Integer.html">Patterns::Integer</a>(1, 1000), </div><div class="line">          <span class="stringliteral">&quot; The maximal number of iterations GMRES must make. &quot;</span>); </div><div class="line">        prm.<a class="code" href="classParameterHandler.html#a6d65f458be69e23a348221cb67fc411d">declare_entry</a>(<span class="stringliteral">&quot;eps&quot;</span>, </div><div class="line">                          <span class="stringliteral">&quot;1e-12&quot;</span>, </div><div class="line">                          <a class="code" href="classPatterns_1_1Double.html">Patterns::Double</a>(0.), </div><div class="line">                          <span class="stringliteral">&quot; The stopping criterion. &quot;</span>); </div><div class="line">        prm.<a class="code" href="classParameterHandler.html#a6d65f458be69e23a348221cb67fc411d">declare_entry</a>(<span class="stringliteral">&quot;Krylov_size&quot;</span>, </div><div class="line">                          <span class="stringliteral">&quot;30&quot;</span>, </div><div class="line">                          <a class="code" href="classPatterns_1_1Integer.html">Patterns::Integer</a>(1), </div><div class="line">                          <span class="stringliteral">&quot; The size of the Krylov subspace to be used. &quot;</span>); </div><div class="line">        prm.<a class="code" href="classParameterHandler.html#a6d65f458be69e23a348221cb67fc411d">declare_entry</a>(<span class="stringliteral">&quot;off_diagonals&quot;</span>, </div><div class="line">                          <span class="stringliteral">&quot;60&quot;</span>, </div><div class="line">                          <a class="code" href="classPatterns_1_1Integer.html">Patterns::Integer</a>(0), </div><div class="line">                          <span class="stringliteral">&quot; The number of off-diagonal elements ILU must &quot;</span> </div><div class="line">                          <span class="stringliteral">&quot;compute. &quot;</span>); </div><div class="line">        prm.<a class="code" href="classParameterHandler.html#a6d65f458be69e23a348221cb67fc411d">declare_entry</a>(<span class="stringliteral">&quot;diag_strength&quot;</span>, </div><div class="line">                          <span class="stringliteral">&quot;0.01&quot;</span>, </div><div class="line">                          <a class="code" href="classPatterns_1_1Double.html">Patterns::Double</a>(0.), </div><div class="line">                          <span class="stringliteral">&quot; Diagonal strengthening coefficient. &quot;</span>); </div><div class="line">        prm.<a class="code" href="classParameterHandler.html#a6d65f458be69e23a348221cb67fc411d">declare_entry</a>(<span class="stringliteral">&quot;update_prec&quot;</span>, </div><div class="line">                          <span class="stringliteral">&quot;15&quot;</span>, </div><div class="line">                          <a class="code" href="classPatterns_1_1Integer.html">Patterns::Integer</a>(1), </div><div class="line">                          <span class="stringliteral">&quot; This number indicates how often we need to &quot;</span> </div><div class="line">                          <span class="stringliteral">&quot;update the preconditioner&quot;</span>); </div><div class="line">      } </div><div class="line">      prm.<a class="code" href="classParameterHandler.html#a599462cacd492e2f712bf7369507dcff">leave_subsection</a>(); </div><div class="line"></div><div class="line">      prm.<a class="code" href="classParameterHandler.html#a6d65f458be69e23a348221cb67fc411d">declare_entry</a>(<span class="stringliteral">&quot;verbose&quot;</span>, </div><div class="line">                        <span class="stringliteral">&quot;true&quot;</span>, </div><div class="line">                        <a class="code" href="classPatterns_1_1Bool.html">Patterns::Bool</a>(), </div><div class="line">                        <span class="stringliteral">&quot; This indicates whether the output of the solution &quot;</span> </div><div class="line">                        <span class="stringliteral">&quot;process should be verbose. &quot;</span>); </div><div class="line"></div><div class="line">      prm.<a class="code" href="classParameterHandler.html#a6d65f458be69e23a348221cb67fc411d">declare_entry</a>(<span class="stringliteral">&quot;output_interval&quot;</span>, </div><div class="line">                        <span class="stringliteral">&quot;1&quot;</span>, </div><div class="line">                        <a class="code" href="classPatterns_1_1Integer.html">Patterns::Integer</a>(1), </div><div class="line">                        <span class="stringliteral">&quot; This indicates between how many time steps we print &quot;</span> </div><div class="line">                        <span class="stringliteral">&quot;the solution. &quot;</span>); </div><div class="line">    } </div><div class="line"></div><div class="line">    <span class="keywordtype">void</span> Data_Storage::read_data(<span class="keyword">const</span> std::string &amp;filename) </div><div class="line">    { </div><div class="line">      std::ifstream file(filename); </div><div class="line">      <a class="code" href="group__Exceptions.html#gafc0ca7ad85b3ebd64e8e51689ac85caf">AssertThrow</a>(file, <a class="code" href="group__Exceptions.html#ga4c22c86ff89575667de2ca9778aa28e5">ExcFileNotOpen</a>(filename)); </div><div class="line"></div><div class="line">      prm.<a class="code" href="classParameterHandler.html#a0ddaa05c5463c6c0b7701e18005717a9">parse_input</a>(file); </div><div class="line"></div><div class="line">      <span class="keywordflow">if</span> (prm.<a class="code" href="classParameterHandler.html#a91cfbaca954f444047302446a4e87125">get</a>(<span class="stringliteral">&quot;Method_Form&quot;</span>) == std::string(<span class="stringliteral">&quot;rotational&quot;</span>)) </div><div class="line">        form = Method::rotational; </div><div class="line">      <span class="keywordflow">else</span> </div><div class="line">        form = Method::standard; </div><div class="line"></div><div class="line">      prm.<a class="code" href="classParameterHandler.html#af29c20cde6d44186806d559beb468696">enter_subsection</a>(<span class="stringliteral">&quot;Physical data&quot;</span>); </div><div class="line">      { </div><div class="line">        initial_time = prm.<a class="code" href="classParameterHandler.html#aeaf3c7846747695b1f327677e3716ec5">get_double</a>(<span class="stringliteral">&quot;initial_time&quot;</span>); </div><div class="line">        final_time   = prm.<a class="code" href="classParameterHandler.html#aeaf3c7846747695b1f327677e3716ec5">get_double</a>(<span class="stringliteral">&quot;final_time&quot;</span>); </div><div class="line">        Reynolds     = prm.<a class="code" href="classParameterHandler.html#aeaf3c7846747695b1f327677e3716ec5">get_double</a>(<span class="stringliteral">&quot;Reynolds&quot;</span>); </div><div class="line">      } </div><div class="line">      prm.<a class="code" href="classParameterHandler.html#a599462cacd492e2f712bf7369507dcff">leave_subsection</a>(); </div><div class="line"></div><div class="line">      prm.<a class="code" href="classParameterHandler.html#af29c20cde6d44186806d559beb468696">enter_subsection</a>(<span class="stringliteral">&quot;Time step data&quot;</span>); </div><div class="line">      { </div><div class="line">        dt = prm.<a class="code" href="classParameterHandler.html#aeaf3c7846747695b1f327677e3716ec5">get_double</a>(<span class="stringliteral">&quot;dt&quot;</span>); </div><div class="line">      } </div><div class="line">      prm.<a class="code" href="classParameterHandler.html#a599462cacd492e2f712bf7369507dcff">leave_subsection</a>(); </div><div class="line"></div><div class="line">      prm.<a class="code" href="classParameterHandler.html#af29c20cde6d44186806d559beb468696">enter_subsection</a>(<span class="stringliteral">&quot;Space discretization&quot;</span>); </div><div class="line">      { </div><div class="line">        n_global_refines = prm.<a class="code" href="classParameterHandler.html#a61fa98fdc0c52980a5b1de0ee1fc5bb2">get_integer</a>(<span class="stringliteral">&quot;n_of_refines&quot;</span>); </div><div class="line">        pressure_degree  = prm.<a class="code" href="classParameterHandler.html#a61fa98fdc0c52980a5b1de0ee1fc5bb2">get_integer</a>(<span class="stringliteral">&quot;pressure_fe_degree&quot;</span>); </div><div class="line">      } </div><div class="line">      prm.<a class="code" href="classParameterHandler.html#a599462cacd492e2f712bf7369507dcff">leave_subsection</a>(); </div><div class="line"></div><div class="line">      prm.<a class="code" href="classParameterHandler.html#af29c20cde6d44186806d559beb468696">enter_subsection</a>(<span class="stringliteral">&quot;Data solve velocity&quot;</span>); </div><div class="line">      { </div><div class="line">        vel_max_iterations = prm.<a class="code" href="classParameterHandler.html#a61fa98fdc0c52980a5b1de0ee1fc5bb2">get_integer</a>(<span class="stringliteral">&quot;max_iterations&quot;</span>); </div><div class="line">        vel_eps            = prm.<a class="code" href="classParameterHandler.html#aeaf3c7846747695b1f327677e3716ec5">get_double</a>(<span class="stringliteral">&quot;eps&quot;</span>); </div><div class="line">        vel_Krylov_size    = prm.<a class="code" href="classParameterHandler.html#a61fa98fdc0c52980a5b1de0ee1fc5bb2">get_integer</a>(<span class="stringliteral">&quot;Krylov_size&quot;</span>); </div><div class="line">        vel_off_diagonals  = prm.<a class="code" href="classParameterHandler.html#a61fa98fdc0c52980a5b1de0ee1fc5bb2">get_integer</a>(<span class="stringliteral">&quot;off_diagonals&quot;</span>); </div><div class="line">        vel_diag_strength  = prm.<a class="code" href="classParameterHandler.html#aeaf3c7846747695b1f327677e3716ec5">get_double</a>(<span class="stringliteral">&quot;diag_strength&quot;</span>); </div><div class="line">        vel_update_prec    = prm.<a class="code" href="classParameterHandler.html#a61fa98fdc0c52980a5b1de0ee1fc5bb2">get_integer</a>(<span class="stringliteral">&quot;update_prec&quot;</span>); </div><div class="line">      } </div><div class="line">      prm.<a class="code" href="classParameterHandler.html#a599462cacd492e2f712bf7369507dcff">leave_subsection</a>(); </div><div class="line"></div><div class="line">      verbose = prm.<a class="code" href="classParameterHandler.html#a6bb45dc67787e3fab7882461929b5fbe">get_bool</a>(<span class="stringliteral">&quot;verbose&quot;</span>); </div><div class="line"></div><div class="line">      output_interval = prm.<a class="code" href="classParameterHandler.html#a61fa98fdc0c52980a5b1de0ee1fc5bb2">get_integer</a>(<span class="stringliteral">&quot;output_interval&quot;</span>); </div><div class="line">    } </div><div class="line">  } <span class="comment">// namespace RunTimeParameters </span></div><div class="line"></div><div class="line"></div><div class="line"></div><div class="line">  <span class="keyword">namespace </span>EquationData </div><div class="line">  { </div><div class="line"></div><div class="line"></div><div class="line">    <span class="keyword">template</span> &lt;<span class="keywordtype">int</span> dim&gt; </div><div class="line">    <span class="keyword">class </span>MultiComponentFunction : <span class="keyword">public</span> <a class="code" href="classFunction.html">Function</a>&lt;dim&gt; </div><div class="line">    { </div><div class="line">    <span class="keyword">public</span>: </div><div class="line">      MultiComponentFunction(<span class="keyword">const</span> <span class="keywordtype">double</span> initial_time = 0.); </div><div class="line">      <span class="keywordtype">void</span> set_component(<span class="keyword">const</span> <span class="keywordtype">unsigned</span> <span class="keywordtype">int</span> d); </div><div class="line"></div><div class="line">    <span class="keyword">protected</span>: </div><div class="line">      <span class="keywordtype">unsigned</span> <span class="keywordtype">int</span> comp; </div><div class="line">    }; </div><div class="line"></div><div class="line">    <span class="keyword">template</span> &lt;<span class="keywordtype">int</span> dim&gt; </div><div class="line">    MultiComponentFunction&lt;dim&gt;::MultiComponentFunction( </div><div class="line">      <span class="keyword">const</span> <span class="keywordtype">double</span> initial_time) </div><div class="line">      : <a class="code" href="classFunction.html">Function</a>&lt;dim&gt;(1, initial_time) </div><div class="line">      , comp(0) </div><div class="line">    {} </div><div class="line"></div><div class="line">    <span class="keyword">template</span> &lt;<span class="keywordtype">int</span> dim&gt; </div><div class="line">    <span class="keywordtype">void</span> MultiComponentFunction&lt;dim&gt;::set_component(<span class="keyword">const</span> <span class="keywordtype">unsigned</span> <span class="keywordtype">int</span> d) </div><div class="line">    { </div><div class="line">      <a class="code" href="group__Exceptions.html#ga70a0bb353656e704acf927945277bbc6">Assert</a>(d &lt; dim, <a class="code" href="group__Exceptions.html#ga0d685aad996180f9851183ae3e29019a">ExcIndexRange</a>(d, 0, dim)); </div><div class="line">      comp = <a class="code" href="namespacePhysics_1_1Elasticity_1_1Kinematics.html#a15728437b942dab0b0042eb06a407d2c">d</a>; </div><div class="line">    } </div><div class="line"></div><div class="line"></div><div class="line">    <span class="keyword">template</span> &lt;<span class="keywordtype">int</span> dim&gt; </div><div class="line">    <span class="keyword">class </span>Velocity : <span class="keyword">public</span> MultiComponentFunction&lt;dim&gt; </div><div class="line">    { </div><div class="line">    <span class="keyword">public</span>: </div><div class="line">      Velocity(<span class="keyword">const</span> <span class="keywordtype">double</span> initial_time = 0.0); </div><div class="line"></div><div class="line">      <span class="keyword">virtual</span> <span class="keywordtype">double</span> value(<span class="keyword">const</span> <a class="code" href="classPoint.html">Point&lt;dim&gt;</a> &amp; p, </div><div class="line">                           <span class="keyword">const</span> <span class="keywordtype">unsigned</span> <span class="keywordtype">int</span> component = 0) <span class="keyword">const override</span>; </div><div class="line"></div><div class="line">      <span class="keyword">virtual</span> <span class="keywordtype">void</span> value_list(<span class="keyword">const</span> std::vector&lt;<a class="code" href="classPoint.html">Point&lt;dim&gt;</a>&gt; &amp;points, </div><div class="line">                              std::vector&lt;double&gt; &amp;          values, </div><div class="line">                              <span class="keyword">const</span> <span class="keywordtype">unsigned</span> <span class="keywordtype">int</span> component = 0) <span class="keyword">const override</span>; </div><div class="line">    }; </div><div class="line"></div><div class="line">    <span class="keyword">template</span> &lt;<span class="keywordtype">int</span> dim&gt; </div><div class="line">    Velocity&lt;dim&gt;::Velocity(<span class="keyword">const</span> <span class="keywordtype">double</span> initial_time) </div><div class="line">      : MultiComponentFunction&lt;dim&gt;(initial_time) </div><div class="line">    {} </div><div class="line"></div><div class="line">    <span class="keyword">template</span> &lt;<span class="keywordtype">int</span> dim&gt; </div><div class="line">    <span class="keywordtype">void</span> Velocity&lt;dim&gt;::value_list(<span class="keyword">const</span> std::vector&lt;<a class="code" href="classPoint.html">Point&lt;dim&gt;</a>&gt; &amp;points, </div><div class="line">                                   std::vector&lt;double&gt; &amp;          values, </div><div class="line">                                   <span class="keyword">const</span> <span class="keywordtype">unsigned</span> <span class="keywordtype">int</span>)<span class="keyword"> const </span></div><div class="line"><span class="keyword">    </span>{ </div><div class="line">      <span class="keyword">const</span> <span class="keywordtype">unsigned</span> <span class="keywordtype">int</span> n_points = points.size(); </div><div class="line">      <a class="code" href="group__Exceptions.html#ga70a0bb353656e704acf927945277bbc6">Assert</a>(values.size() == n_points, </div><div class="line">             <a class="code" href="group__Exceptions.html#ga6060b2304b8600f5efa0d31eeda0207d">ExcDimensionMismatch</a>(values.size(), n_points)); </div><div class="line">      <span class="keywordflow">for</span> (<span class="keywordtype">unsigned</span> <span class="keywordtype">int</span> i = 0; i &lt; n_points; ++i) </div><div class="line">        values[i] = Velocity&lt;dim&gt;::value(points[i]); </div><div class="line">    } </div><div class="line"></div><div class="line">    <span class="keyword">template</span> &lt;<span class="keywordtype">int</span> dim&gt; </div><div class="line">    <span class="keywordtype">double</span> Velocity&lt;dim&gt;::value(<span class="keyword">const</span> <a class="code" href="classPoint.html">Point&lt;dim&gt;</a> &amp;p, <span class="keyword">const</span> <span class="keywordtype">unsigned</span> <span class="keywordtype">int</span>)<span class="keyword"> const </span></div><div class="line"><span class="keyword">    </span>{ </div><div class="line">      <span class="keywordflow">if</span> (this-&gt;comp == 0) </div><div class="line">        { </div><div class="line">          <span class="keyword">const</span> <span class="keywordtype">double</span> Um = 1.5; </div><div class="line">          <span class="keyword">const</span> <span class="keywordtype">double</span> H  = 4.1; </div><div class="line">          <span class="keywordflow">return</span> 4. * Um * p(1) * (H - p(1)) / (H * H); </div><div class="line">        } </div><div class="line">      <span class="keywordflow">else</span> </div><div class="line">        <span class="keywordflow">return</span> 0.; </div><div class="line">    } </div><div class="line"></div><div class="line">    <span class="keyword">template</span> &lt;<span class="keywordtype">int</span> dim&gt; </div><div class="line">    <span class="keyword">class </span>Pressure : <span class="keyword">public</span> <a class="code" href="classFunction.html">Function</a>&lt;dim&gt; </div><div class="line">    { </div><div class="line">    <span class="keyword">public</span>: </div><div class="line">      Pressure(<span class="keyword">const</span> <span class="keywordtype">double</span> initial_time = 0.0); </div><div class="line"></div><div class="line">      <span class="keyword">virtual</span> <span class="keywordtype">double</span> value(<span class="keyword">const</span> <a class="code" href="classPoint.html">Point&lt;dim&gt;</a> &amp; p, </div><div class="line">                           <span class="keyword">const</span> <span class="keywordtype">unsigned</span> <span class="keywordtype">int</span> component = 0) <span class="keyword">const override</span>; </div><div class="line"></div><div class="line">      <span class="keyword">virtual</span> <span class="keywordtype">void</span> value_list(<span class="keyword">const</span> std::vector&lt;<a class="code" href="classPoint.html">Point&lt;dim&gt;</a>&gt; &amp;points, </div><div class="line">                              std::vector&lt;double&gt; &amp;          values, </div><div class="line">                              <span class="keyword">const</span> <span class="keywordtype">unsigned</span> <span class="keywordtype">int</span> component = 0) <span class="keyword">const override</span>; </div><div class="line">    }; </div><div class="line"></div><div class="line">    <span class="keyword">template</span> &lt;<span class="keywordtype">int</span> dim&gt; </div><div class="line">    Pressure&lt;dim&gt;::Pressure(<span class="keyword">const</span> <span class="keywordtype">double</span> initial_time) </div><div class="line">      : <a class="code" href="classFunction.html">Function</a>&lt;dim&gt;(1, initial_time) </div><div class="line">    {} </div><div class="line"></div><div class="line">    <span class="keyword">template</span> &lt;<span class="keywordtype">int</span> dim&gt; </div><div class="line">    <span class="keywordtype">double</span> Pressure&lt;dim&gt;::value(<span class="keyword">const</span> <a class="code" href="classPoint.html">Point&lt;dim&gt;</a> &amp; p, </div><div class="line">                                <span class="keyword">const</span> <span class="keywordtype">unsigned</span> <span class="keywordtype">int</span> component)<span class="keyword"> const </span></div><div class="line"><span class="keyword">    </span>{ </div><div class="line">      (void)component; </div><div class="line">      <a class="code" href="group__Exceptions.html#gaafbb69cc2a791ae55880fd8d57d0c1b0">AssertIndexRange</a>(component, 1); </div><div class="line">      <span class="keywordflow">return</span> 25. - p(0); </div><div class="line">    } </div><div class="line"></div><div class="line">    <span class="keyword">template</span> &lt;<span class="keywordtype">int</span> dim&gt; </div><div class="line">    <span class="keywordtype">void</span> Pressure&lt;dim&gt;::value_list(<span class="keyword">const</span> std::vector&lt;<a class="code" href="classPoint.html">Point&lt;dim&gt;</a>&gt; &amp;points, </div><div class="line">                                   std::vector&lt;double&gt; &amp;          values, </div><div class="line">                                   <span class="keyword">const</span> <span class="keywordtype">unsigned</span> <span class="keywordtype">int</span> component)<span class="keyword"> const </span></div><div class="line"><span class="keyword">    </span>{ </div><div class="line">      (void)component; </div><div class="line">      <a class="code" href="group__Exceptions.html#gaafbb69cc2a791ae55880fd8d57d0c1b0">AssertIndexRange</a>(component, 1); </div><div class="line">      <span class="keyword">const</span> <span class="keywordtype">unsigned</span> <span class="keywordtype">int</span> n_points = points.size(); </div><div class="line">      <a class="code" href="group__Exceptions.html#ga70a0bb353656e704acf927945277bbc6">Assert</a>(values.size() == n_points, </div><div class="line">             <a class="code" href="group__Exceptions.html#ga6060b2304b8600f5efa0d31eeda0207d">ExcDimensionMismatch</a>(values.size(), n_points)); </div><div class="line">      <span class="keywordflow">for</span> (<span class="keywordtype">unsigned</span> <span class="keywordtype">int</span> i = 0; i &lt; n_points; ++i) </div><div class="line">        values[i] = Pressure&lt;dim&gt;::value(points[i]); </div><div class="line">    } </div><div class="line">  } <span class="comment">// namespace EquationData </span></div><div class="line"></div><div class="line"></div><div class="line"></div><div class="line">  <span class="keyword">template</span> &lt;<span class="keywordtype">int</span> dim&gt; </div><div class="line">  <span class="keyword">class </span>NavierStokesProjection </div><div class="line">  { </div><div class="line">  <span class="keyword">public</span>: </div><div class="line">    NavierStokesProjection(<span class="keyword">const</span> RunTimeParameters::Data_Storage &amp;data); </div><div class="line"></div><div class="line">    <span class="keywordtype">void</span> <a class="code" href="namespaceWorkStream_1_1internal_1_1tbb__no__coloring.html#a8673698a405bf47aa24002aeb6d76d70">run</a>(<span class="keyword">const</span> <span class="keywordtype">bool</span> verbose = <span class="keyword">false</span>, <span class="keyword">const</span> <span class="keywordtype">unsigned</span> <span class="keywordtype">int</span> n_plots = 10); </div><div class="line"></div><div class="line">  <span class="keyword">protected</span>: </div><div class="line">    RunTimeParameters::Method type; </div><div class="line"></div><div class="line">    <span class="keyword">const</span> <span class="keywordtype">unsigned</span> <span class="keywordtype">int</span> deg; </div><div class="line">    <span class="keyword">const</span> <span class="keywordtype">double</span>       dt; </div><div class="line">    <span class="keyword">const</span> <span class="keywordtype">double</span>       t_0; </div><div class="line">    <span class="keyword">const</span> <span class="keywordtype">double</span>       <a class="code" href="namespaceLAPACKSupport.html#a8cac1e477eff052db622c8a9a9426ea3">T</a>; </div><div class="line">    <span class="keyword">const</span> <span class="keywordtype">double</span>       Re; </div><div class="line"></div><div class="line">    EquationData::Velocity&lt;dim&gt;               vel_exact; </div><div class="line">    std::map&lt;types::global_dof_index, double&gt; boundary_values; </div><div class="line">    std::vector&lt;types::boundary_id&gt;           boundary_ids; </div><div class="line"></div><div class="line">    <a class="code" href="classTriangulation.html">Triangulation&lt;dim&gt;</a> <a class="code" href="p4est__wrappers_8cc.html#ace00f2f80d9780ef9aa1007e1c22c6a4">triangulation</a>; </div><div class="line"></div><div class="line">    <a class="code" href="classFE__Q.html">FE_Q&lt;dim&gt;</a> fe_velocity; </div><div class="line">    <a class="code" href="classFE__Q.html">FE_Q&lt;dim&gt;</a> fe_pressure; </div><div class="line"></div><div class="line">    <a class="code" href="classDoFHandler.html">DoFHandler&lt;dim&gt;</a> dof_handler_velocity; </div><div class="line">    <a class="code" href="classDoFHandler.html">DoFHandler&lt;dim&gt;</a> dof_handler_pressure; </div><div class="line"></div><div class="line">    <a class="code" href="classQGauss.html">QGauss&lt;dim&gt;</a> quadrature_pressure; </div><div class="line">    <a class="code" href="classQGauss.html">QGauss&lt;dim&gt;</a> quadrature_velocity; </div><div class="line"></div><div class="line">    <a class="code" href="classSparsityPattern.html">SparsityPattern</a> sparsity_pattern_velocity; </div><div class="line">    <a class="code" href="classSparsityPattern.html">SparsityPattern</a> sparsity_pattern_pressure; </div><div class="line">    <a class="code" href="classSparsityPattern.html">SparsityPattern</a> sparsity_pattern_pres_vel; </div><div class="line"></div><div class="line">    <a class="code" href="classSparseMatrix.html">SparseMatrix&lt;double&gt;</a> vel_Laplace_plus_Mass; </div><div class="line">    <a class="code" href="classSparseMatrix.html">SparseMatrix&lt;double&gt;</a> vel_it_matrix[dim]; </div><div class="line">    <a class="code" href="classSparseMatrix.html">SparseMatrix&lt;double&gt;</a> vel_Mass; </div><div class="line">    <a class="code" href="classSparseMatrix.html">SparseMatrix&lt;double&gt;</a> vel_Laplace; </div><div class="line">    <a class="code" href="classSparseMatrix.html">SparseMatrix&lt;double&gt;</a> vel_Advection; </div><div class="line">    <a class="code" href="classSparseMatrix.html">SparseMatrix&lt;double&gt;</a> pres_Laplace; </div><div class="line">    <a class="code" href="classSparseMatrix.html">SparseMatrix&lt;double&gt;</a> pres_Mass; </div><div class="line">    <a class="code" href="classSparseMatrix.html">SparseMatrix&lt;double&gt;</a> pres_Diff[dim]; </div><div class="line">    <a class="code" href="classSparseMatrix.html">SparseMatrix&lt;double&gt;</a> pres_iterative; </div><div class="line"></div><div class="line">    Vector&lt;double&gt; pres_n; </div><div class="line">    Vector&lt;double&gt; pres_n_minus_1; </div><div class="line">    Vector&lt;double&gt; phi_n; </div><div class="line">    Vector&lt;double&gt; phi_n_minus_1; </div><div class="line">    Vector&lt;double&gt; u_n[dim]; </div><div class="line">    Vector&lt;double&gt; u_n_minus_1[dim]; </div><div class="line">    Vector&lt;double&gt; u_star[dim]; </div><div class="line">    Vector&lt;double&gt; force[dim]; </div><div class="line">    Vector&lt;double&gt; v_tmp; </div><div class="line">    Vector&lt;double&gt; pres_tmp; </div><div class="line">    Vector&lt;double&gt; rot_u; </div><div class="line"></div><div class="line">    <a class="code" href="classSparseILU.html">SparseILU&lt;double&gt;</a>   prec_velocity[dim]; </div><div class="line">    <a class="code" href="classSparseILU.html">SparseILU&lt;double&gt;</a>   prec_pres_Laplace; </div><div class="line">    <a class="code" href="classSparseDirectUMFPACK.html">SparseDirectUMFPACK</a> prec_mass; </div><div class="line">    <a class="code" href="classSparseDirectUMFPACK.html">SparseDirectUMFPACK</a> prec_vel_mass; </div><div class="line"></div><div class="line">    <a class="code" href="group__Exceptions.html#ga90900994a811a22ca7c7a1a8872f8fae">DeclException2</a>(ExcInvalidTimeStep, </div><div class="line">                   <span class="keywordtype">double</span>, </div><div class="line">                   <span class="keywordtype">double</span>, </div><div class="line">                   &lt;&lt; <span class="stringliteral">&quot; The time step &quot;</span> &lt;&lt; arg1 &lt;&lt; <span class="stringliteral">&quot; is out of range.&quot;</span> </div><div class="line">                   &lt;&lt; std::endl </div><div class="line">                   &lt;&lt; <span class="stringliteral">&quot; The permitted range is (0,&quot;</span> &lt;&lt; arg2 &lt;&lt; <span class="stringliteral">&quot;]&quot;</span>); </div><div class="line"></div><div class="line">    <span class="keywordtype">void</span> create_triangulation_and_dofs(<span class="keyword">const</span> <span class="keywordtype">unsigned</span> <span class="keywordtype">int</span> n_refines); </div><div class="line"></div><div class="line">    <span class="keywordtype">void</span> initialize(); </div><div class="line"></div><div class="line">    <span class="keywordtype">void</span> interpolate_velocity(); </div><div class="line"></div><div class="line">    <span class="keywordtype">void</span> diffusion_step(<span class="keyword">const</span> <span class="keywordtype">bool</span> reinit_prec); </div><div class="line"></div><div class="line">    <span class="keywordtype">void</span> projection_step(<span class="keyword">const</span> <span class="keywordtype">bool</span> reinit_prec); </div><div class="line"></div><div class="line">    <span class="keywordtype">void</span> update_pressure(<span class="keyword">const</span> <span class="keywordtype">bool</span> reinit_prec); </div><div class="line"></div><div class="line">  <span class="keyword">private</span>: </div><div class="line">    <span class="keywordtype">unsigned</span> <span class="keywordtype">int</span> vel_max_its; </div><div class="line">    <span class="keywordtype">unsigned</span> <span class="keywordtype">int</span> vel_Krylov_size; </div><div class="line">    <span class="keywordtype">unsigned</span> <span class="keywordtype">int</span> vel_off_diagonals; </div><div class="line">    <span class="keywordtype">unsigned</span> <span class="keywordtype">int</span> vel_update_prec; </div><div class="line">    <span class="keywordtype">double</span>       vel_eps; </div><div class="line">    <span class="keywordtype">double</span>       vel_diag_strength; </div><div class="line"></div><div class="line">    <span class="keywordtype">void</span> initialize_velocity_matrices(); </div><div class="line"></div><div class="line">    <span class="keywordtype">void</span> initialize_pressure_matrices(); </div><div class="line"></div><div class="line"></div><div class="line"></div><div class="line"></div><div class="line">    <span class="keyword">using</span> IteratorTuple = </div><div class="line">      std::tuple&lt;typename DoFHandler&lt;dim&gt;::active_cell_iterator, </div><div class="line">                 <span class="keyword">typename</span> <a class="code" href="classDoFHandler.html">DoFHandler&lt;dim&gt;::active_cell_iterator</a>&gt;; </div><div class="line"></div><div class="line">    <span class="keyword">using</span> IteratorPair = <a class="code" href="structSynchronousIterators.html">SynchronousIterators&lt;IteratorTuple&gt;</a>; </div><div class="line"></div><div class="line">    <span class="keywordtype">void</span> initialize_gradient_operator(); </div><div class="line"></div><div class="line">    <span class="keyword">struct </span>InitGradPerTaskData </div><div class="line">    { </div><div class="line">      <span class="keywordtype">unsigned</span> <span class="keywordtype">int</span>                         <a class="code" href="namespacePhysics_1_1Elasticity_1_1Kinematics.html#a15728437b942dab0b0042eb06a407d2c">d</a>; </div><div class="line">      <span class="keywordtype">unsigned</span> <span class="keywordtype">int</span>                         vel_dpc; </div><div class="line">      <span class="keywordtype">unsigned</span> <span class="keywordtype">int</span>                         pres_dpc; </div><div class="line">      <a class="code" href="classFullMatrix.html">FullMatrix&lt;double&gt;</a>                   local_grad; </div><div class="line">      std::vector&lt;types::global_dof_index&gt; vel_local_dof_indices; </div><div class="line">      std::vector&lt;types::global_dof_index&gt; pres_local_dof_indices; </div><div class="line"></div><div class="line">      InitGradPerTaskData(<span class="keyword">const</span> <span class="keywordtype">unsigned</span> <span class="keywordtype">int</span> dd, </div><div class="line">                          <span class="keyword">const</span> <span class="keywordtype">unsigned</span> <span class="keywordtype">int</span> vdpc, </div><div class="line">                          <span class="keyword">const</span> <span class="keywordtype">unsigned</span> <span class="keywordtype">int</span> pdpc) </div><div class="line">        : d(dd) </div><div class="line">        , vel_dpc(vdpc) </div><div class="line">        , pres_dpc(pdpc) </div><div class="line">        , local_grad(vdpc, pdpc) </div><div class="line">        , vel_local_dof_indices(vdpc) </div><div class="line">        , pres_local_dof_indices(pdpc) </div><div class="line">      {} </div><div class="line">    }; </div><div class="line"></div><div class="line">    <span class="keyword">struct </span>InitGradScratchData </div><div class="line">    { </div><div class="line">      <span class="keywordtype">unsigned</span> <span class="keywordtype">int</span>  nqp; </div><div class="line">      <a class="code" href="classFEValues.html">FEValues&lt;dim&gt;</a> fe_val_vel; </div><div class="line">      <a class="code" href="classFEValues.html">FEValues&lt;dim&gt;</a> fe_val_pres; </div><div class="line">      InitGradScratchData(<span class="keyword">const</span> <a class="code" href="classFE__Q.html">FE_Q&lt;dim&gt;</a> &amp;  fe_v, </div><div class="line">                          <span class="keyword">const</span> <a class="code" href="classFE__Q.html">FE_Q&lt;dim&gt;</a> &amp;  fe_p, </div><div class="line">                          <span class="keyword">const</span> <a class="code" href="classQGauss.html">QGauss&lt;dim&gt;</a> &amp;quad, </div><div class="line">                          <span class="keyword">const</span> <a class="code" href="group__feaccess.html#gaa94b67d2fdcc390690c523f28019e52f">UpdateFlags</a>  flags_v, </div><div class="line">                          <span class="keyword">const</span> <a class="code" href="group__feaccess.html#gaa94b67d2fdcc390690c523f28019e52f">UpdateFlags</a>  flags_p) </div><div class="line">        : nqp(quad.size()) </div><div class="line">        , fe_val_vel(fe_v, quad, flags_v) </div><div class="line">        , fe_val_pres(fe_p, quad, flags_p) </div><div class="line">      {} </div><div class="line">      InitGradScratchData(<span class="keyword">const</span> InitGradScratchData &amp;data) </div><div class="line">        : nqp(data.nqp) </div><div class="line">        , fe_val_vel(data.fe_val_vel.get_fe(), </div><div class="line">                     data.fe_val_vel.get_quadrature(), </div><div class="line">                     data.fe_val_vel.get_update_flags()) </div><div class="line">        , fe_val_pres(data.fe_val_pres.get_fe(), </div><div class="line">                      data.fe_val_pres.get_quadrature(), </div><div class="line">                      data.fe_val_pres.get_update_flags()) </div><div class="line">      {} </div><div class="line">    }; </div><div class="line"></div><div class="line">    <span class="keywordtype">void</span> assemble_one_cell_of_gradient(<span class="keyword">const</span> IteratorPair &amp; SI, </div><div class="line">                                       InitGradScratchData &amp;scratch, </div><div class="line">                                       InitGradPerTaskData &amp;data); </div><div class="line"></div><div class="line">    <span class="keywordtype">void</span> copy_gradient_local_to_global(<span class="keyword">const</span> InitGradPerTaskData &amp;data); </div><div class="line"></div><div class="line"></div><div class="line">    <span class="keywordtype">void</span> assemble_advection_term(); </div><div class="line"></div><div class="line">    <span class="keyword">struct </span>AdvectionPerTaskData </div><div class="line">    { </div><div class="line">      <a class="code" href="classFullMatrix.html">FullMatrix&lt;double&gt;</a>                   local_advection; </div><div class="line">      std::vector&lt;types::global_dof_index&gt; local_dof_indices; </div><div class="line">      AdvectionPerTaskData(<span class="keyword">const</span> <span class="keywordtype">unsigned</span> <span class="keywordtype">int</span> dpc) </div><div class="line">        : local_advection(dpc, dpc) </div><div class="line">        , local_dof_indices(dpc) </div><div class="line">      {} </div><div class="line">    }; </div><div class="line"></div><div class="line">    <span class="keyword">struct </span>AdvectionScratchData </div><div class="line">    { </div><div class="line">      <span class="keywordtype">unsigned</span> <span class="keywordtype">int</span>                nqp; </div><div class="line">      <span class="keywordtype">unsigned</span> <span class="keywordtype">int</span>                dpc; </div><div class="line">      std::vector&lt;Point&lt;dim&gt;&gt;     u_star_local; </div><div class="line">      std::vector&lt;Tensor&lt;1, dim&gt;&gt; grad_u_star; </div><div class="line">      std::vector&lt;double&gt;         u_star_tmp; </div><div class="line">      <a class="code" href="classFEValues.html">FEValues&lt;dim&gt;</a>               fe_val; </div><div class="line">      AdvectionScratchData(<span class="keyword">const</span> <a class="code" href="classFE__Q.html">FE_Q&lt;dim&gt;</a> &amp;  fe, </div><div class="line">                           <span class="keyword">const</span> <a class="code" href="classQGauss.html">QGauss&lt;dim&gt;</a> &amp;quad, </div><div class="line">                           <span class="keyword">const</span> <a class="code" href="group__feaccess.html#gaa94b67d2fdcc390690c523f28019e52f">UpdateFlags</a>  flags) </div><div class="line">        : nqp(quad.size()) </div><div class="line">        , dpc(fe.n_dofs_per_cell()) </div><div class="line">        , u_star_local(nqp) </div><div class="line">        , grad_u_star(nqp) </div><div class="line">        , u_star_tmp(nqp) </div><div class="line">        , fe_val(fe, quad, flags) </div><div class="line">      {} </div><div class="line"></div><div class="line">      AdvectionScratchData(<span class="keyword">const</span> AdvectionScratchData &amp;data) </div><div class="line">        : nqp(data.nqp) </div><div class="line">        , dpc(data.dpc) </div><div class="line">        , u_star_local(nqp) </div><div class="line">        , grad_u_star(nqp) </div><div class="line">        , u_star_tmp(nqp) </div><div class="line">        , fe_val(data.fe_val.get_fe(), </div><div class="line">                 data.fe_val.get_quadrature(), </div><div class="line">                 data.fe_val.get_update_flags()) </div><div class="line">      {} </div><div class="line">    }; </div><div class="line"></div><div class="line">    <span class="keywordtype">void</span> assemble_one_cell_of_advection( </div><div class="line">      <span class="keyword">const</span> <span class="keyword">typename</span> DoFHandler&lt;dim&gt;::active_cell_iterator &amp;cell, </div><div class="line">      AdvectionScratchData &amp;                                scratch, </div><div class="line">      AdvectionPerTaskData &amp;                                data); </div><div class="line"></div><div class="line">    <span class="keywordtype">void</span> copy_advection_local_to_global(<span class="keyword">const</span> AdvectionPerTaskData &amp;data); </div><div class="line"></div><div class="line"></div><div class="line">    <span class="keywordtype">void</span> diffusion_component_solve(<span class="keyword">const</span> <span class="keywordtype">unsigned</span> <span class="keywordtype">int</span> d); </div><div class="line"></div><div class="line">    <span class="keywordtype">void</span> output_results(<span class="keyword">const</span> <span class="keywordtype">unsigned</span> <span class="keywordtype">int</span> step); </div><div class="line"></div><div class="line">    <span class="keywordtype">void</span> assemble_vorticity(<span class="keyword">const</span> <span class="keywordtype">bool</span> reinit_prec); </div><div class="line">  }; </div><div class="line"></div><div class="line"></div><div class="line"></div><div class="line">  <span class="keyword">template</span> &lt;<span class="keywordtype">int</span> dim&gt; </div><div class="line">  NavierStokesProjection&lt;dim&gt;::NavierStokesProjection( </div><div class="line">    <span class="keyword">const</span> RunTimeParameters::Data_Storage &amp;data) </div><div class="line">    : type(data.form) </div><div class="line">    , deg(data.pressure_degree) </div><div class="line">    , dt(data.dt) </div><div class="line">    , t_0(data.initial_time) </div><div class="line">    , T(data.final_time) </div><div class="line">    , Re(data.Reynolds) </div><div class="line">    , vel_exact(data.initial_time) </div><div class="line">    , fe_velocity(deg + 1) </div><div class="line">    , fe_pressure(deg) </div><div class="line">    , dof_handler_velocity(triangulation) </div><div class="line">    , dof_handler_pressure(triangulation) </div><div class="line">    , quadrature_pressure(deg + 1) </div><div class="line">    , quadrature_velocity(deg + 2) </div><div class="line">    , vel_max_its(data.vel_max_iterations) </div><div class="line">    , vel_Krylov_size(data.vel_Krylov_size) </div><div class="line">    , vel_off_diagonals(data.vel_off_diagonals) </div><div class="line">    , vel_update_prec(data.vel_update_prec) </div><div class="line">    , vel_eps(data.vel_eps) </div><div class="line">    , vel_diag_strength(data.vel_diag_strength) </div><div class="line">  { </div><div class="line">    <span class="keywordflow">if</span> (deg &lt; 1) </div><div class="line">      std::cout </div><div class="line">        &lt;&lt; <span class="stringliteral">&quot; WARNING: The chosen pair of finite element spaces is not stable.&quot;</span> </div><div class="line">        &lt;&lt; std::endl </div><div class="line">        &lt;&lt; <span class="stringliteral">&quot; The obtained results will be nonsense&quot;</span> &lt;&lt; std::endl; </div><div class="line"></div><div class="line">    <a class="code" href="group__Exceptions.html#gafc0ca7ad85b3ebd64e8e51689ac85caf">AssertThrow</a>(!((dt &lt;= 0.) || (dt &gt; .5 * T)), ExcInvalidTimeStep(dt, .5 * T)); </div><div class="line"></div><div class="line">    create_triangulation_and_dofs(data.n_global_refines); </div><div class="line">    initialize(); </div><div class="line">  } </div><div class="line"></div><div class="line"></div><div class="line">  <span class="keyword">template</span> &lt;<span class="keywordtype">int</span> dim&gt; </div><div class="line">  <span class="keywordtype">void</span> NavierStokesProjection&lt;dim&gt;::create_triangulation_and_dofs( </div><div class="line">    <span class="keyword">const</span> <span class="keywordtype">unsigned</span> <span class="keywordtype">int</span> n_refines) </div><div class="line">  { </div><div class="line">    <a class="code" href="classGridIn.html">GridIn&lt;dim&gt;</a> grid_in; </div><div class="line">    grid_in.<a class="code" href="classGridIn.html#a82ac1c03b0efe87204ad45d2f1d87f7e">attach_triangulation</a>(triangulation); </div><div class="line"></div><div class="line">    { </div><div class="line">      std::string   filename = <span class="stringliteral">&quot;nsbench2.inp&quot;</span>; </div><div class="line">      std::ifstream file(filename); </div><div class="line">      <a class="code" href="group__Exceptions.html#ga70a0bb353656e704acf927945277bbc6">Assert</a>(file, <a class="code" href="group__Exceptions.html#ga4c22c86ff89575667de2ca9778aa28e5">ExcFileNotOpen</a>(filename.c_str())); </div><div class="line">      grid_in.<a class="code" href="classGridIn.html#abbb16aa0aa53bfa9231b69278d397616">read_ucd</a>(file); </div><div class="line">    } </div><div class="line"></div><div class="line">    std::cout &lt;&lt; <span class="stringliteral">&quot;Number of refines = &quot;</span> &lt;&lt; n_refines &lt;&lt; std::endl; </div><div class="line">    triangulation.<a class="code" href="classTriangulation.html#a6ad0b3fb24aae17f4668427a433dea19">refine_global</a>(n_refines); </div><div class="line">    std::cout &lt;&lt; <span class="stringliteral">&quot;Number of active cells: &quot;</span> &lt;&lt; triangulation.<a class="code" href="classTriangulation.html#a5ea5c9957dbb566a562bbe2c0f3971e9">n_active_cells</a>() </div><div class="line">              &lt;&lt; std::endl; </div><div class="line"></div><div class="line">    boundary_ids = triangulation.<a class="code" href="classTriangulation.html#a63a0d3cc6653496e5bebf32220ac4160">get_boundary_ids</a>(); </div><div class="line"></div><div class="line"> </div><div class="line">    <a class="code" href="namespaceDoFRenumbering_1_1boost.html#a408e819ea167bc557d5789ffe9b3f521">DoFRenumbering::boost::Cuthill_McKee</a>(dof_handler_velocity); </div><div class="line">    dof_handler_pressure.distribute_dofs(fe_pressure); </div><div class="line">    <a class="code" href="namespaceDoFRenumbering_1_1boost.html#a408e819ea167bc557d5789ffe9b3f521">DoFRenumbering::boost::Cuthill_McKee</a>(dof_handler_pressure); </div><div class="line"></div><div class="line">    initialize_velocity_matrices(); </div><div class="line">    initialize_pressure_matrices(); </div><div class="line">    initialize_gradient_operator(); </div><div class="line"></div><div class="line">    pres_n.reinit(dof_handler_pressure.n_dofs()); </div><div class="line">    pres_n_minus_1.reinit(dof_handler_pressure.n_dofs()); </div><div class="line">    phi_n.reinit(dof_handler_pressure.n_dofs()); </div><div class="line">    phi_n_minus_1.reinit(dof_handler_pressure.n_dofs()); </div><div class="line">    pres_tmp.reinit(dof_handler_pressure.n_dofs()); </div><div class="line">    <span class="keywordflow">for</span> (<span class="keywordtype">unsigned</span> <span class="keywordtype">int</span> d = 0; d &lt; dim; ++<a class="code" href="namespacePhysics_1_1Elasticity_1_1Kinematics.html#a15728437b942dab0b0042eb06a407d2c">d</a>) </div><div class="line">      { </div><div class="line">        u_n[<a class="code" href="namespacePhysics_1_1Elasticity_1_1Kinematics.html#a15728437b942dab0b0042eb06a407d2c">d</a>].reinit(dof_handler_velocity.n_dofs()); </div><div class="line">        u_n_minus_1[<a class="code" href="namespacePhysics_1_1Elasticity_1_1Kinematics.html#a15728437b942dab0b0042eb06a407d2c">d</a>].reinit(dof_handler_velocity.n_dofs()); </div><div class="line">        u_star[<a class="code" href="namespacePhysics_1_1Elasticity_1_1Kinematics.html#a15728437b942dab0b0042eb06a407d2c">d</a>].reinit(dof_handler_velocity.n_dofs()); </div><div class="line">        force[<a class="code" href="namespacePhysics_1_1Elasticity_1_1Kinematics.html#a15728437b942dab0b0042eb06a407d2c">d</a>].reinit(dof_handler_velocity.n_dofs()); </div><div class="line">      } </div><div class="line">    v_tmp.reinit(dof_handler_velocity.n_dofs()); </div><div class="line">    rot_u.reinit(dof_handler_velocity.n_dofs()); </div><div class="line"></div><div class="line">    std::cout &lt;&lt; <span class="stringliteral">&quot;dim (X_h) = &quot;</span> &lt;&lt; (dof_handler_velocity.n_dofs() * dim) <span class="comment">// </span></div><div class="line">              &lt;&lt; std::endl                                               <span class="comment">// </span></div><div class="line">              &lt;&lt; <span class="stringliteral">&quot;dim (M_h) = &quot;</span> &lt;&lt; dof_handler_pressure.n_dofs()         <span class="comment">// </span></div><div class="line">              &lt;&lt; std::endl                                               <span class="comment">// </span></div><div class="line">              &lt;&lt; <span class="stringliteral">&quot;Re        = &quot;</span> &lt;&lt; Re &lt;&lt; std::endl                       <span class="comment">// </span></div><div class="line">              &lt;&lt; std::endl; </div><div class="line">  } </div><div class="line"></div><div class="line"></div><div class="line">  <span class="keyword">template</span> &lt;<span class="keywordtype">int</span> dim&gt; </div><div class="line">  <span class="keywordtype">void</span> NavierStokesProjection&lt;dim&gt;::initialize() </div><div class="line">  { </div><div class="line">    vel_Laplace_plus_Mass = 0.; </div><div class="line">    vel_Laplace_plus_Mass.add(1. / Re, vel_Laplace); </div><div class="line">    vel_Laplace_plus_Mass.add(1.5 / dt, vel_Mass); </div><div class="line"></div><div class="line">    EquationData::Pressure&lt;dim&gt; pres(t_0); </div><div class="line">    <a class="code" href="namespaceVectorTools.html#a761f008bdeb7d94a69205ae824deefad">VectorTools::interpolate</a>(dof_handler_pressure, pres, pres_n_minus_1); </div><div class="line">    pres.advance_time(dt); </div><div class="line">    <a class="code" href="namespaceVectorTools.html#a761f008bdeb7d94a69205ae824deefad">VectorTools::interpolate</a>(dof_handler_pressure, pres, pres_n); </div><div class="line">    phi_n         = 0.; </div><div class="line">    phi_n_minus_1 = 0.; </div><div class="line">    <span class="keywordflow">for</span> (<span class="keywordtype">unsigned</span> <span class="keywordtype">int</span> d = 0; d &lt; dim; ++<a class="code" href="namespacePhysics_1_1Elasticity_1_1Kinematics.html#a15728437b942dab0b0042eb06a407d2c">d</a>) </div><div class="line">      { </div><div class="line">        vel_exact.set_time(t_0); </div><div class="line">        vel_exact.set_component(d); </div><div class="line">        <a class="code" href="namespaceVectorTools.html#a761f008bdeb7d94a69205ae824deefad">VectorTools::interpolate</a>(dof_handler_velocity, </div><div class="line">                                 vel_exact, </div><div class="line">                                 u_n_minus_1[d]); </div><div class="line">        vel_exact.advance_time(dt); </div><div class="line">        <a class="code" href="namespaceVectorTools.html#a761f008bdeb7d94a69205ae824deefad">VectorTools::interpolate</a>(dof_handler_velocity, vel_exact, u_n[d]); </div><div class="line">      } </div><div class="line">  } </div><div class="line"></div><div class="line"></div><div class="line">  <span class="keyword">template</span> &lt;<span class="keywordtype">int</span> dim&gt; </div><div class="line">  <span class="keywordtype">void</span> NavierStokesProjection&lt;dim&gt;::initialize_velocity_matrices() </div><div class="line">  { </div><div class="line">    { </div><div class="line">      <a class="code" href="classDynamicSparsityPattern.html">DynamicSparsityPattern</a> dsp(dof_handler_velocity.n_dofs(), </div><div class="line">                                 dof_handler_velocity.n_dofs()); </div><div class="line">      <a class="code" href="group__constraints.html#gaf78e864edbfba7e0a7477457bfb96b26">DoFTools::make_sparsity_pattern</a>(dof_handler_velocity, dsp); </div><div class="line">      sparsity_pattern_velocity.copy_from(dsp); </div><div class="line">    } </div><div class="line">    vel_Laplace_plus_Mass.reinit(sparsity_pattern_velocity); </div><div class="line">    <span class="keywordflow">for</span> (<span class="keywordtype">unsigned</span> <span class="keywordtype">int</span> d = 0; d &lt; dim; ++<a class="code" href="namespacePhysics_1_1Elasticity_1_1Kinematics.html#a15728437b942dab0b0042eb06a407d2c">d</a>) </div><div class="line">      vel_it_matrix[d].<a class="code" href="namespaceinternal.html#a38181f4582ff69679bda7d8e31c37291">reinit</a>(sparsity_pattern_velocity); </div><div class="line">    vel_Mass.reinit(sparsity_pattern_velocity); </div><div class="line">    vel_Laplace.reinit(sparsity_pattern_velocity); </div><div class="line">    vel_Advection.reinit(sparsity_pattern_velocity); </div><div class="line"></div><div class="line">    <a class="code" href="namespaceMatrixCreator.html#aab6397f114af66efd781f7f4daba22be">MatrixCreator::create_mass_matrix</a>(dof_handler_velocity, </div><div class="line">                                      quadrature_velocity, </div><div class="line">                                      vel_Mass); </div><div class="line">    <a class="code" href="namespaceMatrixCreator.html#a7b8157122064151d414dc34a22a3ca9c">MatrixCreator::create_laplace_matrix</a>(dof_handler_velocity, </div><div class="line">                                         quadrature_velocity, </div><div class="line">                                         vel_Laplace); </div><div class="line">  } </div><div class="line"></div><div class="line"></div><div class="line">  <span class="keyword">template</span> &lt;<span class="keywordtype">int</span> dim&gt; </div><div class="line">  <span class="keywordtype">void</span> NavierStokesProjection&lt;dim&gt;::initialize_pressure_matrices() </div><div class="line">  { </div><div class="line">    { </div><div class="line">      <a class="code" href="classDynamicSparsityPattern.html">DynamicSparsityPattern</a> dsp(dof_handler_pressure.n_dofs(), </div><div class="line">                                 dof_handler_pressure.n_dofs()); </div><div class="line">      <a class="code" href="group__constraints.html#gaf78e864edbfba7e0a7477457bfb96b26">DoFTools::make_sparsity_pattern</a>(dof_handler_pressure, dsp); </div><div class="line">      sparsity_pattern_pressure.copy_from(dsp); </div><div class="line">    } </div><div class="line"></div><div class="line">    pres_Laplace.reinit(sparsity_pattern_pressure); </div><div class="line">    pres_iterative.reinit(sparsity_pattern_pressure); </div><div class="line">    pres_Mass.reinit(sparsity_pattern_pressure); </div><div class="line"></div><div class="line">    <a class="code" href="namespaceMatrixCreator.html#a7b8157122064151d414dc34a22a3ca9c">MatrixCreator::create_laplace_matrix</a>(dof_handler_pressure, </div><div class="line">                                         quadrature_pressure, </div><div class="line">                                         pres_Laplace); </div><div class="line">    <a class="code" href="namespaceMatrixCreator.html#aab6397f114af66efd781f7f4daba22be">MatrixCreator::create_mass_matrix</a>(dof_handler_pressure, </div><div class="line">                                      quadrature_pressure, </div><div class="line">                                      pres_Mass); </div><div class="line">  } </div><div class="line"></div><div class="line"></div><div class="line">  <span class="keyword">template</span> &lt;<span class="keywordtype">int</span> dim&gt; </div><div class="line">  <span class="keywordtype">void</span> NavierStokesProjection&lt;dim&gt;::initialize_gradient_operator() </div><div class="line">  { </div><div class="line">    { </div><div class="line">      <a class="code" href="classDynamicSparsityPattern.html">DynamicSparsityPattern</a> dsp(dof_handler_velocity.n_dofs(), </div><div class="line">                                 dof_handler_pressure.n_dofs()); </div><div class="line">      <a class="code" href="group__constraints.html#gaf78e864edbfba7e0a7477457bfb96b26">DoFTools::make_sparsity_pattern</a>(dof_handler_velocity, </div><div class="line">                                      dof_handler_pressure, </div><div class="line">                                      dsp); </div><div class="line">      sparsity_pattern_pres_vel.copy_from(dsp); </div><div class="line">    } </div><div class="line"></div><div class="line">    InitGradPerTaskData per_task_data(0, </div><div class="line">                                      fe_velocity.n_dofs_per_cell(), </div><div class="line">                                      fe_pressure.n_dofs_per_cell()); </div><div class="line">    InitGradScratchData scratch_data(fe_velocity, </div><div class="line">                                     fe_pressure, </div><div class="line">                                     quadrature_velocity, </div><div class="line">                                     <a class="code" href="group__feaccess.html#ggaa94b67d2fdcc390690c523f28019e52facbcc430975fa6af05f75ca786dc6fe20">update_gradients</a> | <a class="code" href="group__feaccess.html#ggaa94b67d2fdcc390690c523f28019e52fa714204722e9eeb43aadbd0d5ddc48c85">update_JxW_values</a>, </div><div class="line">                                     <a class="code" href="group__feaccess.html#ggaa94b67d2fdcc390690c523f28019e52fa4057ca2f127aa619c65886a9d3ad4aea">update_values</a>); </div><div class="line"></div><div class="line">    <span class="keywordflow">for</span> (<span class="keywordtype">unsigned</span> <span class="keywordtype">int</span> d = 0; d &lt; dim; ++<a class="code" href="namespacePhysics_1_1Elasticity_1_1Kinematics.html#a15728437b942dab0b0042eb06a407d2c">d</a>) </div><div class="line">      { </div><div class="line">        pres_Diff[<a class="code" href="namespacePhysics_1_1Elasticity_1_1Kinematics.html#a15728437b942dab0b0042eb06a407d2c">d</a>].reinit(sparsity_pattern_pres_vel); </div><div class="line">        per_task_data.d = <a class="code" href="namespacePhysics_1_1Elasticity_1_1Kinematics.html#a15728437b942dab0b0042eb06a407d2c">d</a>; </div><div class="line">        <a class="code" href="namespaceWorkStream.html#ab8ceb010811941c351803b671a19fb73">WorkStream::run</a>( </div><div class="line">          IteratorPair(IteratorTuple(dof_handler_velocity.begin_active(), </div><div class="line">                                     dof_handler_pressure.begin_active())), </div><div class="line">          IteratorPair(IteratorTuple(dof_handler_velocity.end(), </div><div class="line">                                     dof_handler_pressure.end())), </div><div class="line">          *<span class="keyword">this</span>, </div><div class="line">          &amp;NavierStokesProjection&lt;dim&gt;::assemble_one_cell_of_gradient, </div><div class="line">          &amp;NavierStokesProjection&lt;dim&gt;::copy_gradient_local_to_global, </div><div class="line">          scratch_data, </div><div class="line">          per_task_data); </div><div class="line">      } </div><div class="line">  } </div><div class="line"></div><div class="line">  <span class="keyword">template</span> &lt;<span class="keywordtype">int</span> dim&gt; </div><div class="line">  <span class="keywordtype">void</span> NavierStokesProjection&lt;dim&gt;::assemble_one_cell_of_gradient( </div><div class="line">    <span class="keyword">const</span> IteratorPair &amp; SI, </div><div class="line">    InitGradScratchData &amp;scratch, </div><div class="line">    InitGradPerTaskData &amp;data) </div><div class="line">  { </div><div class="line">    scratch.fe_val_vel.reinit(std::get&lt;0&gt;(*SI)); </div><div class="line">    scratch.fe_val_pres.reinit(std::get&lt;1&gt;(*SI)); </div><div class="line"></div><div class="line">    std::get&lt;0&gt;(*SI)-&gt;get_dof_indices(data.vel_local_dof_indices); </div><div class="line">    std::get&lt;1&gt;(*SI)-&gt;get_dof_indices(data.pres_local_dof_indices); </div><div class="line"></div><div class="line">    data.local_grad = 0.; </div><div class="line">    <span class="keywordflow">for</span> (<span class="keywordtype">unsigned</span> <span class="keywordtype">int</span> q = 0; q &lt; scratch.nqp; ++q) </div><div class="line">      { </div><div class="line">        <span class="keywordflow">for</span> (<span class="keywordtype">unsigned</span> <span class="keywordtype">int</span> i = 0; i &lt; data.vel_dpc; ++i) </div><div class="line">          <span class="keywordflow">for</span> (<span class="keywordtype">unsigned</span> <span class="keywordtype">int</span> j = 0; j &lt; data.pres_dpc; ++j) </div><div class="line">            data.local_grad(i, j) += </div><div class="line">              -scratch.fe_val_vel.JxW(q) * </div><div class="line">              scratch.fe_val_vel.shape_grad(i, q)[data.d] * </div><div class="line">              scratch.fe_val_pres.shape_value(j, q); </div><div class="line">      } </div><div class="line">  } </div><div class="line"></div><div class="line">  <span class="keyword">template</span> &lt;<span class="keywordtype">int</span> dim&gt; </div><div class="line">  <span class="keywordtype">void</span> NavierStokesProjection&lt;dim&gt;::copy_gradient_local_to_global( </div><div class="line">    <span class="keyword">const</span> InitGradPerTaskData &amp;data) </div><div class="line">  { </div><div class="line">    <span class="keywordflow">for</span> (<span class="keywordtype">unsigned</span> <span class="keywordtype">int</span> i = 0; i &lt; data.vel_dpc; ++i) </div><div class="line">      <span class="keywordflow">for</span> (<span class="keywordtype">unsigned</span> <span class="keywordtype">int</span> j = 0; j &lt; data.pres_dpc; ++j) </div><div class="line">        pres_Diff[data.d].add(data.vel_local_dof_indices[i], </div><div class="line">                              data.pres_local_dof_indices[j], </div><div class="line">                              data.local_grad(i, j)); </div><div class="line">  } </div><div class="line"></div><div class="line"></div><div class="line"></div><div class="line">  <span class="keyword">template</span> &lt;<span class="keywordtype">int</span> dim&gt; </div><div class="line">  <span class="keywordtype">void</span> <a class="code" href="namespaceWorkStream_1_1internal_1_1tbb__no__coloring.html#a8673698a405bf47aa24002aeb6d76d70">NavierStokesProjection&lt;dim&gt;::run</a>(<span class="keyword">const</span> <span class="keywordtype">bool</span>         verbose, </div><div class="line">                                        <span class="keyword">const</span> <span class="keywordtype">unsigned</span> <span class="keywordtype">int</span> output_interval) </div><div class="line">  { </div><div class="line">    <a class="code" href="classConditionalOStream.html">ConditionalOStream</a> verbose_cout(std::cout, verbose); </div><div class="line"></div><div class="line">    <span class="keyword">const</span> <span class="keyword">auto</span> n_steps = <span class="keyword">static_cast&lt;</span><span class="keywordtype">unsigned</span> <span class="keywordtype">int</span><span class="keyword">&gt;</span>((T - t_0) / dt); </div><div class="line">    vel_exact.set_time(2. * dt); </div><div class="line">    output_results(1); </div><div class="line">    <span class="keywordflow">for</span> (<span class="keywordtype">unsigned</span> <span class="keywordtype">int</span> n = 2; n &lt;= n_steps; ++n) </div><div class="line">      { </div><div class="line">        <span class="keywordflow">if</span> (n % output_interval == 0) </div><div class="line">          { </div><div class="line">            verbose_cout &lt;&lt; <span class="stringliteral">&quot;Plotting Solution&quot;</span> &lt;&lt; std::endl; </div><div class="line">            output_results(n); </div><div class="line">          } </div><div class="line">        std::cout &lt;&lt; <span class="stringliteral">&quot;Step = &quot;</span> &lt;&lt; n &lt;&lt; <span class="stringliteral">&quot; Time = &quot;</span> &lt;&lt; (n * dt) &lt;&lt; std::endl; </div><div class="line">        verbose_cout &lt;&lt; <span class="stringliteral">&quot;  Interpolating the velocity &quot;</span> &lt;&lt; std::endl; </div><div class="line"></div><div class="line">        interpolate_velocity(); </div><div class="line">        verbose_cout &lt;&lt; <span class="stringliteral">&quot;  Diffusion Step&quot;</span> &lt;&lt; std::endl; </div><div class="line">        <span class="keywordflow">if</span> (n % vel_update_prec == 0) </div><div class="line">          verbose_cout &lt;&lt; <span class="stringliteral">&quot;    With reinitialization of the preconditioner&quot;</span> </div><div class="line">                       &lt;&lt; std::endl; </div><div class="line">        diffusion_step((n % vel_update_prec == 0) || (n == 2)); </div><div class="line">        verbose_cout &lt;&lt; <span class="stringliteral">&quot;  Projection Step&quot;</span> &lt;&lt; std::endl; </div><div class="line">        projection_step((n == 2)); </div><div class="line">        verbose_cout &lt;&lt; <span class="stringliteral">&quot;  Updating the Pressure&quot;</span> &lt;&lt; std::endl; </div><div class="line">        update_pressure((n == 2)); </div><div class="line">        vel_exact.advance_time(dt); </div><div class="line">      } </div><div class="line">    output_results(n_steps); </div><div class="line">  } </div><div class="line"></div><div class="line">  <span class="keyword">template</span> &lt;<span class="keywordtype">int</span> dim&gt; </div><div class="line">  <span class="keywordtype">void</span> NavierStokesProjection&lt;dim&gt;::interpolate_velocity() </div><div class="line">  { </div><div class="line">    <span class="keywordflow">for</span> (<span class="keywordtype">unsigned</span> <span class="keywordtype">int</span> d = 0; d &lt; dim; ++<a class="code" href="namespacePhysics_1_1Elasticity_1_1Kinematics.html#a15728437b942dab0b0042eb06a407d2c">d</a>) </div><div class="line">      { </div><div class="line">        u_star[<a class="code" href="namespacePhysics_1_1Elasticity_1_1Kinematics.html#a15728437b942dab0b0042eb06a407d2c">d</a>].equ(2., u_n[d]); </div><div class="line">        u_star[<a class="code" href="namespacePhysics_1_1Elasticity_1_1Kinematics.html#a15728437b942dab0b0042eb06a407d2c">d</a>] -= u_n_minus_1[<a class="code" href="namespacePhysics_1_1Elasticity_1_1Kinematics.html#a15728437b942dab0b0042eb06a407d2c">d</a>]; </div><div class="line">      } </div><div class="line">  } </div><div class="line"></div><div class="line"></div><div class="line">  <span class="keyword">template</span> &lt;<span class="keywordtype">int</span> dim&gt; </div><div class="line">  <span class="keywordtype">void</span> NavierStokesProjection&lt;dim&gt;::diffusion_step(<span class="keyword">const</span> <span class="keywordtype">bool</span> reinit_prec) </div><div class="line">  { </div><div class="line">    pres_tmp.equ(-1., pres_n); </div><div class="line">    pres_tmp.add(-4. / 3., phi_n, 1. / 3., phi_n_minus_1); </div><div class="line"></div><div class="line">    assemble_advection_term(); </div><div class="line"></div><div class="line">    <span class="keywordflow">for</span> (<span class="keywordtype">unsigned</span> <span class="keywordtype">int</span> d = 0; d &lt; dim; ++<a class="code" href="namespacePhysics_1_1Elasticity_1_1Kinematics.html#a15728437b942dab0b0042eb06a407d2c">d</a>) </div><div class="line">      { </div><div class="line">        force[<a class="code" href="namespacePhysics_1_1Elasticity_1_1Kinematics.html#a15728437b942dab0b0042eb06a407d2c">d</a>] = 0.; </div><div class="line">        v_tmp.equ(2. / dt, u_n[d]); </div><div class="line">        v_tmp.add(-.5 / dt, u_n_minus_1[d]); </div><div class="line">        vel_Mass.vmult_add(force[d], v_tmp); </div><div class="line"></div><div class="line">        pres_Diff[<a class="code" href="namespacePhysics_1_1Elasticity_1_1Kinematics.html#a15728437b942dab0b0042eb06a407d2c">d</a>].vmult_add(force[d], pres_tmp); </div><div class="line">        u_n_minus_1[<a class="code" href="namespacePhysics_1_1Elasticity_1_1Kinematics.html#a15728437b942dab0b0042eb06a407d2c">d</a>] = u_n[<a class="code" href="namespacePhysics_1_1Elasticity_1_1Kinematics.html#a15728437b942dab0b0042eb06a407d2c">d</a>]; </div><div class="line"></div><div class="line">        vel_it_matrix[<a class="code" href="namespacePhysics_1_1Elasticity_1_1Kinematics.html#a15728437b942dab0b0042eb06a407d2c">d</a>].copy_from(vel_Laplace_plus_Mass); </div><div class="line">        vel_it_matrix[<a class="code" href="namespacePhysics_1_1Elasticity_1_1Kinematics.html#a15728437b942dab0b0042eb06a407d2c">d</a>].add(1., vel_Advection); </div><div class="line"></div><div class="line">        vel_exact.set_component(d); </div><div class="line">        boundary_values.clear(); </div><div class="line">        <span class="keywordflow">for</span> (<span class="keyword">const</span> <span class="keyword">auto</span> &amp;boundary_id : boundary_ids) </div><div class="line">          { </div><div class="line">            <span class="keywordflow">switch</span> (boundary_id) </div><div class="line">              { </div><div class="line">                <span class="keywordflow">case</span> 1: </div><div class="line">                  <a class="code" href="namespaceVectorTools.html#af27ac28c698a9ed0199faed50a204538">VectorTools::interpolate_boundary_values</a>( </div><div class="line">                    dof_handler_velocity, </div><div class="line">                    boundary_id, </div><div class="line">                    <a class="code" href="classFunctions_1_1ZeroFunction.html">Functions::ZeroFunction&lt;dim&gt;</a>(), </div><div class="line">                    boundary_values); </div><div class="line">                  <span class="keywordflow">break</span>; </div><div class="line">                <span class="keywordflow">case</span> 2: </div><div class="line">                  <a class="code" href="namespaceVectorTools.html#af27ac28c698a9ed0199faed50a204538">VectorTools::interpolate_boundary_values</a>(dof_handler_velocity, </div><div class="line">                                                           boundary_id, </div><div class="line">                                                           vel_exact, </div><div class="line">                                                           boundary_values); </div><div class="line">                  <span class="keywordflow">break</span>; </div><div class="line">                <span class="keywordflow">case</span> 3: </div><div class="line">                  <span class="keywordflow">if</span> (d != 0) </div><div class="line">                    <a class="code" href="namespaceVectorTools.html#af27ac28c698a9ed0199faed50a204538">VectorTools::interpolate_boundary_values</a>( </div><div class="line">                      dof_handler_velocity, </div><div class="line">                      boundary_id, </div><div class="line">                      <a class="code" href="classFunctions_1_1ZeroFunction.html">Functions::ZeroFunction&lt;dim&gt;</a>(), </div><div class="line">                      boundary_values); </div><div class="line">                  <span class="keywordflow">break</span>; </div><div class="line">                <span class="keywordflow">case</span> 4: </div><div class="line">                  <a class="code" href="namespaceVectorTools.html#af27ac28c698a9ed0199faed50a204538">VectorTools::interpolate_boundary_values</a>( </div><div class="line">                    dof_handler_velocity, </div><div class="line">                    boundary_id, </div><div class="line">                    <a class="code" href="classFunctions_1_1ZeroFunction.html">Functions::ZeroFunction&lt;dim&gt;</a>(), </div><div class="line">                    boundary_values); </div><div class="line">                  <span class="keywordflow">break</span>; </div><div class="line">                <span class="keywordflow">default</span>: </div><div class="line">                  <a class="code" href="group__Exceptions.html#ga70a0bb353656e704acf927945277bbc6">Assert</a>(<span class="keyword">false</span>, <a class="code" href="group__Exceptions.html#ga7b52b286796c23ef9ff178faf7a4b68f">ExcNotImplemented</a>()); </div><div class="line">              } </div><div class="line">          } </div><div class="line">        <a class="code" href="namespaceMatrixTools.html#a9ad0eb7a8662628534586716748d62fb">MatrixTools::apply_boundary_values</a>(boundary_values, </div><div class="line">                                           vel_it_matrix[d], </div><div class="line">                                           u_n[d], </div><div class="line">                                           force[d]); </div><div class="line">      } </div><div class="line"></div><div class="line">    <a class="code" href="classThreads_1_1TaskGroup.html">Threads::TaskGroup&lt;void&gt;</a> tasks; </div><div class="line">    <span class="keywordflow">for</span> (<span class="keywordtype">unsigned</span> <span class="keywordtype">int</span> d = 0; d &lt; dim; ++<a class="code" href="namespacePhysics_1_1Elasticity_1_1Kinematics.html#a15728437b942dab0b0042eb06a407d2c">d</a>) </div><div class="line">      { </div><div class="line">        <span class="keywordflow">if</span> (reinit_prec) </div><div class="line">          prec_velocity[<a class="code" href="namespacePhysics_1_1Elasticity_1_1Kinematics.html#a15728437b942dab0b0042eb06a407d2c">d</a>].initialize(vel_it_matrix[d], </div><div class="line">                                      <a class="code" href="classSparseILU.html#ae21347f3202a1186060eac36dcb45817">SparseILU&lt;double&gt;::AdditionalData</a>( </div><div class="line">                                        vel_diag_strength, vel_off_diagonals)); </div><div class="line">        tasks += <a class="code" href="group__threads.html#ga8c1e15b84e1bb58a8029fc6d6ddf3cbf">Threads::new_task</a>( </div><div class="line">          &amp;NavierStokesProjection&lt;dim&gt;::diffusion_component_solve, *<span class="keyword">this</span>, d); </div><div class="line">      } </div><div class="line">    tasks.<a class="code" href="classThreads_1_1TaskGroup.html#a2917c607a567538f8e560c849fa88ac6">join_all</a>(); </div><div class="line">  } </div><div class="line"></div><div class="line">  <span class="keyword">template</span> &lt;<span class="keywordtype">int</span> dim&gt; </div><div class="line">  <span class="keywordtype">void</span> </div><div class="line">  NavierStokesProjection&lt;dim&gt;::diffusion_component_solve(<span class="keyword">const</span> <span class="keywordtype">unsigned</span> <span class="keywordtype">int</span> d) </div><div class="line">  { </div><div class="line">    <a class="code" href="classSolverControl.html">SolverControl</a> solver_control(vel_max_its, vel_eps * force[d].<a class="code" href="namespaceAdaptationStrategies_1_1Refinement.html#a629b528b2c9777d26eb9048d50d6c13a">l2_norm</a>()); </div><div class="line">    <a class="code" href="classSolverGMRES.html">SolverGMRES&lt;Vector&lt;double&gt;</a>&gt; gmres( </div><div class="line">      solver_control, </div><div class="line">      <a class="code" href="classSolverGMRES.html">SolverGMRES</a>&lt;Vector&lt;double&gt;&gt;::AdditionalData(vel_Krylov_size)); </div><div class="line">    gmres.solve(vel_it_matrix[d], u_n[d], force[d], prec_velocity[d]); </div><div class="line">  } </div><div class="line"></div><div class="line"></div><div class="line">  <span class="keyword">template</span> &lt;<span class="keywordtype">int</span> dim&gt; </div><div class="line">  <span class="keywordtype">void</span> NavierStokesProjection&lt;dim&gt;::assemble_advection_term() </div><div class="line">  { </div><div class="line">    vel_Advection = 0.; </div><div class="line">    AdvectionPerTaskData data(fe_velocity.n_dofs_per_cell()); </div><div class="line">    AdvectionScratchData scratch(fe_velocity, </div><div class="line">                                 quadrature_velocity, </div><div class="line">                                 <a class="code" href="group__feaccess.html#ggaa94b67d2fdcc390690c523f28019e52fa4057ca2f127aa619c65886a9d3ad4aea">update_values</a> | <a class="code" href="group__feaccess.html#ggaa94b67d2fdcc390690c523f28019e52fa714204722e9eeb43aadbd0d5ddc48c85">update_JxW_values</a> | </div><div class="line">                                   <a class="code" href="group__feaccess.html#ggaa94b67d2fdcc390690c523f28019e52facbcc430975fa6af05f75ca786dc6fe20">update_gradients</a>); </div><div class="line">    <a class="code" href="namespaceWorkStream.html#ab8ceb010811941c351803b671a19fb73">WorkStream::run</a>( </div><div class="line">      dof_handler_velocity.begin_active(), </div><div class="line">      dof_handler_velocity.end(), </div><div class="line">      *<span class="keyword">this</span>, </div><div class="line">      &amp;NavierStokesProjection&lt;dim&gt;::assemble_one_cell_of_advection, </div><div class="line">      &amp;NavierStokesProjection&lt;dim&gt;::copy_advection_local_to_global, </div><div class="line">      scratch, </div><div class="line">      data); </div><div class="line">  } </div><div class="line"></div><div class="line">  <span class="keyword">template</span> &lt;<span class="keywordtype">int</span> dim&gt; </div><div class="line">  <span class="keywordtype">void</span> NavierStokesProjection&lt;dim&gt;::assemble_one_cell_of_advection( </div><div class="line">    <span class="keyword">const</span> <span class="keyword">typename</span> <a class="code" href="classDoFHandler.html">DoFHandler&lt;dim&gt;::active_cell_iterator</a> &amp;cell, </div><div class="line">    AdvectionScratchData &amp;                                scratch, </div><div class="line">    AdvectionPerTaskData &amp;                                data) </div><div class="line">  { </div><div class="line">    scratch.fe_val.reinit(cell); </div><div class="line">    cell-&gt;get_dof_indices(data.local_dof_indices); </div><div class="line">    <span class="keywordflow">for</span> (<span class="keywordtype">unsigned</span> <span class="keywordtype">int</span> d = 0; d &lt; dim; ++<a class="code" href="namespacePhysics_1_1Elasticity_1_1Kinematics.html#a15728437b942dab0b0042eb06a407d2c">d</a>) </div><div class="line">      { </div><div class="line">        scratch.fe_val.get_function_values(u_star[d], scratch.u_star_tmp); </div><div class="line">        <span class="keywordflow">for</span> (<span class="keywordtype">unsigned</span> <span class="keywordtype">int</span> q = 0; q &lt; scratch.nqp; ++q) </div><div class="line">          scratch.u_star_local[q](d) = scratch.u_star_tmp[q]; </div><div class="line">      } </div><div class="line"></div><div class="line">    <span class="keywordflow">for</span> (<span class="keywordtype">unsigned</span> <span class="keywordtype">int</span> d = 0; d &lt; dim; ++<a class="code" href="namespacePhysics_1_1Elasticity_1_1Kinematics.html#a15728437b942dab0b0042eb06a407d2c">d</a>) </div><div class="line">      { </div><div class="line">        scratch.fe_val.get_function_gradients(u_star[d], scratch.grad_u_star); </div><div class="line">        <span class="keywordflow">for</span> (<span class="keywordtype">unsigned</span> <span class="keywordtype">int</span> q = 0; q &lt; scratch.nqp; ++q) </div><div class="line">          { </div><div class="line">            <span class="keywordflow">if</span> (d == 0) </div><div class="line">              scratch.u_star_tmp[q] = 0.; </div><div class="line">            scratch.u_star_tmp[q] += scratch.grad_u_star[q][<a class="code" href="namespacePhysics_1_1Elasticity_1_1Kinematics.html#a15728437b942dab0b0042eb06a407d2c">d</a>]; </div><div class="line">          } </div><div class="line">      } </div><div class="line"></div><div class="line">    data.local_advection = 0.; </div><div class="line">    <span class="keywordflow">for</span> (<span class="keywordtype">unsigned</span> <span class="keywordtype">int</span> q = 0; q &lt; scratch.nqp; ++q) </div><div class="line">      <span class="keywordflow">for</span> (<span class="keywordtype">unsigned</span> <span class="keywordtype">int</span> i = 0; i &lt; scratch.dpc; ++i) </div><div class="line">        <span class="keywordflow">for</span> (<span class="keywordtype">unsigned</span> <span class="keywordtype">int</span> j = 0; j &lt; scratch.dpc; ++j) </div><div class="line">          data.local_advection(i, j) += (scratch.u_star_local[q] *            <span class="comment">// </span></div><div class="line">                                           scratch.fe_val.shape_grad(j, q) *  <span class="comment">// </span></div><div class="line">                                           scratch.fe_val.shape_value(i, q)   <span class="comment">// </span></div><div class="line">                                         +                                    <span class="comment">// </span></div><div class="line">                                         0.5 *                                <span class="comment">// </span></div><div class="line">                                           scratch.u_star_tmp[q] *            <span class="comment">// </span></div><div class="line">                                           scratch.fe_val.shape_value(i, q) * <span class="comment">// </span></div><div class="line">                                           scratch.fe_val.shape_value(j, q))  <span class="comment">// </span></div><div class="line">                                        * scratch.fe_val.JxW(q); </div><div class="line">  } </div><div class="line"></div><div class="line">  <span class="keyword">template</span> &lt;<span class="keywordtype">int</span> dim&gt; </div><div class="line">  <span class="keywordtype">void</span> NavierStokesProjection&lt;dim&gt;::copy_advection_local_to_global( </div><div class="line">    <span class="keyword">const</span> AdvectionPerTaskData &amp;data) </div><div class="line">  { </div><div class="line">    <span class="keywordflow">for</span> (<span class="keywordtype">unsigned</span> <span class="keywordtype">int</span> i = 0; i &lt; fe_velocity.n_dofs_per_cell(); ++i) </div><div class="line">      <span class="keywordflow">for</span> (<span class="keywordtype">unsigned</span> <span class="keywordtype">int</span> j = 0; j &lt; fe_velocity.n_dofs_per_cell(); ++j) </div><div class="line">        vel_Advection.add(data.local_dof_indices[i], </div><div class="line">                          data.local_dof_indices[j], </div><div class="line">                          data.local_advection(i, j)); </div><div class="line">  } </div><div class="line"></div><div class="line"></div><div class="line"></div><div class="line">  <span class="keyword">template</span> &lt;<span class="keywordtype">int</span> dim&gt; </div><div class="line">  <span class="keywordtype">void</span> NavierStokesProjection&lt;dim&gt;::projection_step(<span class="keyword">const</span> <span class="keywordtype">bool</span> reinit_prec) </div><div class="line">  { </div><div class="line">    pres_iterative.copy_from(pres_Laplace); </div><div class="line"></div><div class="line">    pres_tmp = 0.; </div><div class="line">    <span class="keywordflow">for</span> (<span class="keywordtype">unsigned</span> d = 0; d &lt; dim; ++<a class="code" href="namespacePhysics_1_1Elasticity_1_1Kinematics.html#a15728437b942dab0b0042eb06a407d2c">d</a>) </div><div class="line">      pres_Diff[d].Tvmult_add(pres_tmp, u_n[d]); </div><div class="line"></div><div class="line">    phi_n_minus_1 = phi_n; </div><div class="line"></div><div class="line">    <span class="keyword">static</span> std::map&lt;types::global_dof_index, double&gt; bval; </div><div class="line">    <span class="keywordflow">if</span> (reinit_prec) </div><div class="line">      <a class="code" href="namespaceVectorTools.html#af27ac28c698a9ed0199faed50a204538">VectorTools::interpolate_boundary_values</a>(dof_handler_pressure, </div><div class="line">                                               3, </div><div class="line">                                               <a class="code" href="classFunctions_1_1ZeroFunction.html">Functions::ZeroFunction&lt;dim&gt;</a>(), </div><div class="line">                                               bval); </div><div class="line"></div><div class="line">    <a class="code" href="namespaceMatrixTools.html#a9ad0eb7a8662628534586716748d62fb">MatrixTools::apply_boundary_values</a>(bval, pres_iterative, phi_n, pres_tmp); </div><div class="line"></div><div class="line">    <span class="keywordflow">if</span> (reinit_prec) </div><div class="line">      prec_pres_Laplace.initialize(pres_iterative, </div><div class="line">                                   <a class="code" href="classSparseILU.html#ae21347f3202a1186060eac36dcb45817">SparseILU&lt;double&gt;::AdditionalData</a>( </div><div class="line">                                     vel_diag_strength, vel_off_diagonals)); </div><div class="line"></div><div class="line">    <a class="code" href="classSolverControl.html">SolverControl</a> solvercontrol(vel_max_its, vel_eps * pres_tmp.l2_norm()); </div><div class="line">    <a class="code" href="classSolverCG.html">SolverCG&lt;Vector&lt;double&gt;</a>&gt; cg(solvercontrol); </div><div class="line">    cg.solve(pres_iterative, phi_n, pres_tmp, prec_pres_Laplace); </div><div class="line"></div><div class="line">    phi_n *= 1.5 / dt; </div><div class="line">  } </div><div class="line"></div><div class="line"></div><div class="line">  <span class="keyword">template</span> &lt;<span class="keywordtype">int</span> dim&gt; </div><div class="line">  <span class="keywordtype">void</span> NavierStokesProjection&lt;dim&gt;::update_pressure(<span class="keyword">const</span> <span class="keywordtype">bool</span> reinit_prec) </div><div class="line">  { </div><div class="line">    pres_n_minus_1 = pres_n; </div><div class="line">    <span class="keywordflow">switch</span> (type) </div><div class="line">      { </div><div class="line">        <span class="keywordflow">case</span> RunTimeParameters::Method::standard: </div><div class="line">          pres_n += phi_n; </div><div class="line">          <span class="keywordflow">break</span>; </div><div class="line">        <span class="keywordflow">case</span> RunTimeParameters::Method::rotational: </div><div class="line">          <span class="keywordflow">if</span> (reinit_prec) </div><div class="line">            prec_mass.initialize(pres_Mass); </div><div class="line">          pres_n = pres_tmp; </div><div class="line">          prec_mass.solve(pres_n); </div><div class="line">          pres_n.sadd(1. / Re, 1., pres_n_minus_1); </div><div class="line">          pres_n += phi_n; </div><div class="line">          <span class="keywordflow">break</span>; </div><div class="line">        <span class="keywordflow">default</span>: </div><div class="line">          <a class="code" href="group__Exceptions.html#ga70a0bb353656e704acf927945277bbc6">Assert</a>(<span class="keyword">false</span>, <a class="code" href="group__Exceptions.html#ga7b52b286796c23ef9ff178faf7a4b68f">ExcNotImplemented</a>()); </div><div class="line">      }; </div><div class="line">  } </div><div class="line"></div><div class="line"></div><div class="line"></div><div class="line"></div><div class="line">  <span class="keyword">template</span> &lt;<span class="keywordtype">int</span> dim&gt; </div><div class="line">  <span class="keywordtype">void</span> NavierStokesProjection&lt;dim&gt;::output_results(<span class="keyword">const</span> <span class="keywordtype">unsigned</span> <span class="keywordtype">int</span> step) </div><div class="line">  { </div><div class="line">    assemble_vorticity((step == 1)); </div><div class="line">    <span class="keyword">const</span> <a class="code" href="classFESystem.html">FESystem&lt;dim&gt;</a> joint_fe( </div><div class="line">      fe_velocity, dim, fe_pressure, 1, fe_velocity, 1); </div><div class="line">    <a class="code" href="classDoFHandler.html">DoFHandler&lt;dim&gt;</a> joint_dof_handler(triangulation); </div><div class="line">    joint_dof_handler.distribute_dofs(joint_fe); </div><div class="line">    <a class="code" href="group__Exceptions.html#ga70a0bb353656e704acf927945277bbc6">Assert</a>(joint_dof_handler.n_dofs() == </div><div class="line">             ((dim + 1) * dof_handler_velocity.n_dofs() + </div><div class="line">              dof_handler_pressure.n_dofs()), </div><div class="line">           <a class="code" href="group__Exceptions.html#ga31978c026b8b6b5116df30b8e748f6b7">ExcInternalError</a>()); </div><div class="line">    Vector&lt;double&gt; joint_solution(joint_dof_handler.n_dofs()); </div><div class="line">    std::vector&lt;types::global_dof_index&gt; loc_joint_dof_indices( </div><div class="line">      joint_fe.n_dofs_per_cell()), </div><div class="line">      loc_vel_dof_indices(fe_velocity.n_dofs_per_cell()), </div><div class="line">      loc_pres_dof_indices(fe_pressure.n_dofs_per_cell()); </div><div class="line">    <span class="keyword">typename</span> <a class="code" href="classDoFHandler.html">DoFHandler&lt;dim&gt;::active_cell_iterator</a> </div><div class="line">      joint_cell = joint_dof_handler.<a class="code" href="classDoFHandler.html#a1a36dbbb4c54a7038c60ee9c8eab369a">begin_active</a>(), </div><div class="line">      joint_endc = joint_dof_handler.end(), </div><div class="line">      vel_cell   = dof_handler_velocity.begin_active(), </div><div class="line">      pres_cell  = dof_handler_pressure.begin_active(); </div><div class="line">    <span class="keywordflow">for</span> (; joint_cell != joint_endc; ++joint_cell, ++vel_cell, ++pres_cell) </div><div class="line">      { </div><div class="line">        joint_cell-&gt;get_dof_indices(loc_joint_dof_indices); </div><div class="line">        vel_cell-&gt;get_dof_indices(loc_vel_dof_indices); </div><div class="line">        pres_cell-&gt;get_dof_indices(loc_pres_dof_indices); </div><div class="line">        <span class="keywordflow">for</span> (<span class="keywordtype">unsigned</span> <span class="keywordtype">int</span> i = 0; i &lt; joint_fe.n_dofs_per_cell(); ++i) </div><div class="line">          <span class="keywordflow">switch</span> (joint_fe.system_to_base_index(i).first.first) </div><div class="line">            { </div><div class="line">              <span class="keywordflow">case</span> 0: </div><div class="line">                <a class="code" href="group__Exceptions.html#ga70a0bb353656e704acf927945277bbc6">Assert</a>(joint_fe.system_to_base_index(i).first.second &lt; dim, </div><div class="line">                       <a class="code" href="group__Exceptions.html#ga31978c026b8b6b5116df30b8e748f6b7">ExcInternalError</a>()); </div><div class="line">                joint_solution(loc_joint_dof_indices[i]) = </div><div class="line">                  u_n[joint_fe.system_to_base_index(i).first.second]( </div><div class="line">                    loc_vel_dof_indices[joint_fe.system_to_base_index(i) </div><div class="line">                                          .second]); </div><div class="line">                <span class="keywordflow">break</span>; </div><div class="line">              <span class="keywordflow">case</span> 1: </div><div class="line">                <a class="code" href="group__Exceptions.html#ga70a0bb353656e704acf927945277bbc6">Assert</a>(joint_fe.system_to_base_index(i).first.second == 0, </div><div class="line">                       <a class="code" href="group__Exceptions.html#ga31978c026b8b6b5116df30b8e748f6b7">ExcInternalError</a>()); </div><div class="line">                joint_solution(loc_joint_dof_indices[i]) = </div><div class="line">                  pres_n(loc_pres_dof_indices[joint_fe.system_to_base_index(i) </div><div class="line">                                                .second]); </div><div class="line">                <span class="keywordflow">break</span>; </div><div class="line">              <span class="keywordflow">case</span> 2: </div><div class="line">                <a class="code" href="group__Exceptions.html#ga70a0bb353656e704acf927945277bbc6">Assert</a>(joint_fe.system_to_base_index(i).first.second == 0, </div><div class="line">                       <a class="code" href="group__Exceptions.html#ga31978c026b8b6b5116df30b8e748f6b7">ExcInternalError</a>()); </div><div class="line">                joint_solution(loc_joint_dof_indices[i]) = rot_u( </div><div class="line">                  loc_vel_dof_indices[joint_fe.system_to_base_index(i).second]); </div><div class="line">                <span class="keywordflow">break</span>; </div><div class="line">              <span class="keywordflow">default</span>: </div><div class="line">                <a class="code" href="group__Exceptions.html#ga70a0bb353656e704acf927945277bbc6">Assert</a>(<span class="keyword">false</span>, <a class="code" href="group__Exceptions.html#ga31978c026b8b6b5116df30b8e748f6b7">ExcInternalError</a>()); </div><div class="line">            } </div><div class="line">      } </div><div class="line">    std::vector&lt;std::string&gt; joint_solution_names(dim, <span class="stringliteral">&quot;v&quot;</span>); </div><div class="line">    joint_solution_names.emplace_back(<span class="stringliteral">&quot;p&quot;</span>); </div><div class="line">    joint_solution_names.emplace_back(<span class="stringliteral">&quot;rot_u&quot;</span>); </div><div class="line">    <a class="code" href="classDataOut.html">DataOut&lt;dim&gt;</a> data_out; </div><div class="line">    data_out.<a class="code" href="classDataOut__DoFData.html#a6ed7c846331069f406b8c9933c37fda4">attach_dof_handler</a>(joint_dof_handler); </div><div class="line">    std::vector&lt;DataComponentInterpretation::DataComponentInterpretation&gt; </div><div class="line">      component_interpretation( </div><div class="line">        dim + 2, <a class="code" href="namespaceDataComponentInterpretation.html#a0cd2da3afe902f9004c23a73dbcc8ab0aa783915dbc182d5a49e111815fd23fe0">DataComponentInterpretation::component_is_part_of_vector</a>); </div><div class="line">    component_interpretation[dim] = </div><div class="line">      <a class="code" href="namespaceDataComponentInterpretation.html#a0cd2da3afe902f9004c23a73dbcc8ab0a1f3cd50135818a6458f1d3ff7ea4bb51">DataComponentInterpretation::component_is_scalar</a>; </div><div class="line">    component_interpretation[dim + 1] = </div><div class="line">      <a class="code" href="namespaceDataComponentInterpretation.html#a0cd2da3afe902f9004c23a73dbcc8ab0a1f3cd50135818a6458f1d3ff7ea4bb51">DataComponentInterpretation::component_is_scalar</a>; </div><div class="line">    data_out.<a class="code" href="classDataOut__DoFData.html#a79cbe2f02f8dfb85026c71d783dbb703">add_data_vector</a>(joint_solution, </div><div class="line">                             joint_solution_names, </div><div class="line">                             <a class="code" href="classDataOut.html">DataOut&lt;dim&gt;::type_dof_data</a>, </div><div class="line">                             component_interpretation); </div><div class="line">    data_out.<a class="code" href="classDataOut.html#a087f63e22f0614bca326dbdca288c646">build_patches</a>(deg + 1); </div><div class="line">    std::ofstream output(<span class="stringliteral">&quot;solution-&quot;</span> + <a class="code" href="namespaceUtilities.html#a6195c5f009ea8c7c536c6ffdf108c32f">Utilities::int_to_string</a>(step, 5) + </div><div class="line">                         <span class="stringliteral">&quot;.vtk&quot;</span>); </div><div class="line">    data_out.<a class="code" href="classDataOutInterface.html#acad99726038e4fca7f605fdffb3317e4">write_vtk</a>(output); </div><div class="line">  } </div><div class="line"></div><div class="line"></div><div class="line">  <span class="keyword">template</span> &lt;<span class="keywordtype">int</span> dim&gt; </div><div class="line">  <span class="keywordtype">void</span> NavierStokesProjection&lt;dim&gt;::assemble_vorticity(<span class="keyword">const</span> <span class="keywordtype">bool</span> reinit_prec) </div><div class="line">  { </div><div class="line">    <a class="code" href="group__Exceptions.html#ga70a0bb353656e704acf927945277bbc6">Assert</a>(dim == 2, <a class="code" href="group__Exceptions.html#ga7b52b286796c23ef9ff178faf7a4b68f">ExcNotImplemented</a>()); </div><div class="line">    <span class="keywordflow">if</span> (reinit_prec) </div><div class="line">      prec_vel_mass.initialize(vel_Mass); </div><div class="line"></div><div class="line">    <a class="code" href="classFEValues.html">FEValues&lt;dim&gt;</a>      fe_val_vel(fe_velocity, </div><div class="line">                             quadrature_velocity, </div><div class="line">                             <a class="code" href="group__feaccess.html#ggaa94b67d2fdcc390690c523f28019e52facbcc430975fa6af05f75ca786dc6fe20">update_gradients</a> | <a class="code" href="group__feaccess.html#ggaa94b67d2fdcc390690c523f28019e52fa714204722e9eeb43aadbd0d5ddc48c85">update_JxW_values</a> | </div><div class="line">                               <a class="code" href="group__feaccess.html#ggaa94b67d2fdcc390690c523f28019e52fa4057ca2f127aa619c65886a9d3ad4aea">update_values</a>); </div><div class="line">    <span class="keyword">const</span> <span class="keywordtype">unsigned</span> <span class="keywordtype">int</span> dpc = fe_velocity.n_dofs_per_cell(), </div><div class="line">                       nqp = quadrature_velocity.size(); </div><div class="line">    std::vector&lt;types::global_dof_index&gt; ldi(dpc); </div><div class="line">    Vector&lt;double&gt;                       loc_rot(dpc); </div><div class="line"></div><div class="line">    std::vector&lt;Tensor&lt;1, dim&gt;&gt; grad_u1(nqp), grad_u2(nqp); </div><div class="line">    rot_u = 0.; </div><div class="line"></div><div class="line">    <span class="keywordflow">for</span> (<span class="keyword">const</span> <span class="keyword">auto</span> &amp;cell : dof_handler_velocity.<a class="code" href="group__CPP11.html#gacdb6d3adec96a13a7079f6c893e1d3ff">active_cell_iterators</a>()) </div><div class="line">      { </div><div class="line">        fe_val_vel.reinit(cell); </div><div class="line">        cell-&gt;get_dof_indices(ldi); </div><div class="line">        fe_val_vel.get_function_gradients(u_n[0], grad_u1); </div><div class="line">        fe_val_vel.get_function_gradients(u_n[1], grad_u2); </div><div class="line">        loc_rot = 0.; </div><div class="line">        <span class="keywordflow">for</span> (<span class="keywordtype">unsigned</span> <span class="keywordtype">int</span> q = 0; q &lt; nqp; ++q) </div><div class="line">          <span class="keywordflow">for</span> (<span class="keywordtype">unsigned</span> <span class="keywordtype">int</span> i = 0; i &lt; dpc; ++i) </div><div class="line">            loc_rot(i) += (grad_u2[q][0] - grad_u1[q][1]) * <span class="comment">// </span></div><div class="line">                          fe_val_vel.shape_value(i, q) *    <span class="comment">// </span></div><div class="line">                          fe_val_vel.JxW(q); </div><div class="line"></div><div class="line">        <span class="keywordflow">for</span> (<span class="keywordtype">unsigned</span> <span class="keywordtype">int</span> i = 0; i &lt; dpc; ++i) </div><div class="line">          rot_u(ldi[i]) += loc_rot(i); </div><div class="line">      } </div><div class="line"></div><div class="line">    prec_vel_mass.solve(rot_u); </div><div class="line">  } </div><div class="line">} <span class="comment">// namespace Step35 </span></div><div class="line"></div><div class="line"></div><div class="line"><span class="keywordtype">int</span> main() </div><div class="line">{ </div><div class="line">  <span class="keywordflow">try</span> </div><div class="line">    { </div><div class="line">      <span class="keyword">using namespace </span>Step35; </div><div class="line"></div><div class="line">      RunTimeParameters::Data_Storage data; </div><div class="line">      data.read_data(<span class="stringliteral">&quot;parameter-file.prm&quot;</span>); </div><div class="line"></div><div class="line">      <a class="code" href="logstream_8h.html#ac643e79bd992f1a9bd0dca5b9f2859fb">deallog</a>.<a class="code" href="classLogStream.html#a8028e970ad8388596d625ed463894e98">depth_console</a>(data.verbose ? 2 : 0); </div><div class="line"></div><div class="line">      NavierStokesProjection&lt;2&gt; test(data); </div><div class="line">      test.run(data.verbose, data.output_interval); </div><div class="line">    } </div><div class="line">  <span class="keywordflow">catch</span> (std::exception &amp;exc) </div><div class="line">    { </div><div class="line">      std::cerr &lt;&lt; std::endl </div><div class="line">                &lt;&lt; std::endl </div><div class="line">                &lt;&lt; <span class="stringliteral">&quot;----------------------------------------------------&quot;</span> </div><div class="line">                &lt;&lt; std::endl; </div><div class="line">      std::cerr &lt;&lt; <span class="stringliteral">&quot;Exception on processing: &quot;</span> &lt;&lt; std::endl </div><div class="line">                &lt;&lt; exc.what() &lt;&lt; std::endl </div><div class="line">                &lt;&lt; <span class="stringliteral">&quot;Aborting!&quot;</span> &lt;&lt; std::endl </div><div class="line">                &lt;&lt; <span class="stringliteral">&quot;----------------------------------------------------&quot;</span> </div><div class="line">                &lt;&lt; std::endl; </div><div class="line">      <span class="keywordflow">return</span> 1; </div><div class="line">    } </div><div class="line">  <span class="keywordflow">catch</span> (...) </div><div class="line">    { </div><div class="line">      std::cerr &lt;&lt; std::endl </div><div class="line">                &lt;&lt; std::endl </div><div class="line">                &lt;&lt; <span class="stringliteral">&quot;----------------------------------------------------&quot;</span> </div><div class="line">                &lt;&lt; std::endl; </div><div class="line">      std::cerr &lt;&lt; <span class="stringliteral">&quot;Unknown exception!&quot;</span> &lt;&lt; std::endl </div><div class="line">                &lt;&lt; <span class="stringliteral">&quot;Aborting!&quot;</span> &lt;&lt; std::endl </div><div class="line">                &lt;&lt; <span class="stringliteral">&quot;----------------------------------------------------&quot;</span> </div><div class="line">                &lt;&lt; std::endl; </div><div class="line">      <span class="keywordflow">return</span> 1; </div><div class="line">    } </div><div class="line">  std::cout &lt;&lt; <span class="stringliteral">&quot;----------------------------------------------------&quot;</span> </div><div class="line">            &lt;&lt; std::endl </div><div class="line">            &lt;&lt; <span class="stringliteral">&quot;Apparently everything went fine!&quot;</span> &lt;&lt; std::endl </div><div class="line">            &lt;&lt; <span class="stringliteral">&quot;Don&#39;t forget to brush your teeth :-)&quot;</span> &lt;&lt; std::endl </div><div class="line">            &lt;&lt; std::endl; </div><div class="line">  <span class="keywordflow">return</span> 0; </div><div class="line">} </div><div class="line"></div></div><!-- fragment --> </li>
</ul>
</li>
</ul>
</div></div><!-- contents -->
<!-- HTML footer for doxygen 1.8.13-->
<!-- start footer part -->
<hr class="footer"/><address class="footer"><small>
Generated by &#160;<a href="http://www.doxygen.org/index.html">
<img class="footer" src="doxygen.png" alt="doxygen"/>
</a> 1.8.13
</small></address>
</body>
</html>
